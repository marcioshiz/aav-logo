(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.p5=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){},{}],2:[function(_dereq_,module,exports){"use strict";exports.argument=function(predicate,message){if(!predicate){throw new Error(message)}};exports.assert=exports.argument},{}],3:[function(_dereq_,module,exports){"use strict";function line(ctx,x1,y1,x2,y2){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}exports.line=line},{}],4:[function(_dereq_,module,exports){"use strict";var cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];var cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"];var cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"];var standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(font){this.font=font}DefaultEncoding.prototype.charToGlyphIndex=function(c){var code=c.charCodeAt(0);var glyphs=this.font.glyphs;if(glyphs){for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j<glyph.unicodes.length;j+=1){if(glyph.unicodes[j]===code){return i}}}}else{return null}};function CmapEncoding(cmap){this.cmap=cmap}CmapEncoding.prototype.charToGlyphIndex=function(c){return this.cmap.glyphIndexMap[c.charCodeAt(0)]||0};function CffEncoding(encoding,charset){this.encoding=encoding;this.charset=charset}CffEncoding.prototype.charToGlyphIndex=function(s){var code=s.charCodeAt(0);var charName=this.encoding[code];return this.charset.indexOf(charName)};function GlyphNames(post){var i;switch(post.version){case 1:this.names=exports.standardNames.slice();break;case 2:this.names=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]<exports.standardNames.length){this.names[i]=exports.standardNames[post.glyphNameIndex[i]]}else{this.names[i]=post.names[post.glyphNameIndex[i]-exports.standardNames.length]}}break;case 2.5:this.names=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){this.names[i]=exports.standardNames[i+post.glyphNameIndex[i]]}break;case 3:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(name){return this.names.indexOf(name)};GlyphNames.prototype.glyphIndexToName=function(gid){return this.names[gid]};function addGlyphNames(font){var glyph;var glyphIndexMap=font.tables.cmap.glyphIndexMap;var charCodes=Object.keys(glyphIndexMap);for(var i=0;i<charCodes.length;i+=1){var c=charCodes[i];var glyphIndex=glyphIndexMap[c];glyph=font.glyphs.get(glyphIndex);glyph.addUnicode(parseInt(c))}for(i=0;i<font.glyphs.length;i+=1){glyph=font.glyphs.get(i);if(font.cffEncoding){glyph.name=font.cffEncoding.charset[i]}else{glyph.name=font.glyphNames.glyphIndexToName(i)}}}exports.cffStandardStrings=cffStandardStrings;exports.cffStandardEncoding=cffStandardEncoding;exports.cffExpertEncoding=cffExpertEncoding;exports.standardNames=standardNames;exports.DefaultEncoding=DefaultEncoding;exports.CmapEncoding=CmapEncoding;exports.CffEncoding=CffEncoding;exports.GlyphNames=GlyphNames;exports.addGlyphNames=addGlyphNames},{}],5:[function(_dereq_,module,exports){"use strict";var path=_dereq_("./path");var sfnt=_dereq_("./tables/sfnt");var encoding=_dereq_("./encoding");var glyphset=_dereq_("./glyphset");function Font(options){options=options||{};this.familyName=options.familyName||" ";this.styleName=options.styleName||" ";this.designer=options.designer||" ";this.designerURL=options.designerURL||" ";this.manufacturer=options.manufacturer||" ";this.manufacturerURL=options.manufacturerURL||" ";this.license=options.license||" ";this.licenseURL=options.licenseURL||" ";this.version=options.version||"Version 0.1";this.description=options.description||" ";this.copyright=options.copyright||" ";this.trademark=options.trademark||" ";this.unitsPerEm=options.unitsPerEm||1e3;this.ascender=options.ascender;this.descender=options.descender;this.supported=true;this.glyphs=new glyphset.GlyphSet(this,options.glyphs||[]);this.encoding=new encoding.DefaultEncoding(this);this.tables={}}Font.prototype.hasChar=function(c){return this.encoding.charToGlyphIndex(c)!==null};Font.prototype.charToGlyphIndex=function(s){return this.encoding.charToGlyphIndex(s)};Font.prototype.charToGlyph=function(c){var glyphIndex=this.charToGlyphIndex(c);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.stringToGlyphs=function(s){var glyphs=[];for(var i=0;i<s.length;i+=1){var c=s[i];glyphs.push(this.charToGlyph(c))}return glyphs};Font.prototype.nameToGlyphIndex=function(name){return this.glyphNames.nameToGlyphIndex(name)};Font.prototype.nameToGlyph=function(name){var glyphIndex=this.nametoGlyphIndex(name);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.glyphIndexToName=function(gid){if(!this.glyphNames.glyphIndexToName){return""}return this.glyphNames.glyphIndexToName(gid)};Font.prototype.getKerningValue=function(leftGlyph,rightGlyph){leftGlyph=leftGlyph.index||leftGlyph;rightGlyph=rightGlyph.index||rightGlyph;var gposKerning=this.getGposKerningValue;return gposKerning?gposKerning(leftGlyph,rightGlyph):this.kerningPairs[leftGlyph+","+rightGlyph]||0};Font.prototype.forEachGlyph=function(text,x,y,fontSize,options,callback){if(!this.supported){return}x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;options=options||{};var kerning=options.kerning===undefined?true:options.kerning;var fontScale=1/this.unitsPerEm*fontSize;var glyphs=this.stringToGlyphs(text);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs[i];callback(glyph,x,y,fontSize,options);if(glyph.advanceWidth){x+=glyph.advanceWidth*fontScale}if(kerning&&i<glyphs.length-1){var kerningValue=this.getKerningValue(glyph,glyphs[i+1]);x+=kerningValue*fontScale}}};Font.prototype.getPath=function(text,x,y,fontSize,options){var fullPath=new path.Path;this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){var glyphPath=glyph.getPath(gX,gY,gFontSize);fullPath.extend(glyphPath)});return fullPath};Font.prototype.draw=function(ctx,text,x,y,fontSize,options){this.getPath(text,x,y,fontSize,options).draw(ctx)};Font.prototype.drawPoints=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawPoints(ctx,gX,gY,gFontSize)})};Font.prototype.drawMetrics=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawMetrics(ctx,gX,gY,gFontSize)})};Font.prototype.validate=function(){var warnings=[];var _this=this;function assert(predicate,message){if(!predicate){warnings.push(message)}}function assertStringAttribute(attrName){assert(_this[attrName]&&_this[attrName].trim().length>0,"No "+attrName+" specified.")}assertStringAttribute("familyName");assertStringAttribute("weightName");assertStringAttribute("manufacturer");assertStringAttribute("copyright");assertStringAttribute("version");assert(this.unitsPerEm>0,"No unitsPerEm specified.")};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){var sfntTable=this.toTables();var bytes=sfntTable.encode();var buffer=new ArrayBuffer(bytes.length);var intArray=new Uint8Array(buffer);for(var i=0;i<bytes.length;i++){intArray[i]=bytes[i]}return buffer};Font.prototype.download=function(){var fileName=this.familyName.replace(/\s/g,"")+"-"+this.styleName+".otf";var buffer=this.toBuffer();window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;window.requestFileSystem(window.TEMPORARY,buffer.byteLength,function(fs){fs.root.getFile(fileName,{create:true},function(fileEntry){fileEntry.createWriter(function(writer){var dataView=new DataView(buffer);var blob=new Blob([dataView],{type:"font/opentype"});writer.write(blob);writer.addEventListener("writeend",function(){location.href=fileEntry.toURL()},false)})})},function(err){throw err})};exports.Font=Font},{"./encoding":4,"./glyphset":7,"./path":10,"./tables/sfnt":25}],6:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var draw=_dereq_("./draw");var path=_dereq_("./path");function getPathDefinition(glyph,path){var _path=path||{commands:[]};return{configurable:true,get:function(){if(typeof _path==="function"){_path=_path()}return _path},set:function(p){_path=p}}}function Glyph(options){this.bindConstructorValues(options)}Glyph.prototype.bindConstructorValues=function(options){this.index=options.index||0;this.name=options.name||null;this.unicode=options.unicode||undefined;this.unicodes=options.unicodes||options.unicode!==undefined?[options.unicode]:[];if(options.xMin){this.xMin=options.xMin}if(options.yMin){this.yMin=options.yMin}if(options.xMax){this.xMax=options.xMax}if(options.yMax){this.yMax=options.yMax}if(options.advanceWidth){this.advanceWidth=options.advanceWidth}Object.defineProperty(this,"path",getPathDefinition(this,options.path))};Glyph.prototype.addUnicode=function(unicode){if(this.unicodes.length===0){this.unicode=unicode}this.unicodes.push(unicode)};Glyph.prototype.getPath=function(x,y,fontSize){x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;var scale=1/this.path.unitsPerEm*fontSize;var p=new path.Path;var commands=this.path.commands;for(var i=0;i<commands.length;i+=1){var cmd=commands[i];if(cmd.type==="M"){p.moveTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="L"){p.lineTo(x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Q"){p.quadraticCurveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="C"){p.curveTo(x+cmd.x1*scale,y+-cmd.y1*scale,x+cmd.x2*scale,y+-cmd.y2*scale,x+cmd.x*scale,y+-cmd.y*scale)}else if(cmd.type==="Z"){p.closePath()}}return p};Glyph.prototype.getContours=function(){if(this.points===undefined){return[]}var contours=[];var currentContour=[];for(var i=0;i<this.points.length;i+=1){var pt=this.points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours};Glyph.prototype.getMetrics=function(){var commands=this.path.commands;var xCoords=[];var yCoords=[];for(var i=0;i<commands.length;i+=1){var cmd=commands[i];if(cmd.type!=="Z"){xCoords.push(cmd.x);yCoords.push(cmd.y)}if(cmd.type==="Q"||cmd.type==="C"){xCoords.push(cmd.x1);yCoords.push(cmd.y1)}if(cmd.type==="C"){xCoords.push(cmd.x2);yCoords.push(cmd.y2)}}var metrics={xMin:Math.min.apply(null,xCoords),yMin:Math.min.apply(null,yCoords),xMax:Math.max.apply(null,xCoords),yMax:Math.max.apply(null,yCoords),leftSideBearing:0};metrics.rightSideBearing=this.advanceWidth-metrics.leftSideBearing-(metrics.xMax-metrics.xMin);return metrics};Glyph.prototype.draw=function(ctx,x,y,fontSize){this.getPath(x,y,fontSize).draw(ctx)};Glyph.prototype.drawPoints=function(ctx,x,y,fontSize){function drawCircles(l,x,y,scale){var PI_SQ=Math.PI*2;ctx.beginPath();for(var j=0;j<l.length;j+=1){ctx.moveTo(x+l[j].x*scale,y+l[j].y*scale);ctx.arc(x+l[j].x*scale,y+l[j].y*scale,2,0,PI_SQ,false)}ctx.closePath();ctx.fill()}x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;var scale=1/this.path.unitsPerEm*fontSize;var blueCircles=[];var redCircles=[];var path=this.path;for(var i=0;i<path.commands.length;i+=1){var cmd=path.commands[i];if(cmd.x!==undefined){blueCircles.push({x:cmd.x,y:-cmd.y})}if(cmd.x1!==undefined){redCircles.push({x:cmd.x1,y:-cmd.y1})}if(cmd.x2!==undefined){redCircles.push({x:cmd.x2,y:-cmd.y2})}}ctx.fillStyle="blue";drawCircles(blueCircles,x,y,scale);ctx.fillStyle="red";drawCircles(redCircles,x,y,scale)};Glyph.prototype.drawMetrics=function(ctx,x,y,fontSize){var scale;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;scale=1/this.path.unitsPerEm*fontSize;ctx.lineWidth=1;ctx.strokeStyle="black";draw.line(ctx,x,-1e4,x,1e4);draw.line(ctx,-1e4,y,1e4,y);var xMin=this.xMin||0;var yMin=this.yMin||0;var xMax=this.xMax||0;var yMax=this.yMax||0;var advanceWidth=this.advanceWidth||0;ctx.strokeStyle="blue";draw.line(ctx,x+xMin*scale,-1e4,x+xMin*scale,1e4);draw.line(ctx,x+xMax*scale,-1e4,x+xMax*scale,1e4);draw.line(ctx,-1e4,y+-yMin*scale,1e4,y+-yMin*scale);draw.line(ctx,-1e4,y+-yMax*scale,1e4,y+-yMax*scale);ctx.strokeStyle="green";draw.line(ctx,x+advanceWidth*scale,-1e4,x+advanceWidth*scale,1e4)};exports.Glyph=Glyph},{"./check":2,"./draw":3,"./path":10}],7:[function(_dereq_,module,exports){"use strict";var _glyph=_dereq_("./glyph");function GlyphSet(font,glyphs){this.font=font;this.glyphs={};if(Array.isArray(glyphs)){for(var i=0;i<glyphs.length;i++){this.glyphs[i]=glyphs[i]}}this.length=glyphs&&glyphs.length||0}GlyphSet.prototype.get=function(index){if(typeof this.glyphs[index]==="function"){this.glyphs[index]=this.glyphs[index]()}return this.glyphs[index]};GlyphSet.prototype.push=function(index,loader){this.glyphs[index]=loader;this.length++};function glyphLoader(font,index){return new _glyph.Glyph({index:index,font:font})}function ttfGlyphLoader(font,index,parseGlyph,data,position,buildPath){return function(){var glyph=new _glyph.Glyph({index:index,font:font});glyph.path=function(){parseGlyph(glyph,data,position);var path=buildPath(font.glyphs,glyph);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}function cffGlyphLoader(font,index,parseCFFCharstring,charstring){return function(){var glyph=new _glyph.Glyph({index:index,font:font});glyph.path=function(){var path=parseCFFCharstring(font,glyph,charstring);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}exports.GlyphSet=GlyphSet;exports.glyphLoader=glyphLoader;exports.ttfGlyphLoader=ttfGlyphLoader;exports.cffGlyphLoader=cffGlyphLoader},{"./glyph":6}],8:[function(_dereq_,module,exports){"use strict";var encoding=_dereq_("./encoding");var _font=_dereq_("./font");var glyph=_dereq_("./glyph");var parse=_dereq_("./parse");var path=_dereq_("./path");var cmap=_dereq_("./tables/cmap");var cff=_dereq_("./tables/cff");var glyf=_dereq_("./tables/glyf");var gpos=_dereq_("./tables/gpos");var head=_dereq_("./tables/head");var hhea=_dereq_("./tables/hhea");var hmtx=_dereq_("./tables/hmtx");var kern=_dereq_("./tables/kern");var loca=_dereq_("./tables/loca");var maxp=_dereq_("./tables/maxp");var _name=_dereq_("./tables/name");var os2=_dereq_("./tables/os2");var post=_dereq_("./tables/post");function toArrayBuffer(buffer){var arrayBuffer=new ArrayBuffer(buffer.length);var data=new Uint8Array(arrayBuffer);for(var i=0;i<buffer.length;i+=1){data[i]=buffer[i]}return arrayBuffer}function loadFromFile(path,callback){var fs=_dereq_("fs");fs.readFile(path,function(err,buffer){if(err){return callback(err.message)}callback(null,toArrayBuffer(buffer))})}function loadFromUrl(url,callback){var request=new XMLHttpRequest;request.open("get",url,true);request.responseType="arraybuffer";request.onload=function(){if(request.status!==200){return callback("Font could not be loaded: "+request.statusText)}return callback(null,request.response)};request.send()}function parseBuffer(buffer){var indexToLocFormat;var hmtxOffset;var glyfOffset;var locaOffset;var cffOffset;var kernOffset;var gposOffset;var font=new _font.Font;var data=new DataView(buffer,0);var version=parse.getFixed(data,0);if(version===1){font.outlinesFormat="truetype"}else{version=parse.getTag(data,0);if(version==="OTTO"){font.outlinesFormat="cff"}else{throw new Error("Unsupported OpenType version "+version)}}var numTables=parse.getUShort(data,4);var p=12;for(var i=0;i<numTables;i+=1){var tag=parse.getTag(data,p);var offset=parse.getULong(data,p+8);switch(tag){case"cmap":font.tables.cmap=cmap.parse(data,offset);font.encoding=new encoding.CmapEncoding(font.tables.cmap);if(!font.encoding){font.supported=false}break;case"head":font.tables.head=head.parse(data,offset);font.unitsPerEm=font.tables.head.unitsPerEm;indexToLocFormat=font.tables.head.indexToLocFormat;break;case"hhea":font.tables.hhea=hhea.parse(data,offset);font.ascender=font.tables.hhea.ascender;font.descender=font.tables.hhea.descender;font.numberOfHMetrics=font.tables.hhea.numberOfHMetrics;break;case"hmtx":hmtxOffset=offset;break;case"maxp":font.tables.maxp=maxp.parse(data,offset);font.numGlyphs=font.tables.maxp.numGlyphs;break;case"name":font.tables.name=_name.parse(data,offset);font.familyName=font.tables.name.fontFamily;font.styleName=font.tables.name.fontSubfamily;break;case"OS/2":font.tables.os2=os2.parse(data,offset);break;case"post":font.tables.post=post.parse(data,offset);font.glyphNames=new encoding.GlyphNames(font.tables.post);break;case"glyf":glyfOffset=offset;break;case"loca":locaOffset=offset;break;case"CFF ":cffOffset=offset;break;case"kern":kernOffset=offset;break;case"GPOS":gposOffset=offset;break}p+=16}if(glyfOffset&&locaOffset){var shortVersion=indexToLocFormat===0;var locaTable=loca.parse(data,locaOffset,font.numGlyphs,shortVersion);font.glyphs=glyf.parse(data,glyfOffset,locaTable,font);hmtx.parse(data,hmtxOffset,font.numberOfHMetrics,font.numGlyphs,font.glyphs);encoding.addGlyphNames(font)}else if(cffOffset){cff.parse(data,cffOffset,font);encoding.addGlyphNames(font)}else{font.supported=false}if(font.supported){if(kernOffset){font.kerningPairs=kern.parse(data,kernOffset)}else{font.kerningPairs={}}if(gposOffset){gpos.parse(data,gposOffset,font)}}return font}function load(url,callback){var isNode=typeof window==="undefined";var loadFn=isNode?loadFromFile:loadFromUrl;loadFn(url,function(err,arrayBuffer){if(err){return callback(err)}var font=parseBuffer(arrayBuffer);if(!font.supported){return callback("Font is not supported (is this a Postscript font?)")}return callback(null,font)})}exports._parse=parse;exports.Font=_font.Font;exports.Glyph=glyph.Glyph;exports.Path=path.Path;exports.parse=parseBuffer;exports.load=load},{"./encoding":4,"./font":5,"./glyph":6,"./parse":9,"./path":10,"./tables/cff":12,"./tables/cmap":13,"./tables/glyf":14,"./tables/gpos":15,"./tables/head":16,"./tables/hhea":17,"./tables/hmtx":18,"./tables/kern":19,"./tables/loca":20,"./tables/maxp":21,"./tables/name":22,"./tables/os2":23,"./tables/post":24,fs:1}],9:[function(_dereq_,module,exports){"use strict";exports.getByte=function getByte(dataView,offset){return dataView.getUint8(offset)};exports.getCard8=exports.getByte;exports.getUShort=function(dataView,offset){return dataView.getUint16(offset,false)};exports.getCard16=exports.getUShort;exports.getShort=function(dataView,offset){return dataView.getInt16(offset,false)};exports.getULong=function(dataView,offset){return dataView.getUint32(offset,false)};exports.getFixed=function(dataView,offset){var decimal=dataView.getInt16(offset,false);var fraction=dataView.getUint16(offset+2,false);return decimal+fraction/65535};exports.getTag=function(dataView,offset){var tag="";for(var i=offset;i<offset+4;i+=1){tag+=String.fromCharCode(dataView.getInt8(i))}return tag};exports.getOffset=function(dataView,offset,offSize){var v=0;for(var i=0;i<offSize;i+=1){v<<=8;v+=dataView.getUint8(offset+i)}return v};exports.getBytes=function(dataView,startOffset,endOffset){var bytes=[];for(var i=startOffset;i<endOffset;i+=1){bytes.push(dataView.getUint8(i))}return bytes};exports.bytesToString=function(bytes){var s="";for(var i=0;i<bytes.length;i+=1){s+=String.fromCharCode(bytes[i])}return s};var typeOffsets={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(data,offset){this.data=data;this.offset=offset;this.relativeOffset=0}Parser.prototype.parseByte=function(){var v=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseChar=function(){var v=this.data.getInt8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var v=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var v=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseF2Dot14=function(){var v=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return v};Parser.prototype.parseULong=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseFixed=function(){var v=exports.getFixed(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(count){var offsets=new Array(count);var dataView=this.data;var offset=this.offset+this.relativeOffset;for(var i=0;i<count;i++){offsets[i]=exports.getUShort(dataView,offset);offset+=2}this.relativeOffset+=count*2;
return offsets};Parser.prototype.parseString=function(length){var dataView=this.data;var offset=this.offset+this.relativeOffset;var string="";this.relativeOffset+=length;for(var i=0;i<length;i++){string+=String.fromCharCode(dataView.getUint8(offset+i))}return string};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return v};Parser.prototype.parseFixed=function(){var v=exports.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v/65536};Parser.prototype.parseVersion=function(){var major=exports.getUShort(this.data,this.offset+this.relativeOffset);var minor=exports.getUShort(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;return major+minor/4096/10};Parser.prototype.skip=function(type,amount){if(amount===undefined){amount=1}this.relativeOffset+=typeOffsets[type]*amount};exports.Parser=Parser},{}],10:[function(_dereq_,module,exports){"use strict";function Path(){this.commands=[];this.fill="black";this.stroke=null;this.strokeWidth=1}Path.prototype.moveTo=function(x,y){this.commands.push({type:"M",x:x,y:y})};Path.prototype.lineTo=function(x,y){this.commands.push({type:"L",x:x,y:y})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(x1,y1,x2,y2,x,y){this.commands.push({type:"C",x1:x1,y1:y1,x2:x2,y2:y2,x:x,y:y})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(x1,y1,x,y){this.commands.push({type:"Q",x1:x1,y1:y1,x:x,y:y})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})};Path.prototype.extend=function(pathOrCommands){if(pathOrCommands.commands){pathOrCommands=pathOrCommands.commands}Array.prototype.push.apply(this.commands,pathOrCommands)};Path.prototype.draw=function(ctx){ctx.beginPath();for(var i=0;i<this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type==="M"){ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type==="L"){ctx.lineTo(cmd.x,cmd.y)}else if(cmd.type==="C"){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){ctx.closePath()}}if(this.fill){ctx.fillStyle=this.fill;ctx.fill()}if(this.stroke){ctx.strokeStyle=this.stroke;ctx.lineWidth=this.strokeWidth;ctx.stroke()}};Path.prototype.toPathData=function(decimalPlaces){decimalPlaces=decimalPlaces!==undefined?decimalPlaces:2;function floatToString(v){if(Math.round(v)===v){return""+Math.round(v)}else{return v.toFixed(decimalPlaces)}}function packValues(){var s="";for(var i=0;i<arguments.length;i+=1){var v=arguments[i];if(v>=0&&i>0){s+=" "}s+=floatToString(v)}return s}var d="";for(var i=0;i<this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type==="M"){d+="M"+packValues(cmd.x,cmd.y)}else if(cmd.type==="L"){d+="L"+packValues(cmd.x,cmd.y)}else if(cmd.type==="C"){d+="C"+packValues(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){d+="Q"+packValues(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){d+="Z"}}return d};Path.prototype.toSVG=function(decimalPlaces){var svg='<path d="';svg+=this.toPathData(decimalPlaces);svg+='"';if(this.fill&this.fill!=="black"){if(this.fill===null){svg+=' fill="none"'}else{svg+=' fill="'+this.fill+'"'}}if(this.stroke){svg+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'}svg+="/>";return svg};exports.Path=Path},{}],11:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var encode=_dereq_("./types").encode;var sizeOf=_dereq_("./types").sizeOf;function Table(tableName,fields,options){var i;for(i=0;i<fields.length;i+=1){var field=fields[i];this[field.name]=field.value}this.tableName=tableName;this.fields=fields;if(options){var optionKeys=Object.keys(options);for(i=0;i<optionKeys.length;i+=1){var k=optionKeys[i];var v=options[k];if(this[k]!==undefined){this[k]=v}}}}Table.prototype.sizeOf=function(){var v=0;for(var i=0;i<this.fields.length;i+=1){var field=this.fields[i];var value=this[field.name];if(value===undefined){value=field.value}if(typeof value.sizeOf==="function"){v+=value.sizeOf()}else{var sizeOfFunction=sizeOf[field.type];check.assert(typeof sizeOfFunction==="function","Could not find sizeOf function for field"+field.name);v+=sizeOfFunction(value)}}return v};Table.prototype.encode=function(){return encode.TABLE(this)};exports.Table=Table},{"./check":2,"./types":26}],12:[function(_dereq_,module,exports){"use strict";var encoding=_dereq_("../encoding");var glyphset=_dereq_("../glyphset");var parse=_dereq_("../parse");var path=_dereq_("../path");var table=_dereq_("../table");function equals(a,b){if(a===b){return true}else if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length){return false}for(var i=0;i<a.length;i+=1){if(!equals(a[i],b[i])){return false}}return true}else{return false}}function parseCFFIndex(data,start,conversionFn){var offsets=[];var objects=[];var count=parse.getCard16(data,start);var i;var objectOffset;var endOffset;if(count!==0){var offsetSize=parse.getByte(data,start+2);objectOffset=start+(count+1)*offsetSize+2;var pos=start+3;for(i=0;i<count+1;i+=1){offsets.push(parse.getOffset(data,pos,offsetSize));pos+=offsetSize}endOffset=objectOffset+offsets[count]}else{endOffset=start+2}for(i=0;i<offsets.length-1;i+=1){var value=parse.getBytes(data,objectOffset+offsets[i],objectOffset+offsets[i+1]);if(conversionFn){value=conversionFn(value)}objects.push(value)}return{objects:objects,startOffset:start,endOffset:endOffset}}function parseFloatOperand(parser){var s="";var eof=15;var lookup=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];while(true){var b=parser.parseByte();var n1=b>>4;var n2=b&15;if(n1===eof){break}s+=lookup[n1];if(n2===eof){break}s+=lookup[n2]}return parseFloat(s)}function parseOperand(parser,b0){var b1;var b2;var b3;var b4;if(b0===28){b1=parser.parseByte();b2=parser.parseByte();return b1<<8|b2}if(b0===29){b1=parser.parseByte();b2=parser.parseByte();b3=parser.parseByte();b4=parser.parseByte();return b1<<24|b2<<16|b3<<8|b4}if(b0===30){return parseFloatOperand(parser)}if(b0>=32&&b0<=246){return b0-139}if(b0>=247&&b0<=250){b1=parser.parseByte();return(b0-247)*256+b1+108}if(b0>=251&&b0<=254){b1=parser.parseByte();return-(b0-251)*256-b1-108}throw new Error("Invalid b0 "+b0)}function entriesToObject(entries){var o={};for(var i=0;i<entries.length;i+=1){var key=entries[i][0];var values=entries[i][1];var value;if(values.length===1){value=values[0]}else{value=values}if(o.hasOwnProperty(key)){throw new Error("Object "+o+" already has key "+key)}o[key]=value}return o}function parseCFFDict(data,start,size){start=start!==undefined?start:0;var parser=new parse.Parser(data,start);var entries=[];var operands=[];size=size!==undefined?size:data.length;while(parser.relativeOffset<size){var op=parser.parseByte();if(op<=21){if(op===12){op=1200+parser.parseByte()}entries.push([op,operands]);operands=[]}else{operands.push(parseOperand(parser,op))}}return entriesToObject(entries)}function getCFFString(strings,index){if(index<=390){index=encoding.cffStandardStrings[index]}else{index=strings[index-391]}return index}function interpretDict(dict,meta,strings){var newDict={};for(var i=0;i<meta.length;i+=1){var m=meta[i];var value=dict[m.op];if(value===undefined){value=m.value!==undefined?m.value:null}if(m.type==="SID"){value=getCFFString(strings,value)}newDict[m.name]=value}return newDict}function parseCFFHeader(data,start){var header={};header.formatMajor=parse.getCard8(data,start);header.formatMinor=parse.getCard8(data,start+1);header.size=parse.getCard8(data,start+2);header.offsetSize=parse.getCard8(data,start+3);header.startOffset=start;header.endOffset=start+4;return header}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}];var PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(data,strings){var dict=parseCFFDict(data,0,data.byteLength);return interpretDict(dict,TOP_DICT_META,strings)}function parseCFFPrivateDict(data,start,size,strings){var dict=parseCFFDict(data,start,size);return interpretDict(dict,PRIVATE_DICT_META,strings)}function parseCFFCharset(data,start,nGlyphs,strings){var i;var sid;var count;var parser=new parse.Parser(data,start);nGlyphs-=1;var charset=[".notdef"];var format=parser.parseCard8();if(format===0){for(i=0;i<nGlyphs;i+=1){sid=parser.parseSID();charset.push(getCFFString(strings,sid))}}else if(format===1){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard8();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else if(format===2){while(charset.length<=nGlyphs){sid=parser.parseSID();count=parser.parseCard16();for(i=0;i<=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else{throw new Error("Unknown charset format "+format)}return charset}function parseCFFEncoding(data,start,charset){var i;var code;var enc={};var parser=new parse.Parser(data,start);var format=parser.parseCard8();if(format===0){var nCodes=parser.parseCard8();for(i=0;i<nCodes;i+=1){code=parser.parseCard8();enc[code]=i}}else if(format===1){var nRanges=parser.parseCard8();code=1;for(i=0;i<nRanges;i+=1){var first=parser.parseCard8();var nLeft=parser.parseCard8();for(var j=first;j<=first+nLeft;j+=1){enc[j]=code;code+=1}}}else{throw new Error("Unknown encoding format "+format)}return new encoding.CffEncoding(enc,charset)}function parseCFFCharstring(font,glyph,code){var c1x;var c1y;var c2x;var c2y;var p=new path.Path;var stack=[];var nStems=0;var haveWidth=false;var width=font.defaultWidthX;var open=false;var x=0;var y=0;function newContour(x,y){if(open){p.closePath()}p.moveTo(x,y);open=true}function parseStems(){var hasWidthArg;hasWidthArg=stack.length%2!==0;if(hasWidthArg&&!haveWidth){width=stack.shift()+font.nominalWidthX}nStems+=stack.length>>1;stack.length=0;haveWidth=true}function parse(code){var b1;var b2;var b3;var b4;var codeIndex;var subrCode;var jpx;var jpy;var c3x;var c3y;var c4x;var c4y;var i=0;while(i<code.length){var v=code[i];i+=1;switch(v){case 1:parseStems();break;case 3:parseStems();break;case 4:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();newContour(x,y);break;case 5:while(stack.length>0){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}break;case 6:while(stack.length>0){x+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}y+=stack.shift();p.lineTo(x,y)}break;case 7:while(stack.length>0){y+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}x+=stack.shift();p.lineTo(x,y)}break;case 8:while(stack.length>0){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 10:codeIndex=stack.pop()+font.subrsBias;subrCode=font.subrs[codeIndex];if(subrCode){parse(subrCode)}break;case 11:return;case 12:v=code[i];i+=1;switch(v){case 35:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();y=c4y+stack.shift();stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 34:c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=y;x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 36:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 37:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();if(Math.abs(c4x-x)>Math.abs(c4y-y)){x=c4x+stack.shift()}else{y=c4y+stack.shift()}p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;default:console.log("Glyph "+glyph.index+": unknown operator "+1200+v);stack.length=0}break;case 14:if(stack.length>0&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}if(open){p.closePath();open=false}break;case 18:parseStems();break;case 19:case 20:parseStems();i+=nStems+7>>3;break;case 21:if(stack.length>2&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();x+=stack.pop();newContour(x,y);break;case 22:if(stack.length>1&&!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}x+=stack.pop();newContour(x,y);break;case 23:parseStems();break;case 24:while(stack.length>2){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}x+=stack.shift();y+=stack.shift();p.lineTo(x,y);break;case 25:while(stack.length>6){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y);break;case 26:if(stack.length%2){x+=stack.shift()}while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x;y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 27:if(stack.length%2){y+=stack.shift()}while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y;p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 28:b1=code[i];b2=code[i+1];stack.push((b1<<24|b2<<16)>>16);i+=2;break;case 29:codeIndex=stack.pop()+font.gsubrsBias;subrCode=font.gsubrs[codeIndex];if(subrCode){parse(subrCode)}break;case 30:while(stack.length>0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 31:while(stack.length>0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;default:if(v<32){console.log("Glyph "+glyph.index+": unknown operator "+v)}else if(v<247){stack.push(v-139)}else if(v<251){b1=code[i];i+=1;stack.push((v-247)*256+b1+108)}else if(v<255){b1=code[i];i+=1;stack.push(-(v-251)*256-b1-108)}else{b1=code[i];b2=code[i+1];b3=code[i+2];b4=code[i+3];i+=4;stack.push((b1<<24|b2<<16|b3<<8|b4)/65536)}}}}parse(code);glyph.advanceWidth=width;return p}function calcCFFSubroutineBias(subrs){var bias;if(subrs.length<1240){bias=107}else if(subrs.length<33900){bias=1131}else{bias=32768}return bias}function parseCFFTable(data,start,font){font.tables.cff={};var header=parseCFFHeader(data,start);var nameIndex=parseCFFIndex(data,header.endOffset,parse.bytesToString);var topDictIndex=parseCFFIndex(data,nameIndex.endOffset);var stringIndex=parseCFFIndex(data,topDictIndex.endOffset,parse.bytesToString);var globalSubrIndex=parseCFFIndex(data,stringIndex.endOffset);font.gsubrs=globalSubrIndex.objects;font.gsubrsBias=calcCFFSubroutineBias(font.gsubrs);var topDictData=new DataView(new Uint8Array(topDictIndex.objects[0]).buffer);var topDict=parseCFFTopDict(topDictData,stringIndex.objects);font.tables.cff.topDict=topDict;var privateDictOffset=start+topDict["private"][1];var privateDict=parseCFFPrivateDict(data,privateDictOffset,topDict["private"][0],stringIndex.objects);font.defaultWidthX=privateDict.defaultWidthX;font.nominalWidthX=privateDict.nominalWidthX;if(privateDict.subrs!==0){var subrOffset=privateDictOffset+privateDict.subrs;var subrIndex=parseCFFIndex(data,subrOffset);font.subrs=subrIndex.objects;font.subrsBias=calcCFFSubroutineBias(font.subrs)}else{font.subrs=[];font.subrsBias=0}var charStringsIndex=parseCFFIndex(data,start+topDict.charStrings);font.nGlyphs=charStringsIndex.objects.length;var charset=parseCFFCharset(data,start+topDict.charset,font.nGlyphs,stringIndex.objects);if(topDict.encoding===0){font.cffEncoding=new encoding.CffEncoding(encoding.cffStandardEncoding,charset)}else if(topDict.encoding===1){font.cffEncoding=new encoding.CffEncoding(encoding.cffExpertEncoding,charset)}else{font.cffEncoding=parseCFFEncoding(data,start+topDict.encoding,charset)}font.encoding=font.encoding||font.cffEncoding;font.glyphs=new glyphset.GlyphSet(font);for(var i=0;i<font.nGlyphs;i+=1){var charString=charStringsIndex.objects[i];font.glyphs.push(i,glyphset.cffGlyphLoader(font,i,parseCFFCharstring,charString))}}function encodeString(s,strings){var sid;var i=encoding.cffStandardStrings.indexOf(s);if(i>=0){sid=i}i=strings.indexOf(s);if(i>=0){sid=i+encoding.cffStandardStrings.length}else{sid=encoding.cffStandardStrings.length+strings.length;strings.push(s)}return sid}function makeHeader(){return new table.Table("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(fontNames){var t=new table.Table("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var i=0;i<fontNames.length;i+=1){t.names.push({name:"name_"+i,type:"NAME",value:fontNames[i]})}return t}function makeDict(meta,attrs,strings){var m={};for(var i=0;i<meta.length;i+=1){var entry=meta[i];var value=attrs[entry.name];if(value!==undefined&&!equals(value,entry.value)){if(entry.type==="SID"){value=encodeString(value,strings)}m[entry.op]={name:entry.name,type:entry.type,value:value}}}return m}function makeTopDict(attrs,strings){var t=new table.Table("Top DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(TOP_DICT_META,attrs,strings);return t}function makeTopDictIndex(topDict){var t=new table.Table("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);t.topDicts=[{name:"topDict_0",type:"TABLE",value:topDict}];return t}function makeStringIndex(strings){var t=new table.Table("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var i=0;i<strings.length;i+=1){t.strings.push({name:"string_"+i,type:"STRING",value:strings[i]})}return t}function makeGlobalSubrIndex(){return new table.Table("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(glyphNames,strings){var t=new table.Table("Charsets",[{name:"format",type:"Card8",value:0}]);for(var i=0;i<glyphNames.length;i+=1){var glyphName=glyphNames[i];var glyphSID=encodeString(glyphName,strings);t.fields.push({name:"glyph_"+i,type:"SID",value:glyphSID})}return t}function glyphToOps(glyph){var ops=[];var path=glyph.path;ops.push({name:"width",type:"NUMBER",value:glyph.advanceWidth});var x=0;var y=0;for(var i=0;i<path.commands.length;i+=1){var dx;var dy;var cmd=path.commands[i];if(cmd.type==="Q"){var _13=1/3;var _23=2/3;cmd={type:"C",x:cmd.x,y:cmd.y,x1:_13*x+_23*cmd.x1,y1:_13*y+_23*cmd.y1,x2:_13*cmd.x+_23*cmd.x1,y2:_13*cmd.y+_23*cmd.y1}}if(cmd.type==="M"){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rmoveto",type:"OP",value:21});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type==="L"){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rlineto",type:"OP",value:5});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type==="C"){var dx1=Math.round(cmd.x1-x);var dy1=Math.round(cmd.y1-y);var dx2=Math.round(cmd.x2-cmd.x1);var dy2=Math.round(cmd.y2-cmd.y1);dx=Math.round(cmd.x-cmd.x2);dy=Math.round(cmd.y-cmd.y2);ops.push({name:"dx1",type:"NUMBER",value:dx1});ops.push({name:"dy1",type:"NUMBER",value:dy1});ops.push({name:"dx2",type:"NUMBER",value:dx2});ops.push({name:"dy2",type:"NUMBER",value:dy2});ops.push({name:"dx",type:"NUMBER",value:dx});ops.push({name:"dy",type:"NUMBER",value:dy});ops.push({name:"rrcurveto",type:"OP",value:8});x=Math.round(cmd.x);y=Math.round(cmd.y)}}ops.push({name:"endchar",type:"OP",value:14});return ops}function makeCharStringsIndex(glyphs){var t=new table.Table("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);var ops=glyphToOps(glyph);t.charStrings.push({name:glyph.name,type:"CHARSTRING",value:ops})}return t}function makePrivateDict(attrs,strings){var t=new table.Table("Private DICT",[{name:"dict",type:"DICT",value:{}}]);t.dict=makeDict(PRIVATE_DICT_META,attrs,strings);return t}function makePrivateDictIndex(privateDict){var t=new table.Table("Private DICT INDEX",[{name:"privateDicts",type:"INDEX",value:[]}]);t.privateDicts=[{name:"privateDict_0",type:"TABLE",value:privateDict}];return t}function makeCFFTable(glyphs,options){var t=new table.Table("CFF ",[{name:"header",type:"TABLE"},{name:"nameIndex",type:"TABLE"},{name:"topDictIndex",type:"TABLE"},{name:"stringIndex",type:"TABLE"},{name:"globalSubrIndex",type:"TABLE"},{name:"charsets",type:"TABLE"},{name:"charStringsIndex",type:"TABLE"},{name:"privateDictIndex",type:"TABLE"}]);var fontScale=1/options.unitsPerEm;var attrs={version:options.version,fullName:options.fullName,familyName:options.familyName,weight:options.weightName,fontMatrix:[fontScale,0,0,fontScale,0,0],charset:999,encoding:0,charStrings:999,"private":[0,999]};var privateAttrs={};var glyphNames=[];var glyph;for(var i=1;i<glyphs.length;i+=1){glyph=glyphs.get(i);glyphNames.push(glyph.name)}var strings=[];t.header=makeHeader();t.nameIndex=makeNameIndex([options.postScriptName]);var topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);t.globalSubrIndex=makeGlobalSubrIndex();t.charsets=makeCharsets(glyphNames,strings);t.charStringsIndex=makeCharStringsIndex(glyphs);var privateDict=makePrivateDict(privateAttrs,strings);t.privateDictIndex=makePrivateDictIndex(privateDict);t.stringIndex=makeStringIndex(strings);var startOffset=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();attrs.charset=startOffset;attrs.encoding=0;attrs.charStrings=attrs.charset+t.charsets.sizeOf();attrs.private[1]=attrs.charStrings+t.charStringsIndex.sizeOf();topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);return t}exports.parse=parseCFFTable;exports.make=makeCFFTable},{"../encoding":4,"../glyphset":7,"../parse":9,"../path":10,"../table":11}],13:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");var table=_dereq_("../table");function parseCmapTable(data,start){var i;var cmap={};cmap.version=parse.getUShort(data,start);check.argument(cmap.version===0,"cmap table version should be 0.");cmap.numTables=parse.getUShort(data,start+2);var offset=-1;for(i=0;i<cmap.numTables;i+=1){var platformId=parse.getUShort(data,start+4+i*8);var encodingId=parse.getUShort(data,start+4+i*8+2);if(platformId===3&&(encodingId===1||encodingId===0)){offset=parse.getULong(data,start+4+i*8+4);break}}if(offset===-1){return null}var p=new parse.Parser(data,start+offset);cmap.format=p.parseUShort();check.argument(cmap.format===4,"Only format 4 cmap tables are supported.");cmap.length=p.parseUShort();cmap.language=p.parseUShort();var segCount;cmap.segCount=segCount=p.parseUShort()>>1;p.skip("uShort",3);cmap.glyphIndexMap={};var endCountParser=new parse.Parser(data,start+offset+14);var startCountParser=new parse.Parser(data,start+offset+16+segCount*2);var idDeltaParser=new parse.Parser(data,start+offset+16+segCount*4);var idRangeOffsetParser=new parse.Parser(data,start+offset+16+segCount*6);var glyphIndexOffset=start+offset+16+segCount*8;for(i=0;i<segCount-1;i+=1){var glyphIndex;var endCount=endCountParser.parseUShort();var startCount=startCountParser.parseUShort();var idDelta=idDeltaParser.parseShort();var idRangeOffset=idRangeOffsetParser.parseUShort();for(var c=startCount;c<=endCount;c+=1){if(idRangeOffset!==0){glyphIndexOffset=idRangeOffsetParser.offset+idRangeOffsetParser.relativeOffset-2;glyphIndexOffset+=idRangeOffset;glyphIndexOffset+=(c-startCount)*2;glyphIndex=parse.getUShort(data,glyphIndexOffset);if(glyphIndex!==0){glyphIndex=glyphIndex+idDelta&65535}}else{glyphIndex=c+idDelta&65535}cmap.glyphIndexMap[c]=glyphIndex}}return cmap}function addSegment(t,code,glyphIndex){t.segments.push({end:code,start:code,delta:-(code-glyphIndex),offset:0})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(glyphs){var i;var t=new table.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.segments=[];for(i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j<glyph.unicodes.length;j+=1){addSegment(t,glyph.unicodes[j],i)}t.segments=t.segments.sort(function(a,b){return a.start-b.start})}addTerminatorSegment(t);var segCount;segCount=t.segments.length;t.segCountX2=segCount*2;t.searchRange=Math.pow(2,Math.floor(Math.log(segCount)/Math.log(2)))*2;t.entrySelector=Math.log(t.searchRange/2)/Math.log(2);t.rangeShift=t.segCountX2-t.searchRange;var endCounts=[];var startCounts=[];var idDeltas=[];var idRangeOffsets=[];var glyphIds=[];for(i=0;i<segCount;i+=1){var segment=t.segments[i];endCounts=endCounts.concat({name:"end_"+i,type:"USHORT",value:segment.end});startCounts=startCounts.concat({name:"start_"+i,type:"USHORT",value:segment.start});idDeltas=idDeltas.concat({name:"idDelta_"+i,type:"SHORT",value:segment.delta});idRangeOffsets=idRangeOffsets.concat({name:"idRangeOffset_"+i,type:"USHORT",value:segment.offset});if(segment.glyphId!==undefined){glyphIds=glyphIds.concat({name:"glyph_"+i,type:"USHORT",value:segment.glyphId})}}t.fields=t.fields.concat(endCounts);t.fields.push({name:"reservedPad",type:"USHORT",value:0});t.fields=t.fields.concat(startCounts);t.fields=t.fields.concat(idDeltas);t.fields=t.fields.concat(idRangeOffsets);t.fields=t.fields.concat(glyphIds);t.length=14+endCounts.length*2+2+startCounts.length*2+idDeltas.length*2+idRangeOffsets.length*2+glyphIds.length*2;return t}exports.parse=parseCmapTable;exports.make=makeCmapTable},{"../check":2,"../parse":9,"../table":11}],14:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var glyphset=_dereq_("../glyphset");var parse=_dereq_("../parse");var path=_dereq_("../path");function parseGlyphCoordinate(p,flag,previousValue,shortVectorBitMask,sameBitMask){var v;if((flag&shortVectorBitMask)>0){v=p.parseByte();if((flag&sameBitMask)===0){v=-v}v=previousValue+v}else{if((flag&sameBitMask)>0){v=previousValue}else{v=previousValue+p.parseShort()}}return v}function parseGlyph(glyph,data,start){var p=new parse.Parser(data,start);glyph.numberOfContours=p.parseShort();glyph.xMin=p.parseShort();glyph.yMin=p.parseShort();glyph.xMax=p.parseShort();glyph.yMax=p.parseShort();var flags;var flag;if(glyph.numberOfContours>0){var i;var endPointIndices=glyph.endPointIndices=[];for(i=0;i<glyph.numberOfContours;i+=1){endPointIndices.push(p.parseUShort())}glyph.instructionLength=p.parseUShort();glyph.instructions=[];for(i=0;i<glyph.instructionLength;i+=1){glyph.instructions.push(p.parseByte())}var numberOfCoordinates=endPointIndices[endPointIndices.length-1]+1;flags=[];for(i=0;i<numberOfCoordinates;i+=1){flag=p.parseByte();flags.push(flag);if((flag&8)>0){var repeatCount=p.parseByte();for(var j=0;j<repeatCount;j+=1){flags.push(flag);i+=1}}}check.argument(flags.length===numberOfCoordinates,"Bad flags.");if(endPointIndices.length>0){var points=[];var point;if(numberOfCoordinates>0){for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point={};point.onCurve=!!(flag&1);point.lastPointOfContour=endPointIndices.indexOf(i)>=0;points.push(point)}var px=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.x=parseGlyphCoordinate(p,flag,px,2,16);px=point.x}var py=0;for(i=0;i<numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.y=parseGlyphCoordinate(p,flag,py,4,32);py=point.y}}glyph.points=points}else{glyph.points=[]}}else if(glyph.numberOfContours===0){glyph.points=[]}else{glyph.isComposite=true;glyph.points=[];glyph.components=[];var moreComponents=true;while(moreComponents){flags=p.parseUShort();var component={glyphIndex:p.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};if((flags&1)>0){component.dx=p.parseShort();component.dy=p.parseShort()}else{component.dx=p.parseChar();component.dy=p.parseChar()}if((flags&8)>0){component.xScale=component.yScale=p.parseF2Dot14()}else if((flags&64)>0){component.xScale=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}else if((flags&128)>0){component.xScale=p.parseF2Dot14();component.scale01=p.parseF2Dot14();component.scale10=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}glyph.components.push(component);moreComponents=!!(flags&32)}}}function transformPoints(points,transform){var newPoints=[];for(var i=0;i<points.length;i+=1){var pt=points[i];var newPt={x:transform.xScale*pt.x+transform.scale01*pt.y+transform.dx,y:transform.scale10*pt.x+transform.yScale*pt.y+transform.dy,onCurve:pt.onCurve,lastPointOfContour:pt.lastPointOfContour};newPoints.push(newPt)}return newPoints}function getContours(points){var contours=[];var currentContour=[];for(var i=0;i<points.length;i+=1){var pt=points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}check.argument(currentContour.length===0,"There are still points left in the current contour.");return contours}function getPath(points){var p=new path.Path;if(!points){return p}var contours=getContours(points);for(var i=0;i<contours.length;i+=1){var contour=contours[i];var firstPt=contour[0];var lastPt=contour[contour.length-1];var curvePt;var realFirstPoint;if(firstPt.onCurve){curvePt=null;realFirstPoint=true}else{if(lastPt.onCurve){firstPt=lastPt}else{firstPt={x:(firstPt.x+lastPt.x)/2,y:(firstPt.y+lastPt.y)/2}}curvePt=firstPt;realFirstPoint=false}p.moveTo(firstPt.x,firstPt.y);for(var j=realFirstPoint?1:0;j<contour.length;j+=1){var pt=contour[j];var prevPt=j===0?firstPt:contour[j-1];if(prevPt.onCurve&&pt.onCurve){p.lineTo(pt.x,pt.y)}else if(prevPt.onCurve&&!pt.onCurve){
curvePt=pt}else if(!prevPt.onCurve&&!pt.onCurve){var midPt={x:(prevPt.x+pt.x)/2,y:(prevPt.y+pt.y)/2};p.quadraticCurveTo(prevPt.x,prevPt.y,midPt.x,midPt.y);curvePt=pt}else if(!prevPt.onCurve&&pt.onCurve){p.quadraticCurveTo(curvePt.x,curvePt.y,pt.x,pt.y);curvePt=null}else{throw new Error("Invalid state.")}}if(firstPt!==lastPt){if(curvePt){p.quadraticCurveTo(curvePt.x,curvePt.y,firstPt.x,firstPt.y)}else{p.lineTo(firstPt.x,firstPt.y)}}}p.closePath();return p}function buildPath(glyphs,glyph){if(glyph.isComposite){for(var j=0;j<glyph.components.length;j+=1){var component=glyph.components[j];var componentGlyph=glyphs.get(component.glyphIndex);if(componentGlyph.points){var transformedPoints=transformPoints(componentGlyph.points,component);glyph.points=glyph.points.concat(transformedPoints)}}}return getPath(glyph.points)}function parseGlyfTable(data,start,loca,font){var glyphs=new glyphset.GlyphSet(font);var i;for(i=0;i<loca.length-1;i+=1){var offset=loca[i];var nextOffset=loca[i+1];if(offset!==nextOffset){glyphs.push(i,glyphset.ttfGlyphLoader(font,i,parseGlyph,data,start+offset,buildPath))}else{glyphs.push(i,glyphset.glyphLoader(font,i))}}return glyphs}exports.parse=parseGlyfTable},{"../check":2,"../glyphset":7,"../parse":9,"../path":10}],15:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");function parseTaggedListTable(data,start){var p=new parse.Parser(data,start);var n=p.parseUShort();var list=[];for(var i=0;i<n;i++){list[p.parseTag()]={offset:p.parseUShort()}}return list}function parseCoverageTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();var count=p.parseUShort();if(format===1){return p.parseUShortList(count)}else if(format===2){var coverage=[];for(;count--;){var begin=p.parseUShort();var end=p.parseUShort();var index=p.parseUShort();for(var i=begin;i<=end;i++){coverage[index++]=i}}return coverage}}function parseClassDefTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();if(format===1){var startGlyph=p.parseUShort();var glyphCount=p.parseUShort();var classes=p.parseUShortList(glyphCount);return function(glyphID){return classes[glyphID-startGlyph]||0}}else if(format===2){var rangeCount=p.parseUShort();var startGlyphs=[];var endGlyphs=[];var classValues=[];for(var i=0;i<rangeCount;i++){startGlyphs[i]=p.parseUShort();endGlyphs[i]=p.parseUShort();classValues[i]=p.parseUShort()}return function(glyphID){var l=0;var r=startGlyphs.length-1;while(l<r){var c=l+r+1>>1;if(glyphID<startGlyphs[c]){r=c-1}else{l=c}}if(startGlyphs[l]<=glyphID&&glyphID<=endGlyphs[l]){return classValues[l]||0}return 0}}}function parsePairPosSubTable(data,start){var p=new parse.Parser(data,start);var format=p.parseUShort();var coverageOffset=p.parseUShort();var coverage=parseCoverageTable(data,start+coverageOffset);var valueFormat1=p.parseUShort();var valueFormat2=p.parseUShort();var value1;var value2;if(valueFormat1!==4||valueFormat2!==0)return;var sharedPairSets={};if(format===1){var pairSetCount=p.parseUShort();var pairSet=[];var pairSetOffsets=p.parseOffset16List(pairSetCount);for(var firstGlyph=0;firstGlyph<pairSetCount;firstGlyph++){var pairSetOffset=pairSetOffsets[firstGlyph];var sharedPairSet=sharedPairSets[pairSetOffset];if(!sharedPairSet){sharedPairSet={};p.relativeOffset=pairSetOffset;var pairValueCount=p.parseUShort();for(;pairValueCount--;){var secondGlyph=p.parseUShort();if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();sharedPairSet[secondGlyph]=value1}}pairSet[coverage[firstGlyph]]=sharedPairSet}return function(leftGlyph,rightGlyph){var pairs=pairSet[leftGlyph];if(pairs)return pairs[rightGlyph]}}else if(format===2){var classDef1Offset=p.parseUShort();var classDef2Offset=p.parseUShort();var class1Count=p.parseUShort();var class2Count=p.parseUShort();var getClass1=parseClassDefTable(data,start+classDef1Offset);var getClass2=parseClassDefTable(data,start+classDef2Offset);var kerningMatrix=[];for(var i=0;i<class1Count;i++){var kerningRow=kerningMatrix[i]=[];for(var j=0;j<class2Count;j++){if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();kerningRow[j]=value1}}var covered={};for(i=0;i<coverage.length;i++)covered[coverage[i]]=1;return function(leftGlyph,rightGlyph){if(!covered[leftGlyph])return;var class1=getClass1(leftGlyph);var class2=getClass2(rightGlyph);var kerningRow=kerningMatrix[class1];if(kerningRow){return kerningRow[class2]}}}}function parseLookupTable(data,start){var p=new parse.Parser(data,start);var lookupType=p.parseUShort();var lookupFlag=p.parseUShort();var useMarkFilteringSet=lookupFlag&16;var subTableCount=p.parseUShort();var subTableOffsets=p.parseOffset16List(subTableCount);var table={lookupType:lookupType,lookupFlag:lookupFlag,markFilteringSet:useMarkFilteringSet?p.parseUShort():-1};if(lookupType===2){var subtables=[];for(var i=0;i<subTableCount;i++){subtables.push(parsePairPosSubTable(data,start+subTableOffsets[i]))}table.getKerningValue=function(leftGlyph,rightGlyph){for(var i=subtables.length;i--;){var value=subtables[i](leftGlyph,rightGlyph);if(value!==undefined)return value}return 0}}return table}function parseGposTable(data,start,font){var p=new parse.Parser(data,start);var tableVersion=p.parseFixed();check.argument(tableVersion===1,"Unsupported GPOS table version.");parseTaggedListTable(data,start+p.parseUShort());parseTaggedListTable(data,start+p.parseUShort());var lookupListOffset=p.parseUShort();p.relativeOffset=lookupListOffset;var lookupCount=p.parseUShort();var lookupTableOffsets=p.parseOffset16List(lookupCount);var lookupListAbsoluteOffset=start+lookupListOffset;for(var i=0;i<lookupCount;i++){var table=parseLookupTable(data,lookupListAbsoluteOffset+lookupTableOffsets[i]);if(table.lookupType===2&&!font.getGposKerningValue)font.getGposKerningValue=table.getKerningValue}}exports.parse=parseGposTable},{"../check":2,"../parse":9}],16:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHeadTable(data,start){var head={};var p=new parse.Parser(data,start);head.version=p.parseVersion();head.fontRevision=Math.round(p.parseFixed()*1e3)/1e3;head.checkSumAdjustment=p.parseULong();head.magicNumber=p.parseULong();check.argument(head.magicNumber===1594834165,"Font header has wrong magic number.");head.flags=p.parseUShort();head.unitsPerEm=p.parseUShort();head.created=p.parseLongDateTime();head.modified=p.parseLongDateTime();head.xMin=p.parseShort();head.yMin=p.parseShort();head.xMax=p.parseShort();head.yMax=p.parseShort();head.macStyle=p.parseUShort();head.lowestRecPPEM=p.parseUShort();head.fontDirectionHint=p.parseShort();head.indexToLocFormat=p.parseShort();head.glyphDataFormat=p.parseShort();return head}function makeHeadTable(options){return new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],options)}exports.parse=parseHeadTable;exports.make=makeHeadTable},{"../check":2,"../parse":9,"../table":11}],17:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHheaTable(data,start){var hhea={};var p=new parse.Parser(data,start);hhea.version=p.parseVersion();hhea.ascender=p.parseShort();hhea.descender=p.parseShort();hhea.lineGap=p.parseShort();hhea.advanceWidthMax=p.parseUShort();hhea.minLeftSideBearing=p.parseShort();hhea.minRightSideBearing=p.parseShort();hhea.xMaxExtent=p.parseShort();hhea.caretSlopeRise=p.parseShort();hhea.caretSlopeRun=p.parseShort();hhea.caretOffset=p.parseShort();p.relativeOffset+=8;hhea.metricDataFormat=p.parseShort();hhea.numberOfHMetrics=p.parseUShort();return hhea}function makeHheaTable(options){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],options)}exports.parse=parseHheaTable;exports.make=makeHheaTable},{"../parse":9,"../table":11}],18:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseHmtxTable(data,start,numMetrics,numGlyphs,glyphs){var advanceWidth;var leftSideBearing;var p=new parse.Parser(data,start);for(var i=0;i<numGlyphs;i+=1){if(i<numMetrics){advanceWidth=p.parseUShort();leftSideBearing=p.parseShort()}var glyph=glyphs.get(i);glyph.advanceWidth=advanceWidth;glyph.leftSideBearing=leftSideBearing}}function makeHmtxTable(glyphs){var t=new table.Table("hmtx",[]);for(var i=0;i<glyphs.length;i+=1){var glyph=glyphs.get(i);var advanceWidth=glyph.advanceWidth||0;var leftSideBearing=glyph.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+i,type:"USHORT",value:advanceWidth});t.fields.push({name:"leftSideBearing_"+i,type:"SHORT",value:leftSideBearing})}return t}exports.parse=parseHmtxTable;exports.make=makeHmtxTable},{"../parse":9,"../table":11}],19:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var parse=_dereq_("../parse");function parseKernTable(data,start){var pairs={};var p=new parse.Parser(data,start);var tableVersion=p.parseUShort();check.argument(tableVersion===0,"Unsupported kern table version.");p.skip("uShort",1);var subTableVersion=p.parseUShort();check.argument(subTableVersion===0,"Unsupported kern sub-table version.");p.skip("uShort",2);var nPairs=p.parseUShort();p.skip("uShort",3);for(var i=0;i<nPairs;i+=1){var leftIndex=p.parseUShort();var rightIndex=p.parseUShort();var value=p.parseShort();pairs[leftIndex+","+rightIndex]=value}return pairs}exports.parse=parseKernTable},{"../check":2,"../parse":9}],20:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");function parseLocaTable(data,start,numGlyphs,shortVersion){var p=new parse.Parser(data,start);var parseFn=shortVersion?p.parseUShort:p.parseULong;var glyphOffsets=[];for(var i=0;i<numGlyphs+1;i+=1){var glyphOffset=parseFn.call(p);if(shortVersion){glyphOffset*=2}glyphOffsets.push(glyphOffset)}return glyphOffsets}exports.parse=parseLocaTable},{"../parse":9}],21:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");function parseMaxpTable(data,start){var maxp={};var p=new parse.Parser(data,start);maxp.version=p.parseVersion();maxp.numGlyphs=p.parseUShort();if(maxp.version===1){maxp.maxPoints=p.parseUShort();maxp.maxContours=p.parseUShort();maxp.maxCompositePoints=p.parseUShort();maxp.maxCompositeContours=p.parseUShort();maxp.maxZones=p.parseUShort();maxp.maxTwilightPoints=p.parseUShort();maxp.maxStorage=p.parseUShort();maxp.maxFunctionDefs=p.parseUShort();maxp.maxInstructionDefs=p.parseUShort();maxp.maxStackElements=p.parseUShort();maxp.maxSizeOfInstructions=p.parseUShort();maxp.maxComponentElements=p.parseUShort();maxp.maxComponentDepth=p.parseUShort()}return maxp}function makeMaxpTable(numGlyphs){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:numGlyphs}])}exports.parse=parseMaxpTable;exports.make=makeMaxpTable},{"../parse":9,"../table":11}],22:[function(_dereq_,module,exports){"use strict";var encode=_dereq_("../types").encode;var parse=_dereq_("../parse");var table=_dereq_("../table");var nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","licence","licenceURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"];function parseNameTable(data,start){var name={};var p=new parse.Parser(data,start);name.format=p.parseUShort();var count=p.parseUShort();var stringOffset=p.offset+p.parseUShort();var unknownCount=0;for(var i=0;i<count;i++){var platformID=p.parseUShort();var encodingID=p.parseUShort();var languageID=p.parseUShort();var nameID=p.parseUShort();var property=nameTableNames[nameID];var byteLength=p.parseUShort();var offset=p.parseUShort();if(platformID===3&&encodingID===1&&languageID===1033){var codePoints=[];var length=byteLength/2;for(var j=0;j<length;j++,offset+=2){codePoints[j]=parse.getShort(data,stringOffset+offset)}var str=String.fromCharCode.apply(null,codePoints);if(property){name[property]=str}else{unknownCount++;name["unknown"+unknownCount]=str}}}if(name.format===1){name.langTagCount=p.parseUShort()}return name}function makeNameRecord(platformID,encodingID,languageID,nameID,length,offset){return new table.Table("NameRecord",[{name:"platformID",type:"USHORT",value:platformID},{name:"encodingID",type:"USHORT",value:encodingID},{name:"languageID",type:"USHORT",value:languageID},{name:"nameID",type:"USHORT",value:nameID},{name:"length",type:"USHORT",value:length},{name:"offset",type:"USHORT",value:offset}])}function addMacintoshNameRecord(t,recordID,s,offset){var stringBytes=encode.STRING(s);t.records.push(makeNameRecord(1,0,0,recordID,stringBytes.length,offset));t.strings.push(stringBytes);offset+=stringBytes.length;return offset}function addWindowsNameRecord(t,recordID,s,offset){var utf16Bytes=encode.UTF16(s);t.records.push(makeNameRecord(3,1,1033,recordID,utf16Bytes.length,offset));t.strings.push(utf16Bytes);offset+=utf16Bytes.length;return offset}function makeNameTable(options){var t=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:0},{name:"stringOffset",type:"USHORT",value:0}]);t.records=[];t.strings=[];var offset=0;var i;var s;for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addMacintoshNameRecord(t,i,s,offset)}}for(i=0;i<nameTableNames.length;i+=1){if(options[nameTableNames[i]]!==undefined){s=options[nameTableNames[i]];offset=addWindowsNameRecord(t,i,s,offset)}}t.count=t.records.length;t.stringOffset=6+t.count*12;for(i=0;i<t.records.length;i+=1){t.fields.push({name:"record_"+i,type:"TABLE",value:t.records[i]})}for(i=0;i<t.strings.length;i+=1){t.fields.push({name:"string_"+i,type:"LITERAL",value:t.strings[i]})}return t}exports.parse=parseNameTable;exports.make=makeNameTable},{"../parse":9,"../table":11,"../types":26}],23:[function(_dereq_,module,exports){"use strict";var parse=_dereq_("../parse");var table=_dereq_("../table");var unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(unicode){for(var i=0;i<unicodeRanges.length;i+=1){var range=unicodeRanges[i];if(unicode>=range.begin&&unicode<range.end){return i}}return-1}function parseOS2Table(data,start){var os2={};var p=new parse.Parser(data,start);os2.version=p.parseUShort();os2.xAvgCharWidth=p.parseShort();os2.usWeightClass=p.parseUShort();os2.usWidthClass=p.parseUShort();os2.fsType=p.parseUShort();os2.ySubscriptXSize=p.parseShort();os2.ySubscriptYSize=p.parseShort();os2.ySubscriptXOffset=p.parseShort();os2.ySubscriptYOffset=p.parseShort();os2.ySuperscriptXSize=p.parseShort();os2.ySuperscriptYSize=p.parseShort();os2.ySuperscriptXOffset=p.parseShort();os2.ySuperscriptYOffset=p.parseShort();os2.yStrikeoutSize=p.parseShort();os2.yStrikeoutPosition=p.parseShort();os2.sFamilyClass=p.parseShort();os2.panose=[];for(var i=0;i<10;i++){os2.panose[i]=p.parseByte()}os2.ulUnicodeRange1=p.parseULong();os2.ulUnicodeRange2=p.parseULong();os2.ulUnicodeRange3=p.parseULong();os2.ulUnicodeRange4=p.parseULong();os2.achVendID=String.fromCharCode(p.parseByte(),p.parseByte(),p.parseByte(),p.parseByte());os2.fsSelection=p.parseUShort();os2.usFirstCharIndex=p.parseUShort();os2.usLastCharIndex=p.parseUShort();os2.sTypoAscender=p.parseShort();os2.sTypoDescender=p.parseShort();os2.sTypoLineGap=p.parseShort();os2.usWinAscent=p.parseUShort();os2.usWinDescent=p.parseUShort();if(os2.version>=1){os2.ulCodePageRange1=p.parseULong();os2.ulCodePageRange2=p.parseULong()}if(os2.version>=2){os2.sxHeight=p.parseShort();os2.sCapHeight=p.parseShort();os2.usDefaultChar=p.parseUShort();os2.usBreakChar=p.parseUShort();os2.usMaxContent=p.parseUShort()}return os2}function makeOS2Table(options){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],options)}exports.unicodeRanges=unicodeRanges;exports.getUnicodeRange=getUnicodeRange;exports.parse=parseOS2Table;exports.make=makeOS2Table},{"../parse":9,"../table":11}],24:[function(_dereq_,module,exports){"use strict";var encoding=_dereq_("../encoding");var parse=_dereq_("../parse");var table=_dereq_("../table");function parsePostTable(data,start){var post={};var p=new parse.Parser(data,start);var i;post.version=p.parseVersion();post.italicAngle=p.parseFixed();post.underlinePosition=p.parseShort();post.underlineThickness=p.parseShort();post.isFixedPitch=p.parseULong();post.minMemType42=p.parseULong();post.maxMemType42=p.parseULong();post.minMemType1=p.parseULong();post.maxMemType1=p.parseULong();switch(post.version){case 1:post.names=encoding.standardNames.slice();break;case 2:post.numberOfGlyphs=p.parseUShort();post.glyphNameIndex=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.glyphNameIndex[i]=p.parseUShort()}post.names=[];for(i=0;i<post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]>=encoding.standardNames.length){var nameLength=p.parseChar();post.names.push(p.parseString(nameLength))}}break;case 2.5:post.numberOfGlyphs=p.parseUShort();post.offset=new Array(post.numberOfGlyphs);for(i=0;i<post.numberOfGlyphs;i++){post.offset[i]=p.parseChar()}break}return post}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}exports.parse=parsePostTable;exports.make=makePostTable},{"../encoding":4,"../parse":9,"../table":11}],25:[function(_dereq_,module,exports){"use strict";var check=_dereq_("../check");var table=_dereq_("../table");var cmap=_dereq_("./cmap");var cff=_dereq_("./cff");var head=_dereq_("./head");var hhea=_dereq_("./hhea");var hmtx=_dereq_("./hmtx");var maxp=_dereq_("./maxp");var _name=_dereq_("./name");var os2=_dereq_("./os2");var post=_dereq_("./post");function log2(v){return Math.log(v)/Math.log(2)|0}function computeCheckSum(bytes){while(bytes.length%4!==0){bytes.push(0)}var sum=0;for(var i=0;i<bytes.length;i+=4){sum+=(bytes[i]<<24)+(bytes[i+1]<<16)+(bytes[i+2]<<8)+bytes[i+3]}sum%=Math.pow(2,32);return sum}function makeTableRecord(tag,checkSum,offset,length){return new table.Table("Table Record",[{name:"tag",type:"TAG",value:tag!==undefined?tag:""},{name:"checkSum",type:"ULONG",value:checkSum!==undefined?checkSum:0},{name:"offset",type:"ULONG",value:offset!==undefined?offset:0},{name:"length",type:"ULONG",value:length!==undefined?length:0}])}function makeSfntTable(tables){var sfnt=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);sfnt.tables=tables;sfnt.numTables=tables.length;var highestPowerOf2=Math.pow(2,log2(sfnt.numTables));sfnt.searchRange=16*highestPowerOf2;sfnt.entrySelector=log2(highestPowerOf2);sfnt.rangeShift=sfnt.numTables*16-sfnt.searchRange;var recordFields=[];var tableFields=[];var offset=sfnt.sizeOf()+makeTableRecord().sizeOf()*sfnt.numTables;while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}for(var i=0;i<tables.length;i+=1){var t=tables[i];check.argument(t.tableName.length===4,"Table name"+t.tableName+" is invalid.");var tableLength=t.sizeOf();var tableRecord=makeTableRecord(t.tableName,computeCheckSum(t.encode()),offset,tableLength);recordFields.push({name:tableRecord.tag+" Table Record",type:"TABLE",value:tableRecord});tableFields.push({name:t.tableName+" table",type:"TABLE",value:t});offset+=tableLength;check.argument(!isNaN(offset),"Something went wrong calculating the offset.");while(offset%4!==0){offset+=1;tableFields.push({name:"padding",type:"BYTE",value:0})}}recordFields.sort(function(r1,r2){if(r1.value.tag>r2.value.tag){return 1}else{return-1}});sfnt.fields=sfnt.fields.concat(recordFields);sfnt.fields=sfnt.fields.concat(tableFields);return sfnt}function metricsForChar(font,chars,notFoundMetrics){for(var i=0;i<chars.length;i+=1){var glyphIndex=font.charToGlyphIndex(chars[i]);if(glyphIndex>0){var glyph=font.glyphs.get(glyphIndex);return glyph.getMetrics()}}return notFoundMetrics}function average(vs){var sum=0;for(var i=0;i<vs.length;i+=1){sum+=vs[i]}return sum/vs.length}function fontToSfntTable(font){var xMins=[];var yMins=[];var xMaxs=[];var yMaxs=[];var advanceWidths=[];var leftSideBearings=[];var rightSideBearings=[];var firstCharIndex;var lastCharIndex=0;var ulUnicodeRange1=0;var ulUnicodeRange2=0;var ulUnicodeRange3=0;var ulUnicodeRange4=0;for(var i=0;i<font.glyphs.length;i+=1){var glyph=font.glyphs.get(i);var unicode=glyph.unicode|0;if(firstCharIndex>unicode||firstCharIndex===null){firstCharIndex=unicode}if(lastCharIndex<unicode){lastCharIndex=unicode}var position=os2.getUnicodeRange(unicode);if(position<32){ulUnicodeRange1|=1<<position}else if(position<64){ulUnicodeRange2|=1<<position-32}else if(position<96){ulUnicodeRange3|=1<<position-64}else if(position<123){ulUnicodeRange4|=1<<position-96}else{throw new Error("Unicode ranges bits > 123 are reserved for internal usage")}if(glyph.name===".notdef")continue;var metrics=glyph.getMetrics();xMins.push(metrics.xMin);yMins.push(metrics.yMin);xMaxs.push(metrics.xMax);yMaxs.push(metrics.yMax);leftSideBearings.push(metrics.leftSideBearing);rightSideBearings.push(metrics.rightSideBearing);advanceWidths.push(glyph.advanceWidth)}var globals={xMin:Math.min.apply(null,xMins),yMin:Math.min.apply(null,yMins),xMax:Math.max.apply(null,xMaxs),yMax:Math.max.apply(null,yMaxs),advanceWidthMax:Math.max.apply(null,advanceWidths),advanceWidthAvg:average(advanceWidths),minLeftSideBearing:Math.min.apply(null,leftSideBearings),maxLeftSideBearing:Math.max.apply(null,leftSideBearings),minRightSideBearing:Math.min.apply(null,rightSideBearings)};globals.ascender=font.ascender!==undefined?font.ascender:globals.yMax;globals.descender=font.descender!==undefined?font.descender:globals.yMin;var headTable=head.make({unitsPerEm:font.unitsPerEm,xMin:globals.xMin,yMin:globals.yMin,xMax:globals.xMax,yMax:globals.yMax});var hheaTable=hhea.make({ascender:globals.ascender,descender:globals.descender,advanceWidthMax:globals.advanceWidthMax,minLeftSideBearing:globals.minLeftSideBearing,minRightSideBearing:globals.minRightSideBearing,xMaxExtent:globals.maxLeftSideBearing+(globals.xMax-globals.xMin),numberOfHMetrics:font.glyphs.length});var maxpTable=maxp.make(font.glyphs.length);var os2Table=os2.make({xAvgCharWidth:Math.round(globals.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:firstCharIndex,usLastCharIndex:lastCharIndex,ulUnicodeRange1:ulUnicodeRange1,ulUnicodeRange2:ulUnicodeRange2,ulUnicodeRange3:ulUnicodeRange3,ulUnicodeRange4:ulUnicodeRange4,sTypoAscender:globals.ascender,sTypoDescender:globals.descender,sTypoLineGap:0,usWinAscent:globals.ascender,usWinDescent:-globals.descender,sxHeight:metricsForChar(font,"xyvw",{yMax:0}).yMax,sCapHeight:metricsForChar(font,"HIKLEFJMNTZBDPRAGOQSUVWXY",globals).yMax,usBreakChar:font.hasChar(" ")?32:0});var hmtxTable=hmtx.make(font.glyphs);var cmapTable=cmap.make(font.glyphs);var fullName=font.familyName+" "+font.styleName;var postScriptName=font.familyName.replace(/\s/g,"")+"-"+font.styleName;var nameTable=_name.make({copyright:font.copyright,fontFamily:font.familyName,fontSubfamily:font.styleName,uniqueID:font.manufacturer+":"+fullName,fullName:fullName,version:font.version,postScriptName:postScriptName,trademark:font.trademark,manufacturer:font.manufacturer,designer:font.designer,description:font.description,manufacturerURL:font.manufacturerURL,designerURL:font.designerURL,license:font.license,licenseURL:font.licenseURL,preferredFamily:font.familyName,preferredSubfamily:font.styleName});var postTable=post.make();var cffTable=cff.make(font.glyphs,{version:font.version,fullName:fullName,familyName:font.familyName,weightName:font.styleName,postScriptName:postScriptName,unitsPerEm:font.unitsPerEm});var tables=[headTable,hheaTable,maxpTable,os2Table,nameTable,cmapTable,postTable,cffTable,hmtxTable];var sfntTable=makeSfntTable(tables);var bytes=sfntTable.encode();var checkSum=computeCheckSum(bytes);var tableFields=sfntTable.fields;var checkSumAdjusted=false;for(i=0;i<tableFields.length;i+=1){if(tableFields[i].name==="head table"){tableFields[i].value.checkSumAdjustment=2981146554-checkSum;checkSumAdjusted=true;break}}if(!checkSumAdjusted){throw new Error("Could not find head table with checkSum to adjust.")}return sfntTable}exports.computeCheckSum=computeCheckSum;exports.make=makeSfntTable;exports.fontToTable=fontToSfntTable},{"../check":2,"../table":11,"./cff":12,"./cmap":13,"./head":16,"./hhea":17,"./hmtx":18,"./maxp":21,"./name":22,"./os2":23,"./post":24}],26:[function(_dereq_,module,exports){"use strict";var check=_dereq_("./check");var LIMIT16=32768;var LIMIT32=2147483648;var decode={};var encode={};var sizeOf={};function constant(v){return function(){return v}}encode.BYTE=function(v){check.argument(v>=0&&v<=255,"Byte value should be between 0 and 255.");return[v]};sizeOf.BYTE=constant(1);encode.CHAR=function(v){return[v.charCodeAt(0)]};sizeOf.BYTE=constant(1);encode.CHARARRAY=function(v){var b=[];for(var i=0;i<v.length;i+=1){b.push(v.charCodeAt(i))}return b};sizeOf.CHARARRAY=function(v){return v.length};encode.USHORT=function(v){return[v>>8&255,v&255]};sizeOf.USHORT=constant(2);encode.SHORT=function(v){if(v>=LIMIT16){v=-(2*LIMIT16-v)}return[v>>8&255,v&255]};sizeOf.SHORT=constant(2);encode.UINT24=function(v){return[v>>16&255,v>>8&255,v&255]};sizeOf.UINT24=constant(3);encode.ULONG=function(v){
return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.ULONG=constant(4);encode.LONG=function(v){if(v>=LIMIT32){v=-(2*LIMIT32-v)}return[v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(v){check.argument(v.length===4,"Tag should be exactly 4 ASCII characters.");return[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(v){if(v>=-107&&v<=107){return[v+139]}else if(v>=108&&v<=1131){v=v-108;return[(v>>8)+247,v&255]}else if(v>=-1131&&v<=-108){v=-v-108;return[(v>>8)+251,v&255]}else if(v>=-32768&&v<=32767){return encode.NUMBER16(v)}else{return encode.NUMBER32(v)}};sizeOf.NUMBER=function(v){return encode.NUMBER(v).length};encode.NUMBER16=function(v){return[28,v>>8&255,v&255]};sizeOf.NUMBER16=constant(2);encode.NUMBER32=function(v){return[29,v>>24&255,v>>16&255,v>>8&255,v&255]};sizeOf.NUMBER32=constant(4);encode.REAL=function(v){var value=v.toString();var m=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(value);if(m){var epsilon=parseFloat("1e"+((m[2]?+m[2]:0)+m[1].length));value=(Math.round(v*epsilon)/epsilon).toString()}var nibbles="";var i;var ii;for(i=0,ii=value.length;i<ii;i+=1){var c=value[i];if(c==="e"){nibbles+=value[++i]==="-"?"c":"b"}else if(c==="."){nibbles+="a"}else if(c==="-"){nibbles+="e"}else{nibbles+=c}}nibbles+=nibbles.length&1?"f":"ff";var out=[30];for(i=0,ii=nibbles.length;i<ii;i+=2){out.push(parseInt(nibbles.substr(i,2),16))}return out};sizeOf.REAL=function(v){return encode.REAL(v).length};encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;encode.UTF16=function(v){var b=[];for(var i=0;i<v.length;i+=1){b.push(0);b.push(v.charCodeAt(i))}return b};sizeOf.UTF16=function(v){return v.length*2};encode.INDEX=function(l){var i;var offset=1;var offsets=[offset];var data=[];var dataSize=0;for(i=0;i<l.length;i+=1){var v=encode.OBJECT(l[i]);Array.prototype.push.apply(data,v);dataSize+=v.length;offset+=v.length;offsets.push(offset)}if(data.length===0){return[0,0]}var encodedOffsets=[];var offSize=1+Math.floor(Math.log(dataSize)/Math.log(2))/8|0;var offsetEncoder=[undefined,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][offSize];for(i=0;i<offsets.length;i+=1){var encodedOffset=offsetEncoder(offsets[i]);Array.prototype.push.apply(encodedOffsets,encodedOffset)}return Array.prototype.concat(encode.Card16(l.length),encode.OffSize(offSize),encodedOffsets,data)};sizeOf.INDEX=function(v){return encode.INDEX(v).length};encode.DICT=function(m){var d=[];var keys=Object.keys(m);var length=keys.length;for(var i=0;i<length;i+=1){var k=parseInt(keys[i],0);var v=m[k];d=d.concat(encode.OPERAND(v.value,v.type));d=d.concat(encode.OPERATOR(k))}return d};sizeOf.DICT=function(m){return encode.DICT(m).length};encode.OPERATOR=function(v){if(v<1200){return[v]}else{return[12,v-1200]}};encode.OPERAND=function(v,type){var d=[];if(Array.isArray(type)){for(var i=0;i<type.length;i+=1){check.argument(v.length===type.length,"Not enough arguments given for type"+type);d=d.concat(encode.OPERAND(v[i],type[i]))}}else{if(type==="SID"){d=d.concat(encode.NUMBER(v))}else if(type==="offset"){d=d.concat(encode.NUMBER32(v))}else if(type==="number"){d=d.concat(encode.NUMBER(v))}else if(type==="real"){d=d.concat(encode.REAL(v))}else{throw new Error("Unknown operand type "+type)}}return d};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap==="function"&&new WeakMap;encode.CHARSTRING=function(ops){if(wmm&&wmm.has(ops)){return wmm.get(ops)}var d=[];var length=ops.length;for(var i=0;i<length;i+=1){var op=ops[i];d=d.concat(encode[op.type](op.value))}if(wmm){wmm.set(ops,d)}return d};sizeOf.CHARSTRING=function(ops){return encode.CHARSTRING(ops).length};encode.OBJECT=function(v){var encodingFunction=encode[v.type];check.argument(encodingFunction!==undefined,"No encoding function for type "+v.type);return encodingFunction(v.value)};encode.TABLE=function(table){var d=[];var length=table.fields.length;for(var i=0;i<length;i+=1){var field=table.fields[i];var encodingFunction=encode[field.type];check.argument(encodingFunction!==undefined,"No encoding function for field type "+field.type);var value=table[field.name];if(value===undefined){value=field.value}var bytes=encodingFunction(value);d=d.concat(bytes)}return d};encode.LITERAL=function(v){return v};sizeOf.LITERAL=function(v){return v.length};exports.decode=decode;exports.encode=encode;exports.sizeOf=sizeOf},{"./check":2}],27:[function(_dereq_,module,exports){!function(name,context,definition){if(typeof module!="undefined"&&module.exports)module.exports=definition();else if(typeof define=="function"&&define.amd)define(definition);else context[name]=definition()}("reqwest",this,function(){var win=window,doc=document,httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(o){if(o["crossOrigin"]===true){var xhr=win[xmlHttpRequest]?new XMLHttpRequest:null;if(xhr&&"withCredentials"in xhr){return xhr}else if(win[xDomainRequest]){return new XDomainRequest}else{throw new Error("Browser does not support cross-origin requests")}}else if(win[xmlHttpRequest]){return new XMLHttpRequest}else{return new ActiveXObject("Microsoft.XMLHTTP")}},globalSetupOptions={dataFilter:function(data){return data}};function succeed(r){var protocol=protocolRe.exec(r.url);protocol=protocol&&protocol[1]||window.location.protocol;return httpsRe.test(protocol)?twoHundo.test(r.request.status):!!r.request.response}function handleReadyState(r,success,error){return function(){if(r._aborted)return error(r.request);if(r._timedOut)return error(r.request,"Request is aborted: timeout");if(r.request&&r.request[readyState]==4){r.request.onreadystatechange=noop;if(succeed(r))success(r.request);else error(r.request)}}}function setHeaders(http,o){var headers=o["headers"]||{},h;headers["Accept"]=headers["Accept"]||defaultHeaders["accept"][o["type"]]||defaultHeaders["accept"]["*"];var isAFormData=typeof FormData==="function"&&o["data"]instanceof FormData;if(!o["crossOrigin"]&&!headers[requestedWith])headers[requestedWith]=defaultHeaders["requestedWith"];if(!headers[contentType]&&!isAFormData)headers[contentType]=o["contentType"]||defaultHeaders["contentType"];for(h in headers)headers.hasOwnProperty(h)&&"setRequestHeader"in http&&http.setRequestHeader(h,headers[h])}function setCredentials(http,o){if(typeof o["withCredentials"]!=="undefined"&&typeof http.withCredentials!=="undefined"){http.withCredentials=!!o["withCredentials"]}}function generalCallback(data){lastValue=data}function urlappend(url,s){return url+(/\?/.test(url)?"&":"?")+s}function handleJsonp(o,fn,err,url){var reqId=uniqid++,cbkey=o["jsonpCallback"]||"callback",cbval=o["jsonpCallbackName"]||reqwest.getcallbackPrefix(reqId),cbreg=new RegExp("((^|\\?|&)"+cbkey+")=([^&]+)"),match=url.match(cbreg),script=doc.createElement("script"),loaded=0,isIE10=navigator.userAgent.indexOf("MSIE 10.0")!==-1;if(match){if(match[3]==="?"){url=url.replace(cbreg,"$1="+cbval)}else{cbval=match[3]}}else{url=urlappend(url,cbkey+"="+cbval)}win[cbval]=generalCallback;script.type="text/javascript";script.src=url;script.async=true;if(typeof script.onreadystatechange!=="undefined"&&!isIE10){script.htmlFor=script.id="_reqwest_"+reqId}script.onload=script.onreadystatechange=function(){if(script[readyState]&&script[readyState]!=="complete"&&script[readyState]!=="loaded"||loaded){return false}script.onload=script.onreadystatechange=null;script.onclick&&script.onclick();fn(lastValue);lastValue=undefined;head.removeChild(script);loaded=1};head.appendChild(script);return{abort:function(){script.onload=script.onreadystatechange=null;err({},"Request is aborted: timeout",{});lastValue=undefined;head.removeChild(script);loaded=1}}}function getRequest(fn,err){var o=this.o,method=(o["method"]||"GET").toUpperCase(),url=typeof o==="string"?o:o["url"],data=o["processData"]!==false&&o["data"]&&typeof o["data"]!=="string"?reqwest.toQueryString(o["data"]):o["data"]||null,http,sendWait=false;if((o["type"]=="jsonp"||method=="GET")&&data){url=urlappend(url,data);data=null}if(o["type"]=="jsonp")return handleJsonp(o,fn,err,url);http=o.xhr&&o.xhr(o)||xhr(o);http.open(method,url,o["async"]===false?false:true);setHeaders(http,o);setCredentials(http,o);if(win[xDomainRequest]&&http instanceof win[xDomainRequest]){http.onload=fn;http.onerror=err;http.onprogress=function(){};sendWait=true}else{http.onreadystatechange=handleReadyState(this,fn,err)}o["before"]&&o["before"](http);if(sendWait){setTimeout(function(){http.send(data)},200)}else{http.send(data)}return http}function Reqwest(o,fn){this.o=o;this.fn=fn;init.apply(this,arguments)}function setType(header){if(header.match("json"))return"json";if(header.match("javascript"))return"js";if(header.match("text"))return"html";if(header.match("xml"))return"xml"}function init(o,fn){this.url=typeof o=="string"?o:o["url"];this.timeout=null;this._fulfilled=false;this._successHandler=function(){};this._fulfillmentHandlers=[];this._errorHandlers=[];this._completeHandlers=[];this._erred=false;this._responseArgs={};var self=this;fn=fn||function(){};if(o["timeout"]){this.timeout=setTimeout(function(){timedOut()},o["timeout"])}if(o["success"]){this._successHandler=function(){o["success"].apply(o,arguments)}}if(o["error"]){this._errorHandlers.push(function(){o["error"].apply(o,arguments)})}if(o["complete"]){this._completeHandlers.push(function(){o["complete"].apply(o,arguments)})}function complete(resp){o["timeout"]&&clearTimeout(self.timeout);self.timeout=null;while(self._completeHandlers.length>0){self._completeHandlers.shift()(resp)}}function success(resp){var type=o["type"]||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r){switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML;break}}self._responseArgs.resp=resp;self._fulfilled=true;fn(resp);self._successHandler(resp);while(self._fulfillmentHandlers.length>0){resp=self._fulfillmentHandlers.shift()(resp)}complete(resp)}function timedOut(){self._timedOut=true;self.request.abort()}function error(resp,msg,t){resp=self.request;self._responseArgs.resp=resp;self._responseArgs.msg=msg;self._responseArgs.t=t;self._erred=true;while(self._errorHandlers.length>0){self._errorHandlers.shift()(resp,msg,t)}complete(resp)}this.request=getRequest.call(this,success,error)}Reqwest.prototype={abort:function(){this._aborted=true;this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(success,fail){success=success||function(){};fail=fail||function(){};if(this._fulfilled){this._responseArgs.resp=success(this._responseArgs.resp)}else if(this._erred){fail(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t)}else{this._fulfillmentHandlers.push(success);this._errorHandlers.push(fail)}return this},always:function(fn){if(this._fulfilled||this._erred){fn(this._responseArgs.resp)}else{this._completeHandlers.push(fn)}return this},fail:function(fn){if(this._erred){fn(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t)}else{this._errorHandlers.push(fn)}return this},"catch":function(fn){return this.fail(fn)}};function reqwest(o,fn){return new Reqwest(o,fn)}function normalize(s){return s?s.replace(/\r?\n/g,"\r\n"):""}function serial(el,cb){var n=el.name,t=el.tagName.toLowerCase(),optCb=function(o){if(o&&!o["disabled"])cb(n,normalize(o["attributes"]["value"]&&o["attributes"]["value"]["specified"]?o["value"]:o["text"]))},ch,ra,val,i;if(el.disabled||!n)return;switch(t){case"input":if(!/reset|button|image|file/i.test(el.type)){ch=/checkbox/i.test(el.type);ra=/radio/i.test(el.type);val=el.value;(!(ch||ra)||el.checked)&&cb(n,normalize(ch&&val===""?"on":val))}break;case"textarea":cb(n,normalize(el.value));break;case"select":if(el.type.toLowerCase()==="select-one"){optCb(el.selectedIndex>=0?el.options[el.selectedIndex]:null)}else{for(i=0;el.length&&i<el.length;i++){el.options[i].selected&&optCb(el.options[i])}}break}}function eachFormElement(){var cb=this,e,i,serializeSubtags=function(e,tags){var i,j,fa;for(i=0;i<tags.length;i++){fa=e[byTag](tags[i]);for(j=0;j<fa.length;j++)serial(fa[j],cb)}};for(i=0;i<arguments.length;i++){e=arguments[i];if(/input|select|textarea/i.test(e.tagName))serial(e,cb);serializeSubtags(e,["input","select","textarea"])}}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var hash={};eachFormElement.apply(function(name,value){if(name in hash){hash[name]&&!isArray(hash[name])&&(hash[name]=[hash[name]]);hash[name].push(value)}else hash[name]=value},arguments);return hash}reqwest.serializeArray=function(){var arr=[];eachFormElement.apply(function(name,value){arr.push({name:name,value:value})},arguments);return arr};reqwest.serialize=function(){if(arguments.length===0)return"";var opt,fn,args=Array.prototype.slice.call(arguments,0);opt=args.pop();opt&&opt.nodeType&&args.push(opt)&&(opt=null);opt&&(opt=opt.type);if(opt=="map")fn=serializeHash;else if(opt=="array")fn=reqwest.serializeArray;else fn=serializeQueryString;return fn.apply(null,args)};reqwest.toQueryString=function(o,trad){var prefix,i,traditional=trad||false,s=[],enc=encodeURIComponent,add=function(key,value){value="function"===typeof value?value():value==null?"":value;s[s.length]=enc(key)+"="+enc(value)};if(isArray(o)){for(i=0;o&&i<o.length;i++)add(o[i]["name"],o[i]["value"])}else{for(prefix in o){if(o.hasOwnProperty(prefix))buildParams(prefix,o[prefix],traditional,add)}}return s.join("&").replace(/%20/g,"+")};function buildParams(prefix,obj,traditional,add){var name,i,v,rbracket=/\[\]$/;if(isArray(obj)){for(i=0;obj&&i<obj.length;i++){v=obj[i];if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}}}else if(obj&&obj.toString()==="[object Object]"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}reqwest.getcallbackPrefix=function(){return callbackPrefix};reqwest.compat=function(o,fn){if(o){o["type"]&&(o["method"]=o["type"])&&delete o["type"];o["dataType"]&&(o["type"]=o["dataType"]);o["jsonpCallback"]&&(o["jsonpCallbackName"]=o["jsonpCallback"])&&delete o["jsonpCallback"];o["jsonp"]&&(o["jsonpCallback"]=o["jsonp"])}return new Reqwest(o,fn)};reqwest.ajaxSetup=function(options){options=options||{};for(var k in options){globalSetupOptions[k]=options[k]}};return reqwest})},{}],28:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");_dereq_("./p5.Geometry3D");p5.prototype.plane=function(width,height){width=width||50;height=height||50;var detailX=typeof arguments[2]===Number?arguments[2]:1;var detailY=typeof arguments[3]===Number?arguments[3]:1;var gId="plane|"+width+"|"+height+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createPlane=function(u,v){var x=2*width*u-width;var y=2*height*v-height;var z=0;return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createPlane,detailX,detailY);var obj=geometry3d.generateObj();this._renderer.initBuffer(gId,[obj])}this._renderer.drawBuffer(gId)};p5.prototype.sphere=function(radius,detail){radius=radius||50;var detailX=detail||24;var detailY=detail||16;var gId="sphere|"+radius+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createSphere=function(u,v){var theta=2*Math.PI*u;var phi=Math.PI*v-Math.PI/2;var x=radius*Math.cos(phi)*Math.sin(theta);var y=radius*Math.sin(phi);var z=radius*Math.cos(phi)*Math.cos(theta);return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createSphere,detailX,detailY);var obj=geometry3d.generateObj(true,true);this._renderer.initBuffer(gId,[obj])}this._renderer.drawBuffer(gId);return this};p5.prototype.ellipsoid=function(radiusx,radiusy,radiusz,detail){radiusx=radiusx||50;radiusy=radiusy||50;radiusz=radiusz||50;var detailX=detail||24;var detailY=detail||24;var gId="ellipsoid|"+radiusx+"|"+radiusy+"|"+radiusz+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createEllipsoid=function(u,v){var theta=2*Math.PI*u;var phi=Math.PI*v-Math.PI/2;var x=radiusx*Math.cos(phi)*Math.sin(theta);var y=radiusy*Math.sin(phi);var z=radiusz*Math.cos(phi)*Math.cos(theta);return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createEllipsoid,detailX,detailY);var obj=geometry3d.generateObj(true,true);this._renderer.initBuffer(gId,[obj])}this._renderer.drawBuffer(gId);return this};p5.prototype.cylinder=function(radius,height,detail){radius=radius||50;height=height||50;var detailX=detail||24;var detailY=detail||16;var gId="cylinder|"+radius+"|"+height+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createCylinder=function(u,v){var theta=2*Math.PI*u;var x=radius*Math.sin(theta);var y=2*height*v-height;var z=radius*Math.cos(theta);return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createCylinder,detailX,detailY);var obj=geometry3d.generateObj(true);var createTop=function(u,v){var theta=2*Math.PI*u;var x=radius*Math.sin(-theta);var y=height;var z=radius*Math.cos(theta);if(v===0){return new p5.Vector(0,height,0)}else{return new p5.Vector(x,y,z)}};var geometry3d1=new p5.Geometry3D;geometry3d1.parametricGeometry(createTop,detailX,1);var obj1=geometry3d1.generateObj();var createBottom=function(u,v){var theta=2*Math.PI*u;var x=radius*Math.sin(theta);var y=-height;var z=radius*Math.cos(theta);if(v===0){return new p5.Vector(0,-height,0)}else{return new p5.Vector(x,y,z)}};var geometry3d2=new p5.Geometry3D;geometry3d2.parametricGeometry(createBottom,detailX,1);var obj2=geometry3d2.generateObj();this._renderer.initBuffer(gId,[obj,obj1,obj2])}this._renderer.drawBuffer(gId);return this};p5.prototype.cone=function(radius,height,detail){radius=radius||50;height=height||50;var detailX=detail||24;var detailY=detail||16;var gId="cone|"+radius+"|"+height+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createCone=function(u,v){var theta=2*Math.PI*u;var x=radius*(1-v)*Math.sin(theta);var y=2*height*v-height;var z=radius*(1-v)*Math.cos(theta);return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createCone,detailX,detailY);var obj=geometry3d.generateObj(true);var geometry3d1=new p5.Geometry3D;var createBottom=function(u,v){var theta=2*Math.PI*u;var x=radius*(1-v)*Math.sin(-theta);var y=-height;var z=radius*(1-v)*Math.cos(theta);return new p5.Vector(x,y,z)};geometry3d1.parametricGeometry(createBottom,detailX,1);var obj1=geometry3d1.generateObj();this._renderer.initBuffer(gId,[obj,obj1])}this._renderer.drawBuffer(gId);return this};p5.prototype.torus=function(radius,tubeRadius,detail){radius=radius||50;tubeRadius=tubeRadius||10;var detailX=detail||24;var detailY=detail||16;var gId="torus|"+radius+"|"+tubeRadius+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createTorus=function(u,v){var theta=2*Math.PI*u;var phi=2*Math.PI*v;var x=(radius+tubeRadius*Math.cos(phi))*Math.cos(theta);var y=(radius+tubeRadius*Math.cos(phi))*Math.sin(theta);var z=tubeRadius*Math.sin(phi);return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createTorus,detailX,detailY);var obj=geometry3d.generateObj(true);this._renderer.initBuffer(gId,[obj])}this._renderer.drawBuffer(gId);return this};p5.prototype.box=function(width,height,depth){width=width||50;height=height||width;depth=depth||width;var detailX=typeof arguments[3]===Number?arguments[3]:1;var detailY=typeof arguments[4]===Number?arguments[4]:1;var gId="cube|"+width+"|"+height+"|"+depth+"|"+detailX+"|"+detailY;if(!this._renderer.geometryInHash(gId)){var geometry3d=new p5.Geometry3D;var createPlane1=function(u,v){var x=2*width*u-width;var y=2*height*v-height;var z=depth;return new p5.Vector(x,y,z)};var createPlane2=function(u,v){var x=2*width*(1-u)-width;var y=2*height*v-height;var z=-depth;return new p5.Vector(x,y,z)};var createPlane3=function(u,v){var x=2*width*(1-u)-width;var y=height;var z=2*depth*v-depth;return new p5.Vector(x,y,z)};var createPlane4=function(u,v){var x=2*width*u-width;var y=-height;var z=2*depth*v-depth;return new p5.Vector(x,y,z)};var createPlane5=function(u,v){var x=width;var y=2*height*u-height;var z=2*depth*v-depth;return new p5.Vector(x,y,z)};var createPlane6=function(u,v){var x=-width;var y=2*height*(1-u)-height;var z=2*depth*v-depth;return new p5.Vector(x,y,z)};geometry3d.parametricGeometry(createPlane1,detailX,detailY,geometry3d.vertices.length);geometry3d.parametricGeometry(createPlane2,detailX,detailY,geometry3d.vertices.length);geometry3d.parametricGeometry(createPlane3,detailX,detailY,geometry3d.vertices.length);geometry3d.parametricGeometry(createPlane4,detailX,detailY,geometry3d.vertices.length);geometry3d.parametricGeometry(createPlane5,detailX,detailY,geometry3d.vertices.length);geometry3d.parametricGeometry(createPlane6,detailX,detailY,geometry3d.vertices.length);var obj=geometry3d.generateObj();this._renderer.initBuffer(gId,[obj])}this._renderer.drawBuffer(gId);return this};module.exports=p5},{"../core/core":48,"./p5.Geometry3D":34}],29:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.camera=function(x,y,z){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("camera",args,["Number","Number","Number"]);this._renderer.translate(-x,-y,-z)};p5.prototype.perspective=function(fovy,aspect,near,far){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("perspective",args,["Number","Number","Number","Number"]);this._renderer.uPMatrix=p5.Matrix.identity();this._renderer.uPMatrix.perspective(fovy,aspect,near,far);this._renderer._setCamera=true};p5.prototype.ortho=function(left,right,bottom,top,near,far){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("ortho",args,["Number","Number","Number","Number","Number","Number"]);left/=this.width;right/=this.width;top/=this.height;bottom/=this.height;this._renderer.uPMatrix=p5.Matrix.identity();this._renderer.uPMatrix.ortho(left,right,bottom,top,near,far);this._renderer._setCamera=true};module.exports=p5},{"../core/core":48}],30:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.Renderer3D.prototype._primitives2D=function(arr){this._setDefaultCamera();var gl=this.GL;var shaderProgram=this._getColorVertexShader();var vertexPositionBuffer=this.verticeBuffer;gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(arr),gl.STATIC_DRAW);gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,3,gl.FLOAT,false,0,0);var vertexColorBuffer=this.colorBuffer;gl.bindBuffer(gl.ARRAY_BUFFER,vertexColorBuffer);var color=this._getCurColor();var colors=[];for(var i=0;i<arr.length/3;i++){colors=colors.concat(color)}gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(colors),gl.STATIC_DRAW);gl.vertexAttribPointer(shaderProgram.vertexColorAttribute,4,gl.FLOAT,false,0,0);var mId="vertexColorVert|vertexColorFrag";this.setMatrixUniforms(mId)};p5.Renderer3D.prototype.point=function(x,y,z){var gl=this.GL;this._primitives2D([x,y,z]);gl.drawArrays(gl.POINTS,0,1);return this};p5.Renderer3D.prototype.line=function(x1,y1,z1,x2,y2,z2){var gl=this.GL;this._primitives2D([x1,y1,z1,x2,y2,z2]);gl.drawArrays(gl.LINES,0,2);return this};p5.Renderer3D.prototype.triangle=function(x1,y1,z1,x2,y2,z2,x3,y3,z3){var gl=this.GL;this._primitives2D([x1,y1,z1,x2,y2,z2,x3,y3,z3]);this._strokeCheck();gl.drawArrays(gl.TRIANGLES,0,3);return this};p5.Renderer3D.prototype.quad=function(x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4){var gl=this.GL;this._primitives2D([x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4]);this._strokeCheck();gl.drawArrays(gl.TRIANGLE_STRIP,0,4);return this};p5.Renderer3D.prototype.beginShape=function(mode){this.shapeMode=mode;this.verticeStack=[];return this};p5.Renderer3D.prototype.vertex=function(x,y,z){this.verticeStack.push(x,y,z);return this};p5.Renderer3D.prototype.endShape=function(){var gl=this.GL;this._primitives2D(this.verticeStack);this.verticeStack=[];switch(this.shapeMode){case"POINTS":gl.drawArrays(gl.POINTS,0,1);break;case"LINES":gl.drawArrays(gl.LINES,0,2);break;case"TRIANGLES":this._strokeCheck();gl.drawArrays(gl.TRIANGLES,0,3);break;case"TRIANGLE_STRIP":this._strokeCheck();gl.drawArrays(gl.TRIANGLE_STRIP,0,4);break;default:this._strokeCheck();gl.drawArrays(gl.TRIANGLES,0,3);break}return this};p5.Renderer3D.prototype._strokeCheck=function(){if(this.drawMode==="stroke"){throw new Error("stroke for shapes in 3D not yet implemented, use fill for now :(")}};p5.Renderer3D.prototype.strokeWeight=function(){throw new Error("strokeWeight for 3d not yet implemented")};p5.Renderer3D.prototype.fill=function(r,g,b,a){var color=this._pInst.color.apply(this,arguments);var colorNormalized=color._array;this.curColor=colorNormalized;this.drawMode="fill";return this};p5.Renderer3D.prototype.stroke=function(r,g,b,a){var color=this._pInst.color.apply(this,arguments);var colorNormalized=color._array;this.curColor=colorNormalized;this.drawMode="stroke";return this};p5.Renderer3D.prototype._getColorVertexShader=function(){var gl=this.GL;var mId="vertexColorVert|vertexColorFrag";var shaderProgram;if(!this.materialInHash(mId)){shaderProgram=this.initShaders("vertexColorVert","vertexColorFrag",true);this.mHash[mId]=shaderProgram;shaderProgram.vertexColorAttribute=gl.getAttribLocation(shaderProgram,"aVertexColor");gl.enableVertexAttribArray(shaderProgram.vertexColorAttribute)}else{shaderProgram=this.mHash[mId]}return shaderProgram};module.exports=p5.Renderer3D},{"../core/core":48}],31:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.orbitControl=function(){if(this.mouseIsPressed){this.rotateY((this.mouseX-this.width/2)/(this.width/2));this.rotateX((this.mouseY-this.height/2)/(this.width/2))}return this};module.exports=p5},{"../core/core":48}],32:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.ambientLight=function(v1,v2,v3,a){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.useProgram(shaderProgram);shaderProgram.uAmbientColor=gl.getUniformLocation(shaderProgram,"uAmbientColor["+this._renderer.ambientLightCount+"]");var color=this._renderer._pInst.color.apply(this._renderer._pInst,arguments);var colors=color._array;gl.uniform3f(shaderProgram.uAmbientColor,colors[0],colors[1],colors[2]);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");gl.uniform4f(shaderProgram.uMaterialColor,1,1,1,1);this._renderer.ambientLightCount++;shaderProgram.uAmbientLightCount=gl.getUniformLocation(shaderProgram,"uAmbientLightCount");gl.uniform1i(shaderProgram.uAmbientLightCount,this._renderer.ambientLightCount);return this};p5.prototype.directionalLight=function(v1,v2,v3,a,x,y,z){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.useProgram(shaderProgram);shaderProgram.uDirectionalColor=gl.getUniformLocation(shaderProgram,"uDirectionalColor["+this._renderer.directionalLightCount+"]");var color=this._renderer._pInst.color.apply(this._renderer._pInst,[v1,v2,v3]);var colors=color._array;gl.uniform3f(shaderProgram.uDirectionalColor,colors[0],colors[1],colors[2]);var _x,_y,_z;if(typeof arguments[arguments.length-1]==="number"){_x=arguments[arguments.length-3];_y=arguments[arguments.length-2];_z=arguments[arguments.length-1]}else{try{_x=arguments[arguments.length-1].x;_y=arguments[arguments.length-1].y;_z=arguments[arguments.length-1].z}catch(error){throw error}}shaderProgram.uLightingDirection=gl.getUniformLocation(shaderProgram,"uLightingDirection["+this._renderer.directionalLightCount+"]");gl.uniform3f(shaderProgram.uLightingDirection,_x,_y,_z);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");gl.uniform4f(shaderProgram.uMaterialColor,1,1,1,1);this._renderer.directionalLightCount++;shaderProgram.uDirectionalLightCount=gl.getUniformLocation(shaderProgram,"uDirectionalLightCount");gl.uniform1i(shaderProgram.uDirectionalLightCount,this._renderer.directionalLightCount);return this};p5.prototype.pointLight=function(v1,v2,v3,a,x,y,z){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.useProgram(shaderProgram);shaderProgram.uPointLightColor=gl.getUniformLocation(shaderProgram,"uPointLightColor["+this._renderer.pointLightCount+"]");var color=this._renderer._pInst.color.apply(this._renderer._pInst,[v1,v2,v3]);var colors=color._array;gl.uniform3f(shaderProgram.uPointLightColor,colors[0],colors[1],colors[2]);var _x,_y,_z;if(typeof arguments[arguments.length-1]==="number"){_x=arguments[arguments.length-3];_y=arguments[arguments.length-2];_z=arguments[arguments.length-1]}else{try{_x=arguments[arguments.length-1].x;_y=arguments[arguments.length-1].y;_z=arguments[arguments.length-1].z}catch(error){throw error}}shaderProgram.uPointLightLocation=gl.getUniformLocation(shaderProgram,"uPointLightLocation["+this._renderer.pointLightCount+"]");gl.uniform3f(shaderProgram.uPointLightLocation,_x,_y,_z);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");gl.uniform4f(shaderProgram.uMaterialColor,1,1,1,1);this._renderer.pointLightCount++;shaderProgram.uPointLightCount=gl.getUniformLocation(shaderProgram,"uPointLightCount");gl.uniform1i(shaderProgram.uPointLightCount,this._renderer.pointLightCount);return this};module.exports=p5},{"../core/core":48}],33:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.normalMaterial=function(){this._renderer._getShader("normalVert","normalFrag");return this};p5.prototype.texture=function(image){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.useProgram(shaderProgram);if(image instanceof p5.Image){if(!image.isTexture){var tex=gl.createTexture();image.createTexture(tex);gl.bindTexture(gl.TEXTURE_2D,tex);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1);image._setProperty("isTexture",true)}else{}image.loadPixels();var data=new Uint8Array(image.pixels);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,image.width,image.height,0,gl.RGBA,gl.UNSIGNED_BYTE,data)}else if(image instanceof p5.MediaElement){
if(!image.loadedmetadata){return}gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image.elt)}else{}if(_isPowerOf2(image.width)&&_isPowerOf2(image.height)){gl.generateMipmap(gl.TEXTURE_2D)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}gl.uniform1i(gl.getUniformLocation(shaderProgram,"uSampler"),0);gl.uniform1i(gl.getUniformLocation(shaderProgram,"isTexture"),true);return this};function _isPowerOf2(value){return(value&value-1)===0}p5.prototype.basicMaterial=function(v1,v2,v3,a){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("normalVert","basicFrag");gl.useProgram(shaderProgram);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");var color=this._renderer._pInst.color.apply(this._renderer._pInst,arguments);var colors=color._array;gl.uniform4f(shaderProgram.uMaterialColor,colors[0],colors[1],colors[2],colors[3]);return this};p5.prototype.ambientMaterial=function(v1,v2,v3,a){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.useProgram(shaderProgram);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");var color=this._renderer._pInst.color.apply(this._renderer._pInst,arguments);var colors=color._array;gl.uniform4f(shaderProgram.uMaterialColor,colors[0],colors[1],colors[2],colors[3]);shaderProgram.uSpecular=gl.getUniformLocation(shaderProgram,"uSpecular");gl.uniform1i(shaderProgram.uSpecular,false);gl.uniform1i(gl.getUniformLocation(shaderProgram,"isTexture"),false);return this};p5.prototype.specularMaterial=function(v1,v2,v3,a){var gl=this._renderer.GL;var shaderProgram=this._renderer._getShader("lightVert","lightTextureFrag");gl.uniform1i(gl.getUniformLocation(shaderProgram,"isTexture"),false);gl.useProgram(shaderProgram);shaderProgram.uMaterialColor=gl.getUniformLocation(shaderProgram,"uMaterialColor");var color=this._renderer._pInst.color.apply(this._renderer._pInst,arguments);var colors=color._array;gl.uniform4f(shaderProgram.uMaterialColor,colors[0],colors[1],colors[2],colors[3]);shaderProgram.uSpecular=gl.getUniformLocation(shaderProgram,"uSpecular");gl.uniform1i(shaderProgram.uSpecular,true);return this};module.exports=p5},{"../core/core":48}],34:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.Geometry3D=function(){this.vertices=[];this.vertexNormals=[];this.faces=[];this.faceNormals=[];this.uvs=[]};p5.Geometry3D.prototype.parametricGeometry=function(func,detailX,detailY,offset){var i,j,p;var u,v;offset=offset||0;this.detailX=detailX;this.detailY=detailY;var sliceCount=detailX+1;for(i=0;i<=detailY;i++){v=i/detailY;for(j=0;j<=detailX;j++){u=j/detailX;p=func(u,v);this.vertices.push(p)}}var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<detailY;i++){for(j=0;j<detailX;j++){a=i*sliceCount+j+offset;b=i*sliceCount+j+1+offset;c=(i+1)*sliceCount+j+1+offset;d=(i+1)*sliceCount+j+offset;uva=[j/detailX,i/detailY];uvb=[(j+1)/detailX,i/detailY];uvc=[(j+1)/detailX,(i+1)/detailY];uvd=[j/detailX,(i+1)/detailY];this.faces.push([a,b,d]);this.uvs.push([uva,uvb,uvd]);this.faces.push([b,c,d]);this.uvs.push([uvb,uvc,uvd])}}};p5.Geometry3D.prototype.computeFaceNormals=function(){var cb=new p5.Vector;var ab=new p5.Vector;for(var f=0;f<this.faces.length;f++){var face=this.faces[f];var vA=this.vertices[face[0]];var vB=this.vertices[face[1]];var vC=this.vertices[face[2]];p5.Vector.sub(vC,vB,cb);p5.Vector.sub(vA,vB,ab);var normal=p5.Vector.cross(ab,cb);normal.normalize();normal.mult(-1);this.faceNormals[f]=normal}};p5.Geometry3D.prototype.computeVertexNormals=function(){var v,f,face,faceNormal,vertices;var vertexNormals=[];vertices=new Array(this.vertices.length);for(v=0;v<this.vertices.length;v++){vertices[v]=new p5.Vector}for(f=0;f<this.faces.length;f++){face=this.faces[f];faceNormal=this.faceNormals[f];vertices[face[0]].add(faceNormal);vertices[face[1]].add(faceNormal);vertices[face[2]].add(faceNormal)}for(v=0;v<this.vertices.length;v++){vertices[v].normalize()}for(f=0;f<this.faces.length;f++){face=this.faces[f];vertexNormals[f]=[];vertexNormals[f][0]=vertices[face[0]].copy();vertexNormals[f][1]=vertices[face[1]].copy();vertexNormals[f][2]=vertices[face[2]].copy()}for(f=0;f<this.faces.length;f++){face=this.faces[f];faceNormal=this.faceNormals[f];this.vertexNormals[face[0]]=vertexNormals[f][0];this.vertexNormals[face[1]]=vertexNormals[f][1];this.vertexNormals[face[2]]=vertexNormals[f][2]}};p5.Geometry3D.prototype.averageNormals=function(){for(var i=0;i<=this.detailY;i++){var offset=this.detailX+1;var temp=p5.Vector.add(this.vertexNormals[i*offset],this.vertexNormals[i*offset+this.detailX]);temp=p5.Vector.div(temp,2);this.vertexNormals[i*offset]=temp;this.vertexNormals[i*offset+this.detailX]=temp}};p5.Geometry3D.prototype.averagePoleNormals=function(){var sum=new p5.Vector(0,0,0);for(var i=0;i<this.detailX;i++){sum.add(this.vertexNormals[i])}sum=p5.Vector.div(sum,this.detailX);for(i=0;i<this.detailX;i++){this.vertexNormals[i]=sum}sum=new p5.Vector(0,0,0);for(i=this.vertices.length-1;i>this.vertices.length-1-this.detailX;i--){sum.add(this.vertexNormals[i])}sum=p5.Vector.div(sum,this.detailX);for(i=this.vertices.length-1;i>this.vertices.length-1-this.detailX;i--){this.vertexNormals[i]=sum}};p5.Geometry3D.prototype.generateUV=function(faces,uvs){faces=flatten(faces);uvs=flatten(uvs);var arr=[];faces.forEach(function(item,index){arr[item]=uvs[index]});return flatten(arr)};p5.Geometry3D.prototype.generateObj=function(average,sphere){this.computeFaceNormals();this.computeVertexNormals();if(average){this.averageNormals()}if(sphere){this.averagePoleNormals()}var obj={vertices:turnVectorArrayIntoNumberArray(this.vertices),vertexNormals:turnVectorArrayIntoNumberArray(this.vertexNormals),uvs:this.generateUV(this.faces,this.uvs),faces:flatten(this.faces),len:this.faces.length*3};return obj};function flatten(arr){return arr.reduce(function(a,b){return a.concat(b)})}function turnVectorArrayIntoNumberArray(arr){return flatten(arr.map(function(item){return[item.x,item.y,item.z]}))}module.exports=p5.Geometry3D},{"../core/core":48}],35:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var polarGeometry=_dereq_("../math/polargeometry");var constants=_dereq_("../core/constants");var GLMAT_ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;p5.Matrix=function(){if(arguments[0]instanceof p5){this.p5=arguments[0];this.mat4=arguments[1]||new GLMAT_ARRAY_TYPE([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}else{this.mat4=arguments[0]||new GLMAT_ARRAY_TYPE([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return this};p5.Matrix.prototype.set=function(inMatrix){if(inMatrix instanceof p5.Matrix){this.mat4=inMatrix.mat4;return this}else if(inMatrix instanceof GLMAT_ARRAY_TYPE){this.mat4=inMatrix;return this}return this};p5.Matrix.prototype.get=function(){return new p5.Matrix(this.mat4)};p5.Matrix.prototype.copy=function(){var copied=new p5.Matrix;copied.mat4[0]=this.mat4[0];copied.mat4[1]=this.mat4[1];copied.mat4[2]=this.mat4[2];copied.mat4[3]=this.mat4[3];copied.mat4[4]=this.mat4[4];copied.mat4[5]=this.mat4[5];copied.mat4[6]=this.mat4[6];copied.mat4[7]=this.mat4[7];copied.mat4[8]=this.mat4[8];copied.mat4[9]=this.mat4[9];copied.mat4[10]=this.mat4[10];copied.mat4[11]=this.mat4[11];copied.mat4[12]=this.mat4[12];copied.mat4[13]=this.mat4[13];copied.mat4[14]=this.mat4[14];copied.mat4[15]=this.mat4[15];return copied};p5.Matrix.identity=function(){return new p5.Matrix};p5.Matrix.prototype.transpose=function(a){var a01,a02,a03,a12,a13,a23;if(a instanceof p5.Matrix){a01=a.mat4[1];a02=a.mat4[2];a03=a.mat4[3];a12=a.mat4[6];a13=a.mat4[7];a23=a.mat4[11];this.mat4[0]=a.mat4[0];this.mat4[1]=a.mat4[4];this.mat4[2]=a.mat4[8];this.mat4[3]=a.mat4[12];this.mat4[4]=a01;this.mat4[5]=a.mat4[5];this.mat4[6]=a.mat4[9];this.mat4[7]=a.mat4[13];this.mat4[8]=a02;this.mat4[9]=a12;this.mat4[10]=a.mat4[10];this.mat4[11]=a.mat4[14];this.mat4[12]=a03;this.mat4[13]=a13;this.mat4[14]=a23;this.mat4[15]=a.mat4[15]}else if(a instanceof GLMAT_ARRAY_TYPE){a01=a[1];a02=a[2];a03=a[3];a12=a[6];a13=a[7];a23=a[11];this.mat4[0]=a[0];this.mat4[1]=a[4];this.mat4[2]=a[8];this.mat4[3]=a[12];this.mat4[4]=a01;this.mat4[5]=a[5];this.mat4[6]=a[9];this.mat4[7]=a[13];this.mat4[8]=a02;this.mat4[9]=a12;this.mat4[10]=a[10];this.mat4[11]=a[14];this.mat4[12]=a03;this.mat4[13]=a13;this.mat4[14]=a23;this.mat4[15]=a[15]}return this};p5.Matrix.prototype.invert=function(a){var a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,a30,a31,a32,a33;if(a instanceof p5.Matrix){a00=a.mat4[0];a01=a.mat4[1];a02=a.mat4[2];a03=a.mat4[3];a10=a.mat4[4];a11=a.mat4[5];a12=a.mat4[6];a13=a.mat4[7];a20=a.mat4[8];a21=a.mat4[9];a22=a.mat4[10];a23=a.mat4[11];a30=a.mat4[12];a31=a.mat4[13];a32=a.mat4[14];a33=a.mat4[15]}else if(a instanceof GLMAT_ARRAY_TYPE){a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];a30=a[12];a31=a[13];a32=a[14];a33=a[15]}var b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;this.mat4[0]=(a11*b11-a12*b10+a13*b09)*det;this.mat4[1]=(a02*b10-a01*b11-a03*b09)*det;this.mat4[2]=(a31*b05-a32*b04+a33*b03)*det;this.mat4[3]=(a22*b04-a21*b05-a23*b03)*det;this.mat4[4]=(a12*b08-a10*b11-a13*b07)*det;this.mat4[5]=(a00*b11-a02*b08+a03*b07)*det;this.mat4[6]=(a32*b02-a30*b05-a33*b01)*det;this.mat4[7]=(a20*b05-a22*b02+a23*b01)*det;this.mat4[8]=(a10*b10-a11*b08+a13*b06)*det;this.mat4[9]=(a01*b08-a00*b10-a03*b06)*det;this.mat4[10]=(a30*b04-a31*b02+a33*b00)*det;this.mat4[11]=(a21*b02-a20*b04-a23*b00)*det;this.mat4[12]=(a11*b07-a10*b09-a12*b06)*det;this.mat4[13]=(a00*b09-a01*b07+a02*b06)*det;this.mat4[14]=(a31*b01-a30*b03-a32*b00)*det;this.mat4[15]=(a20*b03-a21*b01+a22*b00)*det;return this};p5.Matrix.prototype.determinant=function(){var d00=this.mat4[0]*this.mat4[5]-this.mat4[1]*this.mat4[4],d01=this.mat4[0]*this.mat4[6]-this.mat4[2]*this.mat4[4],d02=this.mat4[0]*this.mat4[7]-this.mat4[3]*this.mat4[4],d03=this.mat4[1]*this.mat4[6]-this.mat4[2]*this.mat4[5],d04=this.mat4[1]*this.mat4[7]-this.mat4[3]*this.mat4[5],d05=this.mat4[2]*this.mat4[7]-this.mat4[3]*this.mat4[6],d06=this.mat4[8]*this.mat4[13]-this.mat4[9]*this.mat4[12],d07=this.mat4[8]*this.mat4[14]-this.mat4[10]*this.mat4[12],d08=this.mat4[8]*this.mat4[15]-this.mat4[11]*this.mat4[12],d09=this.mat4[9]*this.mat4[14]-this.mat4[10]*this.mat4[13],d10=this.mat4[9]*this.mat4[15]-this.mat4[11]*this.mat4[13],d11=this.mat4[10]*this.mat4[15]-this.mat4[11]*this.mat4[14];return d00*d11-d01*d10+d02*d09+d03*d08-d04*d07+d05*d06};p5.Matrix.prototype.mult=function(multMatrix){var _dest=new GLMAT_ARRAY_TYPE(16);var _src=new GLMAT_ARRAY_TYPE(16);if(multMatrix instanceof p5.Matrix){_src=multMatrix.mat4}else if(multMatrix instanceof GLMAT_ARRAY_TYPE){_src=multMatrix}var b0=this.mat4[0],b1=this.mat4[1],b2=this.mat4[2],b3=this.mat4[3];_dest[0]=b0*_src[0]+b1*_src[4]+b2*_src[8]+b3*_src[12];_dest[1]=b0*_src[1]+b1*_src[5]+b2*_src[9]+b3*_src[13];_dest[2]=b0*_src[2]+b1*_src[6]+b2*_src[10]+b3*_src[14];_dest[3]=b0*_src[3]+b1*_src[7]+b2*_src[11]+b3*_src[15];b0=this.mat4[4];b1=this.mat4[5];b2=this.mat4[6];b3=this.mat4[7];_dest[4]=b0*_src[0]+b1*_src[4]+b2*_src[8]+b3*_src[12];_dest[5]=b0*_src[1]+b1*_src[5]+b2*_src[9]+b3*_src[13];_dest[6]=b0*_src[2]+b1*_src[6]+b2*_src[10]+b3*_src[14];_dest[7]=b0*_src[3]+b1*_src[7]+b2*_src[11]+b3*_src[15];b0=this.mat4[8];b1=this.mat4[9];b2=this.mat4[10];b3=this.mat4[11];_dest[8]=b0*_src[0]+b1*_src[4]+b2*_src[8]+b3*_src[12];_dest[9]=b0*_src[1]+b1*_src[5]+b2*_src[9]+b3*_src[13];_dest[10]=b0*_src[2]+b1*_src[6]+b2*_src[10]+b3*_src[14];_dest[11]=b0*_src[3]+b1*_src[7]+b2*_src[11]+b3*_src[15];b0=this.mat4[12];b1=this.mat4[13];b2=this.mat4[14];b3=this.mat4[15];_dest[12]=b0*_src[0]+b1*_src[4]+b2*_src[8]+b3*_src[12];_dest[13]=b0*_src[1]+b1*_src[5]+b2*_src[9]+b3*_src[13];_dest[14]=b0*_src[2]+b1*_src[6]+b2*_src[10]+b3*_src[14];_dest[15]=b0*_src[3]+b1*_src[7]+b2*_src[11]+b3*_src[15];this.mat4=_dest;return this};p5.Matrix.prototype.scale=function(){var x,y,z;var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}if(args[0]instanceof p5.Vector){x=args[0].x;y=args[0].y;z=args[0].z}else if(args[0]instanceof Array){x=args[0][0];y=args[0][1];z=args[0][2]}var _dest=new GLMAT_ARRAY_TYPE(16);_dest[0]=this.mat4[0]*x;_dest[1]=this.mat4[1]*x;_dest[2]=this.mat4[2]*x;_dest[3]=this.mat4[3]*x;_dest[4]=this.mat4[4]*y;_dest[5]=this.mat4[5]*y;_dest[6]=this.mat4[6]*y;_dest[7]=this.mat4[7]*y;_dest[8]=this.mat4[8]*z;_dest[9]=this.mat4[9]*z;_dest[10]=this.mat4[10]*z;_dest[11]=this.mat4[11]*z;_dest[12]=this.mat4[12];_dest[13]=this.mat4[13];_dest[14]=this.mat4[14];_dest[15]=this.mat4[15];this.mat4=_dest;return this};p5.Matrix.prototype.rotate=function(a,axis){var x,y,z,_a,len;if(this.p5){if(this.p5._angleMode===constants.DEGREES){_a=polarGeometry.degreesToRadians(a)}}else{_a=a}if(axis instanceof p5.Vector){x=axis.x;y=axis.y;z=axis.z}else if(axis instanceof Array){x=axis[0];y=axis[1];z=axis[2]}len=Math.sqrt(x*x+y*y+z*z);x*=1/len;y*=1/len;z*=1/len;var a00=this.mat4[0];var a01=this.mat4[1];var a02=this.mat4[2];var a03=this.mat4[3];var a10=this.mat4[4];var a11=this.mat4[5];var a12=this.mat4[6];var a13=this.mat4[7];var a20=this.mat4[8];var a21=this.mat4[9];var a22=this.mat4[10];var a23=this.mat4[11];var sA=Math.sin(_a);var cA=Math.cos(_a);var tA=1-cA;var b00=x*x*tA+cA;var b01=y*x*tA+z*sA;var b02=z*x*tA-y*sA;var b10=x*y*tA-z*sA;var b11=y*y*tA+cA;var b12=z*y*tA+x*sA;var b20=x*z*tA+y*sA;var b21=y*z*tA-x*sA;var b22=z*z*tA+cA;this.mat4[0]=a00*b00+a10*b01+a20*b02;this.mat4[1]=a01*b00+a11*b01+a21*b02;this.mat4[2]=a02*b00+a12*b01+a22*b02;this.mat4[3]=a03*b00+a13*b01+a23*b02;this.mat4[4]=a00*b10+a10*b11+a20*b12;this.mat4[5]=a01*b10+a11*b11+a21*b12;this.mat4[6]=a02*b10+a12*b11+a22*b12;this.mat4[7]=a03*b10+a13*b11+a23*b12;this.mat4[8]=a00*b20+a10*b21+a20*b22;this.mat4[9]=a01*b20+a11*b21+a21*b22;this.mat4[10]=a02*b20+a12*b21+a22*b22;this.mat4[11]=a03*b20+a13*b21+a23*b22;return this};p5.Matrix.prototype.translate=function(v){var x=v[0],y=v[1],z=v[2]||0;this.mat4[12]=this.mat4[0]*x+this.mat4[4]*y+this.mat4[8]*z+this.mat4[12];this.mat4[13]=this.mat4[1]*x+this.mat4[5]*y+this.mat4[9]*z+this.mat4[13];this.mat4[14]=this.mat4[2]*x+this.mat4[6]*y+this.mat4[10]*z+this.mat4[14];this.mat4[15]=this.mat4[3]*x+this.mat4[7]*y+this.mat4[11]*z+this.mat4[15]};p5.Matrix.prototype.rotateX=function(a){this.rotate(a,[1,0,0])};p5.Matrix.prototype.rotateY=function(a){this.rotate(a,[0,1,0])};p5.Matrix.prototype.rotateZ=function(a){this.rotate(a,[0,0,1])};p5.Matrix.prototype.perspective=function(fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);this.mat4[0]=f/aspect;this.mat4[1]=0;this.mat4[2]=0;this.mat4[3]=0;this.mat4[4]=0;this.mat4[5]=f;this.mat4[6]=0;this.mat4[7]=0;this.mat4[8]=0;this.mat4[9]=0;this.mat4[10]=(far+near)*nf;this.mat4[11]=-1;this.mat4[12]=0;this.mat4[13]=0;this.mat4[14]=2*far*near*nf;this.mat4[15]=0;return this};p5.Matrix.prototype.ortho=function(left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);this.mat4[0]=-2*lr;this.mat4[1]=0;this.mat4[2]=0;this.mat4[3]=0;this.mat4[4]=0;this.mat4[5]=-2*bt;this.mat4[6]=0;this.mat4[7]=0;this.mat4[8]=0;this.mat4[9]=0;this.mat4[10]=2*nf;this.mat4[11]=0;this.mat4[12]=(left+right)*lr;this.mat4[13]=(top+bottom)*bt;this.mat4[14]=(far+near)*nf;this.mat4[15]=1;return this};module.exports=p5.Matrix},{"../core/constants":47,"../core/core":48,"../math/polargeometry":77}],36:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var shader=_dereq_("./shader");_dereq_("../core/p5.Renderer");_dereq_("./p5.Matrix");var uMVMatrixStack=[];var RESOLUTION=1e3;var attributes={alpha:true,depth:true,stencil:true,antialias:false,premultipliedAlpha:false,preserveDrawingBuffer:false};p5.Renderer3D=function(elt,pInst,isMainCanvas){p5.Renderer.call(this,elt,pInst,isMainCanvas);try{this.drawingContext=this.canvas.getContext("webgl",attributes)||this.canvas.getContext("experimental-webgl",attributes);if(this.drawingContext===null){throw new Error("Error creating webgl context")}else{console.log("p5.Renderer3D: enabled webgl context")}}catch(er){throw new Error(er)}this.isP3D=true;this.GL=this.drawingContext;var gl=this.GL;gl.clearColor(1,1,1,1);gl.clearDepth(1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);this._init();return this};p5.Renderer3D.prototype=Object.create(p5.Renderer.prototype);p5.Renderer3D.prototype._applyDefaults=function(){return this};p5.Renderer3D.prototype._init=function(first_argument){var gl=this.GL;this.initMatrix();this.initHash();this.verticeStack=[];this.verticeBuffer=gl.createBuffer();this.colorBuffer=gl.createBuffer();this._setCamera=false;this.ambientLightCount=0;this.directionalLightCount=0;this.pointLightCount=0};p5.Renderer3D.prototype._update=function(){this.resetMatrix();this.translate(0,0,-800);this.ambientLightCount=0;this.directionalLightCount=0;this.pointLightCount=0;this.verticeStack=[]};p5.Renderer3D.prototype.resize=function(w,h){var gl=this.GL;p5.Renderer.prototype.resize.call(this,w,h);gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)};p5.Renderer3D.prototype.background=function(){var gl=this.GL;var _col=this._pInst.color.apply(this._pInst,arguments);var _r=_col.levels[0]/255;var _g=_col.levels[1]/255;var _b=_col.levels[2]/255;var _a=_col.levels[3]/255;gl.clearColor(_r,_g,_b,_a);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)};p5.Renderer3D.prototype.initShaders=function(vertId,fragId,immediateMode){var gl=this.GL;var _vertShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(_vertShader,shader[vertId]);gl.compileShader(_vertShader);if(!gl.getShaderParameter(_vertShader,gl.COMPILE_STATUS)){alert("Yikes! An error occurred compiling the shaders:"+gl.getShaderInfoLog(_vertShader));return null}var _fragShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(_fragShader,shader[fragId]);gl.compileShader(_fragShader);if(!gl.getShaderParameter(_fragShader,gl.COMPILE_STATUS)){alert("Darn! An error occurred compiling the shaders:"+gl.getShaderInfoLog(_fragShader));return null}var shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,_vertShader);gl.attachShader(shaderProgram,_fragShader);gl.linkProgram(shaderProgram);if(!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){alert("Snap! Error linking shader program")}this._getLocation(shaderProgram,immediateMode);return shaderProgram};p5.Renderer3D.prototype._getLocation=function(shaderProgram,immediateMode){var gl=this.GL;gl.useProgram(shaderProgram);shaderProgram.uResolution=gl.getUniformLocation(shaderProgram,"uResolution");gl.uniform1f(shaderProgram.uResolution,RESOLUTION);shaderProgram.vertexPositionAttribute=gl.getAttribLocation(shaderProgram,"aPosition");gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);shaderProgram.uPMatrixUniform=gl.getUniformLocation(shaderProgram,"uProjectionMatrix");shaderProgram.uMVMatrixUniform=gl.getUniformLocation(shaderProgram,"uModelViewMatrix");if(immediateMode===undefined){shaderProgram.vertexNormalAttribute=gl.getAttribLocation(shaderProgram,"aNormal");gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);shaderProgram.uNMatrixUniform=gl.getUniformLocation(shaderProgram,"uNormalMatrix");shaderProgram.textureCoordAttribute=gl.getAttribLocation(shaderProgram,"aTexCoord");gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);shaderProgram.samplerUniform=gl.getUniformLocation(shaderProgram,"uSampler")}};p5.Renderer3D.prototype.setMatrixUniforms=function(shaderKey){var gl=this.GL;var shaderProgram=this.mHash[shaderKey];gl.useProgram(shaderProgram);gl.uniformMatrix4fv(shaderProgram.uPMatrixUniform,false,this.uPMatrix.mat4);gl.uniformMatrix4fv(shaderProgram.uMVMatrixUniform,false,this.uMVMatrix.mat4);this.uNMatrix=new p5.Matrix;this.uNMatrix.invert(this.uMVMatrix);this.uNMatrix.transpose(this.uNMatrix);gl.uniformMatrix4fv(shaderProgram.uNMatrixUniform,false,this.uNMatrix.mat4)};p5.Renderer3D.prototype._getShader=function(vertId,fragId,immediateMode){var mId=vertId+"|"+fragId;if(!this.materialInHash(mId)){var shaderProgram=this.initShaders(vertId,fragId,immediateMode);this.mHash[mId]=shaderProgram}this.curShaderId=mId;return this.mHash[this.curShaderId]};p5.Renderer3D.prototype._getCurShaderId=function(){if(this.curShaderId===undefined){var mId="normalVert|normalFrag";var shaderProgram=this.initShaders("normalVert","normalFrag");this.mHash[mId]=shaderProgram;this.curShaderId=mId}return this.curShaderId};p5.Renderer3D.prototype._getCurColor=function(){if(this.curColor===undefined){this.curColor=[.5,.5,.5,1]}return this.curColor};p5.Renderer3D.prototype.initHash=function(){this.gHash={};this.mHash={}};p5.Renderer3D.prototype.geometryInHash=function(gId){return this.gHash[gId]!==undefined};p5.Renderer3D.prototype.materialInHash=function(mId){return this.mHash[mId]!==undefined};p5.Renderer3D.prototype.initMatrix=function(){this.uMVMatrix=new p5.Matrix;this.uPMatrix=new p5.Matrix;this.uNMatrix=new p5.Matrix};p5.Renderer3D.prototype.resetMatrix=function(){this.uMVMatrix=p5.Matrix.identity()};p5.Renderer3D.prototype._setDefaultCamera=function(){if(!this._setCamera){var _w=this.width;var _h=this.height;this.uPMatrix=p5.Matrix.identity();this.uPMatrix.perspective(60/180*Math.PI,_w/_h,.1,100);this._setCamera=true}};p5.Renderer3D.prototype.translate=function(x,y,z){x=x/RESOLUTION;y=-y/RESOLUTION;z=z/RESOLUTION;this.uMVMatrix.translate([x,y,z]);return this};p5.Renderer3D.prototype.scale=function(x,y,z){this.uMVMatrix.scale([x,y,z]);return this};p5.Renderer3D.prototype.rotate=function(rad,axis){this.uMVMatrix.rotate(rad,axis);return this};p5.Renderer3D.prototype.rotateX=function(rad){this.uMVMatrix.rotateX(rad);return this};p5.Renderer3D.prototype.rotateY=function(rad){this.uMVMatrix.rotateY(rad);return this};p5.Renderer3D.prototype.rotateZ=function(rad){this.uMVMatrix.rotateZ(rad);return this};p5.Renderer3D.prototype.push=function(){uMVMatrixStack.push(this.uMVMatrix.copy())};p5.Renderer3D.prototype.pop=function(){if(uMVMatrixStack.length===0){throw new Error("Invalid popMatrix!")}this.uMVMatrix=uMVMatrixStack.pop()};module.exports=p5.Renderer3D},{"../core/core":48,"../core/p5.Renderer":54,"./p5.Matrix":35,"./shader":38}],37:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var hashCount=0;p5.Renderer3D.prototype.createBuffer=function(gId,arr){hashCount++;if(hashCount>1e3){var key=Object.keys(this.gHash)[0];delete this.gHash[key];hashCount--}var gl=this.GL;this.gHash[gId]={};this.gHash[gId].len=[];this.gHash[gId].vertexBuffer=[];this.gHash[gId].normalBuffer=[];this.gHash[gId].uvBuffer=[];this.gHash[gId].indexBuffer=[];arr.forEach(function(obj){this.gHash[gId].len.push(obj.len);this.gHash[gId].vertexBuffer.push(gl.createBuffer());this.gHash[gId].normalBuffer.push(gl.createBuffer());this.gHash[gId].uvBuffer.push(gl.createBuffer());this.gHash[gId].indexBuffer.push(gl.createBuffer())}.bind(this))};p5.Renderer3D.prototype.initBuffer=function(gId,arr){this._setDefaultCamera();var gl=this.GL;this.createBuffer(gId,arr);var shaderProgram=this.mHash[this._getCurShaderId()];arr.forEach(function(obj,i){gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].vertexBuffer[i]);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(obj.vertices),gl.STATIC_DRAW);gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].normalBuffer[i]);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(obj.vertexNormals),gl.STATIC_DRAW);gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].uvBuffer[i]);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(obj.uvs),gl.STATIC_DRAW);gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.gHash[gId].indexBuffer[i]);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(obj.faces),gl.STATIC_DRAW)}.bind(this))};p5.Renderer3D.prototype.drawBuffer=function(gId){this._setDefaultCamera();var gl=this.GL;var shaderKey=this._getCurShaderId();var shaderProgram=this.mHash[shaderKey];this.gHash[gId].len.forEach(function(d,i){gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].vertexBuffer[i]);gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].normalBuffer[i]);gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.gHash[gId].uvBuffer[i]);gl.vertexAttribPointer(shaderProgram.textureCoordAttribute,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.gHash[gId].indexBuffer[i]);this.setMatrixUniforms(shaderKey);gl.drawElements(gl.TRIANGLES,this.gHash[gId].len[i],gl.UNSIGNED_SHORT,0)}.bind(this))};module.exports=p5.Renderer3D},{"../core/core":48}],38:[function(_dereq_,module,exports){module.exports={vertexColorVert:"attribute vec3 aPosition;\nattribute vec4 aVertexColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform float uResolution;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition / uResolution * vec3(1.0, -1.0, 1.0), 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vColor = aVertexColor;\n}",vertexColorFrag:"precision mediump float;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_FragColor = vColor;\n}",normalVert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uNormalMatrix;\nuniform float uResolution;\n\nvarying vec3 vVertexNormal;\nvarying highp vec2 vVertTexCoord;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition / uResolution, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vVertexNormal = vec3( uNormalMatrix * vec4( aNormal, 1.0 ) );\n  vVertTexCoord = aTexCoord;\n}",normalFrag:"precision mediump float;\nvarying vec3 vVertexNormal;\nvoid main(void) {\n  gl_FragColor = vec4(vVertexNormal, 1.0);\n}",basicFrag:"precision mediump float;\nvarying vec3 vVertexNormal;\nuniform vec4 uMaterialColor;\nvoid main(void) {\n  gl_FragColor = uMaterialColor;\n}",lightVert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uNormalMatrix;\nuniform float uResolution;\nuniform int uAmbientLightCount;\nuniform int uDirectionalLightCount;\nuniform int uPointLightCount;\n\nuniform vec3 uAmbientColor[8];\nuniform vec3 uLightingDirection[8];\nuniform vec3 uDirectionalColor[8];\nuniform vec3 uPointLightLocation[8];\nuniform vec3 uPointLightColor[8];\nuniform bool uSpecular;\n\nvarying vec3 vVertexNormal;\nvarying vec2 vVertTexCoord;\nvarying vec3 vLightWeighting;\n\nvec3 ambientLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 directionalLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 pointLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 pointLightFactor2 = vec3(0.0, 0.0, 0.0);\n\nvoid main(void){\n\n  vec4 positionVec4 = vec4(aPosition / uResolution, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n\n  vec3 vertexNormal = vec3( uNormalMatrix * vec4( aNormal, 1.0 ) );\n  vVertexNormal = vertexNormal;\n  vVertTexCoord = aTexCoord;\n\n  vec4 mvPosition = uModelViewMatrix * vec4(aPosition / uResolution, 1.0);\n  vec3 eyeDirection = normalize(-mvPosition.xyz);\n\n  float shininess = 32.0;\n  float specularFactor = 2.0;\n  float diffuseFactor = 0.3;\n\n  for(int i = 0; i < 8; i++){\n    if(uAmbientLightCount == i) break;\n    ambientLightFactor += uAmbientColor[i];\n  }\n\n  for(int j = 0; j < 8; j++){\n    if(uDirectionalLightCount == j) break;\n    vec3 dir = uLightingDirection[j];\n    float directionalLightWeighting = max(dot(vertexNormal, dir), 0.0);\n    directionalLightFactor += uDirectionalColor[j] * directionalLightWeighting;\n  }\n\n  for(int k = 0; k < 8; k++){\n    if(uPointLightCount == k) break;\n    vec3 loc = uPointLightLocation[k];\n    //loc = loc / uResolution;\n    vec3 lightDirection = normalize(loc - mvPosition.xyz);\n\n    float directionalLightWeighting = max(dot(vertexNormal, lightDirection), 0.0);\n    pointLightFactor += uPointLightColor[k] * directionalLightWeighting;\n\n    //factor2 for specular\n    vec3 reflectionDirection = reflect(-lightDirection, vertexNormal);\n    float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n\n    pointLightFactor2 += uPointLightColor[k] * (specularFactor * specularLightWeighting\n      +  directionalLightWeighting * diffuseFactor);\n  }\n  \n  if(!uSpecular){\n    vLightWeighting =  ambientLightFactor + directionalLightFactor + pointLightFactor;\n  }else{\n    vLightWeighting = ambientLightFactor + directionalLightFactor + pointLightFactor2;\n  }\n\n}",lightTextureFrag:"precision mediump float;\n\nuniform vec4 uMaterialColor;\nuniform sampler2D uSampler;\nuniform bool isTexture;\n\nvarying vec3 vLightWeighting;\nvarying highp vec2 vVertTexCoord;\n\nvoid main(void) {\n  if(!isTexture){\n    gl_FragColor = vec4(vec3(uMaterialColor.rgb * vLightWeighting), uMaterialColor.a);\n  }else{\n    vec4 textureColor = texture2D(uSampler, vVertTexCoord);\n    if(vLightWeighting == vec3(0., 0., 0.)){\n      gl_FragColor = textureColor;\n    }else{\n      gl_FragColor = vec4(vec3(textureColor.rgb * vLightWeighting), textureColor.a); \n    }\n  }\n}"}},{}],39:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core/core");_dereq_("./color/p5.Color");_dereq_("./core/p5.Element");_dereq_("./typography/p5.Font");_dereq_("./core/p5.Graphics");_dereq_("./core/p5.Renderer2D");_dereq_("./image/p5.Image");_dereq_("./math/p5.Vector");_dereq_("./io/p5.TableRow");_dereq_("./io/p5.Table");_dereq_("./color/creating_reading");_dereq_("./color/setting");_dereq_("./core/constants");_dereq_("./utilities/conversion");_dereq_("./utilities/array_functions");_dereq_("./utilities/string_functions");_dereq_("./core/environment");_dereq_("./image/image");_dereq_("./image/loading_displaying");_dereq_("./image/pixels");_dereq_("./io/files");_dereq_("./events/keyboard");_dereq_("./events/acceleration");_dereq_("./events/mouse");_dereq_("./utilities/time_date");_dereq_("./events/touch");_dereq_("./math/math");_dereq_("./math/calculation");_dereq_("./math/random");_dereq_("./math/noise");_dereq_("./math/trigonometry");_dereq_("./core/rendering");_dereq_("./core/2d_primitives");_dereq_("./core/attributes");_dereq_("./core/curves");_dereq_("./core/vertex");_dereq_("./core/structure");_dereq_("./core/transform");_dereq_("./typography/attributes");_dereq_("./typography/loading_displaying");_dereq_("./3d/p5.Renderer3D");_dereq_("./3d/p5.Geometry3D");_dereq_("./3d/retainedMode3D");_dereq_("./3d/immediateMode3D");_dereq_("./3d/3d_primitives");_dereq_("./3d/p5.Matrix");_dereq_("./3d/material");_dereq_("./3d/light");_dereq_("./3d/shader");_dereq_("./3d/camera");_dereq_("./3d/interaction");var _globalInit=function(){if(!window.PHANTOMJS&&!window.mocha){if(window.setup&&typeof window.setup==="function"||window.draw&&typeof window.draw==="function"){new p5}}};if(document.readyState==="complete"){_globalInit()}else{window.addEventListener("load",_globalInit,false)}module.exports=p5},{"./3d/3d_primitives":28,"./3d/camera":29,"./3d/immediateMode3D":30,"./3d/interaction":31,"./3d/light":32,"./3d/material":33,"./3d/p5.Geometry3D":34,"./3d/p5.Matrix":35,"./3d/p5.Renderer3D":36,"./3d/retainedMode3D":37,
"./3d/shader":38,"./color/creating_reading":41,"./color/p5.Color":42,"./color/setting":43,"./core/2d_primitives":44,"./core/attributes":45,"./core/constants":47,"./core/core":48,"./core/curves":49,"./core/environment":50,"./core/p5.Element":52,"./core/p5.Graphics":53,"./core/p5.Renderer2D":55,"./core/rendering":56,"./core/structure":58,"./core/transform":59,"./core/vertex":60,"./events/acceleration":61,"./events/keyboard":62,"./events/mouse":63,"./events/touch":64,"./image/image":66,"./image/loading_displaying":67,"./image/p5.Image":68,"./image/pixels":69,"./io/files":70,"./io/p5.Table":71,"./io/p5.TableRow":72,"./math/calculation":73,"./math/math":74,"./math/noise":75,"./math/p5.Vector":76,"./math/random":78,"./math/trigonometry":79,"./typography/attributes":80,"./typography/loading_displaying":81,"./typography/p5.Font":82,"./utilities/array_functions":83,"./utilities/conversion":84,"./utilities/string_functions":85,"./utilities/time_date":86}],40:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.ColorConversion={};p5.ColorConversion._hsbaToHSLA=function(hsba){var hue=hsba[0];var sat=hsba[1];var val=hsba[2];var li=(2-sat)*val/2;if(li!==0){if(li===1){sat=0}else if(li<.5){sat=sat/(2-sat)}else{sat=sat*val/(2-li*2)}}return[hue,sat,li,hsba[3]]};p5.ColorConversion._hsbaToRGBA=function(hsba){var hue=hsba[0]*6;var sat=hsba[1];var val=hsba[2];var RGBA=[];if(sat===0){RGBA=[val,val,val,hsba[3]]}else{var sector=Math.floor(hue);var tint1=val*(1-sat);var tint2=val*(1-sat*(hue-sector));var tint3=val*(1-sat*(1+sector-hue));var red,green,blue;if(sector===0){red=val;green=tint3;blue=tint1}else if(sector===1){red=tint2;green=val;blue=tint1}else if(sector===2){red=tint1;green=val;blue=tint3}else if(sector===3){red=tint1;green=tint2;blue=val}else if(sector===4){red=tint3;green=tint1;blue=val}else{red=val;green=tint1;blue=tint2}RGBA=[red,green,blue,hsba[3]]}return RGBA};p5.ColorConversion._hslaToHSBA=function(hsla){var hue=hsla[0];var sat=hsla[1];var li=hsla[2];var val;if(li<.5){val=(1+sat)*li}else{val=li+sat-li*sat}sat=2*(val-li)/val;return[hue,sat,val,hsla[3]]};p5.ColorConversion._hslaToRGBA=function(hsla){var hue=hsla[0]*6;var sat=hsla[1];var li=hsla[2];var RGBA=[];if(sat===0){RGBA=[li,li,li,hsla[3]]}else{var val;if(li<.5){val=(1+sat)*li}else{val=li+sat-li*sat}var zest=2*li-val;var hzvToRGB=function(hue,zest,val){if(hue<0){hue+=6}else if(hue>=6){hue-=6}if(hue<1){return zest+(val-zest)*hue}else if(hue<3){return val}else if(hue<4){return zest+(val-zest)*(4-hue)}else{return zest}};RGBA=[hzvToRGB(hue+2,zest,val),hzvToRGB(hue,zest,val),hzvToRGB(hue-2,zest,val),hsla[3]]}return RGBA};p5.ColorConversion._rgbaToHSBA=function(rgba){var red=rgba[0];var green=rgba[1];var blue=rgba[2];var val=Math.max(red,green,blue);var chroma=val-Math.min(red,green,blue);var hue,sat;if(chroma===0){hue=0;sat=0}else{sat=chroma/val;if(red===val){hue=(green-blue)/chroma}else if(green===val){hue=2+(blue-red)/chroma}else if(blue===val){hue=4+(red-green)/chroma}if(hue<0){hue+=6}else if(hue>=6){hue-=6}}return[hue/6,sat,val,rgba[3]]};p5.ColorConversion._rgbaToHSLA=function(rgba){var red=rgba[0];var green=rgba[1];var blue=rgba[2];var val=Math.max(red,green,blue);var min=Math.min(red,green,blue);var li=val+min;var chroma=val-min;var hue,sat;if(chroma===0){hue=0;sat=0}else{if(li<1){sat=chroma/li}else{sat=chroma/(2-chroma)}if(red===val){hue=(green-blue)/chroma}else if(green===val){hue=2+(blue-red)/chroma}else if(blue===val){hue=4+(red-green)/chroma}if(hue<0){hue+=6}else if(hue>=6){hue-=6}}return[hue/6,sat,li/2,rgba[3]]};module.exports=p5.ColorConversion},{"../core/core":48}],41:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");_dereq_("./p5.Color");p5.prototype.alpha=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getAlpha()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.blue=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getBlue()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.brightness=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getBrightness()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.color=function(){if(arguments[0]instanceof p5.Color){return arguments[0]}else if(arguments[0]instanceof Array){if(this instanceof p5.Renderer){return new p5.Color(this,arguments[0])}else{return new p5.Color(this._renderer,arguments[0])}}else{if(this instanceof p5.Renderer){return new p5.Color(this,arguments)}else{return new p5.Color(this._renderer,arguments)}}};p5.prototype.green=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getGreen()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.hue=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getHue()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.lerpColor=function(c1,c2,amt){var mode=this._renderer._colorMode;var maxes=this._renderer._colorMaxes;var l0,l1,l2,l3;var fromArray,toArray;if(mode===constants.RGB){fromArray=c1.levels.map(function(level){return level/255});toArray=c2.levels.map(function(level){return level/255})}else if(mode===constants.HSB){c1._getBrightness();c2._getBrightness();fromArray=c1.hsba;toArray=c2.hsba}else if(mode===constants.HSL){c1._getLightness();c2._getLightness();fromArray=c1.hsla;toArray=c2.hsla}else{throw new Error(mode+"cannot be used for interpolation.")}amt=Math.max(Math.min(amt,1),0);l0=this.lerp(fromArray[0],toArray[0],amt);l1=this.lerp(fromArray[1],toArray[1],amt);l2=this.lerp(fromArray[2],toArray[2],amt);l3=this.lerp(fromArray[3],toArray[3],amt);l0*=maxes[mode][0];l1*=maxes[mode][1];l2*=maxes[mode][2];l3*=maxes[mode][3];return this.color(l0,l1,l2,l3)};p5.prototype.lightness=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getLightness()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.red=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getRed()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};p5.prototype.saturation=function(c){if(c instanceof p5.Color||c instanceof Array){return this.color(c)._getSaturation()}else{throw new Error("Needs p5.Color or pixel array as argument.")}};module.exports=p5},{"../core/constants":47,"../core/core":48,"./p5.Color":42}],42:[function(_dereq_,module,exports){var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");var color_conversion=_dereq_("./color_conversion");p5.Color=function(renderer,vals){this.mode=renderer._colorMode;this.maxes=renderer._colorMaxes;if(this.mode!==constants.RGB&&this.mode!==constants.HSL&&this.mode!==constants.HSB){throw new Error(this.mode+" is an invalid colorMode.")}else{this._array=p5.Color._parseInputs.apply(renderer,vals)}this.levels=this._array.map(function(level){return Math.round(level*255)});return this};p5.Color.prototype.toString=function(){var a=this.levels;a[3]=this._array[3];return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"};p5.Color.prototype._getAlpha=function(){return this._array[3]*this.maxes[this.mode][3]};p5.Color.prototype._getBlue=function(){return this._array[2]*this.maxes[constants.RGB][2]};p5.Color.prototype._getBrightness=function(){if(!this.hsba){this.hsba=color_conversion._rgbaToHSBA(this._array)}return this.hsba[2]*this.maxes[constants.HSB][2]};p5.Color.prototype._getGreen=function(){return this._array[1]*this.maxes[constants.RGB][1]};p5.Color.prototype._getHue=function(){if(this.mode===constants.HSB){if(!this.hsba){this.hsba=color_conversion._rgbaToHSBA(this._array)}return this.hsba[0]*this.maxes[constants.HSB][0]}else{if(!this.hsla){this.hsla=color_conversion._rgbaToHSLA(this._array)}return this.hsla[0]*this.maxes[constants.HSL][0]}};p5.Color.prototype._getLightness=function(){if(!this.hsla){this.hsla=color_conversion._rgbaToHSLA(this._array)}return this.hsla[2]*this.maxes[constants.HSL][2]};p5.Color.prototype._getRed=function(){return this._array[0]*this.maxes[constants.RGB][0]};p5.Color.prototype._getSaturation=function(){if(this.mode===constants.HSB){if(!this.hsba){this.hsba=color_conversion._rgbaToHSBA(this._array)}return this.hsba[1]*this.maxes[constants.HSB][1]}else{if(!this.hsla){this.hsla=color_conversion._rgbaToHSLA(this._array)}return this.hsla[1]*this.maxes[constants.HSL][1]}};var namedColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var WHITESPACE=/\s*/;var INTEGER=/(\d{1,3})/;var DECIMAL=/((?:\d+(?:\.\d+)?)|(?:\.\d+))/;var PERCENT=new RegExp(DECIMAL.source+"%");var colorPatterns={HEX3:/^#([a-f0-9])([a-f0-9])([a-f0-9])$/i,HEX6:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i,RGB:new RegExp(["^rgb\\(",INTEGER.source,",",INTEGER.source,",",INTEGER.source,"\\)$"].join(WHITESPACE.source),"i"),RGB_PERCENT:new RegExp(["^rgb\\(",PERCENT.source,",",PERCENT.source,",",PERCENT.source,"\\)$"].join(WHITESPACE.source),"i"),RGBA:new RegExp(["^rgba\\(",INTEGER.source,",",INTEGER.source,",",INTEGER.source,",",DECIMAL.source,"\\)$"].join(WHITESPACE.source),"i"),RGBA_PERCENT:new RegExp(["^rgba\\(",PERCENT.source,",",PERCENT.source,",",PERCENT.source,",",DECIMAL.source,"\\)$"].join(WHITESPACE.source),"i"),HSL:new RegExp(["^hsl\\(",INTEGER.source,",",PERCENT.source,",",PERCENT.source,"\\)$"].join(WHITESPACE.source),"i"),HSLA:new RegExp(["^hsla\\(",INTEGER.source,",",PERCENT.source,",",PERCENT.source,",",DECIMAL.source,"\\)$"].join(WHITESPACE.source),"i"),HSB:new RegExp(["^hsb\\(",INTEGER.source,",",PERCENT.source,",",PERCENT.source,"\\)$"].join(WHITESPACE.source),"i"),HSBA:new RegExp(["^hsba\\(",INTEGER.source,",",PERCENT.source,",",PERCENT.source,",",DECIMAL.source,"\\)$"].join(WHITESPACE.source),"i")};p5.Color._parseInputs=function(){var numArgs=arguments.length;var mode=this._colorMode;var maxes=this._colorMaxes;var results=[];if(numArgs>=3){results[0]=arguments[0]/maxes[mode][0];results[1]=arguments[1]/maxes[mode][1];results[2]=arguments[2]/maxes[mode][2];if(typeof arguments[3]==="number"){results[3]=arguments[3]/maxes[mode][3]}else{results[3]=1}results=results.map(function(value){return Math.max(Math.min(value,1),0)});if(mode===constants.HSL){return color_conversion._hslaToRGBA(results)}else if(mode===constants.HSB){return color_conversion._hsbaToRGBA(results)}else{return results}}else if(numArgs===1&&typeof arguments[0]==="string"){var str=arguments[0].trim().toLowerCase();if(namedColors[str]){return p5.Color._parseInputs.apply(this,[namedColors[str]])}if(colorPatterns.HEX3.test(str)){results=colorPatterns.HEX3.exec(str).slice(1).map(function(color){return parseInt(color+color,16)/255});results[3]=1;return results}else if(colorPatterns.HEX6.test(str)){results=colorPatterns.HEX6.exec(str).slice(1).map(function(color){return parseInt(color,16)/255});results[3]=1;return results}else if(colorPatterns.RGB.test(str)){results=colorPatterns.RGB.exec(str).slice(1).map(function(color){return color/255});results[3]=1;return results}else if(colorPatterns.RGB_PERCENT.test(str)){results=colorPatterns.RGB_PERCENT.exec(str).slice(1).map(function(color){return parseFloat(color)/100});results[3]=1;return results}else if(colorPatterns.RGBA.test(str)){results=colorPatterns.RGBA.exec(str).slice(1).map(function(color,idx){if(idx===3){return parseFloat(color)}return color/255});return results}else if(colorPatterns.RGBA_PERCENT.test(str)){results=colorPatterns.RGBA_PERCENT.exec(str).slice(1).map(function(color,idx){if(idx===3){return parseFloat(color)}return parseFloat(color)/100});return results}if(colorPatterns.HSL.test(str)){results=colorPatterns.HSL.exec(str).slice(1).map(function(color,idx){if(idx===0){return parseInt(color,10)/360}return parseInt(color,10)/100});results[3]=1}else if(colorPatterns.HSLA.test(str)){results=colorPatterns.HSLA.exec(str).slice(1).map(function(color,idx){if(idx===0){return parseInt(color,10)/360}else if(idx===3){return parseFloat(color)}return parseInt(color,10)/100})}if(results.length){return color_conversion._hslaToRGBA(results)}if(colorPatterns.HSB.test(str)){results=colorPatterns.HSB.exec(str).slice(1).map(function(color,idx){if(idx===0){return parseInt(color,10)/360}return parseInt(color,10)/100});results[3]=1}else if(colorPatterns.HSBA.test(str)){results=colorPatterns.HSBA.exec(str).slice(1).map(function(color,idx){if(idx===0){return parseInt(color,10)/360}else if(idx===3){return parseFloat(color)}return parseInt(color,10)/100})}if(results.length){return color_conversion._hsbaToRGBA(results)}results=[1,1,1,1]}else if((numArgs===1||numArgs===2)&&typeof arguments[0]==="number"){results[0]=arguments[0]/maxes[mode][2];results[1]=arguments[0]/maxes[mode][2];results[2]=arguments[0]/maxes[mode][2];if(typeof arguments[1]==="number"){results[3]=arguments[1]/maxes[mode][3]}else{results[3]=1}results=results.map(function(value){return Math.max(Math.min(value,1),0)})}else{throw new Error(arguments+"is not a valid color representation.")}return results};module.exports=p5.Color},{"../core/constants":47,"../core/core":48,"./color_conversion":40}],43:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");_dereq_("./p5.Color");p5.prototype.background=function(){if(arguments[0]instanceof p5.Image){this.image(arguments[0],0,0,this.width,this.height)}else{this._renderer.background.apply(this._renderer,arguments)}return this};p5.prototype.clear=function(){this._renderer.clear();return this};p5.prototype.colorMode=function(){if(arguments[0]===constants.RGB||arguments[0]===constants.HSB||arguments[0]===constants.HSL){this._renderer._colorMode=arguments[0];var maxes=this._renderer._colorMaxes[this._renderer._colorMode];if(arguments.length===2){maxes[0]=arguments[1];maxes[1]=arguments[1];maxes[2]=arguments[1];maxes[3]=arguments[1]}else if(arguments.length===4){maxes[0]=arguments[1];maxes[1]=arguments[2];maxes[2]=arguments[3]}else if(arguments.length===5){maxes[0]=arguments[1];maxes[1]=arguments[2];maxes[2]=arguments[3];maxes[3]=arguments[4]}}return this};p5.prototype.fill=function(){this._renderer._setProperty("_fillSet",true);this._renderer._setProperty("_doFill",true);this._renderer.fill.apply(this._renderer,arguments);return this};p5.prototype.noFill=function(){this._renderer._setProperty("_doFill",false);return this};p5.prototype.noStroke=function(){this._renderer._setProperty("_doStroke",false);return this};p5.prototype.stroke=function(){this._renderer._setProperty("_strokeSet",true);this._renderer._setProperty("_doStroke",true);this._renderer.stroke.apply(this._renderer,arguments);return this};module.exports=p5},{"../core/constants":47,"../core/core":48,"./p5.Color":42}],44:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var constants=_dereq_("./constants");_dereq_("./error_helpers");p5.prototype.arc=function(x,y,w,h,start,stop,mode){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("arc",args,[["Number","Number","Number","Number","Number","Number"],["Number","Number","Number","Number","Number","Number","String"]]);if(!this._renderer._doStroke&&!this._renderer._doFill){return this}if(this._angleMode===constants.DEGREES){start=this.radians(start);stop=this.radians(stop)}while(start<0){start+=constants.TWO_PI}while(stop<0){stop+=constants.TWO_PI}start%=constants.TWO_PI;stop%=constants.TWO_PI;if(start<=constants.HALF_PI){start=Math.atan(w/h*Math.tan(start))}else if(start>constants.HALF_PI&&start<=3*constants.HALF_PI){start=Math.atan(w/h*Math.tan(start))+constants.PI}else{start=Math.atan(w/h*Math.tan(start))+constants.TWO_PI}if(stop<=constants.HALF_PI){stop=Math.atan(w/h*Math.tan(stop))}else if(stop>constants.HALF_PI&&stop<=3*constants.HALF_PI){stop=Math.atan(w/h*Math.tan(stop))+constants.PI}else{stop=Math.atan(w/h*Math.tan(stop))+constants.TWO_PI}if(start>stop){stop+=constants.TWO_PI}w=Math.abs(w);h=Math.abs(h);this._renderer.arc(x,y,w,h,start,stop,mode);return this};p5.prototype.ellipse=function(x,y,w,h){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("ellipse",args,["Number","Number","Number","Number"]);if(!this._renderer._doStroke&&!this._renderer._doFill){return this}w=Math.abs(w);h=Math.abs(h);this._renderer.ellipse(x,y,w,h);return this};p5.prototype.line=function(){if(!this._renderer._doStroke){return this}var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("line",args,[["Number","Number","Number","Number","Number","Number"]]);this._renderer.line(args[0],args[1],args[2],args[3],args[4],args[5])}else{this._validateParameters("line",args,[["Number","Number","Number","Number"]]);this._renderer.line(args[0],args[1],args[2],args[3])}return this};p5.prototype.point=function(){if(!this._renderer._doStroke){return this}var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("point",args,[["Number","Number","Number"]]);this._renderer.point(args[0],args[1],args[2])}else{this._validateParameters("point",args,[["Number","Number"]]);this._renderer.point(args[0],args[1])}return this};p5.prototype.quad=function(){if(!this._renderer._doStroke&&!this._renderer._doFill){return this}var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("quad",args,[["Number","Number","Number","Number","Number","Number","Number","Number","Number","Number","Number","Number"]]);this._renderer.quad(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9],args[10],args[11])}else{this._validateParameters("quad",args,[["Number","Number","Number","Number","Number","Number","Number","Number"]]);this._renderer.quad(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7])}return this};p5.prototype.rect=function(x,y,w,h,tl,tr,br,bl){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("rect",args,[["Number","Number","Number","Number"],["Number","Number","Number","Number","Number"],["Number","Number","Number","Number","Number","Number","Number","Number"]]);if(!this._renderer._doStroke&&!this._renderer._doFill){return}this._renderer.rect(x,y,w,h,tl,tr,br,bl);return this};p5.prototype.triangle=function(){if(!this._renderer._doStroke&&!this._renderer._doFill){return this}var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("triangle",args,[["Number","Number","Number","Number","Number","Number","Number","Number","Number"]]);this._renderer.triangle(args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7],args[8])}else{this._validateParameters("triangle",args,[["Number","Number","Number","Number","Number","Number"]]);this._renderer.triangle(args[0],args[1],args[2],args[3],args[4],args[5])}return this};module.exports=p5},{"./constants":47,"./core":48,"./error_helpers":51}],45:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var constants=_dereq_("./constants");p5.prototype.ellipseMode=function(m){if(m===constants.CORNER||m===constants.CORNERS||m===constants.RADIUS||m===constants.CENTER){this._renderer._ellipseMode=m}return this};p5.prototype.noSmooth=function(){this._renderer.noSmooth();return this};p5.prototype.rectMode=function(m){if(m===constants.CORNER||m===constants.CORNERS||m===constants.RADIUS||m===constants.CENTER){this._renderer._rectMode=m}return this};p5.prototype.smooth=function(){this._renderer.smooth();return this};p5.prototype.strokeCap=function(cap){if(cap===constants.ROUND||cap===constants.SQUARE||cap===constants.PROJECT){this._renderer.strokeCap(cap)}return this};p5.prototype.strokeJoin=function(join){if(join===constants.ROUND||join===constants.BEVEL||join===constants.MITER){this._renderer.strokeJoin(join)}return this};p5.prototype.strokeWeight=function(w){this._renderer.strokeWeight(w);return this};module.exports=p5},{"./constants":47,"./core":48}],46:[function(_dereq_,module,exports){var constants=_dereq_("./constants");module.exports={modeAdjust:function(a,b,c,d,mode){if(mode===constants.CORNER){return{x:a,y:b,w:c,h:d}}else if(mode===constants.CORNERS){return{x:a,y:b,w:c-a,h:d-b}}else if(mode===constants.RADIUS){return{x:a-c,y:b-d,w:2*c,h:2*d}}else if(mode===constants.CENTER){return{x:a-c*.5,y:b-d*.5,w:c,h:d}}},arcModeAdjust:function(a,b,c,d,mode){if(mode===constants.CORNER){return{x:a+c*.5,y:b+d*.5,w:c,h:d}}else if(mode===constants.CORNERS){return{x:a,y:b,w:c+a,h:d+b}}else if(mode===constants.RADIUS){return{x:a,y:b,w:2*c,h:2*d}}else if(mode===constants.CENTER){return{x:a,y:b,w:c,h:d}}}}},{"./constants":47}],47:[function(_dereq_,module,exports){var PI=Math.PI;module.exports={P2D:"p2d",WEBGL:"webgl",ARROW:"default",CROSS:"crosshair",HAND:"pointer",MOVE:"move",TEXT:"text",WAIT:"wait",HALF_PI:PI/2,PI:PI,QUARTER_PI:PI/4,TAU:PI*2,TWO_PI:PI*2,DEGREES:"degrees",RADIANS:"radians",CORNER:"corner",CORNERS:"corners",RADIUS:"radius",RIGHT:"right",LEFT:"left",CENTER:"center",TOP:"top",BOTTOM:"bottom",BASELINE:"alphabetic",POINTS:"points",LINES:"lines",TRIANGLES:"triangles",TRIANGLE_FAN:"triangles_fan",TRIANGLE_STRIP:"triangles_strip",QUADS:"quads",QUAD_STRIP:"quad_strip",CLOSE:"close",OPEN:"open",CHORD:"chord",PIE:"pie",PROJECT:"square",SQUARE:"butt",ROUND:"round",BEVEL:"bevel",MITER:"miter",RGB:"rgb",HSB:"hsb",HSL:"hsl",AUTO:"auto",ALT:18,BACKSPACE:8,CONTROL:17,DELETE:46,DOWN_ARROW:40,ENTER:13,ESCAPE:27,LEFT_ARROW:37,OPTION:18,RETURN:13,RIGHT_ARROW:39,SHIFT:16,TAB:9,UP_ARROW:38,BLEND:"normal",ADD:"lighter",DARKEST:"darken",LIGHTEST:"lighten",DIFFERENCE:"difference",EXCLUSION:"exclusion",MULTIPLY:"multiply",SCREEN:"screen",REPLACE:"source-over",OVERLAY:"overlay",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DODGE:"color-dodge",BURN:"color-burn",THRESHOLD:"threshold",GRAY:"gray",OPAQUE:"opaque",INVERT:"invert",POSTERIZE:"posterize",DILATE:"dilate",ERODE:"erode",BLUR:"blur",NORMAL:"normal",ITALIC:"italic",BOLD:"bold",_DEFAULT_TEXT_FILL:"#000000",_DEFAULT_LEADMULT:1.25,_CTX_MIDDLE:"middle",LINEAR:"linear",QUADRATIC:"quadratic",BEZIER:"bezier",CURVE:"curve",_DEFAULT_STROKE:"#000000",_DEFAULT_FILL:"#FFFFFF"}},{}],48:[function(_dereq_,module,exports){"use strict";_dereq_("./shim");var constants=_dereq_("./constants");var p5=function(sketch,node,sync){if(arguments.length===2&&typeof node==="boolean"){sync=node;node=undefined}this._setupDone=false;this._pixelDensity=Math.ceil(window.devicePixelRatio)||1;this._userNode=node;this._curElement=null;this._elements=[];this._requestAnimId=0;this._preloadCount=0;this._isGlobal=false;this._loop=true;this._styles=[];this._defaultCanvasSize={width:100,height:100};this._events={mousemove:null,mousedown:null,mouseup:null,dragend:null,dragover:null,click:null,mouseover:null,mouseout:null,keydown:null,keyup:null,keypress:null,touchstart:null,touchmove:null,touchend:null,resize:null,blur:null};if(window.DeviceOrientationEvent){this._events.deviceorientation=null}if(window.DeviceMotionEvent&&!window._isNodeWebkit){this._events.devicemotion=null}this._events.wheel=null;this._loadingScreenId="p5_loading";this._start=function(){if(this._userNode){if(typeof this._userNode==="string"){this._userNode=document.getElementById(this._userNode)}}this.createCanvas(this._defaultCanvasSize.width,this._defaultCanvasSize.height,"p2d",true);var userPreload=this.preload||window.preload;if(userPreload){var loadingScreen=document.getElementById(this._loadingScreenId);if(!loadingScreen){loadingScreen=document.createElement("div");loadingScreen.innerHTML="Loading...";loadingScreen.style.position="absolute";loadingScreen.id=this._loadingScreenId;var node=this._userNode||document.body;node.appendChild(loadingScreen)}for(var method in this._preloadMethods){this._preloadMethods[method]=this._preloadMethods[method]||p5;var obj=this._preloadMethods[method];if(obj===p5.prototype||obj===p5){obj=this._isGlobal?window:this}this._registeredPreloadMethods[method]=obj[method];obj[method]=this._wrapPreload(obj,method)}userPreload();this._runIfPreloadsAreDone()}else{this._setup();this._runFrames();this._draw()}}.bind(this);this._runIfPreloadsAreDone=function(){var context=this._isGlobal?window:this;if(context._preloadCount===0){var loadingScreen=document.getElementById(context._loadingScreenId);if(loadingScreen){loadingScreen.parentNode.removeChild(loadingScreen)}context._setup();context._runFrames();context._draw()}};this._decrementPreload=function(){var context=this._isGlobal?window:this;context._setProperty("_preloadCount",context._preloadCount-1);context._runIfPreloadsAreDone()};this._wrapPreload=function(obj,fnName){return function(){this._incrementPreload();var args=Array.prototype.slice.call(arguments);args.push(this._decrementPreload.bind(this));return this._registeredPreloadMethods[fnName].apply(obj,args)}.bind(this)};this._incrementPreload=function(){var context=this._isGlobal?window:this;context._setProperty("_preloadCount",context._preloadCount+1)};this._setup=function(){var context=this._isGlobal?window:this;if(typeof context.preload==="function"){for(var f in this._preloadMethods){context[f]=this._preloadMethods[f][f];if(context[f]&&this){context[f]=context[f].bind(this)}}}if(typeof context.setup==="function"){context.setup()}var reg=new RegExp(/(^|\s)p5_hidden(?!\S)/g);var canvases=document.getElementsByClassName("p5_hidden");for(var i=0;i<canvases.length;i++){var k=canvases[i];k.style.visibility="";k.className=k.className.replace(reg,"")}this._setupDone=true}.bind(this);this._draw=function(){var now=window.performance.now();var time_since_last=now-this._lastFrameTime;var target_time_between_frames=1e3/this._targetFrameRate;var epsilon=5;if(!this._loop||time_since_last>=target_time_between_frames-epsilon){if(this._renderer.isP3D){this._renderer._update()}this._setProperty("frameCount",this.frameCount+1);this._updateMouseCoords();this._updateTouchCoords();this.redraw();this._frameRate=1e3/(now-this._lastFrameTime);this._lastFrameTime=now}if(this._loop){this._requestAnimId=window.requestAnimationFrame(this._draw)}}.bind(this);this._runFrames=function(){if(this._updateInterval){clearInterval(this._updateInterval)}}.bind(this);this._setProperty=function(prop,value){this[prop]=value;if(this._isGlobal){window[prop]=value}}.bind(this);this.remove=function(){if(this._curElement){this._loop=false;if(this._requestAnimId){window.cancelAnimationFrame(this._requestAnimId)}for(var ev in this._events){window.removeEventListener(ev,this._events[ev])}for(var i=0;i<this._elements.length;i++){var e=this._elements[i];if(e.elt.parentNode){e.elt.parentNode.removeChild(e.elt)}for(var elt_ev in e._events){e.elt.removeEventListener(elt_ev,e._events[elt_ev])}}var self=this;this._registeredMethods.remove.forEach(function(f){if(typeof f!=="undefined"){f.call(self)}});if(this._isGlobal){for(var p in p5.prototype){try{delete window[p]}catch(x){window[p]=undefined}}for(var p2 in this){if(this.hasOwnProperty(p2)){try{delete window[p2]}catch(x){window[p2]=undefined}}}}}}.bind(this);for(var k in constants){p5.prototype[k]=constants[k]}if(!sketch){this._isGlobal=true;for(var p in p5.prototype){if(typeof p5.prototype[p]==="function"){var ev=p.substring(2);if(!this._events.hasOwnProperty(ev)){window[p]=p5.prototype[p].bind(this)}}else{window[p]=p5.prototype[p]}}for(var p2 in this){if(this.hasOwnProperty(p2)){window[p2]=this[p2]}}}else{sketch(this)}for(var e in this._events){var f=this["_on"+e];if(f){var m=f.bind(this);window.addEventListener(e,m);this._events[e]=m}}var focusHandler=function(){this._setProperty("focused",true)}.bind(this);var blurHandler=function(){this._setProperty("focused",false)}.bind(this);window.addEventListener("focus",focusHandler);window.addEventListener("blur",blurHandler);this.registerMethod("remove",function(){window.removeEventListener("focus",focusHandler);window.removeEventListener("blur",blurHandler)});if(sync){this._start()}else{if(document.readyState==="complete"){this._start()}else{window.addEventListener("load",this._start.bind(this),false)}}};p5.prototype._preloadMethods={loadJSON:p5.prototype,loadImage:p5.prototype,loadStrings:p5.prototype,loadXML:p5.prototype,loadShape:p5.prototype,loadTable:p5.prototype,loadFont:p5.prototype};p5.prototype._registeredMethods={pre:[],post:[],remove:[]};p5.prototype._registeredPreloadMethods={};p5.prototype.registerPreloadMethod=function(fnString,obj){if(!p5.prototype._preloadMethods.hasOwnProperty(fnString)){p5.prototype._preloadMethods[fnString]=obj}};p5.prototype.registerMethod=function(name,m){if(!p5.prototype._registeredMethods.hasOwnProperty(name)){p5.prototype._registeredMethods[name]=[]}p5.prototype._registeredMethods[name].push(m)};module.exports=p5},{"./constants":47,"./shim":57}],49:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");_dereq_("./error_helpers");var bezierDetail=20;var curveDetail=20;p5.prototype.bezier=function(x1,y1,x2,y2,x3,y3,x4,y4){
var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("bezier",args,["Number","Number","Number","Number","Number","Number","Number","Number"]);if(!this._renderer._doStroke){return this}this._renderer.bezier(x1,y1,x2,y2,x3,y3,x4,y4);return this};p5.prototype.bezierDetail=function(d){bezierDetail=d;return this};p5.prototype.bezierPoint=function(a,b,c,d,t){var adjustedT=1-t;return Math.pow(adjustedT,3)*a+3*Math.pow(adjustedT,2)*t*b+3*adjustedT*Math.pow(t,2)*c+Math.pow(t,3)*d};p5.prototype.bezierTangent=function(a,b,c,d,t){var adjustedT=1-t;return 3*d*Math.pow(t,2)-3*c*Math.pow(t,2)+6*c*adjustedT*t-6*b*adjustedT*t+3*b*Math.pow(adjustedT,2)-3*a*Math.pow(adjustedT,2)};p5.prototype.curve=function(x1,y1,x2,y2,x3,y3,x4,y4){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("curve",args,["Number","Number","Number","Number","Number","Number","Number","Number"]);if(!this._renderer._doStroke){return}this._renderer.curve(x1,y1,x2,y2,x3,y3,x4,y4);return this};p5.prototype.curveDetail=function(d){curveDetail=d;return this};p5.prototype.curveTightness=function(t){this._renderer._curveTightness=t};p5.prototype.curvePoint=function(a,b,c,d,t){var t3=t*t*t,t2=t*t,f1=-.5*t3+t2-.5*t,f2=1.5*t3-2.5*t2+1,f3=-1.5*t3+2*t2+.5*t,f4=.5*t3-.5*t2;return a*f1+b*f2+c*f3+d*f4};p5.prototype.curveTangent=function(a,b,c,d,t){var t2=t*t,f1=-3*t2/2+2*t-.5,f2=9*t2/2-5*t,f3=-9*t2/2+4*t+.5,f4=3*t2/2-t;return a*f1+b*f2+c*f3+d*f4};module.exports=p5},{"./core":48,"./error_helpers":51}],50:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var C=_dereq_("./constants");var standardCursors=[C.ARROW,C.CROSS,C.HAND,C.MOVE,C.TEXT,C.WAIT];p5.prototype._frameRate=0;p5.prototype._lastFrameTime=window.performance.now();p5.prototype._targetFrameRate=60;if(window.console&&console.log){p5.prototype.print=function(args){try{var newArgs=JSON.parse(JSON.stringify(args));console.log(newArgs)}catch(err){console.log(args)}}}else{p5.prototype.print=function(){}}p5.prototype.println=p5.prototype.print;p5.prototype.frameCount=0;p5.prototype.focused=document.hasFocus();p5.prototype.cursor=function(type,x,y){var cursor="auto";var canvas=this._curElement.elt;if(standardCursors.indexOf(type)>-1){cursor=type}else if(typeof type==="string"){var coords="";if(x&&y&&(typeof x==="number"&&typeof y==="number")){coords=x+" "+y}if(type.substring(0,6)!=="http://"){cursor="url("+type+") "+coords+", auto"}else if(/\.(cur|jpg|jpeg|gif|png|CUR|JPG|JPEG|GIF|PNG)$/.test(type)){cursor="url("+type+") "+coords+", auto"}else{cursor=type}}canvas.style.cursor=cursor};p5.prototype.frameRate=function(fps){if(typeof fps!=="number"||fps<=0){return this._frameRate}else{this._setProperty("_targetFrameRate",fps);this._runFrames();return this}};p5.prototype.getFrameRate=function(){return this.frameRate()};p5.prototype.setFrameRate=function(fps){return this.frameRate(fps)};p5.prototype.noCursor=function(){this._curElement.elt.style.cursor="none"};p5.prototype.displayWidth=screen.width;p5.prototype.displayHeight=screen.height;p5.prototype.windowWidth=window.innerWidth;p5.prototype.windowHeight=window.innerHeight;p5.prototype._onresize=function(e){this._setProperty("windowWidth",window.innerWidth);this._setProperty("windowHeight",window.innerHeight);var context=this._isGlobal?window:this;var executeDefault;if(typeof context.windowResized==="function"){executeDefault=context.windowResized(e);if(executeDefault!==undefined&&!executeDefault){e.preventDefault()}}};p5.prototype.width=0;p5.prototype.height=0;p5.prototype.fullscreen=function(val){if(typeof val==="undefined"){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}else{if(val){launchFullscreen(document.documentElement)}else{exitFullscreen()}}};p5.prototype.pixelDensity=function(val){if(typeof val==="number"){this._pixelDensity=val}else{return this._pixelDensity}this.resizeCanvas(this.width,this.height,true)};p5.prototype.displayDensity=function(){return window.devicePixelRatio};function launchFullscreen(element){var enabled=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;if(!enabled){throw new Error("Fullscreen not enabled in this browser.")}if(element.requestFullscreen){element.requestFullscreen()}else if(element.mozRequestFullScreen){element.mozRequestFullScreen()}else if(element.webkitRequestFullscreen){element.webkitRequestFullscreen()}else if(element.msRequestFullscreen){element.msRequestFullscreen()}}function exitFullscreen(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}p5.prototype.getURL=function(){return location.href};p5.prototype.getURLPath=function(){return location.pathname.split("/").filter(function(v){return v!==""})};p5.prototype.getURLParams=function(){var re=/[?&]([^&=]+)(?:[&=])([^&=]+)/gim;var m;var v={};while((m=re.exec(location.search))!=null){if(m.index===re.lastIndex){re.lastIndex++}v[m[1]]=m[2]}return v};module.exports=p5},{"./constants":47,"./core":48}],51:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var doFriendlyWelcome=false;var class2type={};var toString=class2type.toString;var names=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];for(var n=0;n<names.length;n++){class2type["[object "+names[n]+"]"]=names[n].toLowerCase()}var getType=function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj};var isArray=Array.isArray||function(obj){return getType(obj)==="array"};var isNumeric=function(obj){return!isArray(obj)&&obj-parseFloat(obj)+1>=0};var numberTypes=["Number","Integer","Number/Constant"];function typeMatches(defType,argType,arg){if(defType.match(/^p5\./)){var parts=defType.split(".");return arg instanceof p5[parts[1]]}return defType==="Boolean"||defType.toLowerCase()===argType||numberTypes.indexOf(defType)>-1&&isNumeric(arg)}var PARAM_COUNT=0;var EMPTY_VAR=1;var WRONG_TYPE=2;var FILE_LOAD=3;var typeColors=["#2D7BB6","#EE9900","#4DB200","#C83C00"];function report(message,func,color){if(doFriendlyWelcome){friendlyWelcome();doFriendlyWelcome=false}if("undefined"===getType(color)){color="#B40033"}else if(getType(color)==="number"){color=typeColors[color]}}p5.prototype._validateParameters=function(func,args,types){if(!isArray(types[0])){types=[types]}var diff=Math.abs(args.length-types[0].length);var message,tindex=0;for(var i=1,len=types.length;i<len;i++){var d=Math.abs(args.length-types[i].length);if(d<=diff){tindex=i;diff=d}}var symbol="X";if(diff>0){message="You wrote "+func+"(";if(args.length>0){message+=symbol+Array(args.length).join(","+symbol)}message+="). "+func+" was expecting "+types[tindex].length+" parameters. Try "+func+"(";if(types[tindex].length>0){message+=symbol+Array(types[tindex].length).join(","+symbol)}message+=").";if(types.length>1){message+=" "+func+" takes different numbers of parameters "+"depending on what you want to do. Click this link to learn more: "}report(message,func,PARAM_COUNT)}for(var format=0;format<types.length;format++){for(var p=0;p<types[format].length&&p<args.length;p++){var defType=types[format][p];var argType=getType(args[p]);if("undefined"===argType||null===argType){report("It looks like "+func+" received an empty variable in spot #"+(p+1)+". If not intentional, this is often a problem with scope: "+"[link to scope].",func,EMPTY_VAR)}else if(defType!=="*"&&!typeMatches(defType,argType,args[p])){message=func+" was expecting a "+defType.toLowerCase()+" for parameter #"+(p+1)+", received ";message+="string"===argType?'"'+args[p]+'"':args[p];message+=" instead.";if(types.length>1){message+=" "+func+" takes different numbers of parameters "+"depending on what you want to do. "+"Click this link to learn more:"}report(message,func,WRONG_TYPE)}}}};p5.prototype._validateParameters=function(){return true};var errorCases={0:{fileType:"image",method:"loadImage",message:" hosting the image online,"},1:{fileType:"XML file",method:"loadXML"},2:{fileType:"table file",method:"loadTable"},3:{fileType:"text file",method:"loadStrings"}};p5._friendlyFileLoadError=function(errorType,filePath){var errorInfo=errorCases[errorType];var message="It looks like there was a problem"+" loading your "+errorInfo.fileType+"."+" Try checking if the file path%c ["+filePath+"] %cis correct,"+(errorInfo.message||"")+" or running a local server.";report(message,errorInfo.method,FILE_LOAD)};function friendlyWelcome(){var astrixBgColor="transparent";var astrixTxtColor="#ED225D";var welcomeBgColor="#ED225D";var welcomeTextColor="white";console.log("%c    _ \n"+" /\\| |/\\ \n"+" \\ ` ' /  \n"+" / , . \\  \n"+" \\/|_|\\/ "+"\n\n%c> p5.js says: Welcome! "+"This is your friendly debugger. "+"To turn me off switch to using p5.min.js.","background-color:"+astrixBgColor+";color:"+astrixTxtColor+";","background-color:"+welcomeBgColor+";color:"+welcomeTextColor+";")}var misusedAtTopLevelCode=null;var FAQ_URL="https://github.com/processing/p5.js/wiki/"+"Frequently-Asked-Questions"+"#why-cant-i-assign-variables-using-p5-functions-and-"+"variables-before-setup";function defineMisusedAtTopLevelCode(){var uniqueNamesFound={};var getSymbols=function(obj){return Object.getOwnPropertyNames(obj).filter(function(name){if(name[0]==="_"){return false}if(name in uniqueNamesFound){return false}uniqueNamesFound[name]=true;return true}).map(function(name){var type;if(typeof obj[name]==="function"){type="function"}else if(name===name.toUpperCase()){type="constant"}else{type="variable"}return{name:name,type:type}})};misusedAtTopLevelCode=[].concat(getSymbols(p5.prototype),getSymbols(_dereq_("./constants")));misusedAtTopLevelCode.sort(function(a,b){return b.name.length-a.name.length})}function helpForMisusedAtTopLevelCode(e,log){if(!log){log=console.log.bind(console)}if(!misusedAtTopLevelCode){defineMisusedAtTopLevelCode()}misusedAtTopLevelCode.some(function(symbol){if(e.message&&e.message.indexOf(symbol.name)!==-1){log("%cDid you just try to use p5.js's "+symbol.name+(symbol.type==="function"?"() ":" ")+symbol.type+"? If so, you may want to "+"move it into your sketch's setup() function.\n\n"+"For more details, see: "+FAQ_URL,"color: #B40033");return true}})}p5.prototype._helpForMisusedAtTopLevelCode=helpForMisusedAtTopLevelCode;if(document.readyState!=="complete"){window.addEventListener("error",helpForMisusedAtTopLevelCode,false);window.addEventListener("load",function(){window.removeEventListener("error",helpForMisusedAtTopLevelCode,false)})}module.exports=p5},{"./constants":47,"./core":48}],52:[function(_dereq_,module,exports){var p5=_dereq_("./core");p5.Element=function(elt,pInst){this.elt=elt;this._pInst=pInst;this._events={};this.width=this.elt.offsetWidth;this.height=this.elt.offsetHeight};p5.Element.prototype.parent=function(p){if(arguments.length===0){return this.elt.parentNode}else{if(typeof p==="string"){if(p[0]==="#"){p=p.substring(1)}p=document.getElementById(p)}else if(p instanceof p5.Element){p=p.elt}p.appendChild(this.elt);return this}};p5.Element.prototype.id=function(id){if(arguments.length===0){return this.elt.id}else{this.elt.id=id;this.width=this.elt.offsetWidth;this.height=this.elt.offsetHeight;return this}};p5.Element.prototype.class=function(c){if(arguments.length===0){return this.elt.className}else{this.elt.className=c;this.width=this.elt.offsetWidth;this.height=this.elt.offsetHeight;return this}};p5.Element.prototype.mousePressed=function(fxn){attachListener("mousedown",fxn,this);attachListener("touchstart",fxn,this);return this};p5.Element.prototype.mouseWheel=function(fxn){attachListener("wheel",fxn,this);return this};p5.Element.prototype.mouseReleased=function(fxn){attachListener("mouseup",fxn,this);attachListener("touchend",fxn,this);return this};p5.Element.prototype.mouseClicked=function(fxn){attachListener("click",fxn,this);return this};p5.Element.prototype.mouseMoved=function(fxn){attachListener("mousemove",fxn,this);attachListener("touchmove",fxn,this);return this};p5.Element.prototype.mouseOver=function(fxn){attachListener("mouseover",fxn,this);return this};p5.Element.prototype.changed=function(fxn){attachListener("change",fxn,this);return this};p5.Element.prototype.input=function(fxn){attachListener("input",fxn,this);return this};p5.Element.prototype.mouseOut=function(fxn){attachListener("mouseout",fxn,this);return this};p5.Element.prototype.touchStarted=function(fxn){attachListener("touchstart",fxn,this);attachListener("mousedown",fxn,this);return this};p5.Element.prototype.touchMoved=function(fxn){attachListener("touchmove",fxn,this);attachListener("mousemove",fxn,this);return this};p5.Element.prototype.touchEnded=function(fxn){attachListener("touchend",fxn,this);attachListener("mouseup",fxn,this);return this};p5.Element.prototype.dragOver=function(fxn){attachListener("dragover",fxn,this);return this};p5.Element.prototype.dragLeave=function(fxn){attachListener("dragleave",fxn,this);return this};p5.Element.prototype.drop=function(callback,fxn){function makeLoader(theFile){var p5file=new p5.File(theFile);return function(e){p5file.data=e.target.result;callback(p5file)}}if(window.File&&window.FileReader&&window.FileList&&window.Blob){attachListener("dragover",function(evt){evt.stopPropagation();evt.preventDefault()},this);attachListener("dragleave",function(evt){evt.stopPropagation();evt.preventDefault()},this);if(arguments.length>1){attachListener("drop",fxn,this)}attachListener("drop",function(evt){evt.stopPropagation();evt.preventDefault();var files=evt.dataTransfer.files;for(var i=0;i<files.length;i++){var f=files[i];var reader=new FileReader;reader.onload=makeLoader(f);if(f.type.indexOf("text")>-1){reader.readAsText(f)}else{reader.readAsDataURL(f)}}},this)}else{console.log("The File APIs are not fully supported in this browser.")}return this};function attachListener(ev,fxn,ctx){var f=fxn.bind(ctx);ctx.elt.addEventListener(ev,f,false);ctx._events[ev]=f}p5.Element.prototype._setProperty=function(prop,value){this[prop]=value};module.exports=p5.Element},{"./core":48}],53:[function(_dereq_,module,exports){var p5=_dereq_("./core");var constants=_dereq_("./constants");p5.Graphics=function(w,h,renderer,pInst){var r=renderer||constants.P2D;var c=document.createElement("canvas");var node=this._userNode||document.body;node.appendChild(c);p5.Element.call(this,c,pInst,false);this._styles=[];this.width=w;this.height=h;this._pixelDensity=pInst._pixelDensity;if(r===constants.WEBGL){this._renderer=new p5.Renderer3D(c,pInst,false)}else{this._renderer=new p5.Renderer2D(c,pInst,false)}this._renderer.resize(w,h);this._renderer._applyDefaults();pInst._elements.push(this);for(var p in p5.prototype){if(!this[p]){if(typeof p5.prototype[p]==="function"){this[p]=p5.prototype[p].bind(this)}else{this[p]=p5.prototype[p]}}}return this};p5.Graphics.prototype=Object.create(p5.Element.prototype);module.exports=p5.Graphics},{"./constants":47,"./core":48}],54:[function(_dereq_,module,exports){var p5=_dereq_("./core");var constants=_dereq_("../core/constants");p5.Renderer=function(elt,pInst,isMainCanvas){p5.Element.call(this,elt,pInst);this.canvas=elt;this._pInst=pInst;if(isMainCanvas){this._isMainCanvas=true;this._pInst._setProperty("_curElement",this);this._pInst._setProperty("canvas",this.canvas);this._pInst._setProperty("width",this.width);this._pInst._setProperty("height",this.height)}else{this.canvas.style.display="none";this._styles=[]}this._textSize=12;this._textLeading=15;this._textFont="sans-serif";this._textStyle=constants.NORMAL;this._textAscent=null;this._textDescent=null;this._rectMode=constants.CORNER;this._ellipseMode=constants.CENTER;this._curveTightness=0;this._imageMode=constants.CORNER;this._tint=null;this._doStroke=true;this._doFill=true;this._strokeSet=false;this._fillSet=false;this._colorMode=constants.RGB;this._colorMaxes={rgb:[255,255,255,255],hsb:[360,100,100,1],hsl:[360,100,100,1]}};p5.Renderer.prototype=Object.create(p5.Element.prototype);p5.Renderer.prototype.resize=function(w,h){this.width=w;this.height=h;this.elt.width=w*this._pInst._pixelDensity;this.elt.height=h*this._pInst._pixelDensity;this.elt.style.width=w+"px";this.elt.style.height=h+"px";if(this._isMainCanvas){this._pInst._setProperty("width",this.width);this._pInst._setProperty("height",this.height)}};p5.Renderer.prototype.textLeading=function(l){if(arguments.length&&arguments[0]){this._setProperty("_textLeading",l);return this}return this._textLeading};p5.Renderer.prototype.textSize=function(s){if(arguments.length&&arguments[0]){this._setProperty("_textSize",s);this._setProperty("_textLeading",s*constants._DEFAULT_LEADMULT);return this._applyTextProperties()}return this._textSize};p5.Renderer.prototype.textStyle=function(s){if(arguments.length&&arguments[0]){if(s===constants.NORMAL||s===constants.ITALIC||s===constants.BOLD){this._setProperty("_textStyle",s)}return this._applyTextProperties()}return this._textStyle};p5.Renderer.prototype.textAscent=function(){if(this._textAscent===null){this._updateTextMetrics()}return this._textAscent};p5.Renderer.prototype.textDescent=function(){if(this._textDescent===null){this._updateTextMetrics()}return this._textDescent};p5.Renderer.prototype._isOpenType=function(f){f=f||this._textFont;return typeof f==="object"&&f.font&&f.font.supported};p5.Renderer.prototype._updateTextMetrics=function(){if(this._isOpenType()){this._setProperty("_textAscent",this._textFont._textAscent());this._setProperty("_textDescent",this._textFont._textDescent());return this}var text=document.createElement("span");text.style.fontFamily=this._textFont;text.style.fontSize=this._textSize+"px";text.innerHTML="ABCjgq|";var block=document.createElement("div");block.style.display="inline-block";block.style.width="1px";block.style.height="0px";var container=document.createElement("div");container.appendChild(text);container.appendChild(block);container.style.height="0px";container.style.overflow="hidden";document.body.appendChild(container);block.style.verticalAlign="baseline";var blockOffset=calculateOffset(block);var textOffset=calculateOffset(text);var ascent=blockOffset[1]-textOffset[1];block.style.verticalAlign="bottom";blockOffset=calculateOffset(block);textOffset=calculateOffset(text);var height=blockOffset[1]-textOffset[1];var descent=height-ascent;document.body.removeChild(container);this._setProperty("_textAscent",ascent);this._setProperty("_textDescent",descent);return this};function calculateOffset(object){var currentLeft=0,currentTop=0;if(object.offsetParent){do{currentLeft+=object.offsetLeft;currentTop+=object.offsetTop}while(object=object.offsetParent)}else{currentLeft+=object.offsetLeft;currentTop+=object.offsetTop}return[currentLeft,currentTop]}module.exports=p5.Renderer},{"../core/constants":47,"./core":48}],55:[function(_dereq_,module,exports){var p5=_dereq_("./core");var canvas=_dereq_("./canvas");var constants=_dereq_("./constants");var filters=_dereq_("../image/filters");_dereq_("./p5.Renderer");var styleEmpty="rgba(0,0,0,0)";p5.Renderer2D=function(elt,pInst,isMainCanvas){p5.Renderer.call(this,elt,pInst,isMainCanvas);this.drawingContext=this.canvas.getContext("2d");this._pInst._setProperty("drawingContext",this.drawingContext);return this};p5.Renderer2D.prototype=Object.create(p5.Renderer.prototype);p5.Renderer2D.prototype._applyDefaults=function(){this.drawingContext.fillStyle=constants._DEFAULT_FILL;this.drawingContext.strokeStyle=constants._DEFAULT_STROKE;this.drawingContext.lineCap=constants.ROUND;this.drawingContext.font="normal 12px sans-serif"};p5.Renderer2D.prototype.resize=function(w,h){p5.Renderer.prototype.resize.call(this,w,h);this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity)};p5.Renderer2D.prototype.background=function(){this.drawingContext.save();this.drawingContext.setTransform(1,0,0,1,0,0);this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);if(arguments[0]instanceof p5.Image){this._pInst.image(arguments[0],0,0,this.width,this.height)}else{var curFill=this.drawingContext.fillStyle;var color=this._pInst.color.apply(this,arguments);var newFill=color.toString();this.drawingContext.fillStyle=newFill;this.drawingContext.fillRect(0,0,this.width,this.height);this.drawingContext.fillStyle=curFill}this.drawingContext.restore()};p5.Renderer2D.prototype.clear=function(){this.drawingContext.clearRect(0,0,this.width,this.height)};p5.Renderer2D.prototype.fill=function(){var ctx=this.drawingContext;var color=this._pInst.color.apply(this,arguments);ctx.fillStyle=color.toString()};p5.Renderer2D.prototype.stroke=function(){var ctx=this.drawingContext;var color=this._pInst.color.apply(this,arguments);ctx.strokeStyle=color.toString()};p5.Renderer2D.prototype.image=function(img,sx,sy,sWidth,sHeight,dx,dy,dWidth,dHeight){var cnv;try{if(this._tint){if(p5.MediaElement&&img instanceof p5.MediaElement){img.loadPixels()}if(img.canvas){cnv=this._getTintedImageCanvas(img)}}if(!cnv){cnv=img.canvas||img.elt}this.drawingContext.drawImage(cnv,sx,sy,sWidth,sHeight,dx,dy,dWidth,dHeight)}catch(e){if(e.name!=="NS_ERROR_NOT_AVAILABLE"){throw e}}};p5.Renderer2D.prototype._getTintedImageCanvas=function(img){if(!img.canvas){return img}var pixels=filters._toPixels(img.canvas);var tmpCanvas=document.createElement("canvas");tmpCanvas.width=img.canvas.width;tmpCanvas.height=img.canvas.height;var tmpCtx=tmpCanvas.getContext("2d");var id=tmpCtx.createImageData(img.canvas.width,img.canvas.height);var newPixels=id.data;for(var i=0;i<pixels.length;i+=4){var r=pixels[i];var g=pixels[i+1];var b=pixels[i+2];var a=pixels[i+3];newPixels[i]=r*this._tint[0]/255;newPixels[i+1]=g*this._tint[1]/255;newPixels[i+2]=b*this._tint[2]/255;newPixels[i+3]=a*this._tint[3]/255}tmpCtx.putImageData(id,0,0);return tmpCanvas};p5.Renderer2D.prototype.blendMode=function(mode){this.drawingContext.globalCompositeOperation=mode};p5.Renderer2D.prototype.blend=function(){var currBlend=this.drawingContext.globalCompositeOperation;var blendMode=arguments[arguments.length-1];var copyArgs=Array.prototype.slice.call(arguments,0,arguments.length-1);this.drawingContext.globalCompositeOperation=blendMode;this._pInst.copy.apply(this._pInst,copyArgs);this.drawingContext.globalCompositeOperation=currBlend};p5.Renderer2D.prototype.copy=function(){var srcImage,sx,sy,sw,sh,dx,dy,dw,dh;if(arguments.length===9){srcImage=arguments[0];sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8]}else if(arguments.length===8){srcImage=this._pInst;sx=arguments[0];sy=arguments[1];sw=arguments[2];sh=arguments[3];dx=arguments[4];dy=arguments[5];dw=arguments[6];dh=arguments[7]}else{throw new Error("Signature not supported")}p5.Renderer2D._copyHelper(srcImage,sx,sy,sw,sh,dx,dy,dw,dh)};p5.Renderer2D._copyHelper=function(srcImage,sx,sy,sw,sh,dx,dy,dw,dh){var s=srcImage.canvas.width/srcImage.width;this.drawingContext.drawImage(srcImage.canvas,s*sx,s*sy,s*sw,s*sh,dx,dy,dw,dh)};p5.Renderer2D.prototype.get=function(x,y,w,h){if(x===undefined&&y===undefined&&w===undefined&&h===undefined){x=0;y=0;w=this.width;h=this.height}else if(w===undefined&&h===undefined){w=1;h=1}if(x+w<0||y+h<0||x>this.width||y>this.height){return[0,0,0,255]}var ctx=this._pInst||this;var pd=ctx._pixelDensity;this.loadPixels.call(ctx);x=Math.floor(x);y=Math.floor(y);if(w===1&&h===1){return[ctx.pixels[pd*4*(y*this.width+x)],ctx.pixels[pd*(4*(y*this.width+x)+1)],ctx.pixels[pd*(4*(y*this.width+x)+2)],ctx.pixels[pd*(4*(y*this.width+x)+3)]]}else{var sx=x*pd;var sy=y*pd;var dw=Math.min(w,ctx.width);var dh=Math.min(h,ctx.height);var sw=dw*pd;var sh=dh*pd;var region=new p5.Image(dw,dh);region.canvas.getContext("2d").drawImage(this.canvas,sx,sy,sw,sh,0,0,dw,dh);return region}};p5.Renderer2D.prototype.loadPixels=function(){var pd=this._pixelDensity||this._pInst._pixelDensity;var w=this.width*pd;var h=this.height*pd;var imageData=this.drawingContext.getImageData(0,0,w,h);if(this._pInst){this._pInst._setProperty("imageData",imageData);this._pInst._setProperty("pixels",imageData.data)}else{this._setProperty("imageData",imageData);this._setProperty("pixels",imageData.data)}};p5.Renderer2D.prototype.set=function(x,y,imgOrCol){x=Math.floor(x);y=Math.floor(y);if(imgOrCol instanceof p5.Image){this.drawingContext.save();this.drawingContext.setTransform(1,0,0,1,0,0);this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);this.drawingContext.drawImage(imgOrCol.canvas,x,y);this.loadPixels.call(this._pInst);this.drawingContext.restore()}else{var ctx=this._pInst||this;var r=0,g=0,b=0,a=0;var idx=4*(y*ctx._pixelDensity*(this.width*ctx._pixelDensity)+x*ctx._pixelDensity);if(!ctx.imageData){ctx.loadPixels.call(ctx)}if(typeof imgOrCol==="number"){if(idx<ctx.pixels.length){r=imgOrCol;g=imgOrCol;b=imgOrCol;a=255}}else if(imgOrCol instanceof Array){if(imgOrCol.length<4){throw new Error("pixel array must be of the form [R, G, B, A]")}if(idx<ctx.pixels.length){r=imgOrCol[0];g=imgOrCol[1];b=imgOrCol[2];a=imgOrCol[3]}}else if(imgOrCol instanceof p5.Color){if(idx<ctx.pixels.length){r=imgOrCol.levels[0];g=imgOrCol.levels[1];b=imgOrCol.levels[2];a=imgOrCol.levels[3]}}for(var i=0;i<ctx._pixelDensity;i++){for(var j=0;j<ctx._pixelDensity;j++){idx=4*((y*ctx._pixelDensity+j)*this.width*ctx._pixelDensity+(x*ctx._pixelDensity+i));ctx.pixels[idx]=r;ctx.pixels[idx+1]=g;ctx.pixels[idx+2]=b;ctx.pixels[idx+3]=a}}}};p5.Renderer2D.prototype.updatePixels=function(x,y,w,h){var pd=this._pixelDensity||this._pInst._pixelDensity;if(x===undefined&&y===undefined&&w===undefined&&h===undefined){x=0;y=0;w=this.width;h=this.height}w*=pd;h*=pd;if(this._pInst){this.drawingContext.putImageData(this._pInst.imageData,x,y,0,0,w,h)}else{this.drawingContext.putImageData(this.imageData,x,y,0,0,w,h)}};p5.Renderer2D.prototype._acuteArcToBezier=function _acuteArcToBezier(start,size){var alpha=size/2,cos_alpha=Math.cos(alpha),sin_alpha=Math.sin(alpha),cot_alpha=1/Math.tan(alpha),phi=start+alpha,cos_phi=Math.cos(phi),sin_phi=Math.sin(phi),lambda=(4-cos_alpha)/3,mu=sin_alpha+(cos_alpha-lambda)*cot_alpha;return{ax:Math.cos(start),ay:Math.sin(start),bx:lambda*cos_phi+mu*sin_phi,by:lambda*sin_phi-mu*cos_phi,cx:lambda*cos_phi-mu*sin_phi,cy:lambda*sin_phi+mu*cos_phi,dx:Math.cos(start+size),dy:Math.sin(start+size)}};p5.Renderer2D.prototype.arc=function(x,y,w,h,start,stop,mode){var ctx=this.drawingContext;var vals=canvas.arcModeAdjust(x,y,w,h,this._ellipseMode);var rx=vals.w/2;var ry=vals.h/2;var epsilon=1e-5;var arcToDraw=0;var curves=[];while(stop-start>epsilon){arcToDraw=Math.min(stop-start,constants.HALF_PI);curves.push(this._acuteArcToBezier(start,arcToDraw));start+=arcToDraw}if(this._doFill){ctx.beginPath();curves.forEach(function(curve,index){if(index===0){ctx.moveTo(vals.x+curve.ax*rx,vals.y+curve.ay*ry)}ctx.bezierCurveTo(vals.x+curve.bx*rx,vals.y+curve.by*ry,vals.x+curve.cx*rx,vals.y+curve.cy*ry,vals.x+curve.dx*rx,vals.y+curve.dy*ry)});if(mode===constants.PIE||mode==null){ctx.lineTo(vals.x,vals.y)}ctx.closePath();ctx.fill()}if(this._doStroke){ctx.beginPath();curves.forEach(function(curve,index){if(index===0){ctx.moveTo(vals.x+curve.ax*rx,vals.y+curve.ay*ry)}ctx.bezierCurveTo(vals.x+curve.bx*rx,vals.y+curve.by*ry,vals.x+curve.cx*rx,vals.y+curve.cy*ry,vals.x+curve.dx*rx,vals.y+curve.dy*ry)});if(mode===constants.PIE){ctx.lineTo(vals.x,vals.y);ctx.closePath()}else if(mode===constants.CHORD){ctx.closePath()}ctx.stroke()}return this};p5.Renderer2D.prototype.ellipse=function(x,y,w,h){var ctx=this.drawingContext;var doFill=this._doFill,doStroke=this._doStroke;if(doFill&&!doStroke){if(ctx.fillStyle===styleEmpty){return this}}else if(!doFill&&doStroke){if(ctx.strokeStyle===styleEmpty){return this}}var vals=canvas.modeAdjust(x,y,w,h,this._ellipseMode);var kappa=.5522847498,ox=vals.w/2*kappa,oy=vals.h/2*kappa,xe=vals.x+vals.w,ye=vals.y+vals.h,xm=vals.x+vals.w/2,ym=vals.y+vals.h/2;ctx.beginPath();ctx.moveTo(vals.x,ym);ctx.bezierCurveTo(vals.x,ym-oy,xm-ox,vals.y,xm,vals.y);ctx.bezierCurveTo(xm+ox,vals.y,xe,ym-oy,xe,ym);ctx.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);ctx.bezierCurveTo(xm-ox,ye,vals.x,ym+oy,vals.x,ym);ctx.closePath();if(doFill){ctx.fill()}if(doStroke){ctx.stroke()}};p5.Renderer2D.prototype.line=function(x1,y1,x2,y2){var ctx=this.drawingContext;if(!this._doStroke){return this}else if(ctx.strokeStyle===styleEmpty){return this}if(ctx.lineWidth%2===1){ctx.translate(.5,.5)}ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();if(ctx.lineWidth%2===1){ctx.translate(-.5,-.5)}return this};p5.Renderer2D.prototype.point=function(x,y){var ctx=this.drawingContext;var s=ctx.strokeStyle;var f=ctx.fillStyle;if(!this._doStroke){return this}else if(ctx.strokeStyle===styleEmpty){return this}x=Math.round(x);y=Math.round(y);ctx.fillStyle=s;if(ctx.lineWidth>1){ctx.beginPath();ctx.arc(x,y,ctx.lineWidth/2,0,constants.TWO_PI,false);ctx.fill()}else{ctx.fillRect(x,y,1,1)}ctx.fillStyle=f};p5.Renderer2D.prototype.quad=function(x1,y1,x2,y2,x3,y3,x4,y4){var ctx=this.drawingContext;var doFill=this._doFill,doStroke=this._doStroke;if(doFill&&!doStroke){if(ctx.fillStyle===styleEmpty){return this}}else if(!doFill&&doStroke){if(ctx.strokeStyle===styleEmpty){return this}}ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3,y3);ctx.lineTo(x4,y4);ctx.closePath();if(doFill){ctx.fill()}if(doStroke){ctx.stroke()}return this};p5.Renderer2D.prototype.rect=function(x,y,w,h,tl,tr,br,bl){var ctx=this.drawingContext;var doFill=this._doFill,doStroke=this._doStroke;if(doFill&&!doStroke){if(ctx.fillStyle===styleEmpty){return this}}else if(!doFill&&doStroke){if(ctx.strokeStyle===styleEmpty){return this}}var vals=canvas.modeAdjust(x,y,w,h,this._rectMode);if(this._doStroke&&ctx.lineWidth%2===1){ctx.translate(.5,.5)}ctx.beginPath();if(typeof tl==="undefined"){ctx.rect(vals.x,vals.y,vals.w,vals.h)}else{if(typeof tr==="undefined"){tr=tl}if(typeof br==="undefined"){br=tr}if(typeof bl==="undefined"){bl=br}var _x=vals.x;var _y=vals.y;var _w=vals.w;var _h=vals.h;var hw=_w/2;var hh=_h/2;if(_w<2*tl){tl=hw}if(_h<2*tl){tl=hh}if(_w<2*tr){tr=hw}if(_h<2*tr){tr=hh}if(_w<2*br){br=hw}if(_h<2*br){br=hh}if(_w<2*bl){bl=hw}if(_h<2*bl){bl=hh}ctx.beginPath();ctx.moveTo(_x+tl,_y);ctx.arcTo(_x+_w,_y,_x+_w,_y+_h,tr);ctx.arcTo(_x+_w,_y+_h,_x,_y+_h,br);ctx.arcTo(_x,_y+_h,_x,_y,bl);ctx.arcTo(_x,_y,_x+_w,_y,tl);ctx.closePath()}if(this._doFill){ctx.fill()}if(this._doStroke){ctx.stroke()}if(this._doStroke&&ctx.lineWidth%2===1){ctx.translate(-.5,-.5)}return this};p5.Renderer2D.prototype.triangle=function(x1,y1,x2,y2,x3,y3){var ctx=this.drawingContext;var doFill=this._doFill,doStroke=this._doStroke;if(doFill&&!doStroke){if(ctx.fillStyle===styleEmpty){return this}}else if(!doFill&&doStroke){if(ctx.strokeStyle===styleEmpty){return this}}ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3,y3);ctx.closePath();if(doFill){ctx.fill()}if(doStroke){ctx.stroke()}};p5.Renderer2D.prototype.endShape=function(mode,vertices,isCurve,isBezier,isQuadratic,isContour,shapeKind){if(vertices.length===0){return this}if(!this._doStroke&&!this._doFill){return this}var closeShape=mode===constants.CLOSE;var v;if(closeShape&&!isContour){vertices.push(vertices[0])}var i,j;var numVerts=vertices.length;if(isCurve&&(shapeKind===constants.POLYGON||shapeKind===null)){if(numVerts>3){var b=[],s=1-this._curveTightness;this.drawingContext.beginPath();this.drawingContext.moveTo(vertices[1][0],vertices[1][1]);for(i=1;i+2<numVerts;i++){v=vertices[i];b[0]=[v[0],v[1]];b[1]=[v[0]+(s*vertices[i+1][0]-s*vertices[i-1][0])/6,v[1]+(s*vertices[i+1][1]-s*vertices[i-1][1])/6];b[2]=[vertices[i+1][0]+(s*vertices[i][0]-s*vertices[i+2][0])/6,vertices[i+1][1]+(s*vertices[i][1]-s*vertices[i+2][1])/6];b[3]=[vertices[i+1][0],vertices[i+1][1]];
this.drawingContext.bezierCurveTo(b[1][0],b[1][1],b[2][0],b[2][1],b[3][0],b[3][1])}if(closeShape){this.drawingContext.lineTo(vertices[i+1][0],vertices[i+1][1])}this._doFillStrokeClose()}}else if(isBezier&&(shapeKind===constants.POLYGON||shapeKind===null)){this.drawingContext.beginPath();for(i=0;i<numVerts;i++){if(vertices[i].isVert){if(vertices[i].moveTo){this.drawingContext.moveTo(vertices[i][0],vertices[i][1])}else{this.drawingContext.lineTo(vertices[i][0],vertices[i][1])}}else{this.drawingContext.bezierCurveTo(vertices[i][0],vertices[i][1],vertices[i][2],vertices[i][3],vertices[i][4],vertices[i][5])}}this._doFillStrokeClose()}else if(isQuadratic&&(shapeKind===constants.POLYGON||shapeKind===null)){this.drawingContext.beginPath();for(i=0;i<numVerts;i++){if(vertices[i].isVert){if(vertices[i].moveTo){this.drawingContext.moveTo([0],vertices[i][1])}else{this.drawingContext.lineTo(vertices[i][0],vertices[i][1])}}else{this.drawingContext.quadraticCurveTo(vertices[i][0],vertices[i][1],vertices[i][2],vertices[i][3])}}this._doFillStrokeClose()}else{if(shapeKind===constants.POINTS){for(i=0;i<numVerts;i++){v=vertices[i];if(this._doStroke){this._pInst.stroke(v[6])}this._pInst.point(v[0],v[1])}}else if(shapeKind===constants.LINES){for(i=0;i+1<numVerts;i+=2){v=vertices[i];if(this._doStroke){this._pInst.stroke(vertices[i+1][6])}this._pInst.line(v[0],v[1],vertices[i+1][0],vertices[i+1][1])}}else if(shapeKind===constants.TRIANGLES){for(i=0;i+2<numVerts;i+=3){v=vertices[i];this.drawingContext.beginPath();this.drawingContext.moveTo(v[0],v[1]);this.drawingContext.lineTo(vertices[i+1][0],vertices[i+1][1]);this.drawingContext.lineTo(vertices[i+2][0],vertices[i+2][1]);this.drawingContext.lineTo(v[0],v[1]);if(this._doFill){this._pInst.fill(vertices[i+2][5]);this.drawingContext.fill()}if(this._doStroke){this._pInst.stroke(vertices[i+2][6]);this.drawingContext.stroke()}this.drawingContext.closePath()}}else if(shapeKind===constants.TRIANGLE_STRIP){for(i=0;i+1<numVerts;i++){v=vertices[i];this.drawingContext.beginPath();this.drawingContext.moveTo(vertices[i+1][0],vertices[i+1][1]);this.drawingContext.lineTo(v[0],v[1]);if(this._doStroke){this._pInst.stroke(vertices[i+1][6])}if(this._doFill){this._pInst.fill(vertices[i+1][5])}if(i+2<numVerts){this.drawingContext.lineTo(vertices[i+2][0],vertices[i+2][1]);if(this._doStroke){this._pInst.stroke(vertices[i+2][6])}if(this._doFill){this._pInst.fill(vertices[i+2][5])}}this._doFillStrokeClose()}}else if(shapeKind===constants.TRIANGLE_FAN){if(numVerts>2){this.drawingContext.beginPath();this.drawingContext.moveTo(vertices[0][0],vertices[0][1]);this.drawingContext.lineTo(vertices[1][0],vertices[1][1]);this.drawingContext.lineTo(vertices[2][0],vertices[2][1]);if(this._doFill){this._pInst.fill(vertices[2][5])}if(this._doStroke){this._pInst.stroke(vertices[2][6])}this._doFillStrokeClose();for(i=3;i<numVerts;i++){v=vertices[i];this.drawingContext.beginPath();this.drawingContext.moveTo(vertices[0][0],vertices[0][1]);this.drawingContext.lineTo(vertices[i-1][0],vertices[i-1][1]);this.drawingContext.lineTo(v[0],v[1]);if(this._doFill){this._pInst.fill(v[5])}if(this._doStroke){this._pInst.stroke(v[6])}this._doFillStrokeClose()}}}else if(shapeKind===constants.QUADS){for(i=0;i+3<numVerts;i+=4){v=vertices[i];this.drawingContext.beginPath();this.drawingContext.moveTo(v[0],v[1]);for(j=1;j<4;j++){this.drawingContext.lineTo(vertices[i+j][0],vertices[i+j][1])}this.drawingContext.lineTo(v[0],v[1]);if(this._doFill){this._pInst.fill(vertices[i+3][5])}if(this._doStroke){this._pInst.stroke(vertices[i+3][6])}this._doFillStrokeClose()}}else if(shapeKind===constants.QUAD_STRIP){if(numVerts>3){for(i=0;i+1<numVerts;i+=2){v=vertices[i];this.drawingContext.beginPath();if(i+3<numVerts){this.drawingContext.moveTo(vertices[i+2][0],vertices[i+2][1]);this.drawingContext.lineTo(v[0],v[1]);this.drawingContext.lineTo(vertices[i+1][0],vertices[i+1][1]);this.drawingContext.lineTo(vertices[i+3][0],vertices[i+3][1]);if(this._doFill){this._pInst.fill(vertices[i+3][5])}if(this._doStroke){this._pInst.stroke(vertices[i+3][6])}}else{this.drawingContext.moveTo(v[0],v[1]);this.drawingContext.lineTo(vertices[i+1][0],vertices[i+1][1])}this._doFillStrokeClose()}}}else{this.drawingContext.beginPath();this.drawingContext.moveTo(vertices[0][0],vertices[0][1]);for(i=1;i<numVerts;i++){v=vertices[i];if(v.isVert){if(v.moveTo){this.drawingContext.moveTo(v[0],v[1])}else{this.drawingContext.lineTo(v[0],v[1])}}}this._doFillStrokeClose()}}isCurve=false;isBezier=false;isQuadratic=false;isContour=false;if(closeShape){vertices.pop()}return this};p5.Renderer2D.prototype.noSmooth=function(){if("imageSmoothingEnabled"in this.drawingContext){this.drawingContext.imageSmoothingEnabled=false}else if("mozImageSmoothingEnabled"in this.drawingContext){this.drawingContext.mozImageSmoothingEnabled=false}else if("webkitImageSmoothingEnabled"in this.drawingContext){this.drawingContext.webkitImageSmoothingEnabled=false}else if("msImageSmoothingEnabled"in this.drawingContext){this.drawingContext.msImageSmoothingEnabled=false}return this};p5.Renderer2D.prototype.smooth=function(){if("imageSmoothingEnabled"in this.drawingContext){this.drawingContext.imageSmoothingEnabled=true}else if("mozImageSmoothingEnabled"in this.drawingContext){this.drawingContext.mozImageSmoothingEnabled=true}else if("webkitImageSmoothingEnabled"in this.drawingContext){this.drawingContext.webkitImageSmoothingEnabled=true}else if("msImageSmoothingEnabled"in this.drawingContext){this.drawingContext.msImageSmoothingEnabled=true}return this};p5.Renderer2D.prototype.strokeCap=function(cap){if(cap===constants.ROUND||cap===constants.SQUARE||cap===constants.PROJECT){this.drawingContext.lineCap=cap}return this};p5.Renderer2D.prototype.strokeJoin=function(join){if(join===constants.ROUND||join===constants.BEVEL||join===constants.MITER){this.drawingContext.lineJoin=join}return this};p5.Renderer2D.prototype.strokeWeight=function(w){if(typeof w==="undefined"||w===0){this.drawingContext.lineWidth=1e-4}else{this.drawingContext.lineWidth=w}return this};p5.Renderer2D.prototype._getFill=function(){return this.drawingContext.fillStyle};p5.Renderer2D.prototype._getStroke=function(){return this.drawingContext.strokeStyle};p5.Renderer2D.prototype.bezier=function(x1,y1,x2,y2,x3,y3,x4,y4){this._pInst.beginShape();this._pInst.vertex(x1,y1);this._pInst.bezierVertex(x2,y2,x3,y3,x4,y4);this._pInst.endShape();return this};p5.Renderer2D.prototype.curve=function(x1,y1,x2,y2,x3,y3,x4,y4){this._pInst.beginShape();this._pInst.curveVertex(x1,y1);this._pInst.curveVertex(x2,y2);this._pInst.curveVertex(x3,y3);this._pInst.curveVertex(x4,y4);this._pInst.endShape();return this};p5.Renderer2D.prototype._doFillStrokeClose=function(){if(this._doFill){this.drawingContext.fill()}if(this._doStroke){this.drawingContext.stroke()}this.drawingContext.closePath()};p5.Renderer2D.prototype.applyMatrix=function(n00,n01,n02,n10,n11,n12){this.drawingContext.transform(n00,n01,n02,n10,n11,n12)};p5.Renderer2D.prototype.resetMatrix=function(){this.drawingContext.setTransform(1,0,0,1,0,0);this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);return this};p5.Renderer2D.prototype.rotate=function(r){this.drawingContext.rotate(r)};p5.Renderer2D.prototype.scale=function(x,y){this.drawingContext.scale(x,y);return this};p5.Renderer2D.prototype.shearX=function(angle){if(this._pInst._angleMode===constants.DEGREES){angle=this._pInst.radians(angle)}this.drawingContext.transform(1,0,this._pInst.tan(angle),1,0,0);return this};p5.Renderer2D.prototype.shearY=function(angle){if(this._pInst._angleMode===constants.DEGREES){angle=this._pInst.radians(angle)}this.drawingContext.transform(1,this._pInst.tan(angle),0,1,0,0);return this};p5.Renderer2D.prototype.translate=function(x,y){this.drawingContext.translate(x,y);return this};p5.Renderer2D.prototype.text=function(str,x,y,maxWidth,maxHeight){var p=this._pInst,cars,n,ii,jj,line,testLine,testWidth,words,totalHeight,baselineHacked,finalMaxHeight=Number.MAX_VALUE;if(!(this._doFill||this._doStroke)){return}if(typeof str!=="string"){str=str.toString()}str=str.replace(/(\t)/g,"  ");cars=str.split("\n");if(typeof maxWidth!=="undefined"){totalHeight=0;for(ii=0;ii<cars.length;ii++){line="";words=cars[ii].split(" ");for(n=0;n<words.length;n++){testLine=line+words[n]+" ";testWidth=this.textWidth(testLine);if(testWidth>maxWidth){line=words[n]+" ";totalHeight+=p.textLeading()}else{line=testLine}}}if(this._rectMode===constants.CENTER){x-=maxWidth/2;y-=maxHeight/2}switch(this.drawingContext.textAlign){case constants.CENTER:x+=maxWidth/2;break;case constants.RIGHT:x+=maxWidth;break}if(typeof maxHeight!=="undefined"){switch(this.drawingContext.textBaseline){case constants.BOTTOM:y+=maxHeight-totalHeight;break;case constants._CTX_MIDDLE:y+=(maxHeight-totalHeight)/2;break;case constants.BASELINE:baselineHacked=true;this.drawingContext.textBaseline=constants.TOP;break}finalMaxHeight=y+maxHeight-p.textAscent()}for(ii=0;ii<cars.length;ii++){line="";words=cars[ii].split(" ");for(n=0;n<words.length;n++){testLine=line+words[n]+" ";testWidth=this.textWidth(testLine);if(testWidth>maxWidth&&line.length>0){this._renderText(p,line,x,y,finalMaxHeight);line=words[n]+" ";y+=p.textLeading()}else{line=testLine}}this._renderText(p,line,x,y,finalMaxHeight);y+=p.textLeading()}}else{for(jj=0;jj<cars.length;jj++){this._renderText(p,cars[jj],x,y,finalMaxHeight);y+=p.textLeading()}}if(baselineHacked){this.drawingContext.textBaseline=constants.BASELINE}return p};p5.Renderer2D.prototype._renderText=function(p,line,x,y,maxY){if(y>=maxY){return}p.push();if(!this._isOpenType()){if(this._doStroke&&this._strokeSet){this.drawingContext.strokeText(line,x,y)}if(this._doFill){this.drawingContext.fillStyle=this._fillSet?this.drawingContext.fillStyle:constants._DEFAULT_TEXT_FILL;this.drawingContext.fillText(line,x,y)}}else{this._textFont._renderPath(line,x,y,{renderer:this})}p.pop();return p};p5.Renderer2D.prototype.textWidth=function(s){if(this._isOpenType()){return this._textFont._textWidth(s)}return this.drawingContext.measureText(s).width};p5.Renderer2D.prototype.textAlign=function(h,v){if(arguments.length){if(h===constants.LEFT||h===constants.RIGHT||h===constants.CENTER){this.drawingContext.textAlign=h}if(v===constants.TOP||v===constants.BOTTOM||v===constants.CENTER||v===constants.BASELINE){if(v===constants.CENTER){this.drawingContext.textBaseline=constants._CTX_MIDDLE}else{this.drawingContext.textBaseline=v}}return this._pInst}else{var valign=this.drawingContext.textBaseline;if(valign===constants._CTX_MIDDLE){valign=constants.CENTER}return{horizontal:this.drawingContext.textAlign,vertical:valign}}};p5.Renderer2D.prototype._applyTextProperties=function(){var font,p=this._pInst;this._setProperty("_textAscent",null);this._setProperty("_textDescent",null);font=this._textFont;if(this._isOpenType()){font=this._textFont.font.familyName;this._setProperty("_textStyle",this._textFont.font.styleName)}this.drawingContext.font=this._textStyle+" "+this._textSize+"px "+font;return p};p5.Renderer2D.prototype.push=function(){this.drawingContext.save()};p5.Renderer2D.prototype.pop=function(){this.drawingContext.restore()};module.exports=p5.Renderer2D},{"../image/filters":65,"./canvas":46,"./constants":47,"./core":48,"./p5.Renderer":54}],56:[function(_dereq_,module,exports){var p5=_dereq_("./core");var constants=_dereq_("./constants");_dereq_("./p5.Graphics");_dereq_("./p5.Renderer2D");_dereq_("../3d/p5.Renderer3D");var defaultId="defaultCanvas0";p5.prototype.createCanvas=function(w,h,renderer){var r=renderer||constants.P2D;var isDefault,c;if(arguments[3]){isDefault=typeof arguments[3]==="boolean"?arguments[3]:false}if(r===constants.WEBGL){c=document.getElementById(defaultId);if(c){c.parentNode.removeChild(c)}c=document.createElement("canvas");c.id=defaultId}else{if(isDefault){c=document.createElement("canvas");var i=0;while(document.getElementById("defaultCanvas"+i)){i++}defaultId="defaultCanvas"+i;c.id=defaultId}else{c=this.canvas}}if(!this._setupDone){c.className+=" p5_hidden";c.style.visibility="hidden"}if(this._userNode){this._userNode.appendChild(c)}else{document.body.appendChild(c)}if(r===constants.WEBGL){this._setProperty("_renderer",new p5.Renderer3D(c,this,true));this._isdefaultGraphics=true}else{if(!this._isdefaultGraphics){this._setProperty("_renderer",new p5.Renderer2D(c,this,true));this._isdefaultGraphics=true}}this._renderer.resize(w,h);this._renderer._applyDefaults();if(isDefault){this._elements.push(this._renderer)}return this._renderer};p5.prototype.resizeCanvas=function(w,h,noRedraw){if(this._renderer){var props={};for(var key in this.drawingContext){var val=this.drawingContext[key];if(typeof val!=="object"&&typeof val!=="function"){props[key]=val}}this._renderer.resize(w,h);for(var savedKey in props){this.drawingContext[savedKey]=props[savedKey]}if(!noRedraw){this.redraw()}}};p5.prototype.noCanvas=function(){if(this.canvas){this.canvas.parentNode.removeChild(this.canvas)}};p5.prototype.createGraphics=function(w,h,renderer){return new p5.Graphics(w,h,renderer,this)};p5.prototype.blendMode=function(mode){if(mode===constants.BLEND||mode===constants.DARKEST||mode===constants.LIGHTEST||mode===constants.DIFFERENCE||mode===constants.MULTIPLY||mode===constants.EXCLUSION||mode===constants.SCREEN||mode===constants.REPLACE||mode===constants.OVERLAY||mode===constants.HARD_LIGHT||mode===constants.SOFT_LIGHT||mode===constants.DODGE||mode===constants.BURN||mode===constants.ADD||mode===constants.NORMAL){this._renderer.blendMode(mode)}else{throw new Error("Mode "+mode+" not recognized.")}};module.exports=p5},{"../3d/p5.Renderer3D":36,"./constants":47,"./core":48,"./p5.Graphics":53,"./p5.Renderer2D":55}],57:[function(_dereq_,module,exports){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1e3/60)}}();window.performance=window.performance||{};window.performance.now=function(){var load_date=Date.now();return window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()-load_date}}();(function(){"use strict";if(typeof Uint8ClampedArray!=="undefined"&&!Uint8ClampedArray.prototype.slice){Object.defineProperty(Uint8ClampedArray.prototype,"slice",{value:Array.prototype.slice,writable:true,configurable:true,enumerable:false})}})()},{}],58:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");p5.prototype.exit=function(){throw"exit() not implemented, see remove()"};p5.prototype.noLoop=function(){this._loop=false};p5.prototype.loop=function(){this._loop=true;this._draw()};p5.prototype.push=function(){this._renderer.push();this._styles.push({_doStroke:this._renderer._doStroke,_doFill:this._renderer._doFill,_tint:this._renderer._tint,_imageMode:this._renderer._imageMode,_rectMode:this._renderer._rectMode,_ellipseMode:this._renderer._ellipseMode,_colorMode:this._renderer._colorMode,_textFont:this._renderer._textFont,_textLeading:this._renderer._textLeading,_textSize:this._renderer._textSize,_textStyle:this._renderer._textStyle})};p5.prototype.pop=function(){this._renderer.pop();var lastS=this._styles.pop();for(var prop in lastS){this._renderer[prop]=lastS[prop]}};p5.prototype.pushStyle=function(){throw new Error("pushStyle() not used, see push()")};p5.prototype.popStyle=function(){throw new Error("popStyle() not used, see pop()")};p5.prototype.redraw=function(){var userSetup=this.setup||window.setup;var userDraw=this.draw||window.draw;if(typeof userDraw==="function"){this.push();if(typeof userSetup==="undefined"){this.scale(this._pixelDensity,this._pixelDensity)}var self=this;this._registeredMethods.pre.forEach(function(f){f.call(self)});userDraw();this._registeredMethods.post.forEach(function(f){f.call(self)});this.pop()}};p5.prototype.size=function(){var s="size() is not a valid p5 function, to set the size of the ";s+="drawing canvas, please use createCanvas() instead";throw s};module.exports=p5},{"./core":48}],59:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var constants=_dereq_("./constants");p5.prototype.applyMatrix=function(n00,n01,n02,n10,n11,n12){this._renderer.applyMatrix(n00,n01,n02,n10,n11,n12);return this};p5.prototype.popMatrix=function(){throw new Error("popMatrix() not used, see pop()")};p5.prototype.printMatrix=function(){throw new Error("printMatrix() not implemented")};p5.prototype.pushMatrix=function(){throw new Error("pushMatrix() not used, see push()")};p5.prototype.resetMatrix=function(){this._renderer.resetMatrix();return this};p5.prototype.rotate=function(){var r=arguments[0];if(this._angleMode===constants.DEGREES){r=this.radians(r)}if(arguments.length>1){this._renderer.rotate(r,arguments[1])}else{this._renderer.rotate(r)}return this};p5.prototype.rotateX=function(rad){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("rotateX",args,[["Number"]]);this._renderer.rotateX(rad)}else{throw"not supported in p2d. Please use webgl mode"}return this};p5.prototype.rotateY=function(rad){if(this._renderer.isP3D){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("rotateY",args,[["Number"]]);this._renderer.rotateY(rad)}else{throw"not supported in p2d. Please use webgl mode"}return this};p5.prototype.rotateZ=function(rad){if(this._renderer.isP3D){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("rotateZ",args,[["Number"]]);this._renderer.rotateZ(rad)}else{throw"not supported in p2d. Please use webgl mode"}return this};p5.prototype.scale=function(){var x,y,z;var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}if(args[0]instanceof p5.Vector){x=args[0].x;y=args[0].y;z=args[0].z}else if(args[0]instanceof Array){x=args[0][0];y=args[0][1];z=args[0][2]||1}else{if(args.length===1){x=y=z=args[0]}else{x=args[0];y=args[1];z=args[2]||1}}if(this._renderer.isP3D){this._renderer.scale.call(this._renderer,x,y,z)}else{this._renderer.scale.call(this._renderer,x,y)}return this};p5.prototype.shearX=function(angle){if(this._angleMode===constants.DEGREES){angle=this.radians(angle)}this._renderer.shearX(angle);return this};p5.prototype.shearY=function(angle){if(this._angleMode===constants.DEGREES){angle=this.radians(angle)}this._renderer.shearY(angle);return this};p5.prototype.translate=function(x,y,z){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("translate",args,[["Number","Number","Number"]]);this._renderer.translate(x,y,z)}else{this._validateParameters("translate",args,[["Number","Number"]]);this._renderer.translate(x,y)}return this};module.exports=p5},{"./constants":47,"./core":48}],60:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("./core");var constants=_dereq_("./constants");var shapeKind=null;var vertices=[];var contourVertices=[];var isBezier=false;var isCurve=false;var isQuadratic=false;var isContour=false;p5.prototype.beginContour=function(){contourVertices=[];isContour=true;return this};p5.prototype.beginShape=function(kind){if(kind===constants.POINTS||kind===constants.LINES||kind===constants.TRIANGLES||kind===constants.TRIANGLE_FAN||kind===constants.TRIANGLE_STRIP||kind===constants.QUADS||kind===constants.QUAD_STRIP){shapeKind=kind}else{shapeKind=null}if(this._renderer.isP3D){this._renderer.beginShape(kind)}else{vertices=[];contourVertices=[]}return this};p5.prototype.bezierVertex=function(x2,y2,x3,y3,x4,y4){if(vertices.length===0){throw"vertex() must be used once before calling bezierVertex()"}else{isBezier=true;var vert=[];for(var i=0;i<arguments.length;i++){vert[i]=arguments[i]}vert.isVert=false;if(isContour){contourVertices.push(vert)}else{vertices.push(vert)}}return this};p5.prototype.curveVertex=function(x,y){isCurve=true;this.vertex(x,y);return this};p5.prototype.endContour=function(){var vert=contourVertices[0].slice();vert.isVert=contourVertices[0].isVert;vert.moveTo=false;contourVertices.push(vert);vertices.push(vertices[0]);for(var i=0;i<contourVertices.length;i++){vertices.push(contourVertices[i])}return this};p5.prototype.endShape=function(mode){if(this._renderer.isP3D){this._renderer.endShape()}else{if(vertices.length===0){return this}if(!this._renderer._doStroke&&!this._renderer._doFill){return this}var closeShape=mode===constants.CLOSE;if(closeShape&&!isContour){vertices.push(vertices[0])}this._renderer.endShape(mode,vertices,isCurve,isBezier,isQuadratic,isContour,shapeKind);isCurve=false;isBezier=false;isQuadratic=false;isContour=false;if(closeShape){vertices.pop()}}return this};p5.prototype.quadraticVertex=function(cx,cy,x3,y3){if(this._contourInited){var pt={};pt.x=cx;pt.y=cy;pt.x3=x3;pt.y3=y3;pt.type=constants.QUADRATIC;this._contourVertices.push(pt);return this}if(vertices.length>0){isQuadratic=true;var vert=[];for(var i=0;i<arguments.length;i++){vert[i]=arguments[i]}vert.isVert=false;if(isContour){contourVertices.push(vert)}else{vertices.push(vert)}}else{throw"vertex() must be used once before calling quadraticVertex()"}return this};p5.prototype.vertex=function(x,y,moveTo){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}if(this._renderer.isP3D){this._validateParameters("vertex",args,[["Number","Number","Number"]]);this._renderer.vertex(arguments[0],arguments[1],arguments[2])}else{this._validateParameters("vertex",args,[["Number","Number"],["Number","Number","Number"]]);var vert=[];vert.isVert=true;vert[0]=x;vert[1]=y;vert[2]=0;vert[3]=0;vert[4]=0;vert[5]=this._renderer._getFill();vert[6]=this._renderer._getStroke();if(moveTo){vert.moveTo=moveTo}if(isContour){if(contourVertices.length===0){vert.moveTo=true}contourVertices.push(vert)}else{vertices.push(vert)}}return this};module.exports=p5},{"./constants":47,"./core":48}],61:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.deviceOrientation=undefined;p5.prototype.accelerationX=0;p5.prototype.accelerationY=0;p5.prototype.accelerationZ=0;p5.prototype.pAccelerationX=0;p5.prototype.pAccelerationY=0;p5.prototype.pAccelerationZ=0;p5.prototype._updatePAccelerations=function(){this._setProperty("pAccelerationX",this.accelerationX);this._setProperty("pAccelerationY",this.accelerationY);this._setProperty("pAccelerationZ",this.accelerationZ)};p5.prototype.rotationX=0;p5.prototype.rotationY=0;p5.prototype.rotationZ=0;p5.prototype.pRotationX=0;p5.prototype.pRotationY=0;p5.prototype.pRotationZ=0;var startAngleX=0;var startAngleY=0;var startAngleZ=0;var rotateDirectionX="clockwise";var rotateDirectionY="clockwise";var rotateDirectionZ="clockwise";var pRotateDirectionX;var pRotateDirectionY;var pRotateDirectionZ;p5.prototype._updatePRotations=function(){this._setProperty("pRotationX",this.rotationX);this._setProperty("pRotationY",this.rotationY);this._setProperty("pRotationZ",this.rotationZ)};p5.prototype.turnAxis=undefined;var move_threshold=.5;var shake_threshold=30;p5.prototype.setMoveThreshold=function(val){if(typeof val==="number"){move_threshold=val}};p5.prototype.setShakeThreshold=function(val){if(typeof val==="number"){shake_threshold=val}};p5.prototype._ondeviceorientation=function(e){this._updatePRotations();this._setProperty("rotationX",e.beta);this._setProperty("rotationY",e.gamma);this._setProperty("rotationZ",e.alpha);this._handleMotion()};p5.prototype._ondevicemotion=function(e){this._updatePAccelerations();this._setProperty("accelerationX",e.acceleration.x*2);this._setProperty("accelerationY",e.acceleration.y*2);this._setProperty("accelerationZ",e.acceleration.z*2);this._handleMotion()};p5.prototype._handleMotion=function(){if(window.orientation===90||window.orientation===-90){this._setProperty("deviceOrientation","landscape")}else if(window.orientation===0){this._setProperty("deviceOrientation","portrait")}else if(window.orientation===undefined){this._setProperty("deviceOrientation","undefined")}var deviceMoved=this.deviceMoved||window.deviceMoved;if(typeof deviceMoved==="function"){if(Math.abs(this.accelerationX-this.pAccelerationX)>move_threshold||Math.abs(this.accelerationY-this.pAccelerationY)>move_threshold||Math.abs(this.accelerationZ-this.pAccelerationZ)>move_threshold){deviceMoved()}}var deviceTurned=this.deviceTurned||window.deviceTurned;if(typeof deviceTurned==="function"){var wRX=this.rotationX+180;var wPRX=this.pRotationX+180;var wSAX=startAngleX+180;if(wRX-wPRX>0&&wRX-wPRX<270||wRX-wPRX<-270){rotateDirectionX="clockwise"}else if(wRX-wPRX<0||wRX-wPRX>270){rotateDirectionX="counter-clockwise"}if(rotateDirectionX!==pRotateDirectionX){wSAX=wRX}if(Math.abs(wRX-wSAX)>90&&Math.abs(wRX-wSAX)<270){wSAX=wRX;this._setProperty("turnAxis","X");deviceTurned()}pRotateDirectionX=rotateDirectionX;startAngleX=wSAX-180;var wRY=this.rotationY+180;var wPRY=this.pRotationY+180;var wSAY=startAngleY+180;if(wRY-wPRY>0&&wRY-wPRY<270||wRY-wPRY<-270){rotateDirectionY="clockwise"}else if(wRY-wPRY<0||wRY-this.pRotationY>270){rotateDirectionY="counter-clockwise"}if(rotateDirectionY!==pRotateDirectionY){wSAY=wRY}if(Math.abs(wRY-wSAY)>90&&Math.abs(wRY-wSAY)<270){wSAY=wRY;this._setProperty("turnAxis","Y");deviceTurned()}pRotateDirectionY=rotateDirectionY;startAngleY=wSAY-180;if(this.rotationZ-this.pRotationZ>0&&this.rotationZ-this.pRotationZ<270||this.rotationZ-this.pRotationZ<-270){rotateDirectionZ="clockwise"}else if(this.rotationZ-this.pRotationZ<0||this.rotationZ-this.pRotationZ>270){rotateDirectionZ="counter-clockwise"}if(rotateDirectionZ!==pRotateDirectionZ){startAngleZ=this.rotationZ}if(Math.abs(this.rotationZ-startAngleZ)>90&&Math.abs(this.rotationZ-startAngleZ)<270){startAngleZ=this.rotationZ;this._setProperty("turnAxis","Z");deviceTurned()}pRotateDirectionZ=rotateDirectionZ;this._setProperty("turnAxis",undefined)}var deviceShaken=this.deviceShaken||window.deviceShaken;if(typeof deviceShaken==="function"){var accelerationChangeX;var accelerationChangeY;if(this.pAccelerationX!==null){accelerationChangeX=Math.abs(this.accelerationX-this.pAccelerationX);accelerationChangeY=Math.abs(this.accelerationY-this.pAccelerationY)}if(accelerationChangeX+accelerationChangeY>shake_threshold){deviceShaken()}}};module.exports=p5},{"../core/core":48}],62:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var downKeys={};p5.prototype.isKeyPressed=false;p5.prototype.keyIsPressed=false;p5.prototype.key="";p5.prototype.keyCode=0;p5.prototype._onkeydown=function(e){if(downKeys[e.which]){return}this._setProperty("isKeyPressed",true);this._setProperty("keyIsPressed",true);this._setProperty("keyCode",e.which);downKeys[e.which]=true;var key=String.fromCharCode(e.which);if(!key){key=e.which}this._setProperty("key",key);var keyPressed=this.keyPressed||window.keyPressed;if(typeof keyPressed==="function"&&!e.charCode){var executeDefault=keyPressed(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._onkeyup=function(e){var keyReleased=this.keyReleased||window.keyReleased;this._setProperty("isKeyPressed",false);this._setProperty("keyIsPressed",false);this._setProperty("_lastKeyCodeTyped",null);downKeys[e.which]=false;var key=String.fromCharCode(e.which);if(!key){key=e.which}this._setProperty("key",key);this._setProperty("keyCode",e.which);if(typeof keyReleased==="function"){var executeDefault=keyReleased(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._onkeypress=function(e){if(e.which===this._lastKeyCodeTyped){return}this._setProperty("keyCode",e.which);this._setProperty("_lastKeyCodeTyped",e.which);this._setProperty("key",String.fromCharCode(e.which));var keyTyped=this.keyTyped||window.keyTyped;if(typeof keyTyped==="function"){var executeDefault=keyTyped(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._onblur=function(e){downKeys={}};p5.prototype.keyIsDown=function(code){return downKeys[code]};module.exports=p5},{"../core/core":48}],63:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");p5.prototype._nextMouseX=0;p5.prototype._nextMouseY=0;p5.prototype.mouseX=0;p5.prototype.mouseY=0;p5.prototype.pmouseX=0;p5.prototype.pmouseY=0;p5.prototype.winMouseX=0;p5.prototype.winMouseY=0;p5.prototype.pwinMouseX=0;p5.prototype.pwinMouseY=0;p5.prototype.mouseButton=0;p5.prototype.mouseIsPressed=false;p5.prototype.isMousePressed=false;p5.prototype._updateNextMouseCoords=function(e){if(e.type==="touchstart"||e.type==="touchmove"||e.type==="touchend"){this._setProperty("_nextMouseX",this._nextTouchX);this._setProperty("_nextMouseY",this._nextTouchY)}else{if(this._curElement!==null){var mousePos=getMousePos(this._curElement.elt,e);this._setProperty("_nextMouseX",mousePos.x);this._setProperty("_nextMouseY",mousePos.y)}}this._setProperty("winMouseX",e.pageX);this._setProperty("winMouseY",e.pageY)};p5.prototype._updateMouseCoords=function(){this._setProperty("pmouseX",this.mouseX);this._setProperty("pmouseY",this.mouseY);this._setProperty("mouseX",this._nextMouseX);this._setProperty("mouseY",this._nextMouseY);this._setProperty("pwinMouseX",this.winMouseX);this._setProperty("pwinMouseY",this.winMouseY)};function getMousePos(canvas,evt){var rect=canvas.getBoundingClientRect();return{x:evt.clientX-rect.left,y:evt.clientY-rect.top}}p5.prototype._setMouseButton=function(e){if(e.button===1){this._setProperty("mouseButton",constants.CENTER)}else if(e.button===2){this._setProperty("mouseButton",constants.RIGHT)}else{this._setProperty("mouseButton",constants.LEFT)}};p5.prototype._onmousemove=function(e){var context=this._isGlobal?window:this;var executeDefault;this._updateNextMouseCoords(e);this._updateNextTouchCoords(e);if(!this.isMousePressed){if(typeof context.mouseMoved==="function"){executeDefault=context.mouseMoved(e);if(executeDefault===false){e.preventDefault()}}}else{if(typeof context.mouseDragged==="function"){executeDefault=context.mouseDragged(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.touchMoved==="function"){executeDefault=context.touchMoved(e);if(executeDefault===false){e.preventDefault()}}}};p5.prototype._onmousedown=function(e){var context=this._isGlobal?window:this;var executeDefault;this._setProperty("isMousePressed",true);this._setProperty("mouseIsPressed",true);this._setMouseButton(e);this._updateNextMouseCoords(e);this._updateNextTouchCoords(e);if(typeof context.mousePressed==="function"){executeDefault=context.mousePressed(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.touchStarted==="function"){executeDefault=context.touchStarted(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._onmouseup=function(e){var context=this._isGlobal?window:this;var executeDefault;this._setProperty("isMousePressed",false);this._setProperty("mouseIsPressed",false);if(typeof context.mouseReleased==="function"){executeDefault=context.mouseReleased(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.touchEnded==="function"){executeDefault=context.touchEnded(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._ondragend=p5.prototype._onmouseup;p5.prototype._ondragover=p5.prototype._onmousemove;p5.prototype._onclick=function(e){var context=this._isGlobal?window:this;if(typeof context.mouseClicked==="function"){var executeDefault=context.mouseClicked(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._onwheel=function(e){var context=this._isGlobal?window:this;if(typeof context.mouseWheel==="function"){e.delta=e.deltaY;var executeDefault=context.mouseWheel(e);if(executeDefault===false){e.preventDefault()}}};module.exports=p5},{"../core/constants":47,"../core/core":48}],64:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");
p5.prototype._nextTouchX=0;p5.prototype._nextTouchY=0;p5.prototype.touchX=0;p5.prototype.touchY=0;p5.prototype.ptouchX=0;p5.prototype.ptouchY=0;p5.prototype.touches=[];p5.prototype.touchIsDown=false;p5.prototype._updateNextTouchCoords=function(e){if(e.type==="mousedown"||e.type==="mousemove"||e.type==="mouseup"){this._setProperty("_nextTouchX",this._nextMouseX);this._setProperty("_nextTouchY",this._nextMouseY)}else{if(this._curElement!==null){var touchInfo=getTouchInfo(this._curElement.elt,e,0);this._setProperty("_nextTouchX",touchInfo.x);this._setProperty("_nextTouchY",touchInfo.y);var touches=[];for(var i=0;i<e.touches.length;i++){touches[i]=getTouchInfo(this._curElement.elt,e,i)}this._setProperty("touches",touches)}}};p5.prototype._updateTouchCoords=function(){this._setProperty("ptouchX",this.touchX);this._setProperty("ptouchY",this.touchY);this._setProperty("touchX",this._nextTouchX);this._setProperty("touchY",this._nextTouchY)};function getTouchInfo(canvas,e,i){i=i||0;var rect=canvas.getBoundingClientRect();var touch=e.touches[i]||e.changedTouches[i];return{x:touch.clientX-rect.left,y:touch.clientY-rect.top,id:touch.identifier}}p5.prototype._ontouchstart=function(e){var context=this._isGlobal?window:this;var executeDefault;this._updateNextTouchCoords(e);this._updateNextMouseCoords(e);this._setProperty("touchIsDown",true);if(typeof context.touchStarted==="function"){executeDefault=context.touchStarted(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.mousePressed==="function"){executeDefault=context.mousePressed(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._ontouchmove=function(e){var context=this._isGlobal?window:this;var executeDefault;this._updateNextTouchCoords(e);this._updateNextMouseCoords(e);if(typeof context.touchMoved==="function"){executeDefault=context.touchMoved(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.mouseDragged==="function"){executeDefault=context.mouseDragged(e);if(executeDefault===false){e.preventDefault()}}};p5.prototype._ontouchend=function(e){this._updateNextTouchCoords(e);this._updateNextMouseCoords(e);if(this.touches.length===0){this._setProperty("touchIsDown",false)}var context=this._isGlobal?window:this;var executeDefault;if(typeof context.touchEnded==="function"){executeDefault=context.touchEnded(e);if(executeDefault===false){e.preventDefault()}}else if(typeof context.mouseReleased==="function"){executeDefault=context.mouseReleased(e);if(executeDefault===false){e.preventDefault()}}};module.exports=p5},{"../core/core":48}],65:[function(_dereq_,module,exports){"use strict";var Filters={};Filters._toPixels=function(canvas){if(canvas instanceof ImageData){return canvas.data}else{return canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height).data}};Filters._getARGB=function(data,i){var offset=i*4;return data[offset+3]<<24&4278190080|data[offset]<<16&16711680|data[offset+1]<<8&65280|data[offset+2]&255};Filters._setPixels=function(pixels,data){var offset=0;for(var i=0,al=pixels.length;i<al;i++){offset=i*4;pixels[offset+0]=(data[i]&16711680)>>>16;pixels[offset+1]=(data[i]&65280)>>>8;pixels[offset+2]=data[i]&255;pixels[offset+3]=(data[i]&4278190080)>>>24}};Filters._toImageData=function(canvas){if(canvas instanceof ImageData){return canvas}else{return canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height)}};Filters._createImageData=function(width,height){Filters._tmpCanvas=document.createElement("canvas");Filters._tmpCtx=Filters._tmpCanvas.getContext("2d");return this._tmpCtx.createImageData(width,height)};Filters.apply=function(canvas,func,filterParam){var ctx=canvas.getContext("2d");var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);var newImageData=func(imageData,filterParam);if(newImageData instanceof ImageData){ctx.putImageData(newImageData,0,0,0,0,canvas.width,canvas.height)}else{ctx.putImageData(imageData,0,0,0,0,canvas.width,canvas.height)}};Filters.threshold=function(canvas,level){var pixels=Filters._toPixels(canvas);if(level===undefined){level=.5}var thresh=Math.floor(level*255);for(var i=0;i<pixels.length;i+=4){var r=pixels[i];var g=pixels[i+1];var b=pixels[i+2];var gray=.2126*r+.7152*g+.0722*b;var val;if(gray>=thresh){val=255}else{val=0}pixels[i]=pixels[i+1]=pixels[i+2]=val}};Filters.gray=function(canvas){var pixels=Filters._toPixels(canvas);for(var i=0;i<pixels.length;i+=4){var r=pixels[i];var g=pixels[i+1];var b=pixels[i+2];var gray=.2126*r+.7152*g+.0722*b;pixels[i]=pixels[i+1]=pixels[i+2]=gray}};Filters.opaque=function(canvas){var pixels=Filters._toPixels(canvas);for(var i=0;i<pixels.length;i+=4){pixels[i+3]=255}return pixels};Filters.invert=function(canvas){var pixels=Filters._toPixels(canvas);for(var i=0;i<pixels.length;i+=4){pixels[i]=255-pixels[i];pixels[i+1]=255-pixels[i+1];pixels[i+2]=255-pixels[i+2]}};Filters.posterize=function(canvas,level){var pixels=Filters._toPixels(canvas);if(level<2||level>255){throw new Error("Level must be greater than 2 and less than 255 for posterize")}var levels1=level-1;for(var i=0;i<pixels.length;i+=4){var rlevel=pixels[i];var glevel=pixels[i+1];var blevel=pixels[i+2];pixels[i]=(rlevel*level>>8)*255/levels1;pixels[i+1]=(glevel*level>>8)*255/levels1;pixels[i+2]=(blevel*level>>8)*255/levels1}};Filters.dilate=function(canvas){var pixels=Filters._toPixels(canvas);var currIdx=0;var maxIdx=pixels.length?pixels.length/4:0;var out=new Int32Array(maxIdx);var currRowIdx,maxRowIdx,colOrig,colOut,currLum;var idxRight,idxLeft,idxUp,idxDown,colRight,colLeft,colUp,colDown,lumRight,lumLeft,lumUp,lumDown;while(currIdx<maxIdx){currRowIdx=currIdx;maxRowIdx=currIdx+canvas.width;while(currIdx<maxRowIdx){colOrig=colOut=Filters._getARGB(pixels,currIdx);idxLeft=currIdx-1;idxRight=currIdx+1;idxUp=currIdx-canvas.width;idxDown=currIdx+canvas.width;if(idxLeft<currRowIdx){idxLeft=currIdx}if(idxRight>=maxRowIdx){idxRight=currIdx}if(idxUp<0){idxUp=0}if(idxDown>=maxIdx){idxDown=currIdx}colUp=Filters._getARGB(pixels,idxUp);colLeft=Filters._getARGB(pixels,idxLeft);colDown=Filters._getARGB(pixels,idxDown);colRight=Filters._getARGB(pixels,idxRight);currLum=77*(colOrig>>16&255)+151*(colOrig>>8&255)+28*(colOrig&255);lumLeft=77*(colLeft>>16&255)+151*(colLeft>>8&255)+28*(colLeft&255);lumRight=77*(colRight>>16&255)+151*(colRight>>8&255)+28*(colRight&255);lumUp=77*(colUp>>16&255)+151*(colUp>>8&255)+28*(colUp&255);lumDown=77*(colDown>>16&255)+151*(colDown>>8&255)+28*(colDown&255);if(lumLeft>currLum){colOut=colLeft;currLum=lumLeft}if(lumRight>currLum){colOut=colRight;currLum=lumRight}if(lumUp>currLum){colOut=colUp;currLum=lumUp}if(lumDown>currLum){colOut=colDown;currLum=lumDown}out[currIdx++]=colOut}}Filters._setPixels(pixels,out)};Filters.erode=function(canvas){var pixels=Filters._toPixels(canvas);var currIdx=0;var maxIdx=pixels.length?pixels.length/4:0;var out=new Int32Array(maxIdx);var currRowIdx,maxRowIdx,colOrig,colOut,currLum;var idxRight,idxLeft,idxUp,idxDown,colRight,colLeft,colUp,colDown,lumRight,lumLeft,lumUp,lumDown;while(currIdx<maxIdx){currRowIdx=currIdx;maxRowIdx=currIdx+canvas.width;while(currIdx<maxRowIdx){colOrig=colOut=Filters._getARGB(pixels,currIdx);idxLeft=currIdx-1;idxRight=currIdx+1;idxUp=currIdx-canvas.width;idxDown=currIdx+canvas.width;if(idxLeft<currRowIdx){idxLeft=currIdx}if(idxRight>=maxRowIdx){idxRight=currIdx}if(idxUp<0){idxUp=0}if(idxDown>=maxIdx){idxDown=currIdx}colUp=Filters._getARGB(pixels,idxUp);colLeft=Filters._getARGB(pixels,idxLeft);colDown=Filters._getARGB(pixels,idxDown);colRight=Filters._getARGB(pixels,idxRight);currLum=77*(colOrig>>16&255)+151*(colOrig>>8&255)+28*(colOrig&255);lumLeft=77*(colLeft>>16&255)+151*(colLeft>>8&255)+28*(colLeft&255);lumRight=77*(colRight>>16&255)+151*(colRight>>8&255)+28*(colRight&255);lumUp=77*(colUp>>16&255)+151*(colUp>>8&255)+28*(colUp&255);lumDown=77*(colDown>>16&255)+151*(colDown>>8&255)+28*(colDown&255);if(lumLeft<currLum){colOut=colLeft;currLum=lumLeft}if(lumRight<currLum){colOut=colRight;currLum=lumRight}if(lumUp<currLum){colOut=colUp;currLum=lumUp}if(lumDown<currLum){colOut=colDown;currLum=lumDown}out[currIdx++]=colOut}}Filters._setPixels(pixels,out)};var blurRadius;var blurKernelSize;var blurKernel;var blurMult;function buildBlurKernel(r){var radius=r*3.5|0;radius=radius<1?1:radius<248?radius:248;if(blurRadius!==radius){blurRadius=radius;blurKernelSize=1+blurRadius<<1;blurKernel=new Int32Array(blurKernelSize);blurMult=new Array(blurKernelSize);for(var l=0;l<blurKernelSize;l++){blurMult[l]=new Int32Array(256)}var bk,bki;var bm,bmi;for(var i=1,radiusi=radius-1;i<radius;i++){blurKernel[radius+i]=blurKernel[radiusi]=bki=radiusi*radiusi;bm=blurMult[radius+i];bmi=blurMult[radiusi--];for(var j=0;j<256;j++){bm[j]=bmi[j]=bki*j}}bk=blurKernel[radius]=radius*radius;bm=blurMult[radius];for(var k=0;k<256;k++){bm[k]=bk*k}}}function blurARGB(canvas,radius){var pixels=Filters._toPixels(canvas);var width=canvas.width;var height=canvas.height;var numPackedPixels=width*height;var argb=new Int32Array(numPackedPixels);for(var j=0;j<numPackedPixels;j++){argb[j]=Filters._getARGB(pixels,j)}var sum,cr,cg,cb,ca;var read,ri,ym,ymi,bk0;var a2=new Int32Array(numPackedPixels);var r2=new Int32Array(numPackedPixels);var g2=new Int32Array(numPackedPixels);var b2=new Int32Array(numPackedPixels);var yi=0;buildBlurKernel(radius);var x,y,i;var bm;for(y=0;y<height;y++){for(x=0;x<width;x++){cb=cg=cr=ca=sum=0;read=x-blurRadius;if(read<0){bk0=-read;read=0}else{if(read>=width){break}bk0=0}for(i=bk0;i<blurKernelSize;i++){if(read>=width){break}var c=argb[read+yi];bm=blurMult[i];ca+=bm[(c&-16777216)>>>24];cr+=bm[(c&16711680)>>16];cg+=bm[(c&65280)>>8];cb+=bm[c&255];sum+=blurKernel[i];read++}ri=yi+x;a2[ri]=ca/sum;r2[ri]=cr/sum;g2[ri]=cg/sum;b2[ri]=cb/sum}yi+=width}yi=0;ym=-blurRadius;ymi=ym*width;for(y=0;y<height;y++){for(x=0;x<width;x++){cb=cg=cr=ca=sum=0;if(ym<0){bk0=ri=-ym;read=x}else{if(ym>=height){break}bk0=0;ri=ym;read=x+ymi}for(i=bk0;i<blurKernelSize;i++){if(ri>=height){break}bm=blurMult[i];ca+=bm[a2[read]];cr+=bm[r2[read]];cg+=bm[g2[read]];cb+=bm[b2[read]];sum+=blurKernel[i];ri++;read+=width}argb[x+yi]=ca/sum<<24|cr/sum<<16|cg/sum<<8|cb/sum}yi+=width;ymi+=width;ym++}Filters._setPixels(pixels,argb)}Filters.blur=function(canvas,radius){blurARGB(canvas,radius)};module.exports=Filters},{}],66:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var frames=[];p5.prototype.createImage=function(width,height){return new p5.Image(width,height)};p5.prototype.saveCanvas=function(){var cnv,filename,extension;if(arguments.length===3){cnv=arguments[0];filename=arguments[1];extension=arguments[2]}else if(arguments.length===2){if(typeof arguments[0]==="object"){cnv=arguments[0];filename=arguments[1]}else{filename=arguments[0];extension=arguments[1]}}else if(arguments.length===1){if(typeof arguments[0]==="object"){cnv=arguments[0]}else{filename=arguments[0]}}if(cnv instanceof p5.Element){cnv=cnv.elt}if(!(cnv instanceof HTMLCanvasElement)){cnv=null}if(!extension){extension=p5.prototype._checkFileExtension(filename,extension)[1];if(extension===""){extension="png"}}if(!cnv){if(this._curElement&&this._curElement.elt){cnv=this._curElement.elt}}if(p5.prototype._isSafari()){var aText="Hello, Safari user!\n";aText+="Now capturing a screenshot...\n";aText+="To save this image,\n";aText+="go to File --> Save As.\n";alert(aText);window.location.href=cnv.toDataURL()}else{var mimeType;if(typeof extension==="undefined"){extension="png";mimeType="image/png"}else{switch(extension){case"png":mimeType="image/png";break;case"jpeg":mimeType="image/jpeg";break;case"jpg":mimeType="image/jpeg";break;default:mimeType="image/png";break}}var downloadMime="image/octet-stream";var imageData=cnv.toDataURL(mimeType);imageData=imageData.replace(mimeType,downloadMime);p5.prototype.downloadFile(imageData,filename,extension)}};p5.prototype.saveFrames=function(fName,ext,_duration,_fps,callback){var duration=_duration||3;duration=p5.prototype.constrain(duration,0,15);duration=duration*1e3;var fps=_fps||15;fps=p5.prototype.constrain(fps,0,22);var count=0;var makeFrame=p5.prototype._makeFrame;var cnv=this._curElement.elt;var frameFactory=setInterval(function(){makeFrame(fName+count,ext,cnv);count++},1e3/fps);setTimeout(function(){clearInterval(frameFactory);if(callback){callback(frames)}else{for(var i=0;i<frames.length;i++){var f=frames[i];p5.prototype.downloadFile(f.imageData,f.filename,f.ext)}}frames=[]},duration+.01)};p5.prototype._makeFrame=function(filename,extension,_cnv){var cnv;if(this){cnv=this._curElement.elt}else{cnv=_cnv}var mimeType;if(!extension){extension="png";mimeType="image/png"}else{switch(extension.toLowerCase()){case"png":mimeType="image/png";break;case"jpeg":mimeType="image/jpeg";break;case"jpg":mimeType="image/jpeg";break;default:mimeType="image/png";break}}var downloadMime="image/octet-stream";var imageData=cnv.toDataURL(mimeType);imageData=imageData.replace(mimeType,downloadMime);var thisFrame={};thisFrame.imageData=imageData;thisFrame.filename=filename;thisFrame.ext=extension;frames.push(thisFrame)};module.exports=p5},{"../core/core":48}],67:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var Filters=_dereq_("./filters");var canvas=_dereq_("../core/canvas");var constants=_dereq_("../core/constants");_dereq_("../core/error_helpers");p5.prototype.loadImage=function(path,successCallback,failureCallback){var img=new Image;var pImg=new p5.Image(1,1,this);var decrementPreload=p5._getDecrementPreload.apply(this,arguments);img.onload=function(){pImg.width=pImg.canvas.width=img.width;pImg.height=pImg.canvas.height=img.height;pImg.drawingContext.drawImage(img,0,0);if(typeof successCallback==="function"){successCallback(pImg)}if(decrementPreload&&successCallback!==decrementPreload){decrementPreload()}};img.onerror=function(e){p5._friendlyFileLoadError(0,img.src);if(typeof failureCallback==="function"&&failureCallback!==decrementPreload){failureCallback(e)}};if(path.indexOf("data:image/")!==0){img.crossOrigin="Anonymous"}img.src=path;return pImg};function _sAssign(sVal,iVal){if(sVal>0&&sVal<iVal){return sVal}else{return iVal}}p5.prototype.image=function(img,sx,sy,sWidth,sHeight,dx,dy,dWidth,dHeight){if(arguments.length<=5){dx=sx||0;dy=sy||0;sx=0;sy=0;if(img.elt&&img.elt.videoWidth&&!img.canvas){var actualW=img.elt.videoWidth;var actualH=img.elt.videoHeight;dWidth=sWidth||img.elt.width;dHeight=sHeight||img.elt.width*actualH/actualW;sWidth=actualW;sHeight=actualH}else{dWidth=sWidth||img.width;dHeight=sHeight||img.height;sWidth=img.width;sHeight=img.height}}else if(arguments.length===9){sx=sx||0;sy=sy||0;sWidth=_sAssign(sWidth,img.width);sHeight=_sAssign(sHeight,img.height);dx=dx||0;dy=dy||0;dWidth=dWidth||img.width;dHeight=dHeight||img.height}else{throw"Wrong number of arguments to image()"}var vals=canvas.modeAdjust(dx,dy,dWidth,dHeight,this._renderer._imageMode);this._renderer.image(img,sx,sy,sWidth,sHeight,vals.x,vals.y,vals.w,vals.h)};p5.prototype.tint=function(){var c=this.color.apply(this,arguments);this._renderer._tint=c.levels};p5.prototype.noTint=function(){this._renderer._tint=null};p5.prototype._getTintedImageCanvas=function(img){if(!img.canvas){return img}var pixels=Filters._toPixels(img.canvas);var tmpCanvas=document.createElement("canvas");tmpCanvas.width=img.canvas.width;tmpCanvas.height=img.canvas.height;var tmpCtx=tmpCanvas.getContext("2d");var id=tmpCtx.createImageData(img.canvas.width,img.canvas.height);var newPixels=id.data;for(var i=0;i<pixels.length;i+=4){var r=pixels[i];var g=pixels[i+1];var b=pixels[i+2];var a=pixels[i+3];newPixels[i]=r*this._renderer._tint[0]/255;newPixels[i+1]=g*this._renderer._tint[1]/255;newPixels[i+2]=b*this._renderer._tint[2]/255;newPixels[i+3]=a*this._renderer._tint[3]/255}tmpCtx.putImageData(id,0,0);return tmpCanvas};p5.prototype.imageMode=function(m){if(m===constants.CORNER||m===constants.CORNERS||m===constants.CENTER){this._renderer._imageMode=m}};module.exports=p5},{"../core/canvas":46,"../core/constants":47,"../core/core":48,"../core/error_helpers":51,"./filters":65}],68:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var Filters=_dereq_("./filters");p5.Image=function(width,height){this.width=width;this.height=height;this.canvas=document.createElement("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.drawingContext=this.canvas.getContext("2d");this._pixelDensity=1;this.isTexture=false;this.pixels=[]};p5.Image.prototype._setProperty=function(prop,value){this[prop]=value};p5.Image.prototype.loadPixels=function(){p5.Renderer2D.prototype.loadPixels.call(this)};p5.Image.prototype.updatePixels=function(x,y,w,h){p5.Renderer2D.prototype.updatePixels.call(this,x,y,w,h)};p5.Image.prototype.get=function(x,y,w,h){return p5.Renderer2D.prototype.get.call(this,x,y,w,h)};p5.Image.prototype.set=function(x,y,imgOrCol){p5.Renderer2D.prototype.set.call(this,x,y,imgOrCol)};p5.Image.prototype.resize=function(width,height){if(width===0&&height===0){width=this.canvas.width;height=this.canvas.height}else if(width===0){width=this.canvas.width*height/this.canvas.height}else if(height===0){height=this.canvas.height*width/this.canvas.width}var tempCanvas=document.createElement("canvas");tempCanvas.width=width;tempCanvas.height=height;tempCanvas.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,tempCanvas.width,tempCanvas.height);this.canvas.width=this.width=width;this.canvas.height=this.height=height;this.drawingContext.drawImage(tempCanvas,0,0,width,height,0,0,width,height);if(this.pixels.length>0){this.loadPixels()}};p5.Image.prototype.copy=function(){p5.prototype.copy.apply(this,arguments)};p5.Image.prototype.mask=function(p5Image){if(p5Image===undefined){p5Image=this}var currBlend=this.drawingContext.globalCompositeOperation;var scaleFactor=1;if(p5Image instanceof p5.Renderer){scaleFactor=p5Image._pInst._pixelDensity}var copyArgs=[p5Image,0,0,scaleFactor*p5Image.width,scaleFactor*p5Image.height,0,0,this.width,this.height];this.drawingContext.globalCompositeOperation="destination-in";this.copy.apply(this,copyArgs);this.drawingContext.globalCompositeOperation=currBlend};p5.Image.prototype.filter=function(operation,value){Filters.apply(this.canvas,Filters[operation.toLowerCase()],value)};p5.Image.prototype.blend=function(){p5.prototype.blend.apply(this,arguments)};p5.Image.prototype.save=function(filename,extension){var mimeType;if(!extension){extension="png";mimeType="image/png"}else{switch(extension.toLowerCase()){case"png":mimeType="image/png";break;case"jpeg":mimeType="image/jpeg";break;case"jpg":mimeType="image/jpeg";break;default:mimeType="image/png";break}}var downloadMime="image/octet-stream";var imageData=this.canvas.toDataURL(mimeType);imageData=imageData.replace(mimeType,downloadMime);p5.prototype.downloadFile(imageData,filename,extension)};p5.Image.prototype.createTexture=function(tex){return this};module.exports=p5.Image},{"../core/core":48,"./filters":65}],69:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var Filters=_dereq_("./filters");_dereq_("../color/p5.Color");p5.prototype.pixels=[];p5.prototype.blend=function(){this._renderer.blend.apply(this._renderer,arguments)};p5.prototype.copy=function(){p5.Renderer2D._copyHelper.apply(this,arguments)};p5.prototype.filter=function(operation,value){Filters.apply(this.canvas,Filters[operation.toLowerCase()],value)};p5.prototype.get=function(x,y,w,h){return this._renderer.get(x,y,w,h)};p5.prototype.loadPixels=function(){this._renderer.loadPixels()};p5.prototype.set=function(x,y,imgOrCol){this._renderer.set(x,y,imgOrCol)};p5.prototype.updatePixels=function(x,y,w,h){if(this.pixels.length===0){return}this._renderer.updatePixels(x,y,w,h)};module.exports=p5},{"../color/p5.Color":42,"../core/core":48,"./filters":65}],70:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var reqwest=_dereq_("reqwest");var opentype=_dereq_("opentype.js");_dereq_("../core/error_helpers");p5._getDecrementPreload=function(){var decrementPreload=arguments[arguments.length-1];if((window.preload||this&&this.preload)&&typeof decrementPreload==="function"){return decrementPreload}else{return null}};p5.prototype.loadFont=function(path,onSuccess,onError){var p5Font=new p5.Font(this);var decrementPreload=p5._getDecrementPreload.apply(this,arguments);opentype.load(path,function(err,font){if(err){if(typeof onError!=="undefined"&&onError!==decrementPreload){return onError(err)}throw err}p5Font.font=font;if(typeof onSuccess!=="undefined"){onSuccess(p5Font)}if(decrementPreload&&onSuccess!==decrementPreload){decrementPreload()}var validFontTypes=["ttf","otf","woff","woff2"],fileNoPath=path.split("\\").pop().split("/").pop(),lastDotIdx=fileNoPath.lastIndexOf("."),fontFamily,newStyle,fileExt=lastDotIdx<1?null:fileNoPath.substr(lastDotIdx+1);if(validFontTypes.indexOf(fileExt)>-1){fontFamily=fileNoPath.substr(0,lastDotIdx);newStyle=document.createElement("style");newStyle.appendChild(document.createTextNode("\n@font-face {"+"\nfont-family: "+fontFamily+";\nsrc: url("+path+");\n}\n"));document.head.appendChild(newStyle)}});return p5Font};p5.prototype.createInput=function(){throw"not yet implemented"};p5.prototype.createReader=function(){throw"not yet implemented"};p5.prototype.loadBytes=function(){throw"not yet implemented"};p5.prototype.loadJSON=function(){var path=arguments[0];var callback=arguments[1];var errorCallback;var decrementPreload=p5._getDecrementPreload.apply(this,arguments);var ret=[];var t="json";for(var i=2;i<arguments.length;i++){var arg=arguments[i];if(typeof arg==="string"){if(arg==="jsonp"||arg==="json"){t=arg}}else if(typeof arg==="function"){errorCallback=arg}}reqwest({url:path,type:t,crossOrigin:true,error:function(resp){if(errorCallback){errorCallback(resp)}else{console.log(resp.statusText)}},success:function(resp){for(var k in resp){ret[k]=resp[k]}if(typeof callback!=="undefined"){callback(resp)}if(decrementPreload&&callback!==decrementPreload){decrementPreload()}}});return ret};p5.prototype.loadStrings=function(path,callback,errorCallback){var ret=[];var req=new XMLHttpRequest;var decrementPreload=p5._getDecrementPreload.apply(this,arguments);req.addEventListener("error",function(resp){if(errorCallback){errorCallback(resp)}else{console.log(resp.responseText)}});req.open("GET",path,true);req.onreadystatechange=function(){if(req.readyState===4){if(req.status===200){var arr=req.responseText.match(/[^\r\n]+/g);for(var k in arr){ret[k]=arr[k]}if(typeof callback!=="undefined"){callback(ret)}if(decrementPreload&&callback!==decrementPreload){decrementPreload()}}else{if(errorCallback){errorCallback(req)}else{console.log(req.statusText)}}}};req.send(null);return ret};p5.prototype.loadTable=function(path){var callback=null;var options=[];var header=false;var sep=",";var separatorSet=false;var decrementPreload=p5._getDecrementPreload.apply(this,arguments);for(var i=1;i<arguments.length;i++){if(typeof arguments[i]==="function"&&arguments[i]!==decrementPreload){callback=arguments[i]}else if(typeof arguments[i]==="string"){options.push(arguments[i]);if(arguments[i]==="header"){header=true}if(arguments[i]==="csv"){if(separatorSet){throw new Error("Cannot set multiple separator types.")}else{sep=",";separatorSet=true}}else if(arguments[i]==="tsv"){if(separatorSet){throw new Error("Cannot set multiple separator types.")}else{sep="	";separatorSet=true}}}}var t=new p5.Table;reqwest({url:path,crossOrigin:true,type:"csv"}).then(function(resp){resp=resp.responseText;var state={};var PRE_TOKEN=0,MID_TOKEN=1,POST_TOKEN=2,POST_RECORD=4;var QUOTE='"',CR="\r",LF="\n";var records=[];var offset=0;var currentRecord=null;var currentChar;var recordBegin=function(){state.escaped=false;currentRecord=[];tokenBegin()};var recordEnd=function(){state.currentState=POST_RECORD;records.push(currentRecord);currentRecord=null};var tokenBegin=function(){state.currentState=PRE_TOKEN;state.token=""};var tokenEnd=function(){currentRecord.push(state.token);tokenBegin()};while(true){currentChar=resp[offset++];if(currentChar==null){if(state.escaped){throw new Error("Unclosed quote in file.")}if(currentRecord){tokenEnd();recordEnd();break}}if(currentRecord===null){recordBegin()}if(state.currentState===PRE_TOKEN){if(currentChar===QUOTE){state.escaped=true;state.currentState=MID_TOKEN;continue}state.currentState=MID_TOKEN}if(state.currentState===MID_TOKEN&&state.escaped){if(currentChar===QUOTE){if(resp[offset]===QUOTE){state.token+=QUOTE;offset++}else{state.escaped=false;state.currentState=POST_TOKEN}}else{state.token+=currentChar}continue}if(currentChar===CR){if(resp[offset]===LF){offset++}tokenEnd();recordEnd()}else if(currentChar===LF){tokenEnd();recordEnd()}else if(currentChar===sep){tokenEnd()}else if(state.currentState===MID_TOKEN){state.token+=currentChar}}if(header){t.columns=records.shift()}else{for(i=0;i<records[0].length;i++){t.columns[i]="null"}}var row;for(i=0;i<records.length;i++){if(i===records.length-1&&records[i].length===1){if(records[i][0]==="undefined"){break}}row=new p5.TableRow;row.arr=records[i];row.obj=makeObject(records[i],t.columns);t.addRow(row)}if(callback!==null){callback(t)}if(decrementPreload&&callback!==decrementPreload){decrementPreload()}}).fail(function(err,msg){p5._friendlyFileLoadError(2,path);if(typeof callback!=="undefined"&&callback!==decrementPreload){callback(false)}});return t};function makeObject(row,headers){var ret={};headers=headers||[];if(typeof headers==="undefined"){for(var j=0;j<row.length;j++){headers[j.toString()]=j}}for(var i=0;i<headers.length;i++){var key=headers[i];var val=row[i];ret[key]=val}return ret}p5.prototype.loadXML=function(path,callback,errorCallback){var ret=document.implementation.createDocument(null,null);var decrementPreload=p5._getDecrementPreload.apply(this,arguments);reqwest({url:path,type:"xml",crossOrigin:true,error:function(resp){if(errorCallback){errorCallback(resp)}else{console.log(resp.statusText)}}}).then(function(resp){var x=resp.documentElement;ret.appendChild(x);if(typeof callback!=="undefined"){callback(ret)}if(decrementPreload&&callback!==decrementPreload){decrementPreload()}});return ret};p5.prototype.parseXML=function(){throw"not yet implemented"};p5.prototype.selectFolder=function(){throw"not yet implemented"};p5.prototype.selectInput=function(){throw"not yet implemented"};p5.prototype.httpGet=function(){var args=Array.prototype.slice.call(arguments);args.push("GET");p5.prototype.httpDo.apply(this,args)};p5.prototype.httpPost=function(){var args=Array.prototype.slice.call(arguments);args.push("POST");p5.prototype.httpDo.apply(this,args)};p5.prototype.httpDo=function(){if(typeof arguments[0]==="object"){reqwest(arguments[0])}else{var method="GET";var path=arguments[0];var data={};var type="";var callback;var errorCallback;for(var i=1;i<arguments.length;i++){var a=arguments[i];if(typeof a==="string"){if(a==="GET"||a==="POST"||a==="PUT"){method=a}else{type=a}}else if(typeof a==="object"){data=a}else if(typeof a==="function"){if(!callback){callback=a}else{errorCallback=a}}}if(type===""){if(path.indexOf("json")!==-1){type="json"}else if(path.indexOf("xml")!==-1){type="xml"}else{type="text"}}reqwest({url:path,method:method,data:data,type:type,crossOrigin:true,success:function(resp){if(typeof callback!=="undefined"){if(type==="text"){callback(resp.response)}else{callback(resp)}}},error:function(resp){if(errorCallback){errorCallback(resp)}else{console.log(resp.statusText)}}})}};window.URL=window.URL||window.webkitURL;p5.prototype._pWriters=[];p5.prototype.beginRaw=function(){throw"not yet implemented"};p5.prototype.beginRecord=function(){throw"not yet implemented"};p5.prototype.createOutput=function(){throw"not yet implemented"};p5.prototype.createWriter=function(name,extension){var newPW;for(var i in p5.prototype._pWriters){if(p5.prototype._pWriters[i].name===name){newPW=new p5.PrintWriter(name+window.millis(),extension);p5.prototype._pWriters.push(newPW);return newPW}}newPW=new p5.PrintWriter(name,extension);p5.prototype._pWriters.push(newPW);return newPW};p5.prototype.endRaw=function(){throw"not yet implemented"};p5.prototype.endRecord=function(){throw"not yet implemented"};p5.PrintWriter=function(filename,extension){var self=this;this.name=filename;this.content="";this.print=function(data){this.content+=data};this.println=function(data){this.content+=data+"\n"};this.flush=function(){this.content=""};this.close=function(){var arr=[];arr.push(this.content);p5.prototype.writeFile(arr,filename,extension);for(var i in p5.prototype._pWriters){if(p5.prototype._pWriters[i].name===this.name){p5.prototype._pWriters.splice(i,1)}}self.flush();self={}}};p5.prototype.saveBytes=function(){throw"not yet implemented"};p5.prototype.save=function(object,_filename,_options){var args=arguments;var cnv=this._curElement.elt;if(args.length===0){p5.prototype.saveCanvas(cnv);return}else if(args[0]instanceof p5.Renderer||args[0]instanceof p5.Graphics){p5.prototype.saveCanvas(args[0].elt,args[1],args[2]);return}else if(args.length===1&&typeof args[0]==="string"){p5.prototype.saveCanvas(cnv,args[0])}else{var extension=_checkFileExtension(args[1],args[2])[1];switch(extension){case"json":p5.prototype.saveJSON(args[0],args[1],args[2]);return;case"txt":p5.prototype.saveStrings(args[0],args[1],args[2]);return;default:if(args[0]instanceof Array){p5.prototype.saveStrings(args[0],args[1],args[2])}else if(args[0]instanceof p5.Table){p5.prototype.saveTable(args[0],args[1],args[2],args[3])}else if(args[0]instanceof p5.Image){p5.prototype.saveCanvas(args[0].canvas,args[1])}else if(args[0]instanceof p5.SoundFile){p5.prototype.saveSound(args[0],args[1],args[2],args[3])}}}};p5.prototype.saveJSON=function(json,filename,opt){var stringify;if(opt){stringify=JSON.stringify(json)}else{stringify=JSON.stringify(json,undefined,2)}console.log(stringify);this.saveStrings(stringify.split("\n"),filename,"json")};p5.prototype.saveJSONObject=p5.prototype.saveJSON;p5.prototype.saveJSONArray=p5.prototype.saveJSON;p5.prototype.saveStream=function(){throw"not yet implemented"};p5.prototype.saveStrings=function(list,filename,extension){var ext=extension||"txt";var pWriter=this.createWriter(filename,ext);for(var i=0;i<list.length;i++){if(i<list.length-1){pWriter.println(list[i])}else{pWriter.print(list[i])}}pWriter.close();pWriter.flush()};p5.prototype.saveXML=function(){throw"not yet implemented"};p5.prototype.selectOutput=function(){throw"not yet implemented"};function escapeHelper(content){return content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}p5.prototype.saveTable=function(table,filename,options){var pWriter=this.createWriter(filename,options);var header=table.columns;var sep=",";if(options==="tsv"){sep="	"}if(options!=="html"){if(header[0]!=="0"){for(var h=0;h<header.length;h++){if(h<header.length-1){pWriter.print(header[h]+sep)}else{pWriter.println(header[h])}}}for(var i=0;i<table.rows.length;i++){var j;for(j=0;j<table.rows[i].arr.length;j++){if(j<table.rows[i].arr.length-1){pWriter.print(table.rows[i].arr[j]+sep)}else if(i<table.rows.length-1){pWriter.println(table.rows[i].arr[j])}else{pWriter.print(table.rows[i].arr[j])}}}}else{pWriter.println("<html>");pWriter.println("<head>");var str='  <meta http-equiv="content-type" content';str+='="text/html;charset=utf-8" />';pWriter.println(str);pWriter.println("</head>");pWriter.println("<body>");pWriter.println("  <table>");if(header[0]!=="0"){pWriter.println("    <tr>");for(var k=0;k<header.length;k++){var e=escapeHelper(header[k]);pWriter.println("      <td>"+e);pWriter.println("      </td>")}pWriter.println("    </tr>")}for(var row=0;row<table.rows.length;row++){pWriter.println("    <tr>");for(var col=0;col<table.columns.length;col++){var entry=table.rows[row].getString(col);var htmlEntry=escapeHelper(entry);pWriter.println("      <td>"+htmlEntry);pWriter.println("      </td>")}pWriter.println("    </tr>")}pWriter.println("  </table>");pWriter.println("</body>");pWriter.print("</html>")}pWriter.close();
pWriter.flush()};p5.prototype.writeFile=function(dataToDownload,filename,extension){var type="application/octet-stream";if(p5.prototype._isSafari()){type="text/plain"}var blob=new Blob(dataToDownload,{type:type});var href=window.URL.createObjectURL(blob);p5.prototype.downloadFile(href,filename,extension)};p5.prototype.downloadFile=function(href,fName,extension){var fx=_checkFileExtension(fName,extension);var filename=fx[0];var ext=fx[1];var a=document.createElement("a");a.href=href;a.download=filename;a.onclick=destroyClickedElement;a.style.display="none";document.body.appendChild(a);if(p5.prototype._isSafari()){var aText="Hello, Safari user! To download this file...\n";aText+="1. Go to File --> Save As.\n";aText+='2. Choose "Page Source" as the Format.\n';aText+='3. Name it with this extension: ."'+ext+'"';alert(aText)}a.click();href=null};function _checkFileExtension(filename,extension){if(!extension||extension===true||extension==="true"){extension=""}if(!filename){filename="untitled"}var ext="";if(filename&&filename.indexOf(".")>-1){ext=filename.split(".").pop()}if(extension){if(ext!==extension){ext=extension;filename=filename+"."+ext}}return[filename,ext]}p5.prototype._checkFileExtension=_checkFileExtension;p5.prototype._isSafari=function(){var x=Object.prototype.toString.call(window.HTMLElement);return x.indexOf("Constructor")>0};function destroyClickedElement(event){document.body.removeChild(event.target)}module.exports=p5},{"../core/core":48,"../core/error_helpers":51,"opentype.js":8,reqwest:27}],71:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.Table=function(rows){this.columns=[];this.rows=[]};p5.Table.prototype.addRow=function(row){var r=row||new p5.TableRow;if(typeof r.arr==="undefined"||typeof r.obj==="undefined"){throw"invalid TableRow: "+r}r.table=this;this.rows.push(r);return r};p5.Table.prototype.removeRow=function(id){this.rows[id].table=null;var chunk=this.rows.splice(id+1,this.rows.length);this.rows.pop();this.rows=this.rows.concat(chunk)};p5.Table.prototype.getRow=function(r){return this.rows[r]};p5.Table.prototype.getRows=function(){return this.rows};p5.Table.prototype.findRow=function(value,column){if(typeof column==="string"){for(var i=0;i<this.rows.length;i++){if(this.rows[i].obj[column]===value){return this.rows[i]}}}else{for(var j=0;j<this.rows.length;j++){if(this.rows[j].arr[column]===value){return this.rows[j]}}}return null};p5.Table.prototype.findRows=function(value,column){var ret=[];if(typeof column==="string"){for(var i=0;i<this.rows.length;i++){if(this.rows[i].obj[column]===value){ret.push(this.rows[i])}}}else{for(var j=0;j<this.rows.length;j++){if(this.rows[j].arr[column]===value){ret.push(this.rows[j])}}}return ret};p5.Table.prototype.matchRow=function(regexp,column){if(typeof column==="number"){for(var j=0;j<this.rows.length;j++){if(this.rows[j].arr[column].match(regexp)){return this.rows[j]}}}else{for(var i=0;i<this.rows.length;i++){if(this.rows[i].obj[column].match(regexp)){return this.rows[i]}}}return null};p5.Table.prototype.matchRows=function(regexp,column){var ret=[];if(typeof column==="number"){for(var j=0;j<this.rows.length;j++){if(this.rows[j].arr[column].match(regexp)){ret.push(this.rows[j])}}}else{for(var i=0;i<this.rows.length;i++){if(this.rows[i].obj[column].match(regexp)){ret.push(this.rows[i])}}}return ret};p5.Table.prototype.getColumn=function(value){var ret=[];if(typeof value==="string"){for(var i=0;i<this.rows.length;i++){ret.push(this.rows[i].obj[value])}}else{for(var j=0;j<this.rows.length;j++){ret.push(this.rows[j].arr[value])}}return ret};p5.Table.prototype.clearRows=function(){delete this.rows;this.rows=[]};p5.Table.prototype.addColumn=function(title){var t=title||null;this.columns.push(t)};p5.Table.prototype.getColumnCount=function(){return this.columns.length};p5.Table.prototype.getRowCount=function(){return this.rows.length};p5.Table.prototype.removeTokens=function(chars,column){var escape=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};var charArray=[];for(var i=0;i<chars.length;i++){charArray.push(escape(chars.charAt(i)))}var regex=new RegExp(charArray.join("|"),"g");if(typeof column==="undefined"){for(var c=0;c<this.columns.length;c++){for(var d=0;d<this.rows.length;d++){var s=this.rows[d].arr[c];s=s.replace(regex,"");this.rows[d].arr[c]=s;this.rows[d].obj[this.columns[c]]=s}}}else if(typeof column==="string"){for(var j=0;j<this.rows.length;j++){var val=this.rows[j].obj[column];val=val.replace(regex,"");this.rows[j].obj[column]=val;var pos=this.columns.indexOf(column);this.rows[j].arr[pos]=val}}else{for(var k=0;k<this.rows.length;k++){var str=this.rows[k].arr[column];str=str.replace(regex,"");this.rows[k].arr[column]=str;this.rows[k].obj[this.columns[column]]=str}}};p5.Table.prototype.trim=function(column){var regex=new RegExp(" ","g");if(typeof column==="undefined"){for(var c=0;c<this.columns.length;c++){for(var d=0;d<this.rows.length;d++){var s=this.rows[d].arr[c];s=s.replace(regex,"");this.rows[d].arr[c]=s;this.rows[d].obj[this.columns[c]]=s}}}else if(typeof column==="string"){for(var j=0;j<this.rows.length;j++){var val=this.rows[j].obj[column];val=val.replace(regex,"");this.rows[j].obj[column]=val;var pos=this.columns.indexOf(column);this.rows[j].arr[pos]=val}}else{for(var k=0;k<this.rows.length;k++){var str=this.rows[k].arr[column];str=str.replace(regex,"");this.rows[k].arr[column]=str;this.rows[k].obj[this.columns[column]]=str}}};p5.Table.prototype.removeColumn=function(c){var cString;var cNumber;if(typeof c==="string"){cString=c;cNumber=this.columns.indexOf(c);console.log("string")}else{cNumber=c;cString=this.columns[c]}var chunk=this.columns.splice(cNumber+1,this.columns.length);this.columns.pop();this.columns=this.columns.concat(chunk);for(var i=0;i<this.rows.length;i++){var tempR=this.rows[i].arr;var chip=tempR.splice(cNumber+1,tempR.length);tempR.pop();this.rows[i].arr=tempR.concat(chip);delete this.rows[i].obj[cString]}};p5.Table.prototype.set=function(row,column,value){this.rows[row].set(column,value)};p5.Table.prototype.setNum=function(row,column,value){this.rows[row].setNum(column,value)};p5.Table.prototype.setString=function(row,column,value){this.rows[row].setString(column,value)};p5.Table.prototype.get=function(row,column){return this.rows[row].get(column)};p5.Table.prototype.getNum=function(row,column){return this.rows[row].getNum(column)};p5.Table.prototype.getString=function(row,column){return this.rows[row].getString(column)};p5.Table.prototype.getObject=function(headerColumn){var tableObject={};var obj,cPos,index;for(var i=0;i<this.rows.length;i++){obj=this.rows[i].obj;if(typeof headerColumn==="string"){cPos=this.columns.indexOf(headerColumn);if(cPos>=0){index=obj[headerColumn];tableObject[index]=obj}else{throw'This table has no column named "'+headerColumn+'"'}}else{tableObject[i]=this.rows[i].obj}}return tableObject};p5.Table.prototype.getArray=function(){var tableArray=[];for(var i=0;i<this.rows.length;i++){tableArray.push(this.rows[i].arr)}return tableArray};module.exports=p5.Table},{"../core/core":48}],72:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.TableRow=function(str,separator){var arr=[];var obj={};if(str){separator=separator||",";arr=str.split(separator)}for(var i=0;i<arr.length;i++){var key=i;var val=arr[i];obj[key]=val}this.arr=arr;this.obj=obj;this.table=null};p5.TableRow.prototype.set=function(column,value){if(typeof column==="string"){var cPos=this.table.columns.indexOf(column);if(cPos>=0){this.obj[column]=value;this.arr[cPos]=value}else{throw'This table has no column named "'+column+'"'}}else{if(column<this.table.columns.length){this.arr[column]=value;var cTitle=this.table.columns[column];this.obj[cTitle]=value}else{throw"Column #"+column+" is out of the range of this table"}}};p5.TableRow.prototype.setNum=function(column,value){var floatVal=parseFloat(value,10);this.set(column,floatVal)};p5.TableRow.prototype.setString=function(column,value){var stringVal=value.toString();this.set(column,stringVal)};p5.TableRow.prototype.get=function(column){if(typeof column==="string"){return this.obj[column]}else{return this.arr[column]}};p5.TableRow.prototype.getNum=function(column){var ret;if(typeof column==="string"){ret=parseFloat(this.obj[column],10)}else{ret=parseFloat(this.arr[column],10)}if(ret.toString()==="NaN"){throw"Error: "+this.obj[column]+" is NaN (Not a Number)"}return ret};p5.TableRow.prototype.getString=function(column){if(typeof column==="string"){return this.obj[column].toString()}else{return this.arr[column].toString()}};module.exports=p5.TableRow},{"../core/core":48}],73:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.abs=Math.abs;p5.prototype.ceil=Math.ceil;p5.prototype.constrain=function(n,low,high){return Math.max(Math.min(n,high),low)};p5.prototype.dist=function(x1,y1,z1,x2,y2,z2){if(arguments.length===4){return Math.sqrt((z1-x1)*(z1-x1)+(x2-y1)*(x2-y1))}else if(arguments.length===6){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)+(z2-z1)*(z2-z1))}};p5.prototype.exp=Math.exp;p5.prototype.floor=Math.floor;p5.prototype.lerp=function(start,stop,amt){return amt*(stop-start)+start};p5.prototype.log=Math.log;p5.prototype.mag=function(x,y){return Math.sqrt(x*x+y*y)};p5.prototype.map=function(n,start1,stop1,start2,stop2){return(n-start1)/(stop1-start1)*(stop2-start2)+start2};p5.prototype.max=function(){if(arguments[0]instanceof Array){return Math.max.apply(null,arguments[0])}else{return Math.max.apply(null,arguments)}};p5.prototype.min=function(){if(arguments[0]instanceof Array){return Math.min.apply(null,arguments[0])}else{return Math.min.apply(null,arguments)}};p5.prototype.norm=function(n,start,stop){return this.map(n,start,stop,0,1)};p5.prototype.pow=Math.pow;p5.prototype.round=Math.round;p5.prototype.sq=function(n){return n*n};p5.prototype.sqrt=Math.sqrt;module.exports=p5},{"../core/core":48}],74:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.createVector=function(x,y,z){if(this instanceof p5){return new p5.Vector(this,arguments)}else{return new p5.Vector(x,y,z)}};module.exports=p5},{"../core/core":48}],75:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var PERLIN_YWRAPB=4;var PERLIN_YWRAP=1<<PERLIN_YWRAPB;var PERLIN_ZWRAPB=8;var PERLIN_ZWRAP=1<<PERLIN_ZWRAPB;var PERLIN_SIZE=4095;var perlin_octaves=4;var perlin_amp_falloff=.5;var scaled_cosine=function(i){return.5*(1-Math.cos(i*Math.PI))};var perlin;p5.prototype.noise=function(x,y,z){y=y||0;z=z||0;if(perlin==null){perlin=new Array(PERLIN_SIZE+1);for(var i=0;i<PERLIN_SIZE+1;i++){perlin[i]=Math.random()}}if(x<0){x=-x}if(y<0){y=-y}if(z<0){z=-z}var xi=Math.floor(x),yi=Math.floor(y),zi=Math.floor(z);var xf=x-xi;var yf=y-yi;var zf=z-zi;var rxf,ryf;var r=0;var ampl=.5;var n1,n2,n3;for(var o=0;o<perlin_octaves;o++){var of=xi+(yi<<PERLIN_YWRAPB)+(zi<<PERLIN_ZWRAPB);rxf=scaled_cosine(xf);ryf=scaled_cosine(yf);n1=perlin[of&PERLIN_SIZE];n1+=rxf*(perlin[of+1&PERLIN_SIZE]-n1);n2=perlin[of+PERLIN_YWRAP&PERLIN_SIZE];n2+=rxf*(perlin[of+PERLIN_YWRAP+1&PERLIN_SIZE]-n2);n1+=ryf*(n2-n1);of+=PERLIN_ZWRAP;n2=perlin[of&PERLIN_SIZE];n2+=rxf*(perlin[of+1&PERLIN_SIZE]-n2);n3=perlin[of+PERLIN_YWRAP&PERLIN_SIZE];n3+=rxf*(perlin[of+PERLIN_YWRAP+1&PERLIN_SIZE]-n3);n2+=ryf*(n3-n2);n1+=scaled_cosine(zf)*(n2-n1);r+=n1*ampl;ampl*=perlin_amp_falloff;xi<<=1;xf*=2;yi<<=1;yf*=2;zi<<=1;zf*=2;if(xf>=1){xi++;xf--}if(yf>=1){yi++;yf--}if(zf>=1){zi++;zf--}}return r};p5.prototype.noiseDetail=function(lod,falloff){if(lod>0){perlin_octaves=lod}if(falloff>0){perlin_amp_falloff=falloff}};p5.prototype.noiseSeed=function(seed){var lcg=function(){var m=4294967296,a=1664525,c=1013904223,seed,z;return{setSeed:function(val){z=seed=(val==null?Math.random()*m:val)>>>0},getSeed:function(){return seed},rand:function(){z=(a*z+c)%m;return z/m}}}();lcg.setSeed(seed);perlin=new Array(PERLIN_SIZE+1);for(var i=0;i<PERLIN_SIZE+1;i++){perlin[i]=lcg.rand()}};module.exports=p5},{"../core/core":48}],76:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var polarGeometry=_dereq_("./polargeometry");var constants=_dereq_("../core/constants");p5.Vector=function(){var x,y,z;if(arguments[0]instanceof p5){this.p5=arguments[0];x=arguments[1][0]||0;y=arguments[1][1]||0;z=arguments[1][2]||0}else{x=arguments[0]||0;y=arguments[1]||0;z=arguments[2]||0}this.x=x;this.y=y;this.z=z};p5.Vector.prototype.toString=function p5VectorToString(){return"p5.Vector Object : ["+this.x+", "+this.y+", "+this.z+"]"};p5.Vector.prototype.set=function(x,y,z){if(x instanceof p5.Vector){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;return this}if(x instanceof Array){this.x=x[0]||0;this.y=x[1]||0;this.z=x[2]||0;return this}this.x=x||0;this.y=y||0;this.z=z||0;return this};p5.Vector.prototype.copy=function(){if(this.p5){return new p5.Vector(this.p5,[this.x,this.y,this.z])}else{return new p5.Vector(this.x,this.y,this.z)}};p5.Vector.prototype.add=function(x,y,z){if(x instanceof p5.Vector){this.x+=x.x||0;this.y+=x.y||0;this.z+=x.z||0;return this}if(x instanceof Array){this.x+=x[0]||0;this.y+=x[1]||0;this.z+=x[2]||0;return this}this.x+=x||0;this.y+=y||0;this.z+=z||0;return this};p5.Vector.prototype.sub=function(x,y,z){if(x instanceof p5.Vector){this.x-=x.x||0;this.y-=x.y||0;this.z-=x.z||0;return this}if(x instanceof Array){this.x-=x[0]||0;this.y-=x[1]||0;this.z-=x[2]||0;return this}this.x-=x||0;this.y-=y||0;this.z-=z||0;return this};p5.Vector.prototype.mult=function(n){this.x*=n||0;this.y*=n||0;this.z*=n||0;return this};p5.Vector.prototype.div=function(n){this.x/=n;this.y/=n;this.z/=n;return this};p5.Vector.prototype.mag=function(){return Math.sqrt(this.magSq())};p5.Vector.prototype.magSq=function(){var x=this.x,y=this.y,z=this.z;return x*x+y*y+z*z};p5.Vector.prototype.dot=function(x,y,z){if(x instanceof p5.Vector){return this.dot(x.x,x.y,x.z)}return this.x*(x||0)+this.y*(y||0)+this.z*(z||0)};p5.Vector.prototype.cross=function(v){var x=this.y*v.z-this.z*v.y;var y=this.z*v.x-this.x*v.z;var z=this.x*v.y-this.y*v.x;if(this.p5){return new p5.Vector(this.p5,[x,y,z])}else{return new p5.Vector(x,y,z)}};p5.Vector.prototype.dist=function(v){var d=v.copy().sub(this);return d.mag()};p5.Vector.prototype.normalize=function(){return this.div(this.mag())};p5.Vector.prototype.limit=function(l){var mSq=this.magSq();if(mSq>l*l){this.div(Math.sqrt(mSq));this.mult(l)}return this};p5.Vector.prototype.setMag=function(n){return this.normalize().mult(n)};p5.Vector.prototype.heading=function(){var h=Math.atan2(this.y,this.x);if(this.p5){if(this.p5._angleMode===constants.RADIANS){return h}else{return polarGeometry.radiansToDegrees(h)}}else{return h}};p5.Vector.prototype.rotate=function(a){if(this.p5){if(this.p5._angleMode===constants.DEGREES){a=polarGeometry.degreesToRadians(a)}}var newHeading=this.heading()+a;var mag=this.mag();this.x=Math.cos(newHeading)*mag;this.y=Math.sin(newHeading)*mag;return this};p5.Vector.prototype.lerp=function(x,y,z,amt){if(x instanceof p5.Vector){return this.lerp(x.x,x.y,x.z,y)}this.x+=(x-this.x)*amt||0;this.y+=(y-this.y)*amt||0;this.z+=(z-this.z)*amt||0;return this};p5.Vector.prototype.array=function(){return[this.x||0,this.y||0,this.z||0]};p5.Vector.prototype.equals=function(x,y,z){var a,b,c;if(x instanceof p5.Vector){a=x.x||0;b=x.y||0;c=x.z||0}else if(x instanceof Array){a=x[0]||0;b=x[1]||0;c=x[2]||0}else{a=x||0;b=y||0;c=z||0}return this.x===a&&this.y===b&&this.z===c};p5.Vector.fromAngle=function(angle){if(this.p5){if(this.p5._angleMode===constants.DEGREES){angle=polarGeometry.degreesToRadians(angle)}}if(this.p5){return new p5.Vector(this.p5,[Math.cos(angle),Math.sin(angle),0])}else{return new p5.Vector(Math.cos(angle),Math.sin(angle),0)}};p5.Vector.random2D=function(){var angle;if(this.p5){if(this.p5._angleMode===constants.DEGREES){angle=this.p5.random(360)}else{angle=this.p5.random(constants.TWO_PI)}}else{angle=Math.random()*Math.PI*2}return this.fromAngle(angle)};p5.Vector.random3D=function(){var angle,vz;if(this.p5){angle=this.p5.random(0,constants.TWO_PI);vz=this.p5.random(-1,1)}else{angle=Math.random()*Math.PI*2;vz=Math.random()*2-1}var vx=Math.sqrt(1-vz*vz)*Math.cos(angle);var vy=Math.sqrt(1-vz*vz)*Math.sin(angle);if(this.p5){return new p5.Vector(this.p5,[vx,vy,vz])}else{return new p5.Vector(vx,vy,vz)}};p5.Vector.add=function(v1,v2,target){if(!target){target=v1.copy()}else{target.set(v1)}target.add(v2);return target};p5.Vector.sub=function(v1,v2,target){if(!target){target=v1.copy()}else{target.set(v1)}target.sub(v2);return target};p5.Vector.mult=function(v,n,target){if(!target){target=v.copy()}else{target.set(v)}target.mult(n);return target};p5.Vector.div=function(v,n,target){if(!target){target=v.copy()}else{target.set(v)}target.div(n);return target};p5.Vector.dot=function(v1,v2){return v1.dot(v2)};p5.Vector.cross=function(v1,v2){return v1.cross(v2)};p5.Vector.dist=function(v1,v2){return v1.dist(v2)};p5.Vector.lerp=function(v1,v2,amt,target){if(!target){target=v1.copy()}else{target.set(v1)}target.lerp(v2,amt);return target};p5.Vector.angleBetween=function(v1,v2){var angle=Math.acos(v1.dot(v2)/(v1.mag()*v2.mag()));if(this.p5){if(this.p5._angleMode===constants.DEGREES){angle=polarGeometry.radiansToDegrees(angle)}}return angle};module.exports=p5.Vector},{"../core/constants":47,"../core/core":48,"./polargeometry":77}],77:[function(_dereq_,module,exports){module.exports={degreesToRadians:function(x){return 2*Math.PI*x/360},radiansToDegrees:function(x){return 360*x/(2*Math.PI)}}},{}],78:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var seeded=false;var lcg=function(){var m=4294967296,a=1664525,c=1013904223,seed,z;return{setSeed:function(val){z=seed=(val==null?Math.random()*m:val)>>>0},getSeed:function(){return seed},rand:function(){z=(a*z+c)%m;return z/m}}}();p5.prototype.randomSeed=function(seed){lcg.setSeed(seed);seeded=true};p5.prototype.random=function(min,max){var rand;if(seeded){rand=lcg.rand()}else{rand=Math.random()}if(arguments.length===0){return rand}else if(arguments.length===1){return rand*min}else{if(min>max){var tmp=min;min=max;max=tmp}return rand*(max-min)+min}};var y2;var previous=false;p5.prototype.randomGaussian=function(mean,sd){var y1,x1,x2,w;if(previous){y1=y2;previous=false}else{do{x1=this.random(2)-1;x2=this.random(2)-1;w=x1*x1+x2*x2}while(w>=1);w=Math.sqrt(-2*Math.log(w)/w);y1=x1*w;y2=x2*w;previous=true}var m=mean||0;var s=sd||1;return y1*s+m};module.exports=p5},{"../core/core":48}],79:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var polarGeometry=_dereq_("./polargeometry");var constants=_dereq_("../core/constants");p5.prototype._angleMode=constants.RADIANS;p5.prototype.acos=function(ratio){if(this._angleMode===constants.RADIANS){return Math.acos(ratio)}else{return polarGeometry.radiansToDegrees(Math.acos(ratio))}};p5.prototype.asin=function(ratio){if(this._angleMode===constants.RADIANS){return Math.asin(ratio)}else{return polarGeometry.radiansToDegrees(Math.asin(ratio))}};p5.prototype.atan=function(ratio){if(this._angleMode===constants.RADIANS){return Math.atan(ratio)}else{return polarGeometry.radiansToDegrees(Math.atan(ratio))}};p5.prototype.atan2=function(y,x){if(this._angleMode===constants.RADIANS){return Math.atan2(y,x)}else{return polarGeometry.radiansToDegrees(Math.atan2(y,x))}};p5.prototype.cos=function(angle){if(this._angleMode===constants.RADIANS){return Math.cos(angle)}else{return Math.cos(this.radians(angle))}};p5.prototype.sin=function(angle){if(this._angleMode===constants.RADIANS){return Math.sin(angle)}else{return Math.sin(this.radians(angle))}};p5.prototype.tan=function(angle){if(this._angleMode===constants.RADIANS){return Math.tan(angle)}else{return Math.tan(this.radians(angle))}};p5.prototype.degrees=function(angle){return polarGeometry.radiansToDegrees(angle)};p5.prototype.radians=function(angle){return polarGeometry.degreesToRadians(angle)};p5.prototype.angleMode=function(mode){if(mode===constants.DEGREES||mode===constants.RADIANS){this._angleMode=mode}};module.exports=p5},{"../core/constants":47,"../core/core":48,"./polargeometry":77}],80:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.textAlign=function(horizAlign,vertAlign){return this._renderer.textAlign.apply(this._renderer,arguments)};p5.prototype.textLeading=function(theLeading){return this._renderer.textLeading.apply(this._renderer,arguments)};p5.prototype.textSize=function(theSize){return this._renderer.textSize.apply(this._renderer,arguments)};p5.prototype.textStyle=function(theStyle){return this._renderer.textStyle.apply(this._renderer,arguments)};p5.prototype.textWidth=function(theText){return this._renderer.textWidth.apply(this._renderer,arguments)};p5.prototype.textAscent=function(){return this._renderer.textAscent()};p5.prototype.textDescent=function(){return this._renderer.textDescent()};p5.prototype._updateTextMetrics=function(){return this._renderer._updateTextMetrics()};module.exports=p5},{"../core/core":48}],81:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");_dereq_("../core/error_helpers");p5.prototype.text=function(str,x,y,maxWidth,maxHeight){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this._validateParameters("text",args,[["*","Number","Number"],["*","Number","Number","Number","Number"]]);return!(this._renderer._doFill||this._renderer._doStroke)?this:this._renderer.text.apply(this._renderer,arguments)};p5.prototype.textFont=function(theFont,theSize){if(arguments.length){if(!theFont){throw Error("null font passed to textFont")}this._renderer._setProperty("_textFont",theFont);if(theSize){this._renderer._setProperty("_textSize",theSize);this._renderer._setProperty("_textLeading",theSize*constants._DEFAULT_LEADMULT)}return this._renderer._applyTextProperties()}return this};module.exports=p5},{"../core/constants":47,"../core/core":48,"../core/error_helpers":51}],82:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");var constants=_dereq_("../core/constants");p5.Font=function(p){this.parent=p;this.cache={};this.font=undefined};p5.Font.prototype.list=function(){throw"not yet implemented"};p5.Font.prototype.textBounds=function(str,x,y,fontSize,options){x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize||this.parent._renderer._textSize;var result=this.cache[cacheKey("textBounds",str,x,y,fontSize)];if(!result){var xCoords=[],yCoords=[],self=this,scale=this._scale(fontSize),minX,minY,maxX,maxY;this.font.forEachGlyph(str,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){xCoords.push(gX);yCoords.push(gY);var gm=glyph.getMetrics();if(glyph.name!=="space"){xCoords.push(gX+gm.xMax*scale);yCoords.push(gY+-gm.yMin*scale);yCoords.push(gY+-gm.yMax*scale)}else{xCoords.push(gX+self.font.charToGlyph(" ").advanceWidth*self._scale(fontSize))}});minX=Math.max(0,Math.min.apply(null,xCoords));minY=Math.max(0,Math.min.apply(null,yCoords));maxX=Math.max(0,Math.max.apply(null,xCoords));maxY=Math.max(0,Math.max.apply(null,yCoords));result={x:minX,y:minY,h:maxY-minY,w:maxX-minX,advance:minX-x};this.cache[cacheKey("textBounds",str,x,y,fontSize)]=result}return result};p5.Font.prototype.textToPoints=function(txt,x,y,fontSize,options){var xoff=0,result=[],glyphs=this._getGlyphs(txt);fontSize=fontSize||this.parent._renderer._textSize;for(var i=0;i<glyphs.length;i++){var gpath=glyphs[i].getPath(x,y,fontSize),paths=splitPaths(gpath.commands);for(var j=0;j<paths.length;j++){var pts=pathToPoints(paths[j],options);for(var k=0;k<pts.length;k++){pts[k].x+=xoff;result.push(pts[k])}}xoff+=glyphs[i].advanceWidth*this._scale(fontSize)}return result};p5.Font.prototype._getGlyphs=function(str){return this.font.stringToGlyphs(str)};p5.Font.prototype._getPath=function(line,x,y,options){var p=this.parent,ctx=p._renderer.drawingContext,pos=this._handleAlignment(p,ctx,line,x,y);return this.font.getPath(line,pos.x,pos.y,p._renderer._textSize,options)};p5.Font.prototype._getPathData=function(line,x,y,options){var decimals=3;if(typeof line==="string"&&arguments.length>2){line=this._getPath(line,x,y,options)}else if(typeof x==="object"){options=x}if(options&&typeof options.decimals==="number"){decimals=options.decimals}return line.toPathData(decimals)};p5.Font.prototype._getSVG=function(line,x,y,options){var decimals=3;if(typeof line==="string"&&arguments.length>2){line=this._getPath(line,x,y,options)}else if(typeof x==="object"){options=x}if(options){if(typeof options.decimals==="number"){decimals=options.decimals}if(typeof options.strokeWidth==="number"){line.strokeWidth=options.strokeWidth}if(typeof options.fill!=="undefined"){line.fill=options.fill}if(typeof options.stroke!=="undefined"){line.stroke=options.stroke}}return line.toSVG(decimals)};p5.Font.prototype._renderPath=function(line,x,y,options){var pdata,pg=options&&options.renderer||this.parent._renderer,ctx=pg.drawingContext;if(typeof line==="object"&&line.commands){pdata=line.commands}else{pdata=this._getPath(line,x,y,pg._textSize,options).commands}ctx.beginPath();for(var i=0;i<pdata.length;i+=1){var cmd=pdata[i];if(cmd.type==="M"){ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type==="L"){ctx.lineTo(cmd.x,cmd.y)}else if(cmd.type==="C"){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type==="Z"){ctx.closePath()}}if(pg._doStroke&&pg._strokeSet){ctx.stroke()}if(pg._doFill){ctx.fillStyle=pg._fillSet?ctx.fillStyle:constants._DEFAULT_TEXT_FILL;ctx.fill()}return this};p5.Font.prototype._textWidth=function(str,fontSize){if(str===" "){return this.font.charToGlyph(" ").advanceWidth*this._scale(fontSize)}var bounds=this.textBounds(str,0,0,fontSize);return bounds.w+bounds.advance};p5.Font.prototype._textAscent=function(fontSize){return this.font.ascender*this._scale(fontSize)};p5.Font.prototype._textDescent=function(fontSize){return-this.font.descender*this._scale(fontSize)};p5.Font.prototype._scale=function(fontSize){return 1/this.font.unitsPerEm*(fontSize||this.parent._renderer._textSize)};p5.Font.prototype._handleAlignment=function(p,ctx,line,x,y){var textWidth=this._textWidth(line),textAscent=this._textAscent(),textDescent=this._textDescent(),textHeight=textAscent+textDescent;if(ctx.textAlign===constants.CENTER){x-=textWidth/2}else if(ctx.textAlign===constants.RIGHT){x-=textWidth}if(ctx.textBaseline===constants.TOP){y+=textHeight}else if(ctx.textBaseline===constants._CTX_MIDDLE){y+=textHeight/2-textDescent}else if(ctx.textBaseline===constants.BOTTOM){y-=textDescent}return{x:x,y:y}};function pathToPoints(cmds,options){var opts=parseOpts(options,{sampleFactor:.1,simplifyThreshold:0});var len=pointAtLength(cmds,0,1),t=len/(len*opts.sampleFactor),pts=[];for(var i=0;i<len;i+=t){pts.push(pointAtLength(cmds,i))}if(opts.simplifyThreshold){simplify(pts,opts.simplifyThreshold)}return pts}function simplify(pts,angle){angle=typeof angle==="undefined"?0:angle;var num=0;for(var i=pts.length-1;pts.length>3&&i>=0;--i){if(collinear(at(pts,i-1),at(pts,i),at(pts,i+1),angle)){pts.splice(i%pts.length,1);num++}}return num}function splitPaths(cmds){var paths=[],current;for(var i=0;i<cmds.length;i++){if(cmds[i].type==="M"){if(current){paths.push(current)}current=[]}current.push(cmdToArr(cmds[i]))}paths.push(current);return paths}function cmdToArr(cmd){var arr=[cmd.type];if(cmd.type==="M"||cmd.type==="L"){arr.push(cmd.x,cmd.y)}else if(cmd.type==="C"){arr.push(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type==="Q"){arr.push(cmd.x1,cmd.y1,cmd.x,cmd.y)}return arr}function parseOpts(options,defaults){if(typeof options!=="object"){options=defaults}else{for(var key in defaults){if(typeof options[key]==="undefined"){options[key]=defaults[key]}}}return options}function at(v,i){var s=v.length;return v[i<0?i%s+s:i%s]}function collinear(a,b,c,thresholdAngle){if(!thresholdAngle){return areaTriangle(a,b,c)===0}if(typeof collinear.tmpPoint1==="undefined"){collinear.tmpPoint1=[];collinear.tmpPoint2=[]}var ab=collinear.tmpPoint1,bc=collinear.tmpPoint2;ab.x=b.x-a.x;ab.y=b.y-a.y;bc.x=c.x-b.x;bc.y=c.y-b.y;var dot=ab.x*bc.x+ab.y*bc.y,magA=Math.sqrt(ab.x*ab.x+ab.y*ab.y),magB=Math.sqrt(bc.x*bc.x+bc.y*bc.y),angle=Math.acos(dot/(magA*magB));return angle<thresholdAngle}function areaTriangle(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])}function findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=Math.pow(t1,3),t12=Math.pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+t12*3*t*c1x+t1*3*t*t*c2x+t3*p2x,y=t13*p1y+t12*3*t*c1y+t1*3*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=90-Math.atan2(mx-nx,my-ny)*180/Math.PI;if(mx>nx||my<ny){alpha+=180}return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha}}function getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){return length==null?bezlen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y):findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,getTatLen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length))}function pointAtLength(path,length,istotal){path=path2curve(path);var x,y,p,l,sp="",subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]==="M"){x=+p[1];y=+p[2]}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(!istotal){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return{x:point.x,y:point.y,alpha:point.alpha}}}len+=l;x=+p[5];y=+p[6]}sp+=p.shift()+p}subpaths.end=sp;point=istotal?len:findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1);if(point.alpha){point={x:point.x,y:point.y,alpha:point.alpha}}return point}function pathToAbsolute(pathArray){var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]==="M"){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=["M",x,y]}var dots,crz=pathArray.length===3&&pathArray[0][0]==="M"&&pathArray[1][0].toUpperCase()==="R"&&pathArray[2][0].toUpperCase()==="Z";for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){res.push(r=[]);pa=pathArray[i];if(pa[0]!==String.prototype.toUpperCase.call(pa[0])){r[0]=String.prototype.toUpperCase.call(pa[0]);switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]+x);r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":dots=[x,y].concat(pa.slice(1));for(var j=2,jj=dots.length;j<jj;j++){dots[j]=+dots[j]+x;dots[++j]=+dots[j]+y}res.pop();res=res.concat(catmullRom2bezier(dots,crz));break;case"M":mx=+pa[1]+x;my=+pa[2]+y;break;default:for(j=1,jj=pa.length;j<jj;j++){r[j]=+pa[j]+(j%2?x:y)}}}else if(pa[0]==="R"){dots=[x,y].concat(pa.slice(1));res.pop();res=res.concat(catmullRom2bezier(dots,crz));r=["R"].concat(pa.slice(-2))}else{for(var k=0,kk=pa.length;k<kk;k++){r[k]=pa[k]}}switch(r[0]){case"Z":x=mx;y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2];my=r[r.length-1];break;default:x=r[r.length-2];y=r[r.length-1]}}return res}function path2curve(path,path2){var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d,pcom){var nx,ny,tq={T:1,Q:1};if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y]}if(!(path[0]in tq)){d.qx=d.qy=null}switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":path=["C"].concat(a2c.apply(0,[d.x,d.y].concat(path.slice(1))));break;case"S":if(pcom==="C"||pcom==="S"){nx=d.x*2-d.bx;ny=d.y*2-d.by}else{nx=d.x;ny=d.y}path=["C",nx,ny].concat(path.slice(1));break;case"T":if(pcom==="Q"||pcom==="T"){d.qx=d.x*2-d.qx;d.qy=d.y*2-d.qy}else{d.qx=d.x;d.qy=d.y}path=["C"].concat(q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"].concat(q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"].concat(l2c(d.x,d.y,path[1],path[2]));
break;case"H":path=["C"].concat(l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"].concat(l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"].concat(l2c(d.x,d.y,d.X,d.Y));break}return path},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pcoms1[i]="A";if(p2){pcoms2[i]="A"}pp.splice(i++,0,["C"].concat(pi.splice(0,6)))}pp.splice(i,1);ii=Math.max(p.length,p2&&p2.length||0)}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]==="M"&&path2[i][0]!=="M"){path2.splice(i,0,["M",a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=Math.max(p.length,p2&&p2.length||0)}},pcoms1=[],pcoms2=[],pfirst="",pcom="";for(var i=0,ii=Math.max(p.length,p2&&p2.length||0);i<ii;i++){if(p[i]){pfirst=p[i][0]}if(pfirst!=="C"){pcoms1[i]=pfirst;if(i){pcom=pcoms1[i-1]}}p[i]=processPath(p[i],attrs,pcom);if(pcoms1[i]!=="A"&&pfirst==="C"){pcoms1[i]="C"}fixArc(p,i);if(p2){if(p2[i]){pfirst=p2[i][0]}if(pfirst!=="C"){pcoms2[i]=pfirst;if(i){pcom=pcoms2[i-1]}}p2[i]=processPath(p2[i],attrs2,pcom);if(pcoms2[i]!=="A"&&pfirst==="C"){pcoms2[i]="C"}fixArc(p2,i)}fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=parseFloat(seg[seglen-4])||attrs.x;attrs.by=parseFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(parseFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(parseFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1]}return p2?[p,p2]:p}function a2c(x1,y1,rx,ry,angle,lac,sweep_flag,x2,y2,recursive){var PI=Math.PI,_120=PI*120/180,f1,f2,cx,cy,rad=PI/180*(+angle||0),res=[],xy,rotate=function(x,y,rad){var X=x*Math.cos(rad)-y*Math.sin(rad),Y=x*Math.sin(rad)+y*Math.cos(rad);return{x:X,y:Y}};if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var x=(x1-x2)/2,y=(y1-y2)/2,h=x*x/(rx*rx)+y*y/(ry*ry);if(h>1){h=Math.sqrt(h);rx=h*rx;ry=h*ry}var rx2=rx*rx,ry2=ry*ry,k=(lac===sweep_flag?-1:1)*Math.sqrt(Math.abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x)));cx=k*rx*y/ry+(x1+x2)/2;cy=k*-ry*x/rx+(y1+y2)/2;f1=Math.asin(((y1-cy)/ry).toFixed(9));f2=Math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;if(f1<0){f1=PI*2+f1}if(f2<0){f2=PI*2+f2}if(sweep_flag&&f1>f2){f1=f1-PI*2}if(!sweep_flag&&f2>f1){f2=f2-PI*2}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3]}var df=f2-f1;if(Math.abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*Math.cos(f2);y2=cy+ry*Math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=Math.cos(f1),s1=Math.sin(f1),c2=Math.cos(f2),s2=Math.sin(f2),t=Math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4].concat(res)}else{res=[m2,m3,m4].concat(res).join().split(",");var newres=[];for(var i=0,ii=res.length;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x}return newres}}function catmullRom2bezier(crp,z){var d=[];for(var i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];if(z){if(!i){p[0]={x:+crp[iLen-2],y:+crp[iLen-1]}}else if(iLen-4===i){p[3]={x:+crp[0],y:+crp[1]}}else if(iLen-2===i){p[2]={x:+crp[0],y:+crp[1]};p[3]={x:+crp[2],y:+crp[3]}}}else{if(iLen-4===i){p[3]=p[2]}else if(!i){p[0]={x:+crp[i],y:+crp[i+1]}}}d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y])}return d}function l2c(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2]}function q2c(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2]}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){if(z==null){z=1}z=z>1?1:z<0?0:z;var z2=z/2,n=12,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],sum=0,Cvalues=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];for(var i=0;i<n;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*Math.sqrt(comb)}return z2*sum}function getTatLen(x1,y1,x2,y2,x3,y3,x4,y4,ll){if(ll<0||bezlen(x1,y1,x2,y2,x3,y3,x4,y4)<ll){return}var t=1,step=t/2,t2=t-step,l,e=.01;l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);while(Math.abs(l-ll)>e){step/=2;t2+=(l<ll?1:-1)*step;l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2)}return t2}function base3(t,p1,p2,p3,p4){var t1=-3*p1+9*p2-9*p3+3*p4,t2=t*t1+6*p1-12*p2+6*p3;return t*t2-3*p1+3*p2}function cacheKey(){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}i=args.length;var hash="";while(i--){hash+=args[i]===Object(args[i])?JSON.stringify(args[i]):args[i]}return hash}module.exports=p5.Font},{"../core/constants":47,"../core/core":48}],83:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.append=function(array,value){array.push(value);return array};p5.prototype.arrayCopy=function(src,srcPosition,dst,dstPosition,length){var start,end;if(typeof length!=="undefined"){end=Math.min(length,src.length);start=dstPosition;src=src.slice(srcPosition,end+srcPosition)}else{if(typeof dst!=="undefined"){end=dst;end=Math.min(end,src.length)}else{end=src.length}start=0;dst=srcPosition;src=src.slice(0,end)}Array.prototype.splice.apply(dst,[start,end].concat(src))};p5.prototype.concat=function(list0,list1){return list0.concat(list1)};p5.prototype.reverse=function(list){return list.reverse()};p5.prototype.shorten=function(list){list.pop();return list};p5.prototype.shuffle=function(arr,bool){var isView=ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(arr);arr=bool||isView?arr:arr.slice();var rnd,tmp,idx=arr.length;while(idx>1){rnd=Math.random()*idx|0;tmp=arr[--idx];arr[idx]=arr[rnd];arr[rnd]=tmp}return arr};p5.prototype.sort=function(list,count){var arr=count?list.slice(0,Math.min(count,list.length)):list;var rest=count?list.slice(Math.min(count,list.length)):[];if(typeof arr[0]==="string"){arr=arr.sort()}else{arr=arr.sort(function(a,b){return a-b})}return arr.concat(rest)};p5.prototype.splice=function(list,value,index){Array.prototype.splice.apply(list,[index,0].concat(value));return list};p5.prototype.subset=function(list,start,count){if(typeof count!=="undefined"){return list.slice(start,start+count)}else{return list.slice(start,list.length)}};module.exports=p5},{"../core/core":48}],84:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.float=function(str){return parseFloat(str)};p5.prototype.int=function(n,radix){if(typeof n==="string"){radix=radix||10;return parseInt(n,radix)}else if(typeof n==="number"){return n|0}else if(typeof n==="boolean"){return n?1:0}else if(n instanceof Array){return n.map(function(n){return p5.prototype.int(n,radix)})}};p5.prototype.str=function(n){if(n instanceof Array){return n.map(p5.prototype.str)}else{return String(n)}};p5.prototype.boolean=function(n){if(typeof n==="number"){return n!==0}else if(typeof n==="string"){return n.toLowerCase()==="true"}else if(typeof n==="boolean"){return n}else if(n instanceof Array){return n.map(p5.prototype.boolean)}};p5.prototype.byte=function(n){var nn=p5.prototype.int(n,10);if(typeof nn==="number"){return(nn+128)%256-128}else if(nn instanceof Array){return nn.map(p5.prototype.byte)}};p5.prototype.char=function(n){if(typeof n==="number"&&!isNaN(n)){return String.fromCharCode(n)}else if(n instanceof Array){return n.map(p5.prototype.char)}else if(typeof n==="string"){return p5.prototype.char(parseInt(n,10))}};p5.prototype.unchar=function(n){if(typeof n==="string"&&n.length===1){return n.charCodeAt(0)}else if(n instanceof Array){return n.map(p5.prototype.unchar)}};p5.prototype.hex=function(n,digits){digits=digits===undefined||digits===null?digits=8:digits;if(n instanceof Array){return n.map(function(n){return p5.prototype.hex(n,digits)})}else if(typeof n==="number"){if(n<0){n=4294967295+n+1}var hex=Number(n).toString(16).toUpperCase();while(hex.length<digits){hex="0"+hex}if(hex.length>=digits){hex=hex.substring(hex.length-digits,hex.length)}return hex}};p5.prototype.unhex=function(n){if(n instanceof Array){return n.map(p5.prototype.unhex)}else{return parseInt("0x"+n,16)}};module.exports=p5},{"../core/core":48}],85:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.join=function(list,separator){return list.join(separator)};p5.prototype.match=function(str,reg){return str.match(reg)};p5.prototype.matchAll=function(str,reg){var re=new RegExp(reg,"g");var match=re.exec(str);var matches=[];while(match!==null){matches.push(match);match=re.exec(str)}return matches};p5.prototype.nf=function(){if(arguments[0]instanceof Array){var a=arguments[1];var b=arguments[2];return arguments[0].map(function(x){return doNf(x,a,b)})}else{var typeOfFirst=Object.prototype.toString.call(arguments[0]);if(typeOfFirst==="[object Arguments]"){if(arguments[0].length===3){return this.nf(arguments[0][0],arguments[0][1],arguments[0][2])}else if(arguments[0].length===2){return this.nf(arguments[0][0],arguments[0][1])}else{return this.nf(arguments[0][0])}}else{return doNf.apply(this,arguments)}}};function doNf(){var num=arguments[0];var neg=num<0;var n=neg?num.toString().substring(1):num.toString();var decimalInd=n.indexOf(".");var intPart=decimalInd!==-1?n.substring(0,decimalInd):n;var decPart=decimalInd!==-1?n.substring(decimalInd+1):"";var str=neg?"-":"";if(arguments.length===3){var decimal="";if(decimalInd!==-1||arguments[2]-decPart.length>0){decimal="."}if(decPart.length>arguments[2]){decPart=decPart.substring(0,arguments[2])}for(var i=0;i<arguments[1]-intPart.length;i++){str+="0"}str+=intPart;str+=decimal;str+=decPart;for(var j=0;j<arguments[2]-decPart.length;j++){str+="0"}return str}else{for(var k=0;k<Math.max(arguments[1]-intPart.length,0);k++){str+="0"}str+=n;return str}}p5.prototype.nfc=function(){if(arguments[0]instanceof Array){var a=arguments[1];return arguments[0].map(function(x){return doNfc(x,a)})}else{return doNfc.apply(this,arguments)}};function doNfc(){var num=arguments[0].toString();var dec=num.indexOf(".");var rem=dec!==-1?num.substring(dec):"";var n=dec!==-1?num.substring(0,dec):num;n=n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");if(arguments[1]===0){rem=""}else if(arguments[1]!==undefined){if(arguments[1]>rem.length){rem+=dec===-1?".":"";var len=arguments[1]-rem.length+1;for(var i=0;i<len;i++){rem+="0"}}else{rem=rem.substring(0,arguments[1]+1)}}return n+rem}p5.prototype.nfp=function(){var nfRes=this.nf.apply(this,arguments);if(nfRes instanceof Array){return nfRes.map(addNfp)}else{return addNfp(nfRes)}};function addNfp(){return parseFloat(arguments[0])>0?"+"+arguments[0].toString():arguments[0].toString()}p5.prototype.nfs=function(){var nfRes=this.nf.apply(this,arguments);if(nfRes instanceof Array){return nfRes.map(addNfs)}else{return addNfs(nfRes)}};function addNfs(){return parseFloat(arguments[0])>0?" "+arguments[0].toString():arguments[0].toString()}p5.prototype.split=function(str,delim){return str.split(delim)};p5.prototype.splitTokens=function(){var d,sqo,sqc,str;str=arguments[1];if(arguments.length>1){sqc=/\]/g.exec(str);sqo=/\[/g.exec(str);if(sqo&&sqc){str=str.slice(0,sqc.index)+str.slice(sqc.index+1);sqo=/\[/g.exec(str);str=str.slice(0,sqo.index)+str.slice(sqo.index+1);d=new RegExp("[\\["+str+"\\]]","g")}else if(sqc){str=str.slice(0,sqc.index)+str.slice(sqc.index+1);d=new RegExp("["+str+"\\]]","g")}else if(sqo){str=str.slice(0,sqo.index)+str.slice(sqo.index+1);d=new RegExp("["+str+"\\[]","g")}else{d=new RegExp("["+str+"]","g")}}else{d=/\s/g}return arguments[0].split(d).filter(function(n){return n})};p5.prototype.trim=function(str){if(str instanceof Array){return str.map(this.trim)}else{return str.trim()}};module.exports=p5},{"../core/core":48}],86:[function(_dereq_,module,exports){"use strict";var p5=_dereq_("../core/core");p5.prototype.day=function(){return(new Date).getDate()};p5.prototype.hour=function(){return(new Date).getHours()};p5.prototype.minute=function(){return(new Date).getMinutes()};p5.prototype.millis=function(){return window.performance.now()};p5.prototype.month=function(){return(new Date).getMonth()+1};p5.prototype.second=function(){return(new Date).getSeconds()};p5.prototype.year=function(){return(new Date).getFullYear()};module.exports=p5},{"../core/core":48}]},{},[39])(39)});(function(root,factory){if(typeof define==="function"&&define.amd)define("p5.dom",["p5"],function(p5){factory(p5)});else if(typeof exports==="object")factory(require("../p5"));else factory(root["p5"])})(this,function(p5){p5.prototype.select=function(e,p){var res=null;var container=getContainer(p);if(e[0]==="."){e=e.slice(1);res=container.getElementsByClassName(e);if(res.length){res=res[0]}else{res=null}}else if(e[0]==="#"){e=e.slice(1);res=container.getElementById(e)}else{res=container.getElementsByTagName(e);if(res.length){res=res[0]}else{res=null}}if(res){return wrapElement(res)}else{return null}};p5.prototype.selectAll=function(e,p){var arr=[];var res;var container=getContainer(p);if(e[0]==="."){e=e.slice(1);res=container.getElementsByClassName(e)}else{res=container.getElementsByTagName(e)}if(res){for(var j=0;j<res.length;j++){var obj=wrapElement(res[j]);arr.push(obj)}}return arr};function getContainer(p){var container=document;if(typeof p==="string"&&p[0]==="#"){p=p.slice(1);container=document.getElementById(p)||document}else if(p instanceof p5.Element){container=p.elt}else if(p instanceof HTMLElement){container=p}return container}function wrapElement(elt){if(elt.tagName==="INPUT"&&elt.type==="checkbox"){var converted=new p5.Element(elt);converted.checked=function(){if(arguments.length===0){return this.elt.checked}else if(arguments[0]){this.elt.checked=true}else{this.elt.checked=false}return this};return converted}else if(elt.tagName==="VIDEO"||elt.tagName==="AUDIO"){return new p5.MediaElement(elt)}else{return new p5.Element(elt)}}p5.prototype.removeElements=function(e){for(var i=0;i<this._elements.length;i++){if(!(this._elements[i].elt instanceof HTMLCanvasElement)){this._elements[i].remove()}}};function addElement(elt,pInst,media){var node=pInst._userNode?pInst._userNode:document.body;node.appendChild(elt);var c=media?new p5.MediaElement(elt):new p5.Element(elt);pInst._elements.push(c);return c}var tags=["div","p","span"];tags.forEach(function(tag){var method="create"+tag.charAt(0).toUpperCase()+tag.slice(1);p5.prototype[method]=function(html){var elt=document.createElement(tag);elt.innerHTML=typeof html===undefined?"":html;return addElement(elt,this)}});p5.prototype.createImg=function(){var elt=document.createElement("img");var args=arguments;var self;var setAttrs=function(){self.width=elt.offsetWidth;self.height=elt.offsetHeight;if(args.length>1&&typeof args[1]==="function"){self.fn=args[1];self.fn()}else if(args.length>1&&typeof args[2]==="function"){self.fn=args[2];self.fn()}};elt.src=args[0];if(args.length>1&&typeof args[1]==="string"){elt.alt=args[1]}elt.onload=function(){setAttrs()};self=addElement(elt,this);return self};p5.prototype.createA=function(href,html,target){var elt=document.createElement("a");elt.href=href;elt.innerHTML=html;if(target)elt.target=target;return addElement(elt,this)};p5.prototype.createSlider=function(min,max,value,step){var elt=document.createElement("input");elt.type="range";elt.min=min;elt.max=max;if(step)elt.step=step;if(typeof value==="number")elt.value=value;return addElement(elt,this)};p5.prototype.createButton=function(label,value){var elt=document.createElement("button");elt.innerHTML=label;elt.value=value;if(value)elt.value=value;return addElement(elt,this)};p5.prototype.createCheckbox=function(){var elt=document.createElement("input");elt.type="checkbox";var self=addElement(elt,this);self.checked=function(){if(arguments.length===0){return self.elt.checked}else if(arguments[0]){self.elt.checked=true}else{self.elt.checked=false}return self};this.value=function(val){self.value=val;return this};if(arguments[0]){var ran=Math.random().toString(36).slice(2);var label=document.createElement("label");elt.setAttribute("id",ran);label.htmlFor=ran;self.value(arguments[0]);label.appendChild(document.createTextNode(arguments[0]));addElement(label,this)}if(arguments[1]){elt.checked=true}return self};p5.prototype.createSelect=function(mult){var elt=document.createElement("select");if(mult){elt.setAttribute("multiple","true")}var self=addElement(elt,this);self.option=function(name,value){var opt=document.createElement("option");opt.innerHTML=name;if(arguments.length>1)opt.value=value;else opt.value=name;elt.appendChild(opt)};self.selected=function(value){var arr=[];if(arguments.length>0){for(var i=0;i<this.elt.length;i++){if(value.toString()===this.elt[i].value){this.elt.selectedIndex=i}}return this}else{if(mult){for(var i=0;i<this.elt.selectedOptions.length;i++){arr.push(this.elt.selectedOptions[i].value)}return arr}else{return this.elt.value}}};return self};p5.prototype.createRadio=function(){var radios=document.querySelectorAll("input[type=radio]");var count=0;if(radios.length>1){console.log(radios,radios[0].name);var length=radios.length;var prev=radios[0].name;var current=radios[1].name;count=1;for(var i=1;i<length;i++){current=radios[i].name;if(prev!=current){count++}prev=current}}else if(radios.length==1){count=1}var elt=document.createElement("div");var self=addElement(elt,this);var times=-1;self.option=function(name,value){var opt=document.createElement("input");opt.type="radio";opt.innerHTML=name;if(arguments.length>1)opt.value=value;else opt.value=name;opt.setAttribute("name","defaultradio"+count);elt.appendChild(opt);if(name){times++;var ran=Math.random().toString(36).slice(2);var label=document.createElement("label");opt.setAttribute("id","defaultradio"+count+"-"+times);label.htmlFor="defaultradio"+count+"-"+times;label.appendChild(document.createTextNode(name));elt.appendChild(label)}return opt};self.selected=function(){var length=this.elt.childNodes.length;if(arguments[0]){for(var i=0;i<length;i+=2){if(this.elt.childNodes[i].value==arguments[0])this.elt.childNodes[i].checked=true}return this}else{for(var i=0;i<length;i+=2){if(this.elt.childNodes[i].checked==true)return this.elt.childNodes[i].value}}};self.value=function(){var length=this.elt.childNodes.length;if(arguments[0]){for(var i=0;i<length;i+=2){if(this.elt.childNodes[i].value==arguments[0])this.elt.childNodes[i].checked=true}return this}else{for(var i=0;i<length;i+=2){if(this.elt.childNodes[i].checked==true)return this.elt.childNodes[i].value}return""}};return self};p5.prototype.createInput=function(value){var elt=document.createElement("input");elt.type="text";if(value)elt.value=value;return addElement(elt,this)};p5.prototype.createFileInput=function(callback,multiple){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var elt=document.createElement("input");elt.type="file";if(multiple){elt.multiple="multiple"}function handleFileSelect(evt){var files=evt.target.files;for(var i=0;i<files.length;i++){var f=files[i];var reader=new FileReader;function makeLoader(theFile){var p5file=new p5.File(theFile);return function(e){p5file.data=e.target.result;callback(p5file)}}reader.onload=makeLoader(f);if(f.type.indexOf("text")>-1){reader.readAsText(f)}else{reader.readAsDataURL(f)}}}elt.addEventListener("change",handleFileSelect,false);return addElement(elt,this)}else{console.log("The File APIs are not fully supported in this browser. Cannot create element.")}};function createMedia(pInst,type,src,callback){var elt=document.createElement(type);var src=src||"";if(typeof src==="string"){src=[src]}for(var i=0;i<src.length;i++){var source=document.createElement("source");source.src=src[i];elt.appendChild(source)}if(typeof callback!=="undefined"){var callbackHandler=function(){callback();elt.removeEventListener("canplaythrough",callbackHandler)};elt.addEventListener("canplaythrough",callbackHandler)}var c=addElement(elt,pInst,true);c.loadedmetadata=false;elt.addEventListener("loadedmetadata",function(){c.width=elt.videoWidth;c.height=elt.videoHeight;c.loadedmetadata=true});return c}p5.prototype.createVideo=function(src,callback){return createMedia(this,"video",src,callback)};p5.prototype.createAudio=function(src,callback){return createMedia(this,"audio",src,callback)};p5.prototype.VIDEO="video";p5.prototype.AUDIO="audio";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;p5.prototype.createCapture=function(){var useVideo=true;var useAudio=true;var constraints;var cb;for(var i=0;i<arguments.length;i++){if(arguments[i]===p5.prototype.VIDEO){useAudio=false}else if(arguments[i]===p5.prototype.AUDIO){useVideo=false}else if(typeof arguments[i]==="object"){constraints=arguments[i]}else if(typeof arguments[i]==="function"){cb=arguments[i]}}if(navigator.getUserMedia){var elt=document.createElement("video");if(!constraints){constraints={video:useVideo,audio:useAudio}}navigator.getUserMedia(constraints,function(stream){elt.src=window.URL.createObjectURL(stream);elt.onloadedmetadata=function(e){elt.play();if(cb){cb(stream)}}},function(e){console.log(e)})}else{throw"getUserMedia not supported in this browser"}var c=addElement(elt,this,true);c.loadedmetadata=false;elt.addEventListener("loadedmetadata",function(){c.width=elt.videoWidth;c.height=elt.videoHeight;c.loadedmetadata=true});return c};p5.prototype.createElement=function(tag,content){var elt=document.createElement(tag);if(typeof content!=="undefined"){elt.innerHTML=content}return addElement(elt,this)};p5.Element.prototype.addClass=function(c){if(this.elt.className){this.elt.className=this.elt.className+" "+c}else{this.elt.className=c}return this};p5.Element.prototype.removeClass=function(c){var regex=new RegExp("(?:^|\\s)"+c+"(?!\\S)");this.elt.className=this.elt.className.replace(regex,"");this.elt.className=this.elt.className.replace(/^\s+|\s+$/g,"");return this};p5.Element.prototype.child=function(c){if(c===null){return this.elt.childNodes}if(typeof c==="string"){if(c[0]==="#"){c=c.substring(1)}c=document.getElementById(c)}else if(c instanceof p5.Element){c=c.elt}this.elt.appendChild(c);return this};p5.Element.prototype.center=function(align){var style=this.elt.style.display;var hidden=this.elt.style.display==="none";var parentHidden=this.parent().style.display==="none";var pos={x:this.elt.offsetLeft,y:this.elt.offsetTop};if(hidden)this.show();this.elt.style.display="block";this.position(0,0);if(parentHidden)this.parent().style.display="block";var wOffset=Math.abs(this.parent().offsetWidth-this.elt.offsetWidth);var hOffset=Math.abs(this.parent().offsetHeight-this.elt.offsetHeight);var y=pos.y;var x=pos.x;if(align==="both"||align===undefined){this.position(wOffset/2,hOffset/2)}else if(align==="horizontal"){this.position(wOffset/2,y)}else if(align==="vertical"){this.position(x,hOffset/2)}this.style("display",style);if(hidden)this.hide();if(parentHidden)this.parent().style.display="none";return this};p5.Element.prototype.html=function(html){if(typeof html!=="undefined"){this.elt.innerHTML=html;return this}else{return this.elt.innerHTML}};p5.Element.prototype.position=function(){if(arguments.length===0){return{x:this.elt.offsetLeft,y:this.elt.offsetTop}}else{this.elt.style.position="absolute";this.elt.style.left=arguments[0]+"px";this.elt.style.top=arguments[1]+"px";this.x=arguments[0];this.y=arguments[1];return this}};p5.Element.prototype._translate=function(){this.elt.style.position="absolute";var transform="";if(this.elt.style.transform){transform=this.elt.style.transform.replace(/translate3d\(.*\)/g,"");transform=transform.replace(/translate[X-Z]?\(.*\)/g,"")}if(arguments.length===2){this.elt.style.transform="translate("+arguments[0]+"px, "+arguments[1]+"px)"}else if(arguments.length>2){this.elt.style.transform="translate3d("+arguments[0]+"px,"+arguments[1]+"px,"+arguments[2]+"px)";if(arguments.length===3){this.elt.parentElement.style.perspective="1000px"}else{this.elt.parentElement.style.perspective=arguments[3]+"px"}}this.elt.style.transform+=transform;return this};p5.Element.prototype._rotate=function(){var transform="";if(this.elt.style.transform){var transform=this.elt.style.transform.replace(/rotate3d\(.*\)/g,"");transform=transform.replace(/rotate[X-Z]?\(.*\)/g,"")}if(arguments.length===1){this.elt.style.transform="rotate("+arguments[0]+"deg)"}else if(arguments.length===2){this.elt.style.transform="rotate("+arguments[0]+"deg, "+arguments[1]+"deg)"}else if(arguments.length===3){this.elt.style.transform="rotateX("+arguments[0]+"deg)";this.elt.style.transform+="rotateY("+arguments[1]+"deg)";this.elt.style.transform+="rotateZ("+arguments[2]+"deg)"}this.elt.style.transform+=transform;return this};p5.Element.prototype.style=function(prop,val){var self=this;if(val instanceof p5.Color){val="rgba("+val.levels[0]+","+val.levels[1]+","+val.levels[2]+","+val.levels[3]/255+")"}if(typeof val==="undefined"){if(prop.indexOf(":")===-1){var styles=window.getComputedStyle(self.elt);var style=styles.getPropertyValue(prop);return style}else{var attrs=prop.split(";");for(var i=0;i<attrs.length;i++){var parts=attrs[i].split(":");if(parts[0]&&parts[1]){this.elt.style[parts[0].trim()]=parts[1].trim()}}}}else{if(prop==="rotate"||prop==="translate"||prop==="position"){var trans=Array.prototype.shift.apply(arguments);var f=this[trans]||this["_"+trans];f.apply(this,arguments)}else{this.elt.style[prop]=val;if(prop==="width"||prop==="height"||prop==="left"||prop==="top"){var numVal=val.replace(/\D+/g,"");this[prop]=parseInt(numVal,10)}}}return this};p5.Element.prototype.attribute=function(attr,value){if(typeof value==="undefined"){return this.elt.getAttribute(attr)}else{this.elt.setAttribute(attr,value);return this}};p5.Element.prototype.value=function(){if(arguments.length>0){this.elt.value=arguments[0];return this}else{if(this.elt.type==="range"){return parseFloat(this.elt.value)}else return this.elt.value}};p5.Element.prototype.show=function(){this.elt.style.display="block";return this};p5.Element.prototype.hide=function(){this.elt.style.display="none";return this};p5.Element.prototype.size=function(w,h){if(arguments.length===0){return{width:this.elt.offsetWidth,height:this.elt.offsetHeight}}else{var aW=w;var aH=h;var AUTO=p5.prototype.AUTO;if(aW!==AUTO||aH!==AUTO){if(aW===AUTO){aW=h*this.width/this.height}else if(aH===AUTO){aH=w*this.height/this.width}if(this.elt instanceof HTMLCanvasElement){var j={};var k=this.elt.getContext("2d");for(var prop in k){j[prop]=k[prop]}this.elt.setAttribute("width",aW*this._pInst._pixelDensity);this.elt.setAttribute("height",aH*this._pInst._pixelDensity);this.elt.setAttribute("style","width:"+aW+"px; height:"+aH+"px");this._pInst.scale(this._pInst._pixelDensity,this._pInst._pixelDensity);for(var prop in j){this.elt.getContext("2d")[prop]=j[prop]}}else{this.elt.style.width=aW+"px";this.elt.style.height=aH+"px";this.elt.width=aW;this.elt.height=aH;this.width=aW;this.height=aH}this.width=this.elt.offsetWidth;this.height=this.elt.offsetHeight;if(this._pInst){if(this._pInst._curElement.elt===this.elt){this._pInst._setProperty("width",this.elt.offsetWidth);this._pInst._setProperty("height",this.elt.offsetHeight)}}}return this}};p5.Element.prototype.remove=function(){for(var ev in this._events){this.elt.removeEventListener(ev,this._events[ev])}if(this.elt.parentNode){this.elt.parentNode.removeChild(this.elt)}delete this};p5.MediaElement=function(elt,pInst){p5.Element.call(this,elt,pInst);var self=this;this.elt.crossOrigin="anonymous";this._prevTime=0;this._cueIDCounter=0;this._cues=[];this._pixelDensity=1;Object.defineProperty(self,"src",{get:function(){var firstChildSrc=self.elt.children[0].src;var srcVal=self.elt.src===window.location.href?"":self.elt.src;var ret=firstChildSrc===window.location.href?srcVal:firstChildSrc;return ret},set:function(newValue){for(var i=0;i<self.elt.children.length;i++){self.elt.removeChild(self.elt.children[i])}var source=document.createElement("source");source.src=newValue;elt.appendChild(source);self.elt.src=newValue}});self._onended=function(){};self.elt.onended=function(){self._onended(self)}};p5.MediaElement.prototype=Object.create(p5.Element.prototype);p5.MediaElement.prototype.play=function(){if(this.elt.currentTime===this.elt.duration){this.elt.currentTime=0}if(this.elt.readyState>1){this.elt.play()}else{this.elt.load();this.elt.play()}return this};p5.MediaElement.prototype.stop=function(){this.elt.pause();this.elt.currentTime=0;return this};p5.MediaElement.prototype.pause=function(){this.elt.pause();return this};p5.MediaElement.prototype.loop=function(){this.elt.setAttribute("loop",true);this.play();return this};p5.MediaElement.prototype.noLoop=function(){this.elt.setAttribute("loop",false);return this};p5.MediaElement.prototype.autoplay=function(val){this.elt.setAttribute("autoplay",val);return this};p5.MediaElement.prototype.volume=function(val){if(typeof val==="undefined"){return this.elt.volume}else{this.elt.volume=val}};p5.MediaElement.prototype.speed=function(val){if(typeof val==="undefined"){return this.elt.playbackRate}else{this.elt.playbackRate=val}};p5.MediaElement.prototype.time=function(val){if(typeof val==="undefined"){return this.elt.currentTime}else{this.elt.currentTime=val}};p5.MediaElement.prototype.duration=function(){return this.elt.duration};p5.MediaElement.prototype.pixels=[];p5.MediaElement.prototype.loadPixels=function(){if(!this.canvas){this.canvas=document.createElement("canvas");this.drawingContext=this.canvas.getContext("2d")}if(this.loadedmetadata){if(this.canvas.width!==this.elt.videoWidth){this.canvas.width=this.elt.videoWidth;this.canvas.height=this.elt.videoHeight;this.width=this.canvas.width;this.height=this.canvas.height}this.drawingContext.drawImage(this.elt,0,0,this.canvas.width,this.canvas.height);p5.Renderer2D.prototype.loadPixels.call(this)}return this};p5.MediaElement.prototype.updatePixels=function(x,y,w,h){if(this.loadedmetadata){p5.Renderer2D.prototype.updatePixels.call(this,x,y,w,h)}return this};p5.MediaElement.prototype.get=function(x,y,w,h){if(this.loadedmetadata){return p5.Renderer2D.prototype.get.call(this,x,y,w,h)}else return[0,0,0,255]};p5.MediaElement.prototype.set=function(x,y,imgOrCol){if(this.loadedmetadata){p5.Renderer2D.prototype.set.call(this,x,y,imgOrCol)}};p5.MediaElement.prototype.onended=function(callback){this._onended=callback;return this};p5.MediaElement.prototype.connect=function(obj){var audioContext,masterOutput;if(typeof p5.prototype.getAudioContext==="function"){audioContext=p5.prototype.getAudioContext();masterOutput=p5.soundOut.input}else{try{audioContext=obj.context;masterOutput=audioContext.destination}catch(e){throw"connect() is meant to be used with Web Audio API or p5.sound.js"}}if(!this.audioSourceNode){this.audioSourceNode=audioContext.createMediaElementSource(this.elt);this.audioSourceNode.connect(masterOutput)}if(obj){if(obj.input){this.audioSourceNode.connect(obj.input)}else{this.audioSourceNode.connect(obj)}}else{this.audioSourceNode.connect(masterOutput)}};p5.MediaElement.prototype.disconnect=function(){if(this.audioSourceNode){this.audioSourceNode.disconnect()}else{throw"nothing to disconnect"}};p5.MediaElement.prototype.showControls=function(){this.elt.style["text-align"]="inherit";this.elt.controls=true};p5.MediaElement.prototype.hideControls=function(){this.elt.controls=false};p5.MediaElement.prototype.addCue=function(time,callback,val){var id=this._cueIDCounter++;var cue=new Cue(callback,time,id,val);this._cues.push(cue);if(!this.elt.ontimeupdate){this.elt.ontimeupdate=this._onTimeUpdate.bind(this)}return id};p5.MediaElement.prototype.removeCue=function(id){for(var i=0;i<this._cues.length;i++){var cue=this._cues[i];if(cue.id===id){this.cues.splice(i,1)}}if(this._cues.length===0){this.elt.ontimeupdate=null}};p5.MediaElement.prototype.clearCues=function(){
this._cues=[];this.elt.ontimeupdate=null};p5.MediaElement.prototype._onTimeUpdate=function(){var playbackTime=this.time();for(var i=0;i<this._cues.length;i++){var callbackTime=this._cues[i].time;var val=this._cues[i].val;if(this._prevTime<callbackTime&&callbackTime<=playbackTime){this._cues[i].callback(val)}}this._prevTime=playbackTime};var Cue=function(callback,time,id,val){this.callback=callback;this.time=time;this.id=id;this.val=val};p5.File=function(file,pInst){this.file=file;this._pInst=pInst;var typeList=file.type.split("/");this.type=typeList[0];this.subtype=typeList[1];this.name=file.name;this.size=file.size;this.data=undefined}});(function(root,factory){if(typeof define==="function"&&define.amd)define("p5.sound",["p5"],function(p5){factory(p5)});else if(typeof exports==="object")factory(require("../p5"));else factory(root["p5"])})(this,function(p5){var sndcore;sndcore=function(){"use strict";(function(global,exports,perf){exports=exports||{};"use strict";function fixSetTarget(param){if(!param)return;if(!param.setTargetAtTime)param.setTargetAtTime=param.setTargetValueAtTime}if(window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")){window.AudioContext=webkitAudioContext;if(!AudioContext.prototype.hasOwnProperty("createGain"))AudioContext.prototype.createGain=AudioContext.prototype.createGainNode;if(!AudioContext.prototype.hasOwnProperty("createDelay"))AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode;if(!AudioContext.prototype.hasOwnProperty("createScriptProcessor"))AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode;if(!AudioContext.prototype.hasOwnProperty("createPeriodicWave"))AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable;AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var node=this.internal_createGain();fixSetTarget(node.gain);return node};AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay;AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();fixSetTarget(node.delayTime);return node};AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource;AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();if(!node.start){node.start=function(when,offset,duration){if(offset||duration)this.noteGrainOn(when||0,offset,duration);else this.noteOn(when||0)}}else{node.internal_start=node.start;node.start=function(when,offset,duration){if(typeof duration!=="undefined")node.internal_start(when||0,offset,duration);else node.internal_start(when||0,offset||0)}}if(!node.stop){node.stop=function(when){this.noteOff(when||0)}}else{node.internal_stop=node.stop;node.stop=function(when){node.internal_stop(when||0)}}fixSetTarget(node.playbackRate);return node};AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor;AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();fixSetTarget(node.threshold);fixSetTarget(node.knee);fixSetTarget(node.ratio);fixSetTarget(node.reduction);fixSetTarget(node.attack);fixSetTarget(node.release);return node};AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter;AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();fixSetTarget(node.frequency);fixSetTarget(node.detune);fixSetTarget(node.Q);fixSetTarget(node.gain);return node};if(AudioContext.prototype.hasOwnProperty("createOscillator")){AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();if(!node.start){node.start=function(when){this.noteOn(when||0)}}else{node.internal_start=node.start;node.start=function(when){node.internal_start(when||0)}}if(!node.stop){node.stop=function(when){this.noteOff(when||0)}}else{node.internal_stop=node.stop;node.stop=function(when){node.internal_stop(when||0)}}if(!node.setPeriodicWave)node.setPeriodicWave=node.setWaveTable;fixSetTarget(node.frequency);fixSetTarget(node.detune);return node}}}if(window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")){window.OfflineAudioContext=webkitOfflineAudioContext}return exports})(window);var audiocontext=new window.AudioContext;p5.prototype.getAudioContext=function(){return audiocontext};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var el=document.createElement("audio");p5.prototype.isSupported=function(){return!!el.canPlayType};var isOGGSupported=function(){return!!el.canPlayType&&el.canPlayType('audio/ogg; codecs="vorbis"')};var isMP3Supported=function(){return!!el.canPlayType&&el.canPlayType("audio/mpeg;")};var isWAVSupported=function(){return!!el.canPlayType&&el.canPlayType('audio/wav; codecs="1"')};var isAACSupported=function(){return!!el.canPlayType&&(el.canPlayType("audio/x-m4a;")||el.canPlayType("audio/aac;"))};var isAIFSupported=function(){return!!el.canPlayType&&el.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(extension){switch(extension.toLowerCase()){case"mp3":return isMP3Supported();case"wav":return isWAVSupported();case"ogg":return isOGGSupported();case"aac","m4a","mp4":return isAACSupported();case"aif","aiff":return isAIFSupported();default:return false}};var iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;if(iOS){var iosStarted=false;var startIOS=function(){if(iosStarted)return;var buffer=audiocontext.createBuffer(1,1,22050);var source=audiocontext.createBufferSource();source.buffer=buffer;source.connect(audiocontext.destination);source.start(0);console.log("start ios!");if(audiocontext.state==="running"){iosStarted=true}};document.addEventListener("touchend",startIOS,false);document.addEventListener("touchstart",startIOS,false)}}();var master;master=function(){"use strict";var Master=function(){var audiocontext=p5.prototype.getAudioContext();this.input=audiocontext.createGain();this.output=audiocontext.createGain();this.limiter=audiocontext.createDynamicsCompressor();this.limiter.threshold.value=0;this.limiter.ratio.value=100;this.audiocontext=audiocontext;this.output.disconnect();this.inputSources=[];this.input.connect(this.limiter);this.limiter.connect(this.output);this.meter=audiocontext.createGain();this.fftMeter=audiocontext.createGain();this.output.connect(this.meter);this.output.connect(this.fftMeter);this.output.connect(this.audiocontext.destination);this.soundArray=[];this.parts=[];this.extensions=[]};var p5sound=new Master;p5.prototype.getMasterVolume=function(){return p5sound.output.gain.value};p5.prototype.masterVolume=function(vol,rampTime,tFromNow){if(typeof vol==="number"){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=p5sound.output.gain.value;p5sound.output.gain.cancelScheduledValues(now+tFromNow);p5sound.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow);p5sound.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else if(vol){vol.connect(p5sound.output.gain)}else{return p5sound.output.gain}};p5.soundOut=p5sound;p5.soundOut._silentNode=p5sound.audiocontext.createGain();p5.soundOut._silentNode.gain.value=0;p5.soundOut._silentNode.connect(p5sound.audiocontext.destination);return p5sound}(sndcore);var helpers;helpers=function(){"use strict";var p5sound=master;p5.prototype.sampleRate=function(){return p5sound.audiocontext.sampleRate};p5.prototype.freqToMidi=function(f){var mathlog2=Math.log(f/440)/Math.log(2);var m=Math.round(12*mathlog2)+57;return m};p5.prototype.midiToFreq=function(m){return 440*Math.pow(2,(m-69)/12)};p5.prototype.soundFormats=function(){p5sound.extensions=[];for(var i=0;i<arguments.length;i++){arguments[i]=arguments[i].toLowerCase();if(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[i])>-1){p5sound.extensions.push(arguments[i])}else{throw arguments[i]+" is not a valid sound format!"}}};p5.prototype.disposeSound=function(){for(var i=0;i<p5sound.soundArray.length;i++){p5sound.soundArray[i].dispose()}};p5.prototype.registerMethod("remove",p5.prototype.disposeSound);p5.prototype._checkFileFormats=function(paths){var path;if(typeof paths==="string"){path=paths;var extTest=path.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(extTest)>-1){var supported=p5.prototype.isFileSupported(extTest);if(supported){path=path}else{var pathSplit=path.split(".");var pathCore=pathSplit[pathSplit.length-1];for(var i=0;i<p5sound.extensions.length;i++){var extension=p5sound.extensions[i];var supported=p5.prototype.isFileSupported(extension);if(supported){pathCore="";if(pathSplit.length===2){pathCore+=pathSplit[0]}for(var i=1;i<=pathSplit.length-2;i++){var p=pathSplit[i];pathCore+="."+p}path=pathCore+=".";path=path+=extension;break}}}}else{for(var i=0;i<p5sound.extensions.length;i++){var extension=p5sound.extensions[i];var supported=p5.prototype.isFileSupported(extension);if(supported){path=path+"."+extension;break}}}}else if(typeof paths==="object"){for(var i=0;i<paths.length;i++){var extension=paths[i].split(".").pop();var supported=p5.prototype.isFileSupported(extension);if(supported){path=paths[i];break}}}return path};p5.prototype._mathChain=function(o,math,thisChain,nextChain,type){for(var i in o.mathOps){if(o.mathOps[i]instanceof type){o.mathOps[i].dispose();thisChain=i;if(thisChain<o.mathOps.length-1){nextChain=o.mathOps[i+1]}}}o.mathOps[thisChain-1].disconnect();o.mathOps[thisChain-1].connect(math);math.connect(nextChain);o.mathOps[thisChain]=math;return o}}(master);var errorHandler;errorHandler=function(){"use strict";var CustomError=function(name,errorTrace,failedPath){var err=new Error;var tempStack,splitStack;err.name=name;err.originalStack=err.stack+errorTrace;tempStack=err.stack+errorTrace;err.failedPath=failedPath;var splitStack=tempStack.split("\n");splitStack=splitStack.filter(function(ln){return!ln.match(/(p5.|native code|globalInit)/g)});err.stack=splitStack.join("\n");return err};return CustomError}();var panner;panner=function(){"use strict";var p5sound=master;var ac=p5sound.audiocontext;if(typeof ac.createStereoPanner!=="undefined"){p5.Panner=function(input,output,numInputChannels){this.stereoPanner=this.input=ac.createStereoPanner();input.connect(this.stereoPanner);this.stereoPanner.connect(output)};p5.Panner.prototype.pan=function(val,tFromNow){var time=tFromNow||0;var t=ac.currentTime+time;this.stereoPanner.pan.linearRampToValueAtTime(val,t)};p5.Panner.prototype.inputChannels=function(numChannels){};p5.Panner.prototype.connect=function(obj){this.stereoPanner.connect(obj)};p5.Panner.prototype.disconnect=function(obj){this.stereoPanner.disconnect()}}else{p5.Panner=function(input,output,numInputChannels){this.input=ac.createGain();input.connect(this.input);this.left=ac.createGain();this.right=ac.createGain();this.left.channelInterpretation="discrete";this.right.channelInterpretation="discrete";if(numInputChannels>1){this.splitter=ac.createChannelSplitter(2);this.input.connect(this.splitter);this.splitter.connect(this.left,1);this.splitter.connect(this.right,0)}else{this.input.connect(this.left);this.input.connect(this.right)}this.output=ac.createChannelMerger(2);this.left.connect(this.output,0,1);this.right.connect(this.output,0,0);this.output.connect(output)};p5.Panner.prototype.pan=function(val,tFromNow){var time=tFromNow||0;var t=ac.currentTime+time;var v=(val+1)/2;var rightVal=Math.cos(v*Math.PI/2);var leftVal=Math.sin(v*Math.PI/2);this.left.gain.linearRampToValueAtTime(leftVal,t);this.right.gain.linearRampToValueAtTime(rightVal,t)};p5.Panner.prototype.inputChannels=function(numChannels){if(numChannels===1){this.input.disconnect();this.input.connect(this.left);this.input.connect(this.right)}else if(numChannels===2){if(typeof(this.splitter==="undefined")){this.splitter=ac.createChannelSplitter(2)}this.input.disconnect();this.input.connect(this.splitter);this.splitter.connect(this.left,1);this.splitter.connect(this.right,0)}};p5.Panner.prototype.connect=function(obj){this.output.connect(obj)};p5.Panner.prototype.disconnect=function(obj){this.output.disconnect()}}p5.Panner3D=function(input,output){var panner3D=ac.createPanner();panner3D.panningModel="HRTF";panner3D.distanceModel="linear";panner3D.setPosition(0,0,0);input.connect(panner3D);panner3D.connect(output);panner3D.pan=function(xVal,yVal,zVal){panner3D.setPosition(xVal,yVal,zVal)};return panner3D}}(master);var soundfile;soundfile=function(){"use strict";var CustomError=errorHandler;var p5sound=master;var ac=p5sound.audiocontext;p5.SoundFile=function(paths,onload,onerror,whileLoading){if(typeof paths!=="undefined"){if(typeof paths=="string"||typeof paths[0]=="string"){var path=p5.prototype._checkFileFormats(paths);this.url=path}else if(typeof paths=="object"){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob)){throw"Unable to load file because the File API is not supported"}}if(paths.file){paths=paths.file}this.file=paths}this._onended=function(){};this._looping=false;this._playing=false;this._paused=false;this._pauseTime=0;this._cues=[];this._lastPos=0;this._counterNode;this._scopeNode;this.bufferSourceNodes=[];this.bufferSourceNode=null;this.buffer=null;this.playbackRate=1;this.gain=1;this.input=p5sound.audiocontext.createGain();this.output=p5sound.audiocontext.createGain();this.reversed=false;this.startTime=0;this.endTime=null;this.pauseTime=0;this.mode="sustain";this.startMillis=null;this.panPosition=0;this.panner=new p5.Panner(this.output,p5sound.input,2);if(this.url||this.file){this.load(onload,onerror)}p5sound.soundArray.push(this);if(typeof whileLoading==="function"){this._whileLoading=whileLoading}else{this._whileLoading=function(){}}};p5.prototype.registerPreloadMethod("loadSound",p5.prototype);p5.prototype.loadSound=function(path,callback,onerror,whileLoading){if(window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}var s=new p5.SoundFile(path,callback,onerror,whileLoading);return s};p5.SoundFile.prototype.load=function(callback,errorCallback){var loggedError=false;var self=this;var errorTrace=(new Error).stack;if(this.url!=undefined&&this.url!=""){var request=new XMLHttpRequest;request.addEventListener("progress",function(evt){self._updateProgress(evt)},false);request.open("GET",this.url,true);request.responseType="arraybuffer";request.onload=function(){if(request.status==200){ac.decodeAudioData(request.response,function(buff){self.buffer=buff;self.panner.inputChannels(buff.numberOfChannels);if(callback){callback(self)}},function(e){var err=new CustomError("decodeAudioData",errorTrace,self.url);var msg="AudioContext error at decodeAudioData for "+self.url;if(errorCallback){err.msg=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}})}else{var err=new CustomError("loadSound",errorTrace,self.url);var msg="Unable to load "+self.url+". The request status was: "+request.status+" ("+request.statusText+")";if(errorCallback){err.message=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}}};request.onerror=function(e){var err=new CustomError("loadSound",errorTrace,self.url);var msg="There was no response from the server at "+self.url+". Check the url and internet connectivity.";if(errorCallback){err.message=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}};request.send()}else if(this.file!=undefined){var reader=new FileReader;var self=this;reader.onload=function(){ac.decodeAudioData(reader.result,function(buff){self.buffer=buff;self.panner.inputChannels(buff.numberOfChannels);if(callback){callback(self)}})};reader.onerror=function(e){if(onerror)onerror(e)};reader.readAsArrayBuffer(this.file)}};p5.SoundFile.prototype._updateProgress=function(evt){if(evt.lengthComputable){var percentComplete=Math.log(evt.loaded/evt.total*9.9);this._whileLoading(percentComplete)}else{this._whileLoading("size unknown")}};p5.SoundFile.prototype.isLoaded=function(){if(this.buffer){return true}else{return false}};p5.SoundFile.prototype.play=function(time,rate,amp,_cueStart,duration){var self=this;var now=p5sound.audiocontext.currentTime;var cueStart,cueEnd;var time=time||0;if(time<0){time=0}time=time+now;if(this.buffer){this._pauseTime=0;if(this.mode==="restart"&&this.buffer&&this.bufferSourceNode){var now=p5sound.audiocontext.currentTime;this.bufferSourceNode.stop(time);this._counterNode.stop(time)}this.bufferSourceNode=this._initSourceNode();if(this._counterNode)this._counterNode=undefined;this._counterNode=this._initCounterNode();if(_cueStart){if(_cueStart>=0&&_cueStart<this.buffer.duration){cueStart=_cueStart}else{throw"start time out of range"}}else{cueStart=0}if(duration){duration=duration<=this.buffer.duration-cueStart?duration:this.buffer.duration}else{duration=this.buffer.duration-cueStart}var a=amp||1;this.bufferSourceNode.connect(this.output);this.output.gain.value=a;rate=rate||Math.abs(this.playbackRate);this.bufferSourceNode.playbackRate.setValueAtTime(rate,now);if(this._paused){this.bufferSourceNode.start(time,this.pauseTime,duration);this._counterNode.start(time,this.pauseTime,duration)}else{this.bufferSourceNode.start(time,cueStart,duration);this._counterNode.start(time,cueStart,duration)}this._playing=true;this._paused=false;this.bufferSourceNodes.push(this.bufferSourceNode);this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;var clearOnEnd=function(e){this._playing=false;this.removeEventListener("ended",clearOnEnd,false);self._onended(self);self.bufferSourceNodes.forEach(function(n,i){if(n._playing===false){self.bufferSourceNodes.splice(i)}});if(self.bufferSourceNodes.length===0){self._playing=false}};this.bufferSourceNode.onended=clearOnEnd}else{throw"not ready to play file, buffer has yet to load. Try preload()"}this.bufferSourceNode.loop=this._looping;this._counterNode.loop=this._looping;if(this._looping===true){var cueEnd=cueStart+duration;this.bufferSourceNode.loopStart=cueStart;this.bufferSourceNode.loopEnd=cueEnd;this._counterNode.loopStart=cueStart;this._counterNode.loopEnd=cueEnd}};p5.SoundFile.prototype.playMode=function(str){var s=str.toLowerCase();if(s==="restart"&&this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length-1;i++){var now=p5sound.audiocontext.currentTime;this.bufferSourceNodes[i].stop(now)}}if(s==="restart"||s==="sustain"){this.mode=s}else{throw'Invalid play mode. Must be either "restart" or "sustain"'}};p5.SoundFile.prototype.pause=function(time){var now=p5sound.audiocontext.currentTime;var time=time||0;var pTime=time+now;if(this.isPlaying()&&this.buffer&&this.bufferSourceNode){this.pauseTime=this.currentTime();this.bufferSourceNode.stop(pTime);this._counterNode.stop(pTime);this._paused=true;this._playing=false;this._pauseTime=this.currentTime()}else{this._pauseTime=0}};p5.SoundFile.prototype.loop=function(startTime,rate,amp,loopStart,duration){this._looping=true;this.play(startTime,rate,amp,loopStart,duration)};p5.SoundFile.prototype.setLoop=function(bool){if(bool===true){this._looping=true}else if(bool===false){this._looping=false}else{throw"Error: setLoop accepts either true or false"}if(this.bufferSourceNode){this.bufferSourceNode.loop=this._looping;this._counterNode.loop=this._looping}};p5.SoundFile.prototype.isLooping=function(){if(!this.bufferSourceNode){return false}if(this._looping===true&&this.isPlaying()===true){return true}return false};p5.SoundFile.prototype.isPlaying=function(){return this._playing};p5.SoundFile.prototype.isPaused=function(){return this._paused};p5.SoundFile.prototype.stop=function(timeFromNow){var time=timeFromNow||0;if(this.mode=="sustain"){this.stopAll(time);this._playing=false;this.pauseTime=0;this._paused=false}else if(this.buffer&&this.bufferSourceNode){var now=p5sound.audiocontext.currentTime;var t=time||0;this.pauseTime=0;this.bufferSourceNode.stop(now+t);this._counterNode.stop(now+t);this._playing=false;this._paused=false}};p5.SoundFile.prototype.stopAll=function(_time){var now=p5sound.audiocontext.currentTime;var time=_time||0;if(this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length;i++){if(typeof this.bufferSourceNodes[i]!=undefined){try{this.bufferSourceNodes[i].onended=function(){};this.bufferSourceNodes[i].stop(now+time)}catch(e){}}}this._counterNode.stop(now+time);this._onended(this)}};p5.SoundFile.prototype.setVolume=function(vol,rampTime,tFromNow){if(typeof vol==="number"){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now+tFromNow);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else if(vol){vol.connect(this.output.gain)}else{return this.output.gain}};p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume;p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume;p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value};p5.SoundFile.prototype.pan=function(pval,tFromNow){this.panPosition=pval;this.panner.pan(pval,tFromNow)};p5.SoundFile.prototype.getPan=function(){return this.panPosition};p5.SoundFile.prototype.rate=function(playbackRate){if(this.playbackRate===playbackRate&&this.bufferSourceNode){if(this.bufferSourceNode.playbackRate.value===playbackRate){return}}this.playbackRate=playbackRate;var rate=playbackRate;if(this.playbackRate===0&&this._playing){this.pause()}if(this.playbackRate<0&&!this.reversed){var cPos=this.currentTime();var cRate=this.bufferSourceNode.playbackRate.value;this.reverseBuffer();rate=Math.abs(playbackRate);var newPos=(cPos-this.duration())/rate;this.pauseTime=newPos}else if(this.playbackRate>0&&this.reversed){this.reverseBuffer()}if(this.bufferSourceNode){var now=p5sound.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(now);this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(rate),now);this._counterNode.playbackRate.cancelScheduledValues(now);this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(rate),now)}};p5.SoundFile.prototype.setPitch=function(num){var newPlaybackRate=midiToFreq(num)/midiToFreq(60);this.rate(newPlaybackRate)};p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate};p5.SoundFile.prototype.duration=function(){if(this.buffer){return this.buffer.duration}else{return 0}};p5.SoundFile.prototype.currentTime=function(){if(this._pauseTime>0){return this._pauseTime}else{return this._lastPos/ac.sampleRate}};p5.SoundFile.prototype.jump=function(cueTime,duration){if(cueTime<0||cueTime>this.buffer.duration){throw"jump time out of range"}if(duration>this.buffer.duration-cueTime){throw"end time out of range"}var cTime=cueTime||0;var eTime=duration||this.buffer.duration-cueTime;if(this.isPlaying()){this.stop()}this.play(0,this.playbackRate,this.output.gain.value,cTime,eTime)};p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels};p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate};p5.SoundFile.prototype.frames=function(){return this.buffer.length};p5.SoundFile.prototype.getPeaks=function(length){if(this.buffer){if(!length){length=window.width*5}if(this.buffer){var buffer=this.buffer;var sampleSize=buffer.length/length;var sampleStep=~~(sampleSize/10)||1;var channels=buffer.numberOfChannels;var peaks=new Float32Array(Math.round(length));for(var c=0;c<channels;c++){var chan=buffer.getChannelData(c);for(var i=0;i<length;i++){var start=~~(i*sampleSize);var end=~~(start+sampleSize);var max=0;for(var j=start;j<end;j+=sampleStep){var value=chan[j];if(value>max){max=value}else if(-value>max){max=value}}if(c===0||Math.abs(max)>peaks[i]){peaks[i]=max}}}return peaks}}else{throw"Cannot load peaks yet, buffer is not loaded"}};p5.SoundFile.prototype.reverseBuffer=function(){var curVol=this.getVolume();this.setVolume(0,.01,0);this.pause();if(this.buffer){for(var i=0;i<this.buffer.numberOfChannels;i++){Array.prototype.reverse.call(this.buffer.getChannelData(i))}this.reversed=!this.reversed}else{throw"SoundFile is not done loading"}this.setVolume(curVol,.01,.0101);this.play()};p5.SoundFile.prototype.onended=function(callback){this._onended=callback;return this};p5.SoundFile.prototype.add=function(){};p5.SoundFile.prototype.dispose=function(){var now=p5sound.audiocontext.currentTime;var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.stop(now);if(this.buffer&&this.bufferSourceNode){for(var i=0;i<this.bufferSourceNodes.length-1;i++){if(this.bufferSourceNodes[i]!==null){this.bufferSourceNodes[i].disconnect();try{this.bufferSourceNodes[i].stop(now)}catch(e){}this.bufferSourceNodes[i]=null}}if(this.isPlaying()){try{this._counterNode.stop(now)}catch(e){console.log(e)}this._counterNode=null}}if(this.output){this.output.disconnect();this.output=null}if(this.panner){this.panner.disconnect();this.panner=null}};p5.SoundFile.prototype.connect=function(unit){if(!unit){this.panner.connect(p5sound.input)}else{if(unit.hasOwnProperty("input")){this.panner.connect(unit.input)}else{this.panner.connect(unit)}}};p5.SoundFile.prototype.disconnect=function(unit){this.panner.disconnect(unit)};p5.SoundFile.prototype.getLevel=function(smoothing){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")};p5.SoundFile.prototype.setPath=function(p,callback){var path=p5.prototype._checkFileFormats(p);this.url=path;this.load(callback)};p5.SoundFile.prototype.setBuffer=function(buf){var numChannels=buf.length;var size=buf[0].length;var newBuffer=ac.createBuffer(numChannels,size,ac.sampleRate);if(!buf[0]instanceof Float32Array){buf[0]=new Float32Array(buf[0])}for(var channelNum=0;channelNum<numChannels;channelNum++){var channel=newBuffer.getChannelData(channelNum);channel.set(buf[channelNum])}this.buffer=newBuffer;this.panner.inputChannels(numChannels)};p5.SoundFile.prototype._initCounterNode=function(){var self=this;var now=ac.currentTime;var cNode=ac.createBufferSource();if(self._scopeNode){self._scopeNode.disconnect();self._scopeNode.onaudioprocess=undefined;self._scopeNode=null}self._scopeNode=ac.createScriptProcessor(256,1,1);cNode.buffer=_createCounterBuffer(self.buffer);cNode.playbackRate.setValueAtTime(self.playbackRate,now);cNode.connect(self._scopeNode);self._scopeNode.connect(p5.soundOut._silentNode);self._scopeNode.onaudioprocess=function(processEvent){var inputBuffer=processEvent.inputBuffer.getChannelData(0);self._lastPos=inputBuffer[inputBuffer.length-1]||0;self._onTimeUpdate(self._lastPos)};return cNode};p5.SoundFile.prototype._initSourceNode=function(){var self=this;var now=ac.currentTime;var bufferSourceNode=ac.createBufferSource();bufferSourceNode.buffer=self.buffer;bufferSourceNode.playbackRate.setValueAtTime(self.playbackRate,now);return bufferSourceNode};var _createCounterBuffer=function(buffer){var array=new Float32Array(buffer.length);var audioBuf=ac.createBuffer(1,buffer.length,44100);for(var index=0;index<buffer.length;index++){array[index]=index}audioBuf.getChannelData(0).set(array);return audioBuf};p5.SoundFile.prototype.processPeaks=function(callback,_initThreshold,_minThreshold,_minPeaks){var bufLen=this.buffer.length;var sampleRate=this.buffer.sampleRate;var buffer=this.buffer;var initialThreshold=_initThreshold||.9,threshold=initialThreshold,minThreshold=_minThreshold||.22,minPeaks=_minPeaks||200;var offlineContext=new OfflineAudioContext(1,bufLen,sampleRate);var source=offlineContext.createBufferSource();source.buffer=buffer;var filter=offlineContext.createBiquadFilter();filter.type="lowpass";source.connect(filter);filter.connect(offlineContext.destination);source.start(0);offlineContext.startRendering();offlineContext.oncomplete=function(e){var data={};var filteredBuffer=e.renderedBuffer;var bufferData=filteredBuffer.getChannelData(0);do{allPeaks=getPeaksAtThreshold(bufferData,threshold);threshold-=.005}while(Object.keys(allPeaks).length<minPeaks&&threshold>=minThreshold);var intervalCounts=countIntervalsBetweenNearbyPeaks(allPeaks);var groups=groupNeighborsByTempo(intervalCounts,filteredBuffer.sampleRate);var topTempos=groups.sort(function(intA,intB){return intB.count-intA.count}).splice(0,5);this.tempo=topTempos[0].tempo;var bpmVariance=5;var tempoPeaks=getPeaksAtTopTempo(allPeaks,topTempos[0].tempo,filteredBuffer.sampleRate,bpmVariance);callback(tempoPeaks)}};var Peak=function(amp,i){this.sampleIndex=i;this.amplitude=amp;this.tempos=[];this.intervals=[]};var allPeaks=[];function getPeaksAtThreshold(data,threshold){var peaksObj={};var length=data.length;for(var i=0;i<length;i++){if(data[i]>threshold){var amp=data[i];var peak=new Peak(amp,i);peaksObj[i]=peak;i+=6e3}i++}return peaksObj}function countIntervalsBetweenNearbyPeaks(peaksObj){var intervalCounts=[];var peaksArray=Object.keys(peaksObj).sort();for(var index=0;index<peaksArray.length;index++){for(var i=0;i<10;i++){var startPeak=peaksObj[peaksArray[index]];var endPeak=peaksObj[peaksArray[index+i]];if(startPeak&&endPeak){var startPos=startPeak.sampleIndex;var endPos=endPeak.sampleIndex;var interval=endPos-startPos;if(interval>0){startPeak.intervals.push(interval)}var foundInterval=intervalCounts.some(function(intervalCount,p){if(intervalCount.interval===interval){intervalCount.count++;return intervalCount}});if(!foundInterval){intervalCounts.push({interval:interval,count:1})}}}}return intervalCounts}function groupNeighborsByTempo(intervalCounts,sampleRate){var tempoCounts=[];intervalCounts.forEach(function(intervalCount,i){try{var theoreticalTempo=Math.abs(60/(intervalCount.interval/sampleRate));theoreticalTempo=mapTempo(theoreticalTempo);var foundTempo=tempoCounts.some(function(tempoCount){if(tempoCount.tempo===theoreticalTempo)return tempoCount.count+=intervalCount.count});if(!foundTempo){if(isNaN(theoreticalTempo)){return}tempoCounts.push({tempo:Math.round(theoreticalTempo),count:intervalCount.count})}}catch(e){throw e}});return tempoCounts}function getPeaksAtTopTempo(peaksObj,tempo,sampleRate,bpmVariance){var peaksAtTopTempo=[];var peaksArray=Object.keys(peaksObj).sort();for(var i=0;i<peaksArray.length;i++){var key=peaksArray[i];var peak=peaksObj[key];for(var j=0;j<peak.intervals.length;j++){var intervalBPM=Math.round(Math.abs(60/(peak.intervals[j]/sampleRate)));intervalBPM=mapTempo(intervalBPM);var dif=intervalBPM-tempo;if(Math.abs(intervalBPM-tempo)<bpmVariance){peaksAtTopTempo.push(peak.sampleIndex/44100)}}}peaksAtTopTempo=peaksAtTopTempo.filter(function(peakTime,index,arr){var dif=arr[index+1]-peakTime;if(dif>.01){return true}});return peaksAtTopTempo}function mapTempo(theoreticalTempo){if(!isFinite(theoreticalTempo)||theoreticalTempo==0){return}while(theoreticalTempo<90)theoreticalTempo*=2;while(theoreticalTempo>180&&theoreticalTempo>90)theoreticalTempo/=2;return theoreticalTempo}p5.SoundFile.prototype.addCue=function(time,callback,val){var id=this._cueIDCounter++;var cue=new Cue(callback,time,id,val);this._cues.push(cue);return id};p5.SoundFile.prototype.removeCue=function(id){var cueLength=this._cues.length;for(var i=0;i<cueLength;i++){var cue=this._cues[i];if(cue.id===id){this.cues.splice(i,1)}}if(this._cues.length===0){}};p5.SoundFile.prototype.clearCues=function(){this._cues=[]};p5.SoundFile.prototype._onTimeUpdate=function(position){var playbackTime=position/this.buffer.sampleRate;var cueLength=this._cues.length;for(var i=0;i<cueLength;i++){var cue=this._cues[i];var callbackTime=cue.time;var val=cue.val;if(this._prevTime<callbackTime&&callbackTime<=playbackTime){cue.callback(val)}}this._prevTime=playbackTime;
};var Cue=function(callback,time,id,val){this.callback=callback;this.time=time;this.id=id;this.val=val}}(sndcore,errorHandler,master);var amplitude;amplitude=function(){"use strict";var p5sound=master;p5.Amplitude=function(smoothing){this.bufferSize=2048;this.audiocontext=p5sound.audiocontext;this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1);this.input=this.processor;this.output=this.audiocontext.createGain();this.smoothing=smoothing||0;this.volume=0;this.average=0;this.stereoVol=[0,0];this.stereoAvg=[0,0];this.stereoVolNorm=[0,0];this.volMax=.001;this.normalize=false;this.processor.onaudioprocess=this._audioProcess.bind(this);this.processor.connect(this.output);this.output.gain.value=0;this.output.connect(this.audiocontext.destination);p5sound.meter.connect(this.processor);p5sound.soundArray.push(this)};p5.Amplitude.prototype.setInput=function(source,smoothing){p5sound.meter.disconnect();if(smoothing){this.smoothing=smoothing}if(source==null){console.log("Amplitude input source is not ready! Connecting to master output instead");p5sound.meter.connect(this.processor)}else if(source instanceof p5.Signal){source.output.connect(this.processor)}else if(source){source.connect(this.processor);this.processor.disconnect();this.processor.connect(this.output)}else{p5sound.meter.connect(this.processor)}};p5.Amplitude.prototype.connect=function(unit){if(unit){if(unit.hasOwnProperty("input")){this.output.connect(unit.input)}else{this.output.connect(unit)}}else{this.output.connect(this.panner.connect(p5sound.input))}};p5.Amplitude.prototype.disconnect=function(unit){this.output.disconnect()};p5.Amplitude.prototype._audioProcess=function(event){for(var channel=0;channel<event.inputBuffer.numberOfChannels;channel++){var inputBuffer=event.inputBuffer.getChannelData(channel);var bufLength=inputBuffer.length;var total=0;var sum=0;var x;for(var i=0;i<bufLength;i++){x=inputBuffer[i];if(this.normalize){total+=Math.max(Math.min(x/this.volMax,1),-1);sum+=Math.max(Math.min(x/this.volMax,1),-1)*Math.max(Math.min(x/this.volMax,1),-1)}else{total+=x;sum+=x*x}}var average=total/bufLength;var rms=Math.sqrt(sum/bufLength);this.stereoVol[channel]=Math.max(rms,this.stereoVol[channel]*this.smoothing);this.stereoAvg[channel]=Math.max(average,this.stereoVol[channel]*this.smoothing);this.volMax=Math.max(this.stereoVol[channel],this.volMax)}var self=this;var volSum=this.stereoVol.reduce(function(previousValue,currentValue,index){self.stereoVolNorm[index-1]=Math.max(Math.min(self.stereoVol[index-1]/self.volMax,1),0);self.stereoVolNorm[index]=Math.max(Math.min(self.stereoVol[index]/self.volMax,1),0);return previousValue+currentValue});this.volume=volSum/this.stereoVol.length;this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)};p5.Amplitude.prototype.getLevel=function(channel){if(typeof channel!=="undefined"){if(this.normalize){return this.stereoVolNorm[channel]}else{return this.stereoVol[channel]}}else if(this.normalize){return this.volNorm}else{return this.volume}};p5.Amplitude.prototype.toggleNormalize=function(bool){if(typeof bool==="boolean"){this.normalize=bool}else{this.normalize=!this.normalize}};p5.Amplitude.prototype.smooth=function(s){if(s>=0&&s<1){this.smoothing=s}else{console.log("Error: smoothing must be between 0 and 1")}};p5.Amplitude.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.input.disconnect();this.output.disconnect();this.input=this.processor=undefined;this.output=undefined}}(master);var fft;fft=function(){"use strict";var p5sound=master;p5.FFT=function(smoothing,bins){this.smoothing=smoothing||.8;this.bins=bins||1024;var FFT_SIZE=bins*2||2048;this.input=this.analyser=p5sound.audiocontext.createAnalyser();p5sound.fftMeter.connect(this.analyser);this.analyser.smoothingTimeConstant=this.smoothing;this.analyser.fftSize=FFT_SIZE;this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount);this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount);this.bass=[20,140];this.lowMid=[140,400];this.mid=[400,2600];this.highMid=[2600,5200];this.treble=[5200,14e3];p5sound.soundArray.push(this)};p5.FFT.prototype.setInput=function(source){if(!source){p5sound.fftMeter.connect(this.analyser)}else{if(source.output){source.output.connect(this.analyser)}else if(source.connect){source.connect(this.analyser)}p5sound.fftMeter.disconnect()}};p5.FFT.prototype.waveform=function(){var bins,mode,normalArray;for(var i=0;i<arguments.length;i++){if(typeof arguments[i]==="number"){bins=arguments[i];this.analyser.fftSize=bins*2}if(typeof arguments[i]==="string"){mode=arguments[i]}}if(mode&&!p5.prototype._isSafari()){timeToFloat(this,this.timeDomain);this.analyser.getFloatTimeDomainData(this.timeDomain);return this.timeDomain}else{timeToInt(this,this.timeDomain);this.analyser.getByteTimeDomainData(this.timeDomain);var normalArray=new Array;for(var i=0;i<this.timeDomain.length;i++){var scaled=p5.prototype.map(this.timeDomain[i],0,255,-1,1);normalArray.push(scaled)}return normalArray}};p5.FFT.prototype.analyze=function(){var bins,mode;for(var i=0;i<arguments.length;i++){if(typeof arguments[i]==="number"){bins=this.bins=arguments[i];this.analyser.fftSize=this.bins*2}if(typeof arguments[i]==="string"){mode=arguments[i]}}if(mode&&mode.toLowerCase()==="db"){freqToFloat(this);this.analyser.getFloatFrequencyData(this.freqDomain);return this.freqDomain}else{freqToInt(this,this.freqDomain);this.analyser.getByteFrequencyData(this.freqDomain);var normalArray=Array.apply([],this.freqDomain);normalArray.length===this.analyser.fftSize;normalArray.constructor===Array;return normalArray}};p5.FFT.prototype.getEnergy=function(frequency1,frequency2){var nyquist=p5sound.audiocontext.sampleRate/2;if(frequency1==="bass"){frequency1=this.bass[0];frequency2=this.bass[1]}else if(frequency1==="lowMid"){frequency1=this.lowMid[0];frequency2=this.lowMid[1]}else if(frequency1==="mid"){frequency1=this.mid[0];frequency2=this.mid[1]}else if(frequency1==="highMid"){frequency1=this.highMid[0];frequency2=this.highMid[1]}else if(frequency1==="treble"){frequency1=this.treble[0];frequency2=this.treble[1]}if(typeof frequency1!=="number"){throw"invalid input for getEnergy()"}else if(!frequency2){var index=Math.round(frequency1/nyquist*this.freqDomain.length);return this.freqDomain[index]}else if(frequency1&&frequency2){if(frequency1>frequency2){var swap=frequency2;frequency2=frequency1;frequency1=swap}var lowIndex=Math.round(frequency1/nyquist*this.freqDomain.length);var highIndex=Math.round(frequency2/nyquist*this.freqDomain.length);var total=0;var numFrequencies=0;for(var i=lowIndex;i<=highIndex;i++){total+=this.freqDomain[i];numFrequencies+=1}var toReturn=total/numFrequencies;return toReturn}else{throw"invalid input for getEnergy()"}};p5.FFT.prototype.getFreq=function(freq1,freq2){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var x=this.getEnergy(freq1,freq2);return x};p5.FFT.prototype.getCentroid=function(){var nyquist=p5sound.audiocontext.sampleRate/2;var cumulative_sum=0;var centroid_normalization=0;for(var i=0;i<this.freqDomain.length;i++){cumulative_sum+=i*this.freqDomain[i];centroid_normalization+=this.freqDomain[i]}var mean_freq_index=0;if(centroid_normalization!=0){mean_freq_index=cumulative_sum/centroid_normalization}var spec_centroid_freq=mean_freq_index*(nyquist/this.freqDomain.length);return spec_centroid_freq};p5.FFT.prototype.smooth=function(s){if(s){this.smoothing=s}this.analyser.smoothingTimeConstant=s};p5.FFT.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.analyser.disconnect();this.analyser=undefined};var freqToFloat=function(fft){if(fft.freqDomain instanceof Float32Array===false){fft.freqDomain=new Float32Array(fft.analyser.frequencyBinCount)}};var freqToInt=function(fft){if(fft.freqDomain instanceof Uint8Array===false){fft.freqDomain=new Uint8Array(fft.analyser.frequencyBinCount)}};var timeToFloat=function(fft){if(fft.timeDomain instanceof Float32Array===false){fft.timeDomain=new Float32Array(fft.analyser.frequencyBinCount)}};var timeToInt=function(fft){if(fft.timeDomain instanceof Uint8Array===false){fft.timeDomain=new Uint8Array(fft.analyser.frequencyBinCount)}}}(master);var Tone_core_Tone;Tone_core_Tone=function(){"use strict";function isUndef(val){return val===void 0}function isFunction(val){return typeof val==="function"}var audioContext;if(isUndef(window.AudioContext)){window.AudioContext=window.webkitAudioContext}if(isUndef(window.OfflineAudioContext)){window.OfflineAudioContext=window.webkitOfflineAudioContext}if(!isUndef(AudioContext)){audioContext=new AudioContext}else{throw new Error("Web Audio is not supported in this browser")}if(!isFunction(AudioContext.prototype.createGain)){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}if(!isFunction(AudioContext.prototype.createDelay)){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}if(!isFunction(AudioContext.prototype.createPeriodicWave)){AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable}if(!isFunction(AudioBufferSourceNode.prototype.start)){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}if(!isFunction(AudioBufferSourceNode.prototype.stop)){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}if(!isFunction(OscillatorNode.prototype.start)){OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn}if(!isFunction(OscillatorNode.prototype.stop)){OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff}if(!isFunction(OscillatorNode.prototype.setPeriodicWave)){OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable}AudioNode.prototype._nativeConnect=AudioNode.prototype.connect;AudioNode.prototype.connect=function(B,outNum,inNum){if(B.input){if(Array.isArray(B.input)){if(isUndef(inNum)){inNum=0}this.connect(B.input[inNum])}else{this.connect(B.input,outNum,inNum)}}else{try{if(B instanceof AudioNode){this._nativeConnect(B,outNum,inNum)}else{this._nativeConnect(B,outNum)}}catch(e){throw new Error("error connecting to node: "+B)}}};var Tone=function(inputs,outputs){if(isUndef(inputs)||inputs===1){this.input=this.context.createGain()}else if(inputs>1){this.input=new Array(inputs)}if(isUndef(outputs)||outputs===1){this.output=this.context.createGain()}else if(outputs>1){this.output=new Array(inputs)}};Tone.prototype.set=function(params,value,rampTime){if(this.isObject(params)){rampTime=value}else if(this.isString(params)){var tmpObj={};tmpObj[params]=value;params=tmpObj}for(var attr in params){value=params[attr];var parent=this;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var i=0;i<attrSplit.length-1;i++){parent=parent[attrSplit[i]]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];if(isUndef(param)){continue}if(Tone.Signal&&param instanceof Tone.Signal||Tone.Param&&param instanceof Tone.Param){if(param.value!==value){if(isUndef(rampTime)){param.value=value}else{param.rampTo(value,rampTime)}}}else if(param instanceof AudioParam){if(param.value!==value){param.value=value}}else if(param instanceof Tone){param.set(value)}else if(param!==value){parent[attr]=value}}return this};Tone.prototype.get=function(params){if(isUndef(params)){params=this._collectDefaults(this.constructor)}else if(this.isString(params)){params=[params]}var ret={};for(var i=0;i<params.length;i++){var attr=params[i];var parent=this;var subRet=ret;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{};subRet=subRet[subAttr];parent=parent[subAttr]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];if(this.isObject(params[attr])){subRet[attr]=param.get()}else if(Tone.Signal&&param instanceof Tone.Signal){subRet[attr]=param.value}else if(Tone.Param&&param instanceof Tone.Param){subRet[attr]=param.value}else if(param instanceof AudioParam){subRet[attr]=param.value}else if(param instanceof Tone){subRet[attr]=param.get()}else if(!isFunction(param)&&!isUndef(param)){subRet[attr]=param}}return ret};Tone.prototype._collectDefaults=function(constr){var ret=[];if(!isUndef(constr.defaults)){ret=Object.keys(constr.defaults)}if(!isUndef(constr._super)){var superDefs=this._collectDefaults(constr._super);for(var i=0;i<superDefs.length;i++){if(ret.indexOf(superDefs[i])===-1){ret.push(superDefs[i])}}}return ret};Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/);var sameConstructor=Tone[className]===this.constructor;if(isFunction(Tone[className])&&isLetter&&sameConstructor){return className}}return"Tone"};Tone.context=audioContext;Tone.prototype.context=Tone.context;Tone.prototype.bufferSize=2048;Tone.prototype.blockTime=128/Tone.context.sampleRate;Tone.prototype.dispose=function(){if(!this.isUndef(this.input)){if(this.input instanceof AudioNode){this.input.disconnect()}this.input=null}if(!this.isUndef(this.output)){if(this.output instanceof AudioNode){this.output.disconnect()}this.output=null}return this};var _silentNode=null;Tone.prototype.noGC=function(){this.output.connect(_silentNode);return this};AudioNode.prototype.noGC=function(){this.connect(_silentNode);return this};Tone.prototype.connect=function(unit,outputNum,inputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].connect(unit,0,inputNum)}else{this.output.connect(unit,outputNum,inputNum)}return this};Tone.prototype.disconnect=function(outputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].disconnect()}else{this.output.disconnect()}return this};Tone.prototype.connectSeries=function(){if(arguments.length>1){var currentUnit=arguments[0];for(var i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}return this};Tone.prototype.connectParallel=function(){var connectFrom=arguments[0];if(arguments.length>1){for(var i=1;i<arguments.length;i++){var connectTo=arguments[i];connectFrom.connect(connectTo)}}return this};Tone.prototype.chain=function(){if(arguments.length>0){var currentUnit=this;for(var i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}return this};Tone.prototype.fan=function(){if(arguments.length>0){for(var i=0;i<arguments.length;i++){this.connect(arguments[i])}}return this};AudioNode.prototype.chain=Tone.prototype.chain;AudioNode.prototype.fan=Tone.prototype.fan;Tone.prototype.defaultArg=function(given,fallback){if(this.isObject(given)&&this.isObject(fallback)){var ret={};for(var givenProp in given){ret[givenProp]=this.defaultArg(fallback[givenProp],given[givenProp])}for(var fallbackProp in fallback){ret[fallbackProp]=this.defaultArg(given[fallbackProp],fallback[fallbackProp])}return ret}else{return isUndef(given)?fallback:given}};Tone.prototype.optionsObject=function(values,keys,defaults){var options={};if(values.length===1&&this.isObject(values[0])){options=values[0]}else{for(var i=0;i<keys.length;i++){options[keys[i]]=values[i]}}if(!this.isUndef(defaults)){return this.defaultArg(options,defaults)}else{return options}};Tone.prototype.isUndef=isUndef;Tone.prototype.isFunction=isFunction;Tone.prototype.isNumber=function(arg){return typeof arg==="number"};Tone.prototype.isObject=function(arg){return Object.prototype.toString.call(arg)==="[object Object]"&&arg.constructor===Object};Tone.prototype.isBoolean=function(arg){return typeof arg==="boolean"};Tone.prototype.isArray=function(arg){return Array.isArray(arg)};Tone.prototype.isString=function(arg){return typeof arg==="string"};Tone.noOp=function(){};Tone.prototype._readOnly=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._readOnly(property[i])}}else{Object.defineProperty(this,property,{writable:false,enumerable:true})}};Tone.prototype._writable=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._writable(property[i])}}else{Object.defineProperty(this,property,{writable:true})}};Tone.State={Started:"started",Stopped:"stopped",Paused:"paused"};Tone.prototype.equalPowerScale=function(percent){var piFactor=.5*Math.PI;return Math.sin(percent*piFactor)};Tone.prototype.dbToGain=function(db){return Math.pow(2,db/6)};Tone.prototype.gainToDb=function(gain){return 20*(Math.log(gain)/Math.LN10)};Tone.prototype.now=function(){return this.context.currentTime};Tone.extend=function(child,parent){if(isUndef(parent)){parent=Tone}function TempConstructor(){}TempConstructor.prototype=parent.prototype;child.prototype=new TempConstructor;child.prototype.constructor=child;child._super=parent};var newContextCallbacks=[];Tone._initAudioContext=function(callback){callback(Tone.context);newContextCallbacks.push(callback)};Tone.setContext=function(ctx){Tone.prototype.context=ctx;Tone.context=ctx;for(var i=0;i<newContextCallbacks.length;i++){newContextCallbacks[i](ctx)}};Tone.startMobile=function(){var osc=Tone.context.createOscillator();var silent=Tone.context.createGain();silent.gain.value=0;osc.connect(silent);silent.connect(Tone.context.destination);var now=Tone.context.currentTime;osc.start(now);osc.stop(now+1)};Tone._initAudioContext(function(audioContext){Tone.prototype.blockTime=128/audioContext.sampleRate;_silentNode=audioContext.createGain();_silentNode.gain.value=0;_silentNode.connect(audioContext.destination)});Tone.version="r7-dev";return Tone}();var Tone_signal_SignalBase;Tone_signal_SignalBase=function(Tone){"use strict";Tone.SignalBase=function(){};Tone.extend(Tone.SignalBase);Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){if(Tone.Signal&&Tone.Signal===node.constructor||Tone.Param&&Tone.Param===node.constructor||Tone.TimelineSignal&&Tone.TimelineSignal===node.constructor){node._param.cancelScheduledValues(0);node._param.value=0;node.overridden=true}else if(node instanceof AudioParam){node.cancelScheduledValues(0);node.value=0}Tone.prototype.connect.call(this,node,outputNumber,inputNumber);return this};return Tone.SignalBase}(Tone_core_Tone);var Tone_signal_WaveShaper;Tone_signal_WaveShaper=function(Tone){"use strict";Tone.WaveShaper=function(mapping,bufferLen){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;if(Array.isArray(mapping)){this.curve=mapping}else if(isFinite(mapping)||this.isUndef(mapping)){this._curve=new Float32Array(this.defaultArg(mapping,1024))}else if(this.isFunction(mapping)){this._curve=new Float32Array(this.defaultArg(bufferLen,1024));this.setMap(mapping)}};Tone.extend(Tone.WaveShaper,Tone.SignalBase);Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/len*2-1;this._curve[i]=mapping(normalized,i)}this._shaper.curve=this._curve;return this};Object.defineProperty(Tone.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(mapping){this._curve=new Float32Array(mapping);this._shaper.curve=this._curve}});Object.defineProperty(Tone.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){if(["none","2x","4x"].indexOf(oversampling)!==-1){this._shaper.oversample=oversampling}else{throw new Error("invalid oversampling: "+oversampling)}}});Tone.WaveShaper.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._shaper.disconnect();this._shaper=null;this._curve=null;return this};return Tone.WaveShaper}(Tone_core_Tone);var Tone_core_Type;Tone_core_Type=function(Tone){"use strict";Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"};Tone.prototype.isNowRelative=function(){var nowRelative=new RegExp(/^\s*\+(.)+/i);return function(note){return nowRelative.test(note)}}();Tone.prototype.isTicks=function(){var tickFormat=new RegExp(/^\d+i$/i);return function(note){return tickFormat.test(note)}}();Tone.prototype.isNotation=function(){var notationFormat=new RegExp(/^[0-9]+[mnt]$/i);return function(note){return notationFormat.test(note)}}();Tone.prototype.isTransportTime=function(){var transportTimeFormat=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(transportTime){return transportTimeFormat.test(transportTime)}}();Tone.prototype.isNote=function(){var noteFormat=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(note){return noteFormat.test(note)}}();Tone.prototype.isFrequency=function(){var freqFormat=new RegExp(/^\d*\.?\d+hz$/i);return function(freq){return freqFormat.test(freq)}}();function getTransportBpm(){if(Tone.Transport&&Tone.Transport.bpm){return Tone.Transport.bpm.value}else{return 120}}function getTransportTimeSignature(){if(Tone.Transport&&Tone.Transport.timeSignature){return Tone.Transport.timeSignature}else{return 4}}Tone.prototype.notationToSeconds=function(notation,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var beatTime=60/bpm;if(notation==="1n"){notation="1m"}var subdivision=parseInt(notation,10);var beats=0;if(subdivision===0){beats=0}var lastLetter=notation.slice(-1);if(lastLetter==="t"){beats=4/subdivision*2/3}else if(lastLetter==="n"){beats=4/subdivision}else if(lastLetter==="m"){beats=subdivision*timeSignature}else{beats=0}return beatTime*beats};Tone.prototype.transportTimeToSeconds=function(transportTime,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var measures=0;var quarters=0;var sixteenths=0;var split=transportTime.split(":");if(split.length===2){measures=parseFloat(split[0]);quarters=parseFloat(split[1])}else if(split.length===1){quarters=parseFloat(split[0])}else if(split.length===3){measures=parseFloat(split[0]);quarters=parseFloat(split[1]);sixteenths=parseFloat(split[2])}var beats=measures*timeSignature+quarters+sixteenths/4;return beats*(60/bpm)};Tone.prototype.ticksToSeconds=function(ticks,bpm){if(this.isUndef(Tone.Transport)){return 0}ticks=parseFloat(ticks);bpm=this.defaultArg(bpm,getTransportBpm());var tickTime=60/bpm/Tone.Transport.PPQ;return tickTime*ticks};Tone.prototype.frequencyToSeconds=function(freq){return 1/parseFloat(freq)};Tone.prototype.samplesToSeconds=function(samples){return samples/this.context.sampleRate};Tone.prototype.secondsToSamples=function(seconds){return seconds*this.context.sampleRate};Tone.prototype.secondsToTransportTime=function(seconds,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var quarterTime=60/bpm;var quarters=seconds/quarterTime;var measures=Math.floor(quarters/timeSignature);var sixteenths=quarters%1*4;quarters=Math.floor(quarters)%timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(":")};Tone.prototype.secondsToFrequency=function(seconds){return 1/seconds};Tone.prototype.toTransportTime=function(time,bpm,timeSignature){var seconds=this.toSeconds(time);return this.secondsToTransportTime(seconds,bpm,timeSignature)};Tone.prototype.toFrequency=function(freq,now){if(this.isFrequency(freq)){return parseFloat(freq)}else if(this.isNotation(freq)||this.isTransportTime(freq)){return this.secondsToFrequency(this.toSeconds(freq,now))}else if(this.isNote(freq)){return this.noteToFrequency(freq)}else{return freq}};Tone.prototype.toTicks=function(time){if(this.isUndef(Tone.Transport)){return 0}var bpm=Tone.Transport.bpm.value;var plusNow=0;if(this.isNowRelative(time)){time=time.replace("+","");plusNow=Tone.Transport.ticks}else if(this.isUndef(time)){return Tone.Transport.ticks}var seconds=this.toSeconds(time);var quarter=60/bpm;var quarters=seconds/quarter;var tickNum=quarters*Tone.Transport.PPQ;return Math.round(tickNum+plusNow)};Tone.prototype.toSamples=function(time){var seconds=this.toSeconds(time);return Math.round(seconds*this.context.sampleRate)};Tone.prototype.toSeconds=function(time,now){now=this.defaultArg(now,this.now());if(this.isNumber(time)){return time}else if(this.isString(time)){var plusTime=0;if(this.isNowRelative(time)){time=time.replace("+","");plusTime=now}var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens){for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,"");var symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}}if(time.indexOf("@")!==-1){var quantizationSplit=time.split("@");if(!this.isUndef(Tone.Transport)){var toQuantize=quantizationSplit[0].trim();if(toQuantize===""){toQuantize=undefined}if(plusTime>0){toQuantize="+"+toQuantize;plusTime=0}var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{throw new Error("quantization requires Tone.Transport")}}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){var originalTime=time;for(var i=0;i<components.length;i++){var symb=components[i].trim();if(symb!==""){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(e){throw new EvalError("cannot evaluate Time: "+originalTime)}}else if(this.isNotation(time)){time=this.notationToSeconds(time)}else if(this.isTransportTime(time)){time=this.transportTimeToSeconds(time)}else if(this.isFrequency(time)){time=this.frequencyToSeconds(time)}else if(this.isTicks(time)){time=this.ticksToSeconds(time)}else{time=parseFloat(time)}}return time+plusTime}else{return now}};Tone.prototype.toNotation=function(time,bpm,timeSignature){var testNotations=["1m","2n","4n","8n","16n","32n","64n","128n"];var retNotation=toNotationHelper.call(this,time,bpm,timeSignature,testNotations);var testTripletNotations=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"];var retTripletNotation=toNotationHelper.call(this,time,bpm,timeSignature,testTripletNotations);if(retTripletNotation.split("+").length<retNotation.split("+").length){return retTripletNotation}else{return retNotation}};function toNotationHelper(time,bpm,timeSignature,testNotations){var seconds=this.toSeconds(time);var threshold=this.notationToSeconds(testNotations[testNotations.length-1],bpm,timeSignature);var retNotation="";for(var i=0;i<testNotations.length;i++){var notationTime=this.notationToSeconds(testNotations[i],bpm,timeSignature);var multiple=seconds/notationTime;var floatingPointError=1e-6;if(1-multiple%1<floatingPointError){multiple+=floatingPointError}multiple=Math.floor(multiple);if(multiple>0){if(multiple===1){retNotation+=testNotations[i]}else{retNotation+=multiple.toString()+"*"+testNotations[i]}seconds-=multiple*notationTime;if(seconds<threshold){break}else{retNotation+=" + "}}}if(retNotation===""){retNotation="0"}return retNotation}Tone.prototype.fromUnits=function(val,units){if(this.convert||this.isUndef(this.convert)){switch(units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}}else{return val}};Tone.prototype.toUnits=function(val,units){if(this.convert||this.isUndef(this.convert)){switch(units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}}else{return val}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};var scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];Tone.A4=440;Tone.prototype.noteToFrequency=function(note){var parts=note.split(/(-?\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()];var octave=parts[1];var noteNumber=index+(parseInt(octave,10)+1)*12;return this.midiToFrequency(noteNumber)}else{return 0}};Tone.prototype.frequencyToNote=function(freq){var log=Math.log(freq/Tone.A4)/Math.LN2;var noteNumber=Math.round(12*log)+57;var octave=Math.floor(noteNumber/12);if(octave<0){noteNumber+=-12*octave}var noteName=scaleIndexToNote[noteNumber%12];return noteName+octave.toString()};Tone.prototype.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)};Tone.prototype.midiToNote=function(midiNumber){var octave=Math.floor(midiNumber/12)-1;var note=midiNumber%12;return scaleIndexToNote[note]+octave};Tone.prototype.noteToMidi=function(note){var parts=note.split(/(\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()];var octave=parts[1];return index+(parseInt(octave,10)+1)*12}else{return 0}};Tone.prototype.midiToFrequency=function(midi){return Tone.A4*Math.pow(2,(midi-69)/12)};return Tone}(Tone_core_Tone);var Tone_core_Param;Tone_core_Param=function(Tone){"use strict";Tone.Param=function(){var options=this.optionsObject(arguments,["param","units","convert"],Tone.Param.defaults);this._param=this.input=options.param;this.units=options.units;this.convert=options.convert;this.overridden=false;if(!this.isUndef(options.value)){this.value=options.value}};Tone.extend(Tone.Param);Tone.Param.defaults={units:Tone.Type.Default,convert:true,param:undefined};Object.defineProperty(Tone.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._param.value=convertedVal}});Tone.Param.prototype._fromUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}}else{return val}};Tone.Param.prototype._toUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}}else{return val}};Tone.Param.prototype._minOutput=1e-5;Tone.Param.prototype.setValueAtTime=function(value,time){value=this._fromUnits(value);this._param.setValueAtTime(value,this.toSeconds(time));return this};Tone.Param.prototype.setRampPoint=function(now){now=this.defaultArg(now,this.now());var currentVal=this._param.value;this._param.setValueAtTime(currentVal,now);return this};Tone.Param.prototype.linearRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);this._param.linearRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Param.prototype.exponentialRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);value=Math.max(this._minOutput,value);this._param.exponentialRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Param.prototype.exponentialRampToValue=function(value,rampTime){var now=this.now();var currentVal=this.value;this.setValueAtTime(Math.max(currentVal,this._minOutput),now);this.exponentialRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Param.prototype.linearRampToValue=function(value,rampTime){var now=this.now();this.setRampPoint(now);this.linearRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Param.prototype.setTargetAtTime=function(value,startTime,timeConstant){value=this._fromUnits(value);value=Math.max(this._minOutput,value);timeConstant=Math.max(this._minOutput,timeConstant);this._param.setTargetAtTime(value,this.toSeconds(startTime),timeConstant);return this};Tone.Param.prototype.setValueCurveAtTime=function(values,startTime,duration){for(var i=0;i<values.length;i++){
values[i]=this._fromUnits(values[i])}this._param.setValueCurveAtTime(values,this.toSeconds(startTime),this.toSeconds(duration));return this};Tone.Param.prototype.cancelScheduledValues=function(startTime){this._param.cancelScheduledValues(this.toSeconds(startTime));return this};Tone.Param.prototype.rampTo=function(value,rampTime){rampTime=this.defaultArg(rampTime,0);if(this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM){this.exponentialRampToValue(value,rampTime)}else{this.linearRampToValue(value,rampTime)}return this};Tone.Param.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._param=null;return this};return Tone.Param}(Tone_core_Tone);var Tone_core_Gain;Tone_core_Gain=function(Tone){"use strict";Tone.Gain=function(){var options=this.optionsObject(arguments,["gain","units"],Tone.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain();this.gain=new Tone.Param({param:this._gainNode.gain,units:options.units,value:options.gain,convert:options.convert});this._readOnly("gain")};Tone.extend(Tone.Gain);Tone.Gain.defaults={gain:1,convert:true};Tone.Gain.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this);this._gainNode.disconnect();this._gainNode=null;this._writable("gain");this.gain.dispose();this.gain=null};return Tone.Gain}(Tone_core_Tone,Tone_core_Param);var Tone_signal_Signal;Tone_signal_Signal=function(Tone){"use strict";Tone.Signal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);this.output=this._gain=this.context.createGain();options.param=this._gain.gain;Tone.Param.call(this,options);this.input=this._param=this._gain.gain;Tone.Signal._constant.chain(this._gain)};Tone.extend(Tone.Signal,Tone.Param);Tone.Signal.defaults={value:0,units:Tone.Type.Default,convert:true};Tone.Signal.prototype.connect=Tone.SignalBase.prototype.connect;Tone.Signal.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this);this._param=null;this._gain.disconnect();this._gain=null;return this};Tone.Signal._constant=null;Tone._initAudioContext(function(audioContext){var buffer=audioContext.createBuffer(1,128,audioContext.sampleRate);var arr=buffer.getChannelData(0);for(var i=0;i<arr.length;i++){arr[i]=1}Tone.Signal._constant=audioContext.createBufferSource();Tone.Signal._constant.channelCount=1;Tone.Signal._constant.channelCountMode="explicit";Tone.Signal._constant.buffer=buffer;Tone.Signal._constant.loop=true;Tone.Signal._constant.start(0);Tone.Signal._constant.noGC()});return Tone.Signal}(Tone_core_Tone,Tone_signal_WaveShaper,Tone_core_Type,Tone_core_Param);var Tone_signal_Add;Tone_signal_Add=function(Tone){"use strict";Tone.Add=function(value){Tone.call(this,2,0);this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain();this._param=this.input[1]=new Tone.Signal(value);this._param.connect(this._sum)};Tone.extend(Tone.Add,Tone.Signal);Tone.Add.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sum.disconnect();this._sum=null;this._param.dispose();this._param=null;return this};return Tone.Add}(Tone_core_Tone);var Tone_signal_Multiply;Tone_signal_Multiply=function(Tone){"use strict";Tone.Multiply=function(value){Tone.call(this,2,0);this._mult=this.input[0]=this.output=this.context.createGain();this._param=this.input[1]=this.output.gain;this._param.value=this.defaultArg(value,0)};Tone.extend(Tone.Multiply,Tone.Signal);Tone.Multiply.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._mult.disconnect();this._mult=null;this._param=null;return this};return Tone.Multiply}(Tone_core_Tone);var Tone_signal_Scale;Tone_signal_Scale=function(Tone){"use strict";Tone.Scale=function(outputMin,outputMax){this._outputMin=this.defaultArg(outputMin,0);this._outputMax=this.defaultArg(outputMax,1);this._scale=this.input=new Tone.Multiply(1);this._add=this.output=new Tone.Add(0);this._scale.connect(this._add);this._setRange()};Tone.extend(Tone.Scale,Tone.SignalBase);Object.defineProperty(Tone.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(min){this._outputMin=min;this._setRange()}});Object.defineProperty(Tone.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(max){this._outputMax=max;this._setRange()}});Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin};Tone.Scale.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._add.dispose();this._add=null;this._scale.dispose();this._scale=null;return this};return Tone.Scale}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Multiply);var signal;signal=function(){"use strict";var Signal=Tone_signal_Signal;var Add=Tone_signal_Add;var Mult=Tone_signal_Multiply;var Scale=Tone_signal_Scale;var Tone=Tone_core_Tone;var p5sound=master;Tone.setContext(p5sound.audiocontext);p5.Signal=function(value){var s=new Signal(value);return s};Signal.prototype.fade=Signal.prototype.linearRampToValueAtTime;Mult.prototype.fade=Signal.prototype.fade;Add.prototype.fade=Signal.prototype.fade;Scale.prototype.fade=Signal.prototype.fade;Signal.prototype.setInput=function(_input){_input.connect(this)};Mult.prototype.setInput=Signal.prototype.setInput;Add.prototype.setInput=Signal.prototype.setInput;Scale.prototype.setInput=Signal.prototype.setInput;Signal.prototype.add=function(num){var add=new Add(num);this.connect(add);return add};Mult.prototype.add=Signal.prototype.add;Add.prototype.add=Signal.prototype.add;Scale.prototype.add=Signal.prototype.add;Signal.prototype.mult=function(num){var mult=new Mult(num);this.connect(mult);return mult};Mult.prototype.mult=Signal.prototype.mult;Add.prototype.mult=Signal.prototype.mult;Scale.prototype.mult=Signal.prototype.mult;Signal.prototype.scale=function(inMin,inMax,outMin,outMax){var mapOutMin,mapOutMax;if(arguments.length===4){mapOutMin=p5.prototype.map(outMin,inMin,inMax,0,1)-.5;mapOutMax=p5.prototype.map(outMax,inMin,inMax,0,1)-.5}else{mapOutMin=arguments[0];mapOutMax=arguments[1]}var scale=new Scale(mapOutMin,mapOutMax);this.connect(scale);return scale};Mult.prototype.scale=Signal.prototype.scale;Add.prototype.scale=Signal.prototype.scale;Scale.prototype.scale=Signal.prototype.scale}(Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone,master);var oscillator;oscillator=function(){"use strict";var p5sound=master;var Signal=Tone_signal_Signal;var Add=Tone_signal_Add;var Mult=Tone_signal_Multiply;var Scale=Tone_signal_Scale;p5.Oscillator=function(freq,type){if(typeof freq==="string"){var f=type;type=freq;freq=f}if(typeof type==="number"){var f=type;type=freq;freq=f}this.started=false;this.phaseAmount=undefined;this.oscillator=p5sound.audiocontext.createOscillator();this.f=freq||440;this.oscillator.frequency.setValueAtTime(this.f,p5sound.audiocontext.currentTime);this.oscillator.type=type||"sine";var o=this.oscillator;this.input=p5sound.audiocontext.createGain();this.output=p5sound.audiocontext.createGain();this._freqMods=[];this.output.gain.value=.5;this.output.gain.setValueAtTime(.5,p5sound.audiocontext.currentTime);this.oscillator.connect(this.output);this.panPosition=0;this.connection=p5sound.input;this.panner=new p5.Panner(this.output,this.connection,1);this.mathOps=[this.output];p5sound.soundArray.push(this)};p5.Oscillator.prototype.start=function(time,f){if(this.started){var now=p5sound.audiocontext.currentTime;this.stop(now)}if(!this.started){var freq=f||this.f;var type=this.oscillator.type;this.oscillator=p5sound.audiocontext.createOscillator();this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(freq),p5sound.audiocontext.currentTime);this.oscillator.type=type;this.oscillator.connect(this.output);time=time||0;this.oscillator.start(time+p5sound.audiocontext.currentTime);this.freqNode=this.oscillator.frequency;for(var i in this._freqMods){if(typeof this._freqMods[i].connect!=="undefined"){this._freqMods[i].connect(this.oscillator.frequency)}}this.started=true}};p5.Oscillator.prototype.stop=function(time){if(this.started){var t=time||0;var now=p5sound.audiocontext.currentTime;this.oscillator.stop(t+now);this.started=false}};p5.Oscillator.prototype.amp=function(vol,rampTime,tFromNow){var self=this;if(typeof vol==="number"){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)}else if(vol){vol.connect(self.output.gain)}else{return this.output.gain}};p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp;p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value};p5.Oscillator.prototype.freq=function(val,rampTime,tFromNow){if(typeof val==="number"&&!isNaN(val)){this.f=val;var now=p5sound.audiocontext.currentTime;var rampTime=rampTime||0;var tFromNow=tFromNow||0;if(rampTime==0){this.oscillator.frequency.cancelScheduledValues(now);this.oscillator.frequency.setValueAtTime(val,tFromNow+now)}else{if(val>0){this.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now)}else{this.oscillator.frequency.linearRampToValueAtTime(val,tFromNow+rampTime+now)}}if(this.phaseAmount){this.phase(this.phaseAmount)}}else if(val){if(val.output){val=val.output}val.connect(this.oscillator.frequency);this._freqMods.push(val)}else{return this.oscillator.frequency}};p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value};p5.Oscillator.prototype.setType=function(type){this.oscillator.type=type};p5.Oscillator.prototype.getType=function(){return this.oscillator.type};p5.Oscillator.prototype.connect=function(unit){if(!unit){this.panner.connect(p5sound.input)}else if(unit.hasOwnProperty("input")){this.panner.connect(unit.input);this.connection=unit.input}else{this.panner.connect(unit);this.connection=unit}};p5.Oscillator.prototype.disconnect=function(unit){this.output.disconnect();this.panner.disconnect();this.output.connect(this.panner);this.oscMods=[]};p5.Oscillator.prototype.pan=function(pval,tFromNow){this.panPosition=pval;this.panner.pan(pval,tFromNow)};p5.Oscillator.prototype.getPan=function(){return this.panPosition};p5.Oscillator.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);if(this.oscillator){var now=p5sound.audiocontext.currentTime;this.stop(now);this.disconnect();this.oscillator.disconnect();this.panner=null;this.oscillator=null}if(this.osc2){this.osc2.dispose()}};p5.Oscillator.prototype.phase=function(p){var delayAmt=p5.prototype.map(p,0,1,0,1/this.f);var now=p5sound.audiocontext.currentTime;this.phaseAmount=p;if(!this.dNode){this.dNode=p5sound.audiocontext.createDelay();this.oscillator.disconnect();this.oscillator.connect(this.dNode);this.dNode.connect(this.output)}this.dNode.delayTime.setValueAtTime(delayAmt,now)};var sigChain=function(o,mathObj,thisChain,nextChain,type){var chainSource=o.oscillator;for(var i in o.mathOps){if(o.mathOps[i]instanceof type){chainSource.disconnect();o.mathOps[i].dispose();thisChain=i;if(thisChain<o.mathOps.length-2){nextChain=o.mathOps[i+1]}}}if(thisChain==o.mathOps.length-1){o.mathOps.push(nextChain)}if(i>0){chainSource=o.mathOps[i-1]}chainSource.disconnect();chainSource.connect(mathObj);mathObj.connect(nextChain);o.mathOps[thisChain]=mathObj;return o};p5.Oscillator.prototype.add=function(num){var add=new Add(num);var thisChain=this.mathOps.length-1;var nextChain=this.output;return sigChain(this,add,thisChain,nextChain,Add)};p5.Oscillator.prototype.mult=function(num){var mult=new Mult(num);var thisChain=this.mathOps.length-1;var nextChain=this.output;return sigChain(this,mult,thisChain,nextChain,Mult)};p5.Oscillator.prototype.scale=function(inMin,inMax,outMin,outMax){var mapOutMin,mapOutMax;if(arguments.length===4){mapOutMin=p5.prototype.map(outMin,inMin,inMax,0,1)-.5;mapOutMax=p5.prototype.map(outMax,inMin,inMax,0,1)-.5}else{mapOutMin=arguments[0];mapOutMax=arguments[1]}var scale=new Scale(mapOutMin,mapOutMax);var thisChain=this.mathOps.length-1;var nextChain=this.output;return sigChain(this,scale,thisChain,nextChain,Scale)};p5.SinOsc=function(freq){p5.Oscillator.call(this,freq,"sine")};p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype);p5.TriOsc=function(freq){p5.Oscillator.call(this,freq,"triangle")};p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype);p5.SawOsc=function(freq){p5.Oscillator.call(this,freq,"sawtooth")};p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype);p5.SqrOsc=function(freq){p5.Oscillator.call(this,freq,"square")};p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale);var Tone_core_Timeline;Tone_core_Timeline=function(Tone){"use strict";Tone.Timeline=function(){var options=this.optionsObject(arguments,["memory"],Tone.Timeline.defaults);this._timeline=[];this._toRemove=[];this._iterating=false;this.memory=options.memory};Tone.extend(Tone.Timeline);Tone.Timeline.defaults={memory:Infinity};Object.defineProperty(Tone.Timeline.prototype,"length",{get:function(){return this._timeline.length}});Tone.Timeline.prototype.addEvent=function(event){if(this.isUndef(event.time)){throw new Error("events must have a time attribute")}event.time=this.toSeconds(event.time);if(this._timeline.length){var index=this._search(event.time);this._timeline.splice(index+1,0,event)}else{this._timeline.push(event)}if(this.length>this.memory){var diff=this.length-this.memory;this._timeline.splice(0,diff)}return this};Tone.Timeline.prototype.removeEvent=function(event){if(this._iterating){this._toRemove.push(event)}else{var index=this._timeline.indexOf(event);if(index!==-1){this._timeline.splice(index,1)}}return this};Tone.Timeline.prototype.getEvent=function(time){time=this.toSeconds(time);var index=this._search(time);if(index!==-1){return this._timeline[index]}else{return null}};Tone.Timeline.prototype.getEventAfter=function(time){time=this.toSeconds(time);var index=this._search(time);if(index+1<this._timeline.length){return this._timeline[index+1]}else{return null}};Tone.Timeline.prototype.getEventBefore=function(time){time=this.toSeconds(time);var index=this._search(time);if(index-1>=0){return this._timeline[index-1]}else{return null}};Tone.Timeline.prototype.cancel=function(after){if(this._timeline.length>1){after=this.toSeconds(after);var index=this._search(after);if(index>=0){this._timeline=this._timeline.slice(0,index)}else{this._timeline=[]}}else if(this._timeline.length===1){if(this._timeline[0].time>=after){this._timeline=[]}}return this};Tone.Timeline.prototype.cancelBefore=function(time){if(this._timeline.length){time=this.toSeconds(time);var index=this._search(time);if(index>=0){this._timeline=this._timeline.slice(index+1)}}return this};Tone.Timeline.prototype._search=function(time){var beginning=0;var len=this._timeline.length;var end=len;while(beginning<=end&&beginning<len){var midPoint=Math.floor(beginning+(end-beginning)/2);var event=this._timeline[midPoint];if(event.time===time){for(var i=midPoint;i<this._timeline.length;i++){var testEvent=this._timeline[i];if(testEvent.time===time){midPoint=i}}return midPoint}else if(event.time>time){end=midPoint-1}else if(event.time<time){beginning=midPoint+1}}return beginning-1};Tone.Timeline.prototype._iterate=function(callback,lowerBound,upperBound){this._iterating=true;lowerBound=this.defaultArg(lowerBound,0);upperBound=this.defaultArg(upperBound,this._timeline.length-1);for(var i=lowerBound;i<=upperBound;i++){callback(this._timeline[i])}this._iterating=false;if(this._toRemove.length>0){for(var j=0;j<this._toRemove.length;j++){var index=this._timeline.indexOf(this._toRemove[j]);if(index!==-1){this._timeline.splice(index,1)}}this._toRemove=[]}};Tone.Timeline.prototype.forEach=function(callback){this._iterate(callback);return this};Tone.Timeline.prototype.forEachBefore=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);if(upperBound!==-1){this._iterate(callback,0,upperBound)}return this};Tone.Timeline.prototype.forEachAfter=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);this._iterate(callback,lowerBound+1);return this};Tone.Timeline.prototype.forEachFrom=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);while(lowerBound>=0&&this._timeline[lowerBound].time>=time){lowerBound--}this._iterate(callback,lowerBound+1);return this};Tone.Timeline.prototype.forEachAtTime=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);if(upperBound!==-1){this._iterate(function(event){if(event.time===time){callback(event)}},0,upperBound)}return this};Tone.Timeline.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._timeline=null;this._toRemove=null};return Tone.Timeline}(Tone_core_Tone);var Tone_signal_TimelineSignal;Tone_signal_TimelineSignal=function(Tone){"use strict";Tone.TimelineSignal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);Tone.Signal.apply(this,options);options.param=this._param;Tone.Param.call(this,options);this._events=new Tone.Timeline(10);this._initial=this._fromUnits(this._param.value)};Tone.extend(Tone.TimelineSignal,Tone.Param);Tone.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"};Object.defineProperty(Tone.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._initial=convertedVal;this._param.value=convertedVal}});Tone.TimelineSignal.prototype.setValueAtTime=function(value,startTime){value=this._fromUnits(value);startTime=this.toSeconds(startTime);this._events.addEvent({type:Tone.TimelineSignal.Type.Set,value:value,time:startTime});this._param.setValueAtTime(value,startTime);return this};Tone.TimelineSignal.prototype.linearRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);endTime=this.toSeconds(endTime);this._events.addEvent({type:Tone.TimelineSignal.Type.Linear,value:value,time:endTime});this._param.linearRampToValueAtTime(value,endTime);return this};Tone.TimelineSignal.prototype.exponentialRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);value=Math.max(this._minOutput,value);endTime=this.toSeconds(endTime);this._events.addEvent({type:Tone.TimelineSignal.Type.Exponential,value:value,time:endTime});this._param.exponentialRampToValueAtTime(value,endTime);return this};Tone.TimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){value=this._fromUnits(value);value=Math.max(this._minOutput,value);timeConstant=Math.max(this._minOutput,timeConstant);startTime=this.toSeconds(startTime);this._events.addEvent({type:Tone.TimelineSignal.Type.Target,value:value,time:startTime,constant:timeConstant});this._param.setTargetAtTime(value,startTime,timeConstant);return this};Tone.TimelineSignal.prototype.cancelScheduledValues=function(after){this._events.cancel(after);this._param.cancelScheduledValues(this.toSeconds(after));return this};Tone.TimelineSignal.prototype.setRampPoint=function(time){time=this.toSeconds(time);var val=this.getValueAtTime(time);var after=this._searchAfter(time);if(after){this.cancelScheduledValues(time);if(after.type===Tone.TimelineSignal.Type.Linear){this.linearRampToValueAtTime(val,time)}else if(after.type===Tone.TimelineSignal.Type.Exponential){this.exponentialRampToValueAtTime(val,time)}}this.setValueAtTime(val,time);return this};Tone.TimelineSignal.prototype.linearRampToValueBetween=function(value,start,finish){this.setRampPoint(start);this.linearRampToValueAtTime(value,finish);return this};Tone.TimelineSignal.prototype.exponentialRampToValueBetween=function(value,start,finish){this.setRampPoint(start);this.exponentialRampToValueAtTime(value,finish);return this};Tone.TimelineSignal.prototype._searchBefore=function(time){return this._events.getEvent(time)};Tone.TimelineSignal.prototype._searchAfter=function(time){return this._events.getEventAfter(time)};Tone.TimelineSignal.prototype.getValueAtTime=function(time){var after=this._searchAfter(time);var before=this._searchBefore(time);var value=this._initial;if(before===null){value=this._initial}else if(before.type===Tone.TimelineSignal.Type.Target){var previous=this._events.getEventBefore(before.time);var previouVal;if(previous===null){previouVal=this._initial}else{previouVal=previous.value}value=this._exponentialApproach(before.time,previouVal,before.value,before.constant,time)}else if(after===null){value=before.value}else if(after.type===Tone.TimelineSignal.Type.Linear){value=this._linearInterpolate(before.time,before.value,after.time,after.value,time)}else if(after.type===Tone.TimelineSignal.Type.Exponential){value=this._exponentialInterpolate(before.time,before.value,after.time,after.value,time)}else{value=before.value}return value};Tone.TimelineSignal.prototype.connect=Tone.SignalBase.prototype.connect;Tone.TimelineSignal.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)};Tone.TimelineSignal.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(v1-v0)*((t-t0)/(t1-t0))};Tone.TimelineSignal.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){v0=Math.max(this._minOutput,v0);return v0*Math.pow(v1/v0,(t-t0)/(t1-t0))};Tone.TimelineSignal.prototype.dispose=function(){Tone.Signal.prototype.dispose.call(this);Tone.Param.prototype.dispose.call(this);this._events.dispose();this._events=null};return Tone.TimelineSignal}(Tone_core_Tone,Tone_signal_Signal);var env;env=function(){"use strict";var p5sound=master;var Add=Tone_signal_Add;var Mult=Tone_signal_Multiply;var Scale=Tone_signal_Scale;var TimelineSignal=Tone_signal_TimelineSignal;var Tone=Tone_core_Tone;Tone.setContext(p5sound.audiocontext);p5.Env=function(t1,l1,t2,l2,t3,l3){var now=p5sound.audiocontext.currentTime;this.aTime=t1||.1;this.aLevel=l1||1;this.dTime=t2||.5;this.dLevel=l2||0;this.rTime=t3||0;this.rLevel=l3||0;this._rampHighPercentage=.98;this._rampLowPercentage=.02;this.output=p5sound.audiocontext.createGain();this.control=new TimelineSignal;this._init();this.control.connect(this.output);this.connection=null;this.mathOps=[this.control];this.isExponential=false;this.sourceToClear=null;this.wasTriggered=false;p5sound.soundArray.push(this)};p5.Env.prototype._init=function(){var now=p5sound.audiocontext.currentTime;var t=now;this.control.setTargetAtTime(1e-5,t,.001);this._setRampAD(this.aTime,this.dTime)};p5.Env.prototype.set=function(t1,l1,t2,l2,t3,l3){this.aTime=t1;this.aLevel=l1;this.dTime=t2||0;this.dLevel=l2||0;this.rTime=t4||0;this.rLevel=l4||0;this._setRampAD(t1,t2)};p5.Env.prototype.setADSR=function(aTime,dTime,sPercent,rTime){this.aTime=aTime;this.dTime=dTime||0;this.sPercent=sPercent||0;this.dLevel=typeof sPercent!=="undefined"?sPercent*(this.aLevel-this.rLevel)+this.rLevel:0;this.rTime=rTime||0;this._setRampAD(aTime,dTime)};p5.Env.prototype.setRange=function(aLevel,rLevel){this.aLevel=aLevel||1;this.rLevel=rLevel||0};p5.Env.prototype._setRampAD=function(t1,t2){this._rampAttackTime=this.checkExpInput(t1);this._rampDecayTime=this.checkExpInput(t2);var TCDenominator=1;TCDenominator=Math.log(1/this.checkExpInput(1-this._rampHighPercentage));this._rampAttackTC=t1/this.checkExpInput(TCDenominator);TCDenominator=Math.log(1/this._rampLowPercentage);this._rampDecayTC=t2/this.checkExpInput(TCDenominator)};p5.Env.prototype.setRampPercentages=function(p1,p2){this._rampHighPercentage=this.checkExpInput(p1);this._rampLowPercentage=this.checkExpInput(p2);var TCDenominator=1;TCDenominator=Math.log(1/this.checkExpInput(1-this._rampHighPercentage));this._rampAttackTC=this._rampAttackTime/this.checkExpInput(TCDenominator);TCDenominator=Math.log(1/this._rampLowPercentage);this._rampDecayTC=this._rampDecayTime/this.checkExpInput(TCDenominator)};p5.Env.prototype.setInput=function(unit){for(var i=0;i<arguments.length;i++){this.connect(arguments[i])}};p5.Env.prototype.setExp=function(isExp){this.isExponential=isExp};p5.Env.prototype.checkExpInput=function(value){if(value<=0){value=1e-4}return value};p5.Env.prototype.play=function(unit,secondsFromNow,susTime){var now=p5sound.audiocontext.currentTime;var tFromNow=secondsFromNow||0;var susTime=susTime||0;if(unit){if(this.connection!==unit){this.connect(unit)}}this.triggerAttack(unit,tFromNow);this.triggerRelease(unit,tFromNow+this.aTime+this.dTime+susTime)};p5.Env.prototype.triggerAttack=function(unit,secondsFromNow){var now=p5sound.audiocontext.currentTime;var tFromNow=secondsFromNow||0;var t=now+tFromNow;this.lastAttack=t;this.wasTriggered=true;if(unit){if(this.connection!==unit){this.connect(unit)}}var valToSet=this.control.getValueAtTime(t);this.control.cancelScheduledValues(t);if(this.isExponential==true){this.control.exponentialRampToValueAtTime(this.checkExpInput(valToSet),t)}else{this.control.linearRampToValueAtTime(valToSet,t)}t+=this.aTime;if(this.isExponential==true){this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),t);valToSet=this.checkExpInput(this.control.getValueAtTime(t));this.control.cancelScheduledValues(t);this.control.exponentialRampToValueAtTime(valToSet,t)}else{this.control.linearRampToValueAtTime(this.aLevel,t);valToSet=this.control.getValueAtTime(t);this.control.cancelScheduledValues(t);this.control.linearRampToValueAtTime(valToSet,t)}t+=this.dTime;if(this.isExponential==true){this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),t);valToSet=this.checkExpInput(this.control.getValueAtTime(t));this.control.cancelScheduledValues(t);this.control.exponentialRampToValueAtTime(valToSet,t)}else{this.control.linearRampToValueAtTime(this.dLevel,t);valToSet=this.control.getValueAtTime(t);this.control.cancelScheduledValues(t);this.control.linearRampToValueAtTime(valToSet,t)}};p5.Env.prototype.triggerRelease=function(unit,secondsFromNow){if(!this.wasTriggered){return}var now=p5sound.audiocontext.currentTime;var tFromNow=secondsFromNow||0;var t=now+tFromNow;if(unit){if(this.connection!==unit){this.connect(unit)}}var valToSet=this.control.getValueAtTime(t);this.control.cancelScheduledValues(t);if(this.isExponential==true){this.control.exponentialRampToValueAtTime(this.checkExpInput(valToSet),t)}else{this.control.linearRampToValueAtTime(valToSet,t)}t+=this.rTime;if(this.isExponential==true){this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),t);valToSet=this.checkExpInput(this.control.getValueAtTime(t));this.control.cancelScheduledValues(t);this.control.exponentialRampToValueAtTime(valToSet,t)}else{this.control.linearRampToValueAtTime(this.rLevel,t);valToSet=this.control.getValueAtTime(t);this.control.cancelScheduledValues(t);this.control.linearRampToValueAtTime(valToSet,t)}this.wasTriggered=false};p5.Env.prototype.ramp=function(unit,secondsFromNow,v1,v2){var now=p5sound.audiocontext.currentTime;var tFromNow=secondsFromNow||0;var t=now+tFromNow;var destination1=this.checkExpInput(v1);var destination2=typeof v2!=="undefined"?this.checkExpInput(v2):undefined;if(unit){if(this.connection!==unit){this.connect(unit)}}var currentVal=this.checkExpInput(this.control.getValueAtTime(t));this.control.cancelScheduledValues(t);if(destination1>currentVal){this.control.setTargetAtTime(destination1,t,this._rampAttackTC);t+=this._rampAttackTime}else if(destination1<currentVal){this.control.setTargetAtTime(destination1,t,this._rampDecayTC);t+=this._rampDecayTime}if(destination2===undefined)return;if(destination2>destination1){this.control.setTargetAtTime(destination2,t,this._rampAttackTC)}else if(destination2<destination1){this.control.setTargetAtTime(destination2,t,this._rampDecayTC)}};p5.Env.prototype.connect=function(unit){this.connection=unit;if(unit instanceof p5.Oscillator||unit instanceof p5.SoundFile||unit instanceof p5.AudioIn||unit instanceof p5.Reverb||unit instanceof p5.Noise||unit instanceof p5.Filter||unit instanceof p5.Delay){unit=unit.output.gain}if(unit instanceof AudioParam){unit.setValueAtTime(0,p5sound.audiocontext.currentTime)}if(unit instanceof p5.Signal){unit.setValue(0)}this.output.connect(unit)};p5.Env.prototype.disconnect=function(unit){this.output.disconnect()};p5.Env.prototype.add=function(num){var add=new Add(num);var thisChain=this.mathOps.length;var nextChain=this.output;return p5.prototype._mathChain(this,add,thisChain,nextChain,Add)};p5.Env.prototype.mult=function(num){var mult=new Mult(num);var thisChain=this.mathOps.length;var nextChain=this.output;return p5.prototype._mathChain(this,mult,thisChain,nextChain,Mult)};p5.Env.prototype.scale=function(inMin,inMax,outMin,outMax){var scale=new Scale(inMin,inMax,outMin,outMax);var thisChain=this.mathOps.length;var nextChain=this.output;return p5.prototype._mathChain(this,scale,thisChain,nextChain,Scale)};p5.Env.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);var now=p5sound.audiocontext.currentTime;this.disconnect();try{this.control.dispose();this.control=null}catch(e){}for(var i=1;i<this.mathOps.length;i++){mathOps[i].dispose()}}}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_signal_TimelineSignal,Tone_core_Tone);var pulse;pulse=function(){"use strict";var p5sound=master;p5.Pulse=function(freq,w){p5.Oscillator.call(this,freq,"sawtooth");this.w=w||0;this.osc2=new p5.SawOsc(freq);this.dNode=p5sound.audiocontext.createDelay();this.dcOffset=createDCOffset();this.dcGain=p5sound.audiocontext.createGain();this.dcOffset.connect(this.dcGain);this.dcGain.connect(this.output);this.f=freq||440;var mW=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=mW;this.dcGain.gain.value=1.7*(.5-this.w);this.osc2.disconnect();this.osc2.panner.disconnect();this.osc2.amp(-1);this.osc2.output.connect(this.dNode);this.dNode.connect(this.output);this.output.gain.value=1;this.output.connect(this.panner)};p5.Pulse.prototype=Object.create(p5.Oscillator.prototype);p5.Pulse.prototype.width=function(w){if(typeof w==="number"){if(w<=1&&w>=0){this.w=w;var mW=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=mW}this.dcGain.gain.value=1.7*(.5-this.w)}else{w.connect(this.dNode.delayTime);var sig=new p5.SignalAdd(-.5);sig.setInput(w);sig=sig.mult(-1);sig=sig.mult(1.7);sig.connect(this.dcGain.gain)}};p5.Pulse.prototype.start=function(f,time){var now=p5sound.audiocontext.currentTime;var t=time||0;if(!this.started){var freq=f||this.f;var type=this.oscillator.type;this.oscillator=p5sound.audiocontext.createOscillator();this.oscillator.frequency.setValueAtTime(freq,now);this.oscillator.type=type;this.oscillator.connect(this.output);this.oscillator.start(t+now);this.osc2.oscillator=p5sound.audiocontext.createOscillator();this.osc2.oscillator.frequency.setValueAtTime(freq,t+now);this.osc2.oscillator.type=type;this.osc2.oscillator.connect(this.osc2.output);this.osc2.start(t+now);this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency];this.dcOffset=createDCOffset();this.dcOffset.connect(this.dcGain);this.dcOffset.start(t+now);if(this.mods!==undefined&&this.mods.frequency!==undefined){this.mods.frequency.connect(this.freqNode[0]);this.mods.frequency.connect(this.freqNode[1])}this.started=true;this.osc2.started=true}};p5.Pulse.prototype.stop=function(time){if(this.started){var t=time||0;var now=p5sound.audiocontext.currentTime;this.oscillator.stop(t+now);this.osc2.oscillator.stop(t+now);this.dcOffset.stop(t+now);this.started=false;this.osc2.started=false}};p5.Pulse.prototype.freq=function(val,rampTime,tFromNow){if(typeof val==="number"){this.f=val;var now=p5sound.audiocontext.currentTime;var rampTime=rampTime||0;var tFromNow=tFromNow||0;var currentFreq=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(now);this.oscillator.frequency.setValueAtTime(currentFreq,now+tFromNow);this.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now);
this.osc2.oscillator.frequency.cancelScheduledValues(now);this.osc2.oscillator.frequency.setValueAtTime(currentFreq,now+tFromNow);this.osc2.oscillator.frequency.exponentialRampToValueAtTime(val,tFromNow+rampTime+now);if(this.freqMod){this.freqMod.output.disconnect();this.freqMod=null}}else if(val.output){val.output.disconnect();val.output.connect(this.oscillator.frequency);val.output.connect(this.osc2.oscillator.frequency);this.freqMod=val}};function createDCOffset(){var ac=p5sound.audiocontext;var buffer=ac.createBuffer(1,2048,ac.sampleRate);var data=buffer.getChannelData(0);for(var i=0;i<2048;i++)data[i]=1;var bufferSource=ac.createBufferSource();bufferSource.buffer=buffer;bufferSource.loop=true;return bufferSource}}(master,oscillator);var noise;noise=function(){"use strict";var p5sound=master;p5.Noise=function(type){p5.Oscillator.call(this);delete this.f;delete this.freq;delete this.oscillator;this.buffer=_whiteNoise};p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var _whiteNoise=function(){var bufferSize=2*p5sound.audiocontext.sampleRate;var whiteBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate);var noiseData=whiteBuffer.getChannelData(0);for(var i=0;i<bufferSize;i++){noiseData[i]=Math.random()*2-1}whiteBuffer.type="white";return whiteBuffer}();var _pinkNoise=function(){var bufferSize=2*p5sound.audiocontext.sampleRate;var pinkBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate);var noiseData=pinkBuffer.getChannelData(0);var b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<bufferSize;i++){var white=Math.random()*2-1;b0=.99886*b0+white*.0555179;b1=.99332*b1+white*.0750759;b2=.969*b2+white*.153852;b3=.8665*b3+white*.3104856;b4=.55*b4+white*.5329522;b5=-.7616*b5-white*.016898;noiseData[i]=b0+b1+b2+b3+b4+b5+b6+white*.5362;noiseData[i]*=.11;b6=white*.115926}pinkBuffer.type="pink";return pinkBuffer}();var _brownNoise=function(){var bufferSize=2*p5sound.audiocontext.sampleRate;var brownBuffer=p5sound.audiocontext.createBuffer(1,bufferSize,p5sound.audiocontext.sampleRate);var noiseData=brownBuffer.getChannelData(0);var lastOut=0;for(var i=0;i<bufferSize;i++){var white=Math.random()*2-1;noiseData[i]=(lastOut+.02*white)/1.02;lastOut=noiseData[i];noiseData[i]*=3.5}brownBuffer.type="brown";return brownBuffer}();p5.Noise.prototype.setType=function(type){switch(type){case"white":this.buffer=_whiteNoise;break;case"pink":this.buffer=_pinkNoise;break;case"brown":this.buffer=_brownNoise;break;default:this.buffer=_whiteNoise}if(this.started){var now=p5sound.audiocontext.currentTime;this.stop(now);this.start(now+.01)}};p5.Noise.prototype.getType=function(){return this.buffer.type};p5.Noise.prototype.start=function(){if(this.started){this.stop()}this.noise=p5sound.audiocontext.createBufferSource();this.noise.buffer=this.buffer;this.noise.loop=true;this.noise.connect(this.output);var now=p5sound.audiocontext.currentTime;this.noise.start(now);this.started=true};p5.Noise.prototype.stop=function(){var now=p5sound.audiocontext.currentTime;if(this.noise){this.noise.stop(now);this.started=false}};p5.Noise.prototype.dispose=function(){var now=p5sound.audiocontext.currentTime;var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);if(this.noise){this.noise.disconnect();this.stop(now)}if(this.output){this.output.disconnect()}if(this.panner){this.panner.disconnect()}this.output=null;this.panner=null;this.buffer=null;this.noise=null}}(master);var audioin;audioin=function(){"use strict";var p5sound=master;var CustomError=errorHandler;p5.AudioIn=function(){this.input=p5sound.audiocontext.createGain();this.output=p5sound.audiocontext.createGain();this.stream=null;this.mediaStream=null;this.currentSource=0;this.enabled=false;this.amplitude=new p5.Amplitude;this.output.connect(this.amplitude.input);if(typeof window.MediaStreamTrack==="undefined"){window.alert("This browser does not support MediaStreamTrack")}else if(typeof window.MediaStreamTrack.getSources==="function"){window.MediaStreamTrack.getSources(this._gotSources)}else{}p5sound.soundArray.push(this)};p5.AudioIn.prototype.start=function(successCallback,errorCallback){var self=this;if(p5sound.inputSources[self.currentSource]){var audioSource=p5sound.inputSources[self.currentSource].id;var constraints={audio:{optional:[{sourceId:audioSource}]}};window.navigator.getUserMedia(constraints,this._onStream=function(stream){self.stream=stream;self.enabled=true;self.mediaStream=p5sound.audiocontext.createMediaStreamSource(stream);self.mediaStream.connect(self.output);if(successCallback)successCallback();self.amplitude.setInput(self.output)},this._onStreamError=function(e){if(errorCallback)errorCallback(e);else console.error(e)})}else{window.navigator.getUserMedia({audio:true},this._onStream=function(stream){self.stream=stream;self.enabled=true;self.mediaStream=p5sound.audiocontext.createMediaStreamSource(stream);self.mediaStream.connect(self.output);self.amplitude.setInput(self.output);if(successCallback)successCallback()},this._onStreamError=function(e){if(errorCallback)errorCallback(e);else console.error(e)})}};p5.AudioIn.prototype.stop=function(){if(this.stream){this.stream.stop()}};p5.AudioIn.prototype.connect=function(unit){if(unit){if(unit.hasOwnProperty("input")){this.output.connect(unit.input)}else if(unit.hasOwnProperty("analyser")){this.output.connect(unit.analyser)}else{this.output.connect(unit)}}else{this.output.connect(p5sound.input)}};p5.AudioIn.prototype.disconnect=function(unit){this.output.disconnect(unit);this.output.connect(this.amplitude.input)};p5.AudioIn.prototype.getLevel=function(smoothing){if(smoothing){this.amplitude.smoothing=smoothing}return this.amplitude.getLevel()};p5.AudioIn.prototype._gotSources=function(sourceInfos){for(var i=0;i<sourceInfos.length;i++){var sourceInfo=sourceInfos[i];if(sourceInfo.kind==="audio"){return sourceInfo}}};p5.AudioIn.prototype.amp=function(vol,t){if(t){var rampTime=t||0;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(p5sound.audiocontext.currentTime);this.output.gain.setValueAtTime(currentVol,p5sound.audiocontext.currentTime);this.output.gain.linearRampToValueAtTime(vol,rampTime+p5sound.audiocontext.currentTime)}else{this.output.gain.cancelScheduledValues(p5sound.audiocontext.currentTime);this.output.gain.setValueAtTime(vol,p5sound.audiocontext.currentTime)}};p5.AudioIn.prototype.listSources=function(){console.log("listSources is deprecated - please use AudioIn.getSources");console.log("input sources: ");if(p5sound.inputSources.length>0){return p5sound.inputSources}else{return"This browser does not support MediaStreamTrack.getSources()"}};p5.AudioIn.prototype.getSources=function(callback){if(typeof window.MediaStreamTrack.getSources==="function"){window.MediaStreamTrack.getSources(function(data){for(var i=0,max=data.length;i<max;i++){var sourceInfo=data[i];if(sourceInfo.kind==="audio"){p5sound.inputSources.push(sourceInfo)}}callback(p5sound.inputSources)})}else{console.log("This browser does not support MediaStreamTrack.getSources()")}};p5.AudioIn.prototype.setSource=function(num){var self=this;if(p5sound.inputSources.length>0&&num<p5sound.inputSources.length){self.currentSource=num;console.log("set source to "+p5sound.inputSources[self.currentSource].id)}else{console.log("unable to set input source")}};p5.AudioIn.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.stop();if(this.output){this.output.disconnect()}if(this.amplitude){this.amplitude.disconnect()}this.amplitude=null;this.output=null}}(master,errorHandler);var filter;filter=function(){"use strict";var p5sound=master;p5.Filter=function(type){this.ac=p5sound.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this.biquad=this.ac.createBiquadFilter();this.input.connect(this.biquad);this.biquad.connect(this.output);this.connect();if(type){this.setType(type)}p5sound.soundArray.push(this)};p5.Filter.prototype.process=function(src,freq,res){src.connect(this.input);this.set(freq,res)};p5.Filter.prototype.set=function(freq,res,time){if(freq){this.freq(freq,time)}if(res){this.res(res,time)}};p5.Filter.prototype.freq=function(freq,time){var self=this;var t=time||0;if(freq<=0){freq=1}if(typeof freq==="number"){self.biquad.frequency.value=freq;self.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+t);self.biquad.frequency.exponentialRampToValueAtTime(freq,this.ac.currentTime+.02+t)}else if(freq){freq.connect(this.biquad.frequency)}return self.biquad.frequency.value};p5.Filter.prototype.res=function(res,time){var self=this;var t=time||0;if(typeof res=="number"){self.biquad.Q.value=res;self.biquad.Q.cancelScheduledValues(self.ac.currentTime+.01+t);self.biquad.Q.linearRampToValueAtTime(res,self.ac.currentTime+.02+t)}else if(res){freq.connect(this.biquad.Q)}return self.biquad.Q.value};p5.Filter.prototype.setType=function(t){this.biquad.type=t};p5.Filter.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow+.001);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime+.001)};p5.Filter.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u)};p5.Filter.prototype.disconnect=function(){this.output.disconnect()};p5.Filter.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.input.disconnect();this.input=undefined;this.output.disconnect();this.output=undefined;this.biquad.disconnect();this.biquad=undefined};p5.LowPass=function(){p5.Filter.call(this,"lowpass")};p5.LowPass.prototype=Object.create(p5.Filter.prototype);p5.HighPass=function(){p5.Filter.call(this,"highpass")};p5.HighPass.prototype=Object.create(p5.Filter.prototype);p5.BandPass=function(){p5.Filter.call(this,"bandpass")};p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(master);var delay;delay=function(){"use strict";var p5sound=master;var Filter=filter;p5.Delay=function(){this.ac=p5sound.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this._split=this.ac.createChannelSplitter(2);this._merge=this.ac.createChannelMerger(2);this._leftGain=this.ac.createGain();this._rightGain=this.ac.createGain();this.leftDelay=this.ac.createDelay();this.rightDelay=this.ac.createDelay();this._leftFilter=new p5.Filter;this._rightFilter=new p5.Filter;this._leftFilter.disconnect();this._rightFilter.disconnect();this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime);this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime);this.input.connect(this._split);this.leftDelay.connect(this._leftGain);this.rightDelay.connect(this._rightGain);this._leftGain.connect(this._leftFilter.input);this._rightGain.connect(this._rightFilter.input);this._merge.connect(this.output);this.output.connect(p5.soundOut.input);this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this.setType(0);this._maxDelay=this.leftDelay.delayTime.maxValue;p5sound.soundArray.push(this)};p5.Delay.prototype.process=function(src,_delayTime,_feedback,_filter){var feedback=_feedback||0;var delayTime=_delayTime||0;if(feedback>=1){throw new Error("Feedback value will force a positive feedback loop.")}if(delayTime>=this._maxDelay){throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.")}src.connect(this.input);this.leftDelay.delayTime.setValueAtTime(delayTime,this.ac.currentTime);this.rightDelay.delayTime.setValueAtTime(delayTime,this.ac.currentTime);this._leftGain.gain.setValueAtTime(feedback,this.ac.currentTime);this._rightGain.gain.setValueAtTime(feedback,this.ac.currentTime);if(_filter){this._leftFilter.freq(_filter);this._rightFilter.freq(_filter)}};p5.Delay.prototype.delayTime=function(t){if(typeof t!=="number"){t.connect(this.leftDelay.delayTime);t.connect(this.rightDelay.delayTime)}else{this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime);this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime);this.leftDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime);this.rightDelay.delayTime.linearRampToValueAtTime(t,this.ac.currentTime)}};p5.Delay.prototype.feedback=function(f){if(typeof f!=="number"){f.connect(this._leftGain.gain);f.connect(this._rightGain.gain)}else if(f>=1){throw new Error("Feedback value will force a positive feedback loop.")}else{this._leftGain.gain.exponentialRampToValueAtTime(f,this.ac.currentTime);this._rightGain.gain.exponentialRampToValueAtTime(f,this.ac.currentTime)}};p5.Delay.prototype.filter=function(freq,q){this._leftFilter.set(freq,q);this._rightFilter.set(freq,q)};p5.Delay.prototype.setType=function(t){if(t===1){t="pingPong"}this._split.disconnect();this._leftFilter.disconnect();this._rightFilter.disconnect();this._split.connect(this.leftDelay,0);this._split.connect(this.rightDelay,1);switch(t){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type);this._leftFilter.output.connect(this._merge,0,0);this._rightFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.rightDelay);this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0);this._leftFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.leftDelay);this._leftFilter.output.connect(this.rightDelay)}};p5.Delay.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow+.001);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime+.001)};p5.Delay.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u)};p5.Delay.prototype.disconnect=function(){this.output.disconnect()};p5.Delay.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.input.disconnect();this.output.disconnect();this._split.disconnect();this._leftFilter.disconnect();this._rightFilter.disconnect();this._merge.disconnect();this._leftGain.disconnect();this._rightGain.disconnect();this.leftDelay.disconnect();this.rightDelay.disconnect();this.input=undefined;this.output=undefined;this._split=undefined;this._leftFilter=undefined;this._rightFilter=undefined;this._merge=undefined;this._leftGain=undefined;this._rightGain=undefined;this.leftDelay=undefined;this.rightDelay=undefined}}(master,filter);var reverb;reverb=function(){"use strict";var p5sound=master;var CustomError=errorHandler;p5.Reverb=function(){this.ac=p5sound.audiocontext;this.convolverNode=this.ac.createConvolver();this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.output);this._seconds=3;this._decay=2;this._reverse=false;this._buildImpulse();this.connect();p5sound.soundArray.push(this)};p5.Reverb.prototype.process=function(src,seconds,decayRate,reverse){src.connect(this.input);var rebuild=false;if(seconds){this._seconds=seconds;rebuild=true}if(decayRate){this._decay=decayRate}if(reverse){this._reverse=reverse}if(rebuild){this._buildImpulse()}};p5.Reverb.prototype.set=function(seconds,decayRate,reverse){var rebuild=false;if(seconds){this._seconds=seconds;rebuild=true}if(decayRate){this._decay=decayRate}if(reverse){this._reverse=reverse}if(rebuild){this._buildImpulse()}};p5.Reverb.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow+.001);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime+.001)};p5.Reverb.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u.input?u.input:u)};p5.Reverb.prototype.disconnect=function(){this.output.disconnect()};p5.Reverb.prototype._buildImpulse=function(){var rate=this.ac.sampleRate;var length=rate*this._seconds;var decay=this._decay;var impulse=this.ac.createBuffer(2,length,rate);var impulseL=impulse.getChannelData(0);var impulseR=impulse.getChannelData(1);var n,i;for(i=0;i<length;i++){n=this.reverse?length-i:i;impulseL[i]=(Math.random()*2-1)*Math.pow(1-n/length,decay);impulseR[i]=(Math.random()*2-1)*Math.pow(1-n/length,decay)}this.convolverNode.buffer=impulse};p5.Reverb.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);if(this.convolverNode){this.convolverNode.buffer=null;this.convolverNode=null}if(typeof this.output!=="undefined"){this.output.disconnect();this.output=null}if(typeof this.panner!=="undefined"){this.panner.disconnect();this.panner=null}};p5.Convolver=function(path,callback,errorCallback){this.ac=p5sound.audiocontext;this.convolverNode=this.ac.createConvolver();this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.output);if(path){this.impulses=[];this._loadBuffer(path,callback,errorCallback)}else{this._seconds=3;this._decay=2;this._reverse=false;this._buildImpulse()}this.connect();p5sound.soundArray.push(this)};p5.Convolver.prototype=Object.create(p5.Reverb.prototype);p5.prototype.registerPreloadMethod("createConvolver",p5.prototype);p5.prototype.createConvolver=function(path,callback,errorCallback){if(window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}var cReverb=new p5.Convolver(path,callback,errorCallback);cReverb.impulses=[];return cReverb};p5.Convolver.prototype._loadBuffer=function(path,callback,errorCallback){var path=p5.prototype._checkFileFormats(path);var self=this;var errorTrace=(new Error).stack;var ac=p5.prototype.getAudioContext();var request=new XMLHttpRequest;request.open("GET",path,true);request.responseType="arraybuffer";request.onload=function(){if(request.status==200){ac.decodeAudioData(request.response,function(buff){var buffer={};var chunks=path.split("/");buffer.name=chunks[chunks.length-1];buffer.audioBuffer=buff;self.impulses.push(buffer);self.convolverNode.buffer=buffer.audioBuffer;if(callback){callback(buffer)}},function(e){var err=new CustomError("decodeAudioData",errorTrace,self.url);var msg="AudioContext error at decodeAudioData for "+self.url;if(errorCallback){err.msg=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}})}else{var err=new CustomError("loadConvolver",errorTrace,self.url);var msg="Unable to load "+self.url+". The request status was: "+request.status+" ("+request.statusText+")";if(errorCallback){err.message=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}}};request.onerror=function(e){var err=new CustomError("loadConvolver",errorTrace,self.url);var msg="There was no response from the server at "+self.url+". Check the url and internet connectivity.";if(errorCallback){err.message=msg;errorCallback(err)}else{console.error(msg+"\n The error stack trace includes: \n"+err.stack)}};request.send()};p5.Convolver.prototype.set=null;p5.Convolver.prototype.process=function(src){src.connect(this.input)};p5.Convolver.prototype.impulses=[];p5.Convolver.prototype.addImpulse=function(path,callback,errorCallback){if(window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}this._loadBuffer(path,callback,errorCallback)};p5.Convolver.prototype.resetImpulse=function(path,callback,errorCallback){if(window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"){alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS")}this.impulses=[];this._loadBuffer(path,callback,errorCallback)};p5.Convolver.prototype.toggleImpulse=function(id){if(typeof id==="number"&&id<this.impulses.length){this.convolverNode.buffer=this.impulses[id].audioBuffer}if(typeof id==="string"){for(var i=0;i<this.impulses.length;i++){if(this.impulses[i].name===id){this.convolverNode.buffer=this.impulses[i].audioBuffer;break}}}};p5.Convolver.prototype.dispose=function(){for(var i in this.impulses){this.impulses[i]=null}this.convolverNode.disconnect();this.concolverNode=null;if(typeof this.output!=="undefined"){this.output.disconnect();this.output=null}if(typeof this.panner!=="undefined"){this.panner.disconnect();this.panner=null}}}(master,errorHandler,sndcore);var Tone_core_TimelineState;Tone_core_TimelineState=function(Tone){"use strict";Tone.TimelineState=function(initial){Tone.Timeline.call(this);this._initial=initial};Tone.extend(Tone.TimelineState,Tone.Timeline);Tone.TimelineState.prototype.getStateAtTime=function(time){var event=this.getEvent(time);if(event!==null){return event.state}else{return this._initial}};Tone.TimelineState.prototype.setStateAtTime=function(state,time){this.addEvent({state:state,time:this.toSeconds(time)})};return Tone.TimelineState}(Tone_core_Tone,Tone_core_Timeline);var Tone_core_Clock;Tone_core_Clock=function(Tone){"use strict";Tone.Clock=function(){var options=this.optionsObject(arguments,["callback","frequency"],Tone.Clock.defaults);this.callback=options.callback;this._lookAhead="auto";this._computedLookAhead=1/60;this._threshold=.5;this._nextTick=-1;this._lastUpdate=0;this._loopID=-1;this.frequency=new Tone.TimelineSignal(options.frequency,Tone.Type.Frequency);this.ticks=0;this._state=new Tone.TimelineState(Tone.State.Stopped);this._boundLoop=this._loop.bind(this);this._readOnly("frequency");this._loop()};Tone.extend(Tone.Clock);Tone.Clock.defaults={callback:Tone.noOp,frequency:1,lookAhead:"auto"};Object.defineProperty(Tone.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}});Object.defineProperty(Tone.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(val){if(val==="auto"){this._lookAhead="auto"}else{this._lookAhead=this.toSeconds(val)}}});Tone.Clock.prototype.start=function(time,offset){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Started){this._state.addEvent({state:Tone.State.Started,time:time,offset:offset})}return this};Tone.Clock.prototype.stop=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Stopped){this._state.setStateAtTime(Tone.State.Stopped,time)}return this};Tone.Clock.prototype.pause=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Paused,time)}return this};Tone.Clock.prototype._loop=function(time){this._loopID=requestAnimationFrame(this._boundLoop);if(this._lookAhead==="auto"){if(!this.isUndef(time)){var diff=(time-this._lastUpdate)/1e3;this._lastUpdate=time;if(diff<this._threshold){this._computedLookAhead=(9*this._computedLookAhead+diff)/10}}}else{this._computedLookAhead=this._lookAhead}var now=this.now();var lookAhead=this._computedLookAhead*2;var event=this._state.getEvent(now+lookAhead);var state=Tone.State.Stopped;if(event){state=event.state;if(this._nextTick===-1&&state===Tone.State.Started){this._nextTick=event.time;if(!this.isUndef(event.offset)){this.ticks=event.offset}}}if(state===Tone.State.Started){while(now+lookAhead>this._nextTick){if(now>this._nextTick+this._threshold){this._nextTick=now}var tickTime=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick);this.callback(tickTime);this.ticks++}}else if(state===Tone.State.Stopped){this._nextTick=-1;this.ticks=0}};Tone.Clock.prototype.getStateAtTime=function(time){return this._state.getStateAtTime(time)};Tone.Clock.prototype.dispose=function(){cancelAnimationFrame(this._loopID);Tone.TimelineState.prototype.dispose.call(this);this._writable("frequency");this.frequency.dispose();this.frequency=null;this._boundLoop=Tone.noOp;this._nextTick=Infinity;this.callback=null;this._state.dispose();this._state=null};return Tone.Clock}(Tone_core_Tone,Tone_signal_TimelineSignal);var metro;metro=function(){"use strict";var p5sound=master;var Clock=Tone_core_Clock;var ac=p5sound.audiocontext;p5.Metro=function(){this.clock=new Clock({callback:this.ontick.bind(this)});this.syncedParts=[];this.bpm=120;this._init();this.tickCallback=function(){}};var prevTick=0;var tatumTime=0;p5.Metro.prototype.ontick=function(tickTime){var elapsedTime=tickTime-prevTick;var secondsFromNow=tickTime-p5sound.audiocontext.currentTime;if(elapsedTime-tatumTime<=-.02){return}else{prevTick=tickTime;for(var i in this.syncedParts){var thisPart=this.syncedParts[i];thisPart.incrementStep(secondsFromNow);for(var j in thisPart.phrases){var thisPhrase=thisPart.phrases[j];var phraseArray=thisPhrase.sequence;var bNum=this.metroTicks%phraseArray.length;if(phraseArray[bNum]!==0&&(this.metroTicks<phraseArray.length||!thisPhrase.looping)){thisPhrase.callback(secondsFromNow,phraseArray[bNum])}}}this.metroTicks+=1;this.tickCallback(secondsFromNow)}};p5.Metro.prototype.setBPM=function(bpm,rampTime){var beatTime=60/(bpm*this.tatums);var now=p5sound.audiocontext.currentTime;tatumTime=beatTime;var rampTime=rampTime||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,now);this.clock.frequency.linearRampToValueAtTime(bpm,now+rampTime);this.bpm=bpm};p5.Metro.prototype.getBPM=function(tempo){return this.clock.getRate()/this.tatums*60};p5.Metro.prototype._init=function(){this.metroTicks=0};p5.Metro.prototype.resetSync=function(part){this.syncedParts=[part]};p5.Metro.prototype.pushSync=function(part){this.syncedParts.push(part)};p5.Metro.prototype.start=function(timeFromNow){var t=timeFromNow||0;var now=p5sound.audiocontext.currentTime;this.clock.start(now+t);this.setBPM(this.bpm)};p5.Metro.prototype.stop=function(timeFromNow){var t=timeFromNow||0;var now=p5sound.audiocontext.currentTime;if(this.clock._oscillator){this.clock.stop(now+t)}};p5.Metro.prototype.beatLength=function(tatums){this.tatums=1/tatums/4}}(master,Tone_core_Clock);var looper;looper=function(){"use strict";var p5sound=master;var bpm=120;p5.prototype.setBPM=function(BPM,rampTime){bpm=BPM;for(var i in p5sound.parts){p5sound.parts[i].setBPM(bpm,rampTime)}};p5.Phrase=function(name,callback,sequence){this.phraseStep=0;this.name=name;this.callback=callback;this.sequence=sequence};p5.Part=function(steps,bLength){this.length=steps||0;this.partStep=0;this.phrases=[];this.looping=false;this.isPlaying=false;this.onended=function(){this.stop()};this.tatums=bLength||.0625;this.metro=new p5.Metro;this.metro._init();this.metro.beatLength(this.tatums);this.metro.setBPM(bpm);p5sound.parts.push(this);this.callback=function(){}};p5.Part.prototype.setBPM=function(tempo,rampTime){this.metro.setBPM(tempo,rampTime)};p5.Part.prototype.getBPM=function(){return this.metro.getBPM()};p5.Part.prototype.start=function(time){if(!this.isPlaying){this.isPlaying=true;this.metro.resetSync(this);var t=time||0;this.metro.start(t)}};p5.Part.prototype.loop=function(time){this.looping=true;this.onended=function(){this.partStep=0};var t=time||0;this.start(t)};p5.Part.prototype.noLoop=function(){this.looping=false;this.onended=function(){this.stop()}};p5.Part.prototype.stop=function(time){this.partStep=0;this.pause(time)};p5.Part.prototype.pause=function(time){this.isPlaying=false;var t=time||0;this.metro.stop(t)};p5.Part.prototype.addPhrase=function(name,callback,array){var p;if(arguments.length===3){p=new p5.Phrase(name,callback,array)}else if(arguments[0]instanceof p5.Phrase){p=arguments[0]}else{throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase"}this.phrases.push(p);if(p.sequence.length>this.length){this.length=p.sequence.length}};p5.Part.prototype.removePhrase=function(name){for(var i in this.phrases){if(this.phrases[i].name===name){this.phrases.split(i,1)}}};p5.Part.prototype.getPhrase=function(name){for(var i in this.phrases){if(this.phrases[i].name===name){return this.phrases[i]}}};p5.Part.prototype.replaceSequence=function(name,array){for(var i in this.phrases){if(this.phrases[i].name===name){this.phrases[i].sequence=array}}};p5.Part.prototype.incrementStep=function(time){if(this.partStep<this.length-1){this.callback(time);this.partStep+=1}else{if(this.looping){this.callback(time)}this.onended();this.partStep=0}};p5.Part.prototype.onStep=function(callback){this.callback=callback};p5.Score=function(){this.parts=[];this.currentPart=0;var thisScore=this;for(var i in arguments){this.parts[i]=arguments[i];this.parts[i].nextPart=this.parts[i+1];this.parts[i].onended=function(){thisScore.resetPart(i);playNextPart(thisScore)}}this.looping=false};p5.Score.prototype.onended=function(){if(this.looping){this.parts[0].start()}else{this.parts[this.parts.length-1].onended=function(){this.stop();this.resetParts()}}this.currentPart=0};p5.Score.prototype.start=function(){this.parts[this.currentPart].start();this.scoreStep=0};p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop();this.currentPart=0;this.scoreStep=0};p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()};p5.Score.prototype.loop=function(){this.looping=true;this.start()};p5.Score.prototype.noLoop=function(){this.looping=false};p5.Score.prototype.resetParts=function(){for(var i in this.parts){this.resetPart(i)}};p5.Score.prototype.resetPart=function(i){this.parts[i].stop();this.parts[i].partStep=0;for(var p in this.parts[i].phrases){this.parts[i].phrases[p].phraseStep=0}};p5.Score.prototype.setBPM=function(bpm,rampTime){for(var i in this.parts){this.parts[i].setBPM(bpm,rampTime)}};function playNextPart(aScore){aScore.currentPart++;if(aScore.currentPart>=aScore.parts.length){aScore.scoreStep=0;aScore.onended()}else{aScore.scoreStep=0;aScore.parts[aScore.currentPart-1].stop();aScore.parts[aScore.currentPart].start()}}}(master);var soundRecorder;soundRecorder=function(){"use strict";var p5sound=master;var ac=p5sound.audiocontext;p5.SoundRecorder=function(){this.input=ac.createGain();this.output=ac.createGain();this.recording=false;this.bufferSize=1024;this._channels=2;this._clear();this._jsNode=ac.createScriptProcessor(this.bufferSize,this._channels,2);this._jsNode.onaudioprocess=this._audioprocess.bind(this);this._callback=function(){};this._jsNode.connect(p5.soundOut._silentNode);this.setInput();p5sound.soundArray.push(this)};p5.SoundRecorder.prototype.setInput=function(unit){this.input.disconnect();this.input=null;this.input=ac.createGain();this.input.connect(this._jsNode);this.input.connect(this.output);if(unit){unit.connect(this.input)}else{p5.soundOut.output.connect(this.input)}};p5.SoundRecorder.prototype.record=function(sFile,duration,callback){this.recording=true;if(duration){this.sampleLimit=Math.round(duration*ac.sampleRate)}if(sFile&&callback){this._callback=function(){this.buffer=this._getBuffer();sFile.setBuffer(this.buffer);callback()}}else if(sFile){this._callback=function(){this.buffer=this._getBuffer();sFile.setBuffer(this.buffer)}}};p5.SoundRecorder.prototype.stop=function(){this.recording=false;this._callback();this._clear()};p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[];this._rightBuffers=[];this.recordedSamples=0;this.sampleLimit=null};p5.SoundRecorder.prototype._audioprocess=function(event){if(this.recording===false){return}else if(this.recording===true){if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit){this.stop();
}else{var left=event.inputBuffer.getChannelData(0);var right=event.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(left));this._rightBuffers.push(new Float32Array(right));this.recordedSamples+=this.bufferSize}}};p5.SoundRecorder.prototype._getBuffer=function(){var buffers=[];buffers.push(this._mergeBuffers(this._leftBuffers));buffers.push(this._mergeBuffers(this._rightBuffers));return buffers};p5.SoundRecorder.prototype._mergeBuffers=function(channelBuffer){var result=new Float32Array(this.recordedSamples);var offset=0;var lng=channelBuffer.length;for(var i=0;i<lng;i++){var buffer=channelBuffer[i];result.set(buffer,offset);offset+=buffer.length}return result};p5.SoundRecorder.prototype.dispose=function(){this._clear();var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this._callback=function(){};if(this.input){this.input.disconnect()}this.input=null;this._jsNode=null};p5.prototype.saveSound=function(soundFile,name){var leftChannel=soundFile.buffer.getChannelData(0);var rightChannel=soundFile.buffer.getChannelData(1);var interleaved=interleave(leftChannel,rightChannel);var buffer=new ArrayBuffer(44+interleaved.length*2);var view=new DataView(buffer);writeUTFBytes(view,0,"RIFF");view.setUint32(4,44+interleaved.length*2,true);writeUTFBytes(view,8,"WAVE");writeUTFBytes(view,12,"fmt ");view.setUint32(16,16,true);view.setUint16(20,1,true);view.setUint16(22,2,true);view.setUint32(24,44100,true);view.setUint32(28,44100*4,true);view.setUint16(32,4,true);view.setUint16(34,16,true);writeUTFBytes(view,36,"data");view.setUint32(40,interleaved.length*2,true);var lng=interleaved.length;var index=44;var volume=1;for(var i=0;i<lng;i++){view.setInt16(index,interleaved[i]*(32767*volume),true);index+=2}p5.prototype.writeFile([view],name,"wav")};function interleave(leftChannel,rightChannel){var length=leftChannel.length+rightChannel.length;var result=new Float32Array(length);var inputIndex=0;for(var index=0;index<length;){result[index++]=leftChannel[inputIndex];result[index++]=rightChannel[inputIndex];inputIndex++}return result}function writeUTFBytes(view,offset,string){var lng=string.length;for(var i=0;i<lng;i++){view.setUint8(offset+i,string.charCodeAt(i))}}}(sndcore,master);var peakdetect;peakdetect=function(){"use strict";var p5sound=master;p5.PeakDetect=function(freq1,freq2,threshold,_framesPerPeak){var framesPerPeak;this.framesPerPeak=_framesPerPeak||20;this.framesSinceLastPeak=0;this.decayRate=.95;this.threshold=threshold||.35;this.cutoff=0;this.cutoffMult=1.5;this.energy=0;this.penergy=0;this.currentValue=0;this.isDetected=false;this.f1=freq1||40;this.f2=freq2||2e4;this._onPeak=function(){}};p5.PeakDetect.prototype.update=function(fftObject){var nrg=this.energy=fftObject.getEnergy(this.f1,this.f2)/255;if(nrg>this.cutoff&&nrg>this.threshold&&nrg-this.penergy>0){this._onPeak();this.isDetected=true;this.cutoff=nrg*this.cutoffMult;this.framesSinceLastPeak=0}else{this.isDetected=false;if(this.framesSinceLastPeak<=this.framesPerPeak){this.framesSinceLastPeak++}else{this.cutoff*=this.decayRate;this.cutoff=Math.max(this.cutoff,this.threshold)}}this.currentValue=nrg;this.penergy=nrg};p5.PeakDetect.prototype.onPeak=function(callback,val){var self=this;self._onPeak=function(){callback(self.energy,val)}}}(master);var gain;gain=function(){"use strict";var p5sound=master;p5.Gain=function(){this.ac=p5sound.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=.5;this.input.connect(this.output);p5sound.soundArray.push(this)};p5.Gain.prototype.setInput=function(src){src.connect(this.input)};p5.Gain.prototype.connect=function(unit){var u=unit||p5.soundOut.input;this.output.connect(u.input?u.input:u)};p5.Gain.prototype.disconnect=function(){this.output.disconnect()};p5.Gain.prototype.amp=function(vol,rampTime,tFromNow){var rampTime=rampTime||0;var tFromNow=tFromNow||0;var now=p5sound.audiocontext.currentTime;var currentVol=this.output.gain.value;this.output.gain.cancelScheduledValues(now);this.output.gain.linearRampToValueAtTime(currentVol,now+tFromNow);this.output.gain.linearRampToValueAtTime(vol,now+tFromNow+rampTime)};p5.Gain.prototype.dispose=function(){var index=p5sound.soundArray.indexOf(this);p5sound.soundArray.splice(index,1);this.output.disconnect();this.input.disconnect();this.output=undefined;this.input=undefined}}(master,sndcore);var src_app;src_app=function(){"use strict";var p5SOUND=sndcore;return p5SOUND}(sndcore,master,helpers,errorHandler,panner,soundfile,amplitude,fft,signal,oscillator,env,pulse,noise,audioin,filter,delay,reverb,metro,looper,soundRecorder,peakdetect,gain)});var myCanvas;var vol;var dots=[];var numDots=250;var t=0;var time=0;var getT=[];var getTime=[];var randNums=[];function preload(){song=loadSound("assets/decoder.mp3")}function setup(){myCanvas=createCanvas(windowWidth,windowHeight,"p2d");background(0);frameRate(30);smooth();colorMode(HSB,255,255,255,255);analyzer=new p5.Amplitude;analyzer.setInput(song);fft=new p5.FFT;fft.setInput(song);song.loop();for(var i=0;i<numDots;i++){dots[i]=new Dot(180,0,.5+random(.95,1),.5);t+=.01;time+=.001;getT[i]=t;getTime[i]=time}}var varRot=0;function draw(){vol=analyzer.getLevel()*10;push();translate(0,0);noStroke();fill(0);rect(0,0,width,height);pop();push();translate(width/2,height/2);rotate(varRot);for(var i=0;i<dots.length;++i){rotate(radians(360/numDots));push();for(var j=i;j<dots.length;j+=10){dots[i].intersect(dots[j])}pop();dots[i].display();dots[i].move(vol)}varRot=varRot+vol/100;time=time+1e-4;pop()}function Dot(tempX,tempY,tempSpeed,tempSpeedY){this.x=tempX;this.y=tempY;this.speed=tempSpeed;this.speedY=tempSpeedY;this.alph=random(120,255);this.c=color(random(100,255),255,255,this.alph);this.eleSize=random(2,10)}Dot.prototype.display=function(){noStroke();fill(this.c);if(random(1)>.995){this.vol2=vol*3;if(analyzer.getLevel()>.3){ellipse(this.x,this.y,this.vol2*2,this.vol2*2)}else{ellipse(this.x,this.y,this.vol2,this.vol2)}}else{ellipse(this.x,this.y,this.eleSize-3,this.eleSize-3)}};Dot.prototype.move=function(tempA){this.ranSize=tempA*10;constrain(this.ranSize,0,3);this.x=this.x+this.speed*(tempA/1);if(this.y>100){this.speedY=-this.speedY}else if(this.y<-100){this.speedY=-this.speedY}if(this.x>180){this.speed=-this.speed}else if(this.x<110){this.speed=-this.speed}};Dot.prototype.intersect=function(other){var d=dist(this.x,this.y,other.x,other.y);if(d<8){stroke(this.c);noFill();strokeWeight(.5);line(other.x,other.x,this.x,this.x)}};function windowResized(){resizeCanvas(windowWidth,windowHeight)}